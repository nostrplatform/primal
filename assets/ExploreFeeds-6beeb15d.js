var R=Object.defineProperty;var a=(F,g)=>R(F,"name",{value:g,configurable:!0});import{u as U,b as B,ad as H,g as K,aI as q,Y as z,U as j,D as L,E as Q,N as Y,a2 as f,aR as G,aS as W,c,aQ as X,j as v,l as M,m as k,A as Z,d as x,t as D,T as ee}from"./index-64dc6460.js";import{N as te,E as se,a as re,s as l}from"./ExploreHotTopics-83547ce2.js";import{S as oe}from"./StickySidebar-65b823c5.js";import{P as ne}from"./PageCaption-27eb7f4c.js";import{P as ae}from"./PageTitle-3d0a9832.js";import{F as ie}from"./FeedMarketPlacePreview-16ae6dd4.js";import{B as de}from"./ButtonFlip-65663082.js";import"./Wormhole-fa0163d3.js";import"./ArticlePreview-3d0aa4c8.js";import"./dates-9bcb2bf7.js";import"./Note-f0f70728.js";import"./ParsedNote-9900e3c8.js";import"./ButtonGhost-a0fa1826.js";import"./Buttons.module-e818c1ea.js";import"./5WXHJDCZ-8b9b8e69.js";import"./index-b4296c5e.js";import"./ButtonPrimary-1f64caa8.js";import"./Loader-1ac7e304.js";import"./Paginator-4878ac5b.js";import"./FeedMarketPlaceItem-1368feb7.js";const V=D("<div>"),ue=D("<div>Feed Marketplace"),A=D("<div><div>"),Pe=a(()=>{const F=U(),g=B();H();const P=K(),u=q();z();const $=j(),[o,m]=L({});Q(()=>{if(u?.previewDVM){m(()=>({dvm:u.previewDVM,stats:u.previewDVMStats,metadata:u.previewDVMMetadata,author:u.previewDVMAuthor,actions:u.previewDVMActions,users:u.previewDVMUsers||{},commonFollowsPubkeys:u.previewDVMFollows||[]}));return}if($.id){const[e,n]=$.id.split("_by_");C(e,n);return}});const C=a((e,n)=>{const s=`explore_dvm_${ee}`,d=Y(s,{onEvent:(i,r)=>{if(r.kind===f.DVM){const t=JSON.parse(r.content),p={id:r.id,name:t.name||"",about:t.about||"",amount:t.amount||"free",primalVerifiedRequired:t.primalVerifiedRequired||!1,pubkey:r.pubkey,supportedKinds:r.tags?.reduce((b,w)=>w[0]==="k"?[...b,w[1]]:b,[])||[],identifier:(r.tags?.find(b=>b[0]==="d")||["d",""])[1],picture:t.picture,image:t.image,primal_spec:t.primal_spec};m("dvm",()=>({...p}));return}if(r.kind===f.Metadata){const t=r,p=G(t,t.pubkey);p&&m("users",()=>({[t.pubkey]:{...p}}));return}if(r.kind===f.NoteStats){const t=JSON.parse(r.content);if(!t.event_id)return;m("stats",()=>({likes:t.likes||0,satszapped:t.satszapped||0}))}if(r.kind===f.DVMMetadata){const t=JSON.parse(r.content);if(!t.event_id)return;m("metadata",()=>({kind:t.kind,isPrimal:t.is_primal}))}if(r.kind===f.NoteActions){const p=JSON.parse(r.content);m("actions",()=>({...p}));return}if(r.kind===f.DVMFollowsActions){const t=JSON.parse(r.content);m("commonFollowsPubkeys",()=>[...t.users])}},onEose:()=>{if(d(),!o.users)return;const i=o.users[o.dvm?.pubkey||""];i&&m("author",()=>({...i}))}});W(F?.publicKey,s,e,n)},"getDVM"),N=a(()=>o.dvm,"dvm"),E=a(()=>o.stats,"stats"),y=a(()=>o.metadata,"metadata"),T=a(()=>o.author,"author"),J=a(()=>o.actions,"actions"),O=a(()=>{const e=o.users;return e?(o.commonFollowsPubkeys||[]).reduce((d,i)=>{const r=e[i];return r?[...d,{...r}]:d},[]):[]},"commonUsers"),h=a(()=>{const e=o.dvm;if(!e)return;const n=o.dvm?.primal_spec??JSON.stringify({dvm_id:e.id,dvm_pubkey:e.pubkey,kind:o.metadata?.kind||"notes"});return{name:e.name,description:e.about,spec:n,enabled:!0,feedkind:"dvm"}},"generateFeedDefinition"),S=a(()=>{const e=h();return e?g?.actions.isFeedAdded(e,_()):!1},"isFeedAdded"),_=a(()=>y()?.kind==="reads"?"reads":"home","addFeedDestination"),I=a(()=>{const e=h();if(e){if(S()){g?.actions.removeFeed(e,_());return}g?.actions.addFeed(e,_())}},"toggleFeed");return[c(ae,{get title(){return P.formatMessage(X.pageTitle)}}),c(oe,{get children(){const e=V();return v(e,c(te,{get stats(){return u?.stats}}),null),v(e,c(se,{}),null),v(e,c(re,{}),null),M(()=>k(e,l.exploreSide)),e}}),c(ne,{get children(){const e=A(),n=e.firstChild;return v(n,c(Z,{get class(){return l.backButton},href:"/explore#feeds",get children(){return[(()=>{const s=V();return M(()=>k(s,l.backIcon)),s})(),ue()]}}),null),v(n,c(de,{get when(){return S()},get class(){return l.addToFeed},onClick:I,get fallback(){return["Add this feed to your ",x(_)," feed"]},get children(){return["Remove this feed from your ",x(_)," feed"]}}),null),M(s=>{const d=l.exploreHeader,i=l.exploreDVMFeedHeader;return d!==s._v$&&k(e,s._v$=d),i!==s._v$2&&k(n,s._v$2=i),s},{_v$:void 0,_v$2:void 0}),e}}),(()=>{const e=A(),n=e.firstChild;return v(n,c(ie,{get dvm(){return N()},get author(){return T()},get stats(){return E()},get actions(){return J()},get metadata(){return y()},get type(){return y()?.kind},get commonFollows(){return O()}})),M(s=>{const d=l.explorePageTabs,i=l.feedMarketplaceContent;return d!==s._v$3&&k(e,s._v$3=d),i!==s._v$4&&k(n,s._v$4=i),s},{_v$3:void 0,_v$4:void 0}),e})()]},"ExploreFeeds");export{Pe as default};
//# sourceMappingURL=ExploreFeeds-6beeb15d.js.map
