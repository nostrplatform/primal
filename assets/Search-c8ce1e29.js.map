{"version":3,"file":"Search-c8ce1e29.js","sources":["../../src/components/Search/Search.tsx"],"sourcesContent":["import { useIntl } from '@cookbook/solid-intl';\nimport { useNavigate } from '@solidjs/router';\nimport { Component, createEffect, createSignal, For, Show } from 'solid-js';\nimport { useSearchContext } from '../../contexts/SearchContext';\nimport { nip05Verification, userName } from '../../stores/profile';\nimport { PrimalUser } from '../../types/primal';\nimport { debounce } from '../../utils';\nimport Avatar from '../Avatar/Avatar';\nimport Loader from '../Loader/Loader';\nimport { useToastContext } from '../Toaster/Toaster';\nimport { placeholders, search as t } from '../../translations';\n\nimport styles from './Search.module.scss';\nimport SearchOption from './SearchOption';\nimport { hookForDev } from '../../lib/devTools';\nimport { useProfileContext } from '../../contexts/ProfileContext';\nimport { sanitize } from '../../lib/notes';\nimport DOMPurify from 'dompurify';\nimport { useAppContext } from '../../contexts/AppContext';\n\n\nconst Search: Component<{\n  onInputConfirm?: (query: string) => void,\n  onUserSelect?: (selected: PrimalUser | string) => void,\n  noLinks?: boolean,\n  hideDefault?: boolean,\n  placeholder?: string,\n  id?: string,\n  fullWidth?: boolean,\n}> = (props) => {\n\n  const toaster = useToastContext();\n  const search = useSearchContext();\n  const navigate = useNavigate();\n  const intl = useIntl();\n  const profile = useProfileContext();\n  const app = useAppContext();\n\n  const [query, setQuery] = createSignal('');\n  const [isFocused, setIsFocused] = createSignal(false);\n\n  const queryUrl = () => DOMPurify.sanitize(query().replaceAll('#', '%23'));\n\n  let input: HTMLInputElement | undefined;\n\n  const onSearch = (e: SubmitEvent) => {\n    e.preventDefault();\n\n    const form = e.target as HTMLFormElement;\n\n    const data = new FormData(form);\n\n    const q = DOMPurify.sanitize(data.get('searchQuery') as string || '');\n\n    if (q.length > 0) {\n      if (props.onInputConfirm) {\n        props.onInputConfirm(q);\n      }\n      else {\n        navigate(`/search/${q.replaceAll('#', '%23')}`);\n      }\n      onBlur();\n      resetQuery();\n    }\n    else {\n      toaster?.sendInfo(intl.formatMessage(t.invalid))\n    }\n    return false;\n  }\n\n  const onInput = (e: InputEvent) => {\n    setIsFocused(true);\n    debounce(() => {\n      // @ts-ignore\n      const value = e.target?.value;\n\n      if (value.startsWith('npub') || value.startsWith('nprofile')) {\n        search?.actions.findUserByNupub(value);\n        return;\n      }\n\n      setQuery(DOMPurify.sanitize(value) || '');\n    }, 500);\n  };\n\n  const onFocus = (e: FocusEvent) => {\n    setIsFocused(true);\n  }\n\n  const onBlur = (e?: FocusEvent) => {\n    setTimeout(() => {\n      setIsFocused(false);\n    }, 200);\n  }\n\n  const resetQuery = () => {\n    setQuery('');\n\n    if (input) {\n      input.value = '';\n    }\n  };\n\n  const selectUser = (user: PrimalUser) => {\n    if (props.onUserSelect) {\n      props.onUserSelect(user);\n    }\n    resetQuery();\n  }\n\n  createEffect(() => {\n    if (query().length === 0) {\n      search?.actions.getRecomendedUsers(profile?.profileHistory.profiles || []);\n      return;\n    }\n\n    search?.actions.findUsers(query());\n  });\n\n  return (\n    <div id={props.id} class={`${styles.searchHolder} ${isFocused() ? styles.focused : ''} ${props.fullWidth ? styles.wideHolder : ''}`}>\n      <form\n        class={`${styles.search} ${props.fullWidth ? styles.wide : ''}`}\n        onsubmit={onSearch}\n        autocomplete=\"off\"\n      >\n        <div class={styles.searchIcon}></div>\n        <input\n          type='text'\n          name='searchQuery'\n          ref={input}\n          placeholder={\n            props.placeholder ??\n            intl.formatMessage(placeholders.search)\n          }\n          value={query()}\n          onInput={onInput}\n          onFocus={onFocus}\n          onBlur={onBlur}\n          onClick={onFocus}\n        />\n      </form>\n\n      <div class={`${styles.searchSuggestions} ${!isFocused() ? styles.hidden : ''} ${props.fullWidth ? styles.wide : ''}`}>\n        <Show\n          when={!props.hideDefault}\n        >\n          <Show\n            when={query().length > 0}\n            fallback={\n              <SearchOption\n                title={intl.formatMessage(t.searchNostr)}\n                narrow={true}\n                darkTitle={true}\n                icon={<div class={styles.searchIconDark}></div>}\n              />\n            }\n          >\n            <SearchOption\n              href={props.noLinks ? undefined : `/search/${queryUrl()}`}\n              title={query()}\n              icon={<div class={styles.searchIcon}></div>}\n              onClick={resetQuery}\n            />\n          </Show>\n        </Show>\n      </div>\n\n      <div class={`${styles.searchSuggestions} ${!isFocused() ? styles.hidden : ''} ${props.fullWidth ? styles.wide : ''}`}>\n        <Show when={search?.isFetchingUsers && query().length > 0}>\n          <div class={styles.loadingOverlay}>\n            <div>\n              <Loader />\n            </div>\n          </div>\n        </Show>\n\n        <For each={search?.users}>\n          {(user) => (\n            <SearchOption\n              href={props.noLinks ? undefined : app?.actions.profileLink(user.npub) || ''}\n              title={userName(user)}\n              description={nip05Verification(user)}\n              icon={<Avatar user={user} size=\"vvs\" />}\n              statNumber={profile?.profileHistory.stats[user.pubkey]?.followers_count || search?.scores[user.pubkey]}\n              statLabel={intl.formatMessage(t.followers)}\n              onClick={() => selectUser(user)}\n            />\n          )}\n        </For>\n      </div>\n    </div>\n  )\n}\n\nexport default hookForDev(Search);\n"],"names":["Search","props","toaster","useToastContext","search","useSearchContext","navigate","useNavigate","intl","useIntl","profile","useProfileContext","app","useAppContext","query","setQuery","createSignal","isFocused","setIsFocused","queryUrl","DOMPurify","sanitize","replaceAll","input","onSearch","e","preventDefault","form","target","data","FormData","q","get","length","onInputConfirm","onBlur","resetQuery","sendInfo","formatMessage","t","invalid","onInput","debounce","value","startsWith","actions","findUserByNupub","onFocus","setTimeout","selectUser","user","onUserSelect","createEffect","getRecomendedUsers","profileHistory","profiles","findUsers","_el$","_tmpl$2","_el$2","firstChild","_el$3","_el$4","nextSibling","_el$5","_el$6","addEventListener","$$click","$$input","_ref$","_$use","_$insert","_$createComponent","Show","when","hideDefault","children","fallback","SearchOption","title","searchNostr","narrow","darkTitle","icon","_el$9","_tmpl$3","_$effect","_$className","styles","searchIconDark","href","_$memo","noLinks","undefined","_el$10","searchIcon","onClick","isFetchingUsers","_el$7","_tmpl$","_el$8","Loader","loadingOverlay","For","each","users","profileLink","npub","userName","description","nip05Verification","Avatar","size","statNumber","stats","pubkey","followers_count","scores","statLabel","followers","_p$","_v$","id","_v$2","searchHolder","focused","fullWidth","wideHolder","_v$3","wide","_v$4","_v$5","placeholder","placeholders","_v$6","searchSuggestions","hidden","_v$7","_$setAttribute","Search$1","hookForDev","_$delegateEvents"],"mappings":"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"}