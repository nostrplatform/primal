{"version":3,"file":"ExploreHotTopics-83547ce2.js","sources":["../../src/components/NostrStats/NostrStats.tsx","../../src/components/ExploreSidebar/ExploreSidebar.tsx","../../src/components/ExploreSidebar/ExploreHotTopics.tsx"],"sourcesContent":["import { useIntl } from \"@cookbook/solid-intl\";\nimport { Component } from \"solid-js\";\nimport { PrimalNetStats } from \"../../types/primal\";\nimport styles from  \"./NostrStats.module.scss\";\nimport { explore as t } from '../../translations';\nimport { hookForDev } from \"../../lib/devTools\";\n\nconst NostrStats: Component<{ stats: PrimalNetStats, id?: string }> = (props) => {\n\n  const intl = useIntl();\n\n  const statDisplay = (opts:{\n    stat: number | string | undefined,\n    key: string,\n    id?: string,\n  }) => {\n    // @ts-ignore Record find entry by key\n    const label = t.statDisplay[opts.key] || '';\n\n    return (\n      <div id={opts.id} class={styles.netstat}>\n        <div class={styles.number}>\n          {opts.stat?.toLocaleString()}\n        </div>\n        <div class={styles.label}>\n          {intl.formatMessage(label)}\n        </div>\n      </div>\n    );\n  };\n\n\n  return (\n    <div id={props.id} class={styles.netstats}>\n      {hookForDev(statDisplay)({ stat: props.stats.users, key: 'users' })}\n      {/* {hookForDev(statDisplay)({ stat: props.stats.pubkeys, key: 'pubkeys' })} */}\n      {hookForDev(statDisplay)({ stat: props.stats.zaps, key: 'zaps' })}\n      {hookForDev(statDisplay)({ stat: (props.stats.satszapped /100000000).toFixed(8), key: 'btcZapped' })}\n      {hookForDev(statDisplay)({ stat: props.stats.pubnotes, key: 'pubnotes' })}\n      {/* {hookForDev(statDisplay)({ stat: props.stats.reposts, key: 'reposts' })} */}\n      {hookForDev(statDisplay)({ stat: props.stats.reactions, key: 'reactions' })}\n      {hookForDev(statDisplay)({ stat: props.stats.any, key: 'any' })}\n    </div>\n  )\n}\n\nexport default hookForDev(NostrStats);\n","import { A, useResolvedPath } from '@solidjs/router';\nimport { Component, createEffect, createMemo, For, onCleanup, onMount } from 'solid-js';\nimport { createStore } from 'solid-js/store';\nimport { Kind } from '../../constants';\nimport { APP_ID } from '../../App';\nimport { getExploreFeed } from '../../lib/feed';\nimport { cacheServer, decompressBlob, isConnected, readData, refreshSocketListeners, removeSocketListeners, socket, subsTo } from '../../sockets';\nimport { sortingPlan, convertToNotes } from '../../stores/note';\nimport { convertToUser, emptyUser, truncateNpub } from '../../stores/profile';\nimport { FeedPage, NostrEOSE, NostrEvent, NostrEventContent, NostrEvents, NostrUserContent, PrimalNote, PrimalUser } from '../../types/primal';\nimport Avatar from '../Avatar/Avatar';\n\nimport styles from './ExploreSidebar.module.scss';\nimport { useIntl } from '@cookbook/solid-intl';\nimport { getTrendingUsers } from '../../lib/profile';\nimport { hexToNpub } from '../../lib/keys';\nimport { exploreSidebarCaption } from '../../translations';\nimport { useAccountContext } from '../../contexts/AccountContext';\nimport { hookForDev } from '../../lib/devTools';\nimport { loadTrendingUsers, saveTrendingUsers } from '../../lib/localStore';\nimport { useAppContext } from '../../contexts/AppContext';\n\nconst ExploreSidebar: Component<{ id?: string }> = (props) => {\n\n  const intl = useIntl();\n  const account = useAccountContext();\n  const app = useAppContext();\n\n  const [store, setStore] = createStore<{ users: Record<string, NostrUserContent>, scores: Record<string, number> }>({\n    users: {},\n    scores: {},\n  });\n\n  const [trendingUsers, setTrendingUsers] = createStore<PrimalUser[]>([]);\n\n  const authorName = (user: PrimalUser) => {\n    return user.displayName ||\n      user.name ||\n      truncateNpub(user.npub);\n  }\n\n  onMount(() => {\n    const users = loadTrendingUsers();\n\n    setTrendingUsers(() => ({ ...users }));\n  })\n\n//  ACTIONS -------------------------------------\n\n  const processUsers = (type: string, content: NostrEventContent | undefined) => {\n\n    if (type === 'EOSE') {\n      const sortedKeys = Object.keys(store.scores).sort(\n        (a, b) => store.scores[b] - store.scores[a]);\n\n      const users = sortedKeys.map(key => {\n        if (!store.users[key]) {\n          return emptyUser(key);\n        }\n\n        return convertToUser(store.users[key], key);\n      });\n\n      setTrendingUsers(() => [...users]);\n      saveTrendingUsers(users);\n      return;\n    }\n\n    if (type === 'EVENT') {\n      if (content && content.kind === Kind.Metadata) {\n        setStore('users', (users) => ({ ...users, [content.pubkey]: content}));\n        return;\n      }\n      if (content && content.kind === Kind.UserScore) {\n        const scores = JSON.parse(content.content);\n\n        setStore('scores', () => ({ ...scores }));\n        return;\n      }\n    }\n  };\n\n// EFFECTS --------------------------------------\n\n  createEffect(() => {\n    if (isConnected()) {\n      setStore(() => ({\n        users: {},\n        scores: {},\n      }));\n\t\t}\n\t});\n\n  createEffect(() => {\n    if (!isConnected() || !account?.isKeyLookupDone) return;\n\n    const subId = `explore_sidebar_${APP_ID}`\n    const unsub = subsTo(subId, {\n      onEvent: (_, content) => {\n        if (content && content.kind === Kind.Metadata) {\n          setStore('users', (users) => ({ ...users, [content.pubkey]: content}));\n          return;\n        }\n\n        if (content && content.kind === Kind.UserScore) {\n          const scores = JSON.parse(content.content);\n\n          setStore('scores', () => ({ ...scores }));\n          return;\n        }\n      },\n      onEose: () => {\n        unsub();\n        const sortedKeys = Object.keys(store.scores).sort(\n          (a, b) => store.scores[b] - store.scores[a]);\n\n        const users = sortedKeys.map(key => {\n          if (!store.users[key]) {\n            return emptyUser(key);\n          }\n\n          return convertToUser(store.users[key], key);\n        });\n\n        setTrendingUsers(() => [...users]);\n        saveTrendingUsers(users);\n      },\n    });\n\n    getTrendingUsers(subId, account?.publicKey);\n  })\n\n// RENDER ---------------------------------------\n\n  return (\n    <div id={props.id} class={styles.topUsersHolder}>\n      <div class={styles.trendingUsersCaption}>\n        {intl.formatMessage(exploreSidebarCaption)}\n      </div>\n      <div class={styles.trendingUsers}>\n        <For each={trendingUsers}>\n          {\n            user => (\n              <A\n                href={app?.actions.profileLink(user.npub) || ''}\n                class={styles.user}\n                title={authorName(user)}\n              >\n                <Avatar user={user} size=\"vs\" />\n                <div class={styles.name}>{authorName(user)}</div>\n              </A>\n            )\n          }\n        </For>\n      </div>\n    </div>\n  )\n}\n\nexport default hookForDev(ExploreSidebar);\n","import { A, useResolvedPath } from '@solidjs/router';\nimport { Component, createEffect, createMemo, For, onCleanup } from 'solid-js';\nimport { createStore } from 'solid-js/store';\nimport { Kind } from '../../constants';\nimport { APP_ID } from '../../App';\nimport { getExploreFeed } from '../../lib/feed';\nimport { cacheServer, decompressBlob, isConnected, readData, refreshSocketListeners, removeSocketListeners, socket } from '../../sockets';\nimport { sortingPlan, convertToNotes } from '../../stores/note';\nimport { convertToUser, emptyUser, truncateNpub } from '../../stores/profile';\nimport { FeedPage, NostrEOSE, NostrEvent, NostrEventContent, NostrEvents, NostrUserContent, PrimalNote, PrimalUser } from '../../types/primal';\nimport Avatar from '../Avatar/Avatar';\n\nimport styles from './ExploreSidebar.module.scss';\nimport { useIntl } from '@cookbook/solid-intl';\nimport { getTrendingUsers } from '../../lib/profile';\nimport { hexToNpub } from '../../lib/keys';\nimport { exploreSidebarCaption } from '../../translations';\nimport { useAccountContext } from '../../contexts/AccountContext';\nimport { hookForDev } from '../../lib/devTools';\nimport { useExploreContext } from '../../contexts/ExploreContext';\nimport { fetchExploreTopics } from '../../megaFeeds';\n\nconst ExploreHotTopics: Component<{ id?: string }> = (props) => {\n\n  const intl = useIntl();\n  const account = useAccountContext();\n  const explore = useExploreContext();\n\n  // @ts-ignore\n  const topics = () => explore?.exploreTopics.toSorted((a, b) => {\n    return b[1] - a[1];\n  }).slice(0, 19);\n\n  createEffect(() => {\n    if (!explore || explore.exploreTopics.length > 0) return;\n\n    getTopics();\n  })\n\n  const getTopics = async () => {\n    const { topicStats } = await fetchExploreTopics(account?.publicKey, `explore_topics_${APP_ID}`);\n\n    explore?.actions.setExploreTopics(topicStats);\n  }\n\n  return (\n    <div id={props.id} class={styles.topicsHolder}>\n      <div class={styles.hotTopicsCaption}>\n        Hot Topics\n      </div>\n      <div class={styles.exploreHotTopics}>\n        <For each={topics()}>\n          {\n            topic => (\n              <A href={`/search/%23${topic[0]}`} class={styles.exploreHotTopic}>{topic[0]}</A>\n            )\n          }\n        </For>\n      </div>\n    </div>\n  )\n}\n\nexport default hookForDev(ExploreHotTopics);\n"],"names":["NostrStats","props","intl","useIntl","statDisplay","opts","label","t","key","_el$","_tmpl$","_el$2","firstChild","_el$3","nextSibling","_$insert","stat","toLocaleString","formatMessage","_$effect","_p$","_v$","id","_v$2","styles","netstat","_v$3","number","_v$4","_$setAttribute","_$className","undefined","_el$4","_tmpl$2","hookForDev","stats","users","zaps","satszapped","toFixed","pubnotes","reactions","any","_v$5","_v$6","netstats","ExploreSidebar","account","useAccountContext","app","useAppContext","store","setStore","createStore","scores","trendingUsers","setTrendingUsers","authorName","user","displayName","name","truncateNpub","npub","onMount","loadTrendingUsers","createEffect","isConnected","isKeyLookupDone","subId","APP_ID","unsub","subsTo","onEvent","_","content","kind","Kind","Metadata","pubkey","UserScore","JSON","parse","onEose","Object","keys","sort","a","b","map","convertToUser","emptyUser","saveTrendingUsers","getTrendingUsers","publicKey","exploreSidebarCaption","_$createComponent","For","each","children","A","href","actions","profileLink","title","Avatar","size","topUsersHolder","trendingUsersCaption","ExploreHotTopics","explore","useExploreContext","topics","exploreTopics","toSorted","slice","length","getTopics","__name","topicStats","fetchExploreTopics","setExploreTopics","topic","exploreHotTopic","topicsHolder","hotTopicsCaption","exploreHotTopics"],"mappings":"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"}