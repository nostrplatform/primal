{"version":3,"file":"CreatePinModal-3a4f5174.js","sources":["../../src/components/CreatePinModal/CreatePinModal.tsx"],"sourcesContent":["import { useIntl } from '@cookbook/solid-intl';\nimport { Component, createEffect, createSignal } from 'solid-js';\nimport Modal from '../Modal/Modal';\n\nimport { login as tLogin, pin as tPin, actions as tActions } from '../../translations';\n\nimport styles from './CreatePinModal.module.scss';\nimport { hookForDev } from '../../lib/devTools';\nimport ButtonPrimary from '../Buttons/ButtonPrimary';\nimport TextInput from '../TextInput/TextInput';\nimport ButtonSecondary from '../Buttons/ButtonSecondary';\nimport { encryptWithPin, setCurrentPin } from '../../lib/PrimalNostr';\nimport AdvancedSearchDialog from '../AdvancedSearch/AdvancedSearchDialog';\n\nconst CreatePinModal: Component<{\n  id?: string,\n  open?: boolean,\n  valueToEncrypt?: string,\n  onPinApplied?: (encryptedValue: string) => void,\n  onAbort?: () => void,\n}> = (props) => {\n\n  const intl = useIntl();\n\n  let pinInput: HTMLInputElement | undefined;\n\n  const [pin, setPin] = createSignal('');\n  const [rePin, setRePin] = createSignal('');\n\n  const encWithPin = async () => {\n    const val = props.valueToEncrypt || '';\n    const enc = await encryptWithPin(pin(), val);\n    return enc;\n  };\n\n  const onSetPin = async() => {\n    if (!isValidPin || !isValidRePin()) return;\n\n    // Encrypt private key\n    const enc = await encWithPin();\n\n    // Save PIN for the session\n    setCurrentPin(pin());\n\n    // Execute callback\n    props.onPinApplied && props.onPinApplied(enc);\n  };\n\n  const onOptout = () => {\n    props.onPinApplied && props.onPinApplied(props.valueToEncrypt || '');\n  };\n\n  createEffect(() => {\n    if (props.open) {\n      pinInput?.focus();\n    }\n  });\n\n  const isValidPin = () => {\n    return pin().length > 3;\n  }\n\n  const isValidRePin = () => {\n    return rePin() === pin();\n  };\n\n  const onKeyUp = (e: KeyboardEvent) => {\n    if (e.code === 'Enter' && isValidPin() && isValidRePin()) {\n      onSetPin();\n    }\n  };\n\n  return (\n    <AdvancedSearchDialog\n      open={props.open}\n      setOpen={(isOpen: boolean) => !isOpen && props.onAbort && props.onAbort()}\n      title={\n        <div class={styles.title}>\n          {intl.formatMessage(tPin.title)}\n        </div>\n      }\n      triggerClass={styles.hidden}\n    >\n      <div id={props.id} class={styles.modal}>\n        <TextInput\n          type=\"password\"\n          ref={pinInput}\n          value={pin()}\n          onKeyUp={onKeyUp}\n          onChange={(val: string) => setPin(val)}\n          validationState={pin().length === 0 || isValidPin() ? 'valid' : 'invalid'}\n          errorMessage={intl.formatMessage(tPin.invalidPin)}\n        />\n\n        <div class={styles.description}>\n          {intl.formatMessage(tPin.reEnter)}\n        </div>\n        <TextInput\n          type=\"password\"\n          value={rePin()}\n          onKeyUp={onKeyUp}\n          onChange={(val: string) => setRePin(val)}\n          validationState={rePin().length === 0 || isValidRePin() ? 'valid' : 'invalid'}\n          errorMessage={intl.formatMessage(tPin.invalidRePin)}\n        />\n\n        <div class={styles.actions}>\n          <ButtonPrimary\n            onClick={onSetPin}\n            disabled={!isValidPin() || !isValidRePin()}\n          >\n            {intl.formatMessage(tActions.createPin)}\n          </ButtonPrimary>\n          <ButtonSecondary\n            onClick={onOptout}\n            light={true}\n          >\n            {intl.formatMessage(tActions.optoutPin)}\n          </ButtonSecondary>\n        </div>\n      </div>\n    </AdvancedSearchDialog>\n  );\n}\n\nexport default hookForDev(CreatePinModal);\n"],"names":["CreatePinModal","props","intl","useIntl","pinInput","pin","setPin","createSignal","rePin","setRePin","encWithPin","__name","val","valueToEncrypt","encryptWithPin","onSetPin","isValidPin","isValidRePin","enc","setCurrentPin","onPinApplied","onOptout","createEffect","open","focus","length","onKeyUp","e","code","_$createComponent","AdvancedSearchDialog","setOpen","isOpen","onAbort","title","_el$4","_tmpl$2","_$insert","formatMessage","tPin","_$effect","_$className","styles","triggerClass","hidden","children","_el$","_tmpl$","_el$2","firstChild","_el$3","nextSibling","TextInput","type","ref","r$","_ref$","value","onChange","validationState","errorMessage","invalidPin","reEnter","invalidRePin","ButtonPrimary","onClick","disabled","tActions","createPin","ButtonSecondary","light","optoutPin","_p$","_v$","id","_v$2","modal","_v$3","description","_v$4","actions","_$setAttribute","undefined","hookForDev"],"mappings":"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"}