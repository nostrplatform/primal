var Nn=Object.defineProperty;var c=(i,h)=>Nn(i,"name",{value:h,configurable:!0});import{e as pt,u as nt,C as Z,E as Y,o as Xt,n as en,j as g,c as m,l as N,s as K,m as v,t as D,h as st,g as tn,bq as Je,S as ne,B as $t,a_ as nn,D as re,k as sn,w as Fe,V as Rn,br as Ln,F as tt,b3 as Pn,x as ve,bi as Qe,bk as ht,$ as Hn,bs as An,ad as Zn,aD as jn,b as Bn,Y as Dn,bt as dt,bu as On,bv as zn,bw as Un,ao as Fn,bx as qe,by as ft,bz as Kn,bA as Wn,bB as Le,bC as gt,J as Vn,bD as Jn,q as zt,b6 as Ut,bE as Qn,H as qn,M as Yn,ak as Pe,bF as Ft,bG as Gn,aG as Xn,bH as es,N as Ye,bI as ts,bJ as ns,bK as ss,bL as os,bM as Ge,T as Xe,bN as is,bO as rs,bh as as,a2 as O,bm as ls,bP as cs,bQ as us,ay as Kt,ba as ds,al as _t,aR as fs,bl as gs,bR as Wt,a8 as _s,bp as vs,bS as hs,b7 as ms,aY as ps}from"./index-64dc6460.js";import{h as H,L as $s,E as bs}from"./ParsedNote-9900e3c8.js";import{S as ks}from"./SearchOption-a7f2ab4a.js";import{_ as Vt}from"./index-555a6fe0.js";import{g as Jt}from"./textArea-802fec28.js";import{B as on}from"./ButtonPrimary-1f64caa8.js";import{B as mt}from"./ButtonSecondary-cc5e2282.js";import{B as ys}from"./ButtonGhost-a0fa1826.js";import{E as Cs,a as ws}from"./EmojiPickHeader-dfcd5384.js";import{s as Ue}from"./ConfirmModal.module-73b4314e.js";import{A as Ss}from"./AdvancedSearchDialog-eff41eef.js";import{U as Es}from"./Uploader-f6bcb09a.js";import{s as xs}from"./dates-9bcb2bf7.js";import{a as Ms}from"./Note-f0f70728.js";const Is="_noteEditBox_ku2s9_1",Ts="_newNoteHolder_ku2s9_7",Ns="_holderBottomBorder_ku2s9_14",Rs="_rightCorner_ku2s9_20",Ls="_leftCorner_ku2s9_28",Ps="_newNoteBorder_ku2s9_37",Hs="_newNote_ku2s9_7",As="_leftSide_ku2s9_60",Zs="_controls_ku2s9_64",js="_editorOptions_ku2s9_75",Bs="_editorOption_ku2s9_75",Ds="_attachIcon_ku2s9_93",Os="_emojiIcon_ku2s9_104",zs="_highlight_ku2s9_111",Us="_editorDescision_ku2s9_117",Fs="_primaryButton_ku2s9_125",Ks="_secondaryButton_ku2s9_140",Ws="_searchSuggestions_ku2s9_162",Vs="_userReference_ku2s9_177",Js="_error_ku2s9_210",Qs="_editorWrap_ku2s9_214",qs="_previewCaption_ku2s9_222",Ys="_editorScroll_ku2s9_230",Gs="_editor_ku2s9_75",Xs="_emojiSuggestions_ku2s9_260",eo="_emojiOption_ku2s9_274",to="_uploadLoader_ku2s9_299",no="_dropOverlay_ku2s9_319",so="_uploader_ku2s9_334",oo="_toggle_ku2s9_338",io="_off_ku2s9_346",ro="_on_ku2s9_352",ao="_context_ku2s9_359",I={noteEditBox:Is,newNoteHolder:Ts,holderBottomBorder:Ns,rightCorner:Rs,leftCorner:Ls,newNoteBorder:Ps,newNote:Hs,leftSide:As,controls:Zs,editorOptions:js,editorOption:Bs,attachIcon:Ds,emojiIcon:Os,highlight:zs,editorDescision:Us,primaryButton:Fs,secondaryButton:Ks,searchSuggestions:Ws,userReference:Vs,error:Js,editorWrap:Qs,previewCaption:qs,editorScroll:Ys,editor:Gs,emojiSuggestions:Xs,emojiOption:eo,uploadLoader:to,dropOverlay:no,uploader:so,toggle:oo,off:io,on:ro,context:ao},lo="_emojiPickHolder_1nyeu_11",co="_contentShow_1nyeu_1",uo="_down_1nyeu_15",fo="_up_1nyeu_19",go="_zapEmojiChangeModal_1nyeu_24",_o="_title_1nyeu_36",vo="_xClose_1nyeu_44",ho="_iconClose_1nyeu_54",vt={emojiPickHolder:lo,contentShow:co,down:uo,up:fo,zapEmojiChangeModal:go,title:_o,xClose:vo,iconClose:ho},mo=D("<div><div>"),et="face",po=c(i=>{const h=nt(),[S,j]=Z(et),[T,d]=Z(!1),[p,R]=Z(!0),W=c(b=>{if(b.stopPropagation(),b.code==="Escape"){i.onClose(b);return}},"onKey");Y(()=>{S().length===0&&j(()=>et)});const r=c(b=>{b==="default"?(R(!0),j(()=>et)):(R(!1),j(()=>b))},"setFilter"),se=c(b=>{i.onClose(b)},"onClickOutside"),ae=c(b=>{j(()=>b),R(()=>b.length===0)},"onEmojiSearch");return Xt(()=>{setTimeout(()=>{j(()=>et),d(()=>!0),d(()=>!1),window.addEventListener("keyup",W),window.addEventListener("click",se)},10)}),en(()=>{window.removeEventListener("keyup",W),window.removeEventListener("click",se)}),(()=>{const b=mo(),le=b.firstChild;return b.$$click=w=>w.stopPropagation(),g(le,m(Cs,{get focus(){return T()},onInput:ae,onFilter:r}),null),g(le,m(ws,{get showPreset(){return p()},get preset(){return h?.emojiHistory||[]},get filter(){return S()},onSelect:w=>{i.onSelect(w),d(!0),d(()=>!1)},get short(){return i.orientation==="up"}}),null),N(w=>{const V=i.id,ce=`${vt.emojiPickHolder} ${i.orientation&&vt[i.orientation]}`,he=vt.zapEmojiChangeModal;return V!==w._v$&&K(b,"id",w._v$=V),ce!==w._v$2&&v(b,w._v$2=ce),he!==w._v$3&&v(le,w._v$3=he),w},{_v$:void 0,_v$2:void 0,_v$3:void 0}),b})()},"EmojiPickPopover");pt(["click"]);const $o=D("<div><div></div><div>"),bo=D("<div>"),ko=c(i=>{const h=tn();return m(Ss,{get open(){return i.open},setOpen:S=>!S&&i.onCancel&&i.onCancel(),get title(){return(()=>{const S=bo();return g(S,()=>i.title||h.formatMessage(Je.title)),N(()=>v(S,Ue.feedConfirmationTitle)),S})()},get triggerClass(){return Ue.hidden},get children(){const S=$o(),j=S.firstChild,T=j.nextSibling;return g(j,()=>i.description),g(T,m(ne,{get when(){return i.onConfirm},get children(){return m(on,{get onClick(){return i.onConfirm},get children(){return i.confirmLabel||h.formatMessage(Je.confirm)}})}}),null),g(T,m(ne,{get when(){return i.onAbort},get children(){return m(mt,{get onClick(){return i.onAbort},light:!0,get children(){return i.abortLabel||h.formatMessage(Je.abort)}})}}),null),g(T,m(ne,{get when(){return i.onCancel},get children(){return m(mt,{get onClick(){return i.onCancel},light:!0,get children(){return i.cancelLabel||h.formatMessage(Je.cancel)}})}}),null),N(d=>{const p=i.id,R=Ue.confirmAlternateModal,W=Ue.feedConfirmationDescription,r=Ue.feedConfirmationActions;return p!==d._v$&&K(S,"id",d._v$=p),R!==d._v$2&&v(S,d._v$2=R),W!==d._v$3&&v(j,d._v$3=W),r!==d._v$4&&v(T,d._v$4=r),d},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),S}})},"ConfirmAlternativeModal"),yo=st(ko),Co=D("<div>+ "),Qt=D("<img>"),wo=D("<div><div></div><div><div><div></div><div></div></div><div></div></div><div><div><div><div></div><div></div></div><div><div> minute read</div></div></div><div>"),qt=D("<div>"),So=c(i=>{const h=$t(),S=nt(),j=nn(),[T,d]=re({likes:i.article.likes||0,liked:i.article.noteActions?.liked||!1,reposts:i.article.reposts||0,reposted:i.article.noteActions?.reposted||!1,replies:i.article.replies||0,replied:i.article.noteActions?.replied||!1,zapCount:i.article.zaps||0,satsZapped:i.article.satszapped||0,zapped:i.article.noteActions?.zapped||!1,zappedAmount:0,zappedNow:!1,isZapping:!1,showZapAnim:!1,hideZapIcon:!1,moreZapsAvailable:!1,isRepostMenuVisible:!1,topZaps:[],topZapsFeed:[],quoteCount:0});let p="",R="",W;const r=c(k=>{h?.actions.closeCustomZapModal(),Qe(()=>{d("zappedAmount",()=>k.amount||0),d("satsZapped",M=>M+(k.amount||0)),d("zapped",()=>!0),d("showZapAnim",()=>!0)}),le(k),V(k)},"onConfirmZap"),se=c(k=>{h?.actions.closeCustomZapModal(),h?.actions.resetCustomZap(),S?.publicKey&&Qe(()=>{d("zapCount",E=>E+1),d("isZapping",()=>!1),d("showZapAnim",()=>!1),d("hideZapIcon",()=>!1),d("zapped",()=>!0)})},"onSuccessZap"),ae=c(k=>{h?.actions.closeCustomZapModal(),h?.actions.resetCustomZap(),Qe(()=>{d("zappedAmount",()=>-(k.amount||0)),d("satsZapped",M=>M-(k.amount||0)),d("isZapping",()=>!1),d("showZapAnim",()=>!1),d("hideZapIcon",()=>!1),d("zapped",()=>i.article.noteActions.zapped)}),w(),ce()},"onFailZap"),b=c(k=>{h?.actions.closeCustomZapModal(),h?.actions.resetCustomZap(),Qe(()=>{d("zappedAmount",()=>-(k.amount||0)),d("satsZapped",M=>M-(k.amount||0)),d("isZapping",()=>!1),d("showZapAnim",()=>!1),d("hideZapIcon",()=>!1),d("zapped",()=>i.article.noteActions.zapped)}),w(),ce()},"onCancelZap"),le=c(k=>{const M=S?.publicKey;if(!M)return;const E=[...T.topZaps];p=ht();const L={amount:k.amount||0,message:k.message||"",pubkey:M,eventId:i.article.id,id:p};j?.users.find(B=>B.pubkey===M)||j?.actions.fetchUsers([M]);const z=[...E,{...L}].sort((B,U)=>U.amount-B.amount);d("topZaps",()=>[...z])},"addTopZap"),w=c(k=>{const M=T.topZaps.filter(E=>E.id!==p);d("topZaps",()=>[...M])},"removeTopZap"),V=c(k=>{const M=S?.publicKey;if(!M)return;const E=[...T.topZapsFeed];R=ht();const L={amount:k.amount||0,message:k.message||"",pubkey:M,eventId:i.article.id,id:R},z=[...E,{...L}].sort((B,U)=>U.amount-B.amount).slice(0,4);d("topZapsFeed",()=>[...z])},"addTopZapFeed"),ce=c(k=>{const M=T.topZapsFeed.filter(E=>E.id!==R);d("topZapsFeed",()=>[...M])},"removeTopZapFeed"),he=c(()=>({note:i.article,onConfirm:r,onSuccess:se,onFail:ae,onCancel:b}),"customZapInfo"),ue=c((k="likes")=>{h?.actions.openReactionModal(i.article.naddr,{likes:T.likes,zaps:T.zapCount,reposts:T.reposts,quotes:T.quoteCount,openOn:k})},"openReactionModal"),de=c(()=>{h?.actions.openContextMenu(i.article,W?.getBoundingClientRect(),()=>{h?.actions.openCustomZapModal(he())},ue)},"onContextMenuTrigger");let Se;const Ee=c(()=>{},"onImageLoaded");return(()=>{const k=wo(),M=k.firstChild,E=M.nextSibling,L=E.firstChild,z=L.firstChild,B=z.nextSibling,U=L.nextSibling,oe=E.nextSibling,G=oe.firstChild,X=G.firstChild,A=X.firstChild,fe=A.nextSibling,J=X.nextSibling,me=J.firstChild,He=me.firstChild,Ke=G.nextSibling,xe=Se;return typeof xe=="function"?ve(xe,k):Se=k,g(M,m(Ms,{ref(u){const Q=W;typeof Q=="function"?Q(u):W=u},onClick:de})),g(L,m(sn,{get user(){return i.article.user},size:"micro"}),z),g(z,()=>Fe(i.article.user)),g(L,m(Rn,{get user(){return i.article.user}}),B),g(B,()=>i.article.user?.nip05||""),g(U,()=>xs(i.article.published)),g(A,()=>i.article.title),g(fe,()=>i.article.summary),g(me,()=>Math.ceil(i.article.wordCount/Ln),He),g(J,m(tt,{get each(){return i.article.tags?.slice(0,3)},children:u=>(()=>{const Q=qt();return g(Q,u),N(()=>v(Q,H.tag)),Q})()}),null),g(J,m(ne,{get when(){return i.article.tags?.length&&i.article.tags.length>3},get children(){const u=Co();return u.firstChild,g(u,()=>i.article.tags.length-3,null),N(()=>v(u,H.tag)),u}}),null),g(Ke,m(ne,{get when(){return i.article.image},get fallback(){return m(ne,{get when(){return i.article.user.picture},get fallback(){return(()=>{const u=qt();return N(()=>v(u,H.placeholderImage)),u})()},get children(){const u=Qt();return u.addEventListener("load",Ee),N(()=>K(u,"src",i.article.user.picture)),u}})},get children(){const u=Qt();return u.addEventListener("load",Ee),N(()=>K(u,"src",i.article.image)),u}})),N(u=>{const Q=H.article,ot=i.height?`height: ${i.height}px`:"",Ae=H.upRightFloater,Me=H.header,ge=H.userInfo,_e=H.userName,We=H.nip05,pe=H.time,Ve=H.body,$e=H.text,Ze=H.content,ye=H.title,ie=H.summary,Ce=H.tags,je=H.estimate,Be=H.image;return Q!==u._v$&&v(k,u._v$=Q),u._v$2=Pn(k,ot,u._v$2),Ae!==u._v$3&&v(M,u._v$3=Ae),Me!==u._v$4&&v(E,u._v$4=Me),ge!==u._v$5&&v(L,u._v$5=ge),_e!==u._v$6&&v(z,u._v$6=_e),We!==u._v$7&&v(B,u._v$7=We),pe!==u._v$8&&v(U,u._v$8=pe),Ve!==u._v$9&&v(oe,u._v$9=Ve),$e!==u._v$10&&v(G,u._v$10=$e),Ze!==u._v$11&&v(X,u._v$11=Ze),ye!==u._v$12&&v(A,u._v$12=ye),ie!==u._v$13&&v(fe,u._v$13=ie),Ce!==u._v$14&&v(J,u._v$14=Ce),je!==u._v$15&&v(me,u._v$15=je),Be!==u._v$16&&v(Ke,u._v$16=Be),u},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0,_v$10:void 0,_v$11:void 0,_v$12:void 0,_v$13:void 0,_v$14:void 0,_v$15:void 0,_v$16:void 0}),k})()},"SimpleArticlePreview"),Eo=st(So),xo=D('<em class="article_highlight">'),Mo=c(i=>{$t(),nt(),nn();const h=c(S=>{S.preventDefault(),S.stopPropagation(),S.target.setAttribute("data-highlight-selected",""),i.onShowMenu(i.highlight.id)},"onOver");return(()=>{const S=xo();return S.$$click=h,g(S,()=>i.highlight.content),N(()=>K(S,"data-highlight",i.highlight.id)),S})()},"ArticleHighlight"),Io=st(Mo);pt(["click"]);const te=D("<div>"),To=D("<span><span>#"),No=D('<span class="linkish"> @'),Yt=D('<a target="_blank" class="linkish">@'),Gt=D('<span class="linkish">'),Ro=D('<div><div><div><textarea rows="1" data-min-rows="1"></textarea><div></div></div><div><div></div></div></div><div><div><div><input type="file" accept="image/*,video/*,audio/*"><label></label></div><div></div></div><div>'),Lo=D("<button>"),Po=c(i=>{const h=tn(),S=Hn(),j=$t(),T=ht(),d=An(),p=nt(),R=Zn(),W=jn();Bn();let r,se,ae,b,le,w,V,ce={top:0,left:0,height:0},he={top:0,left:0,height:0};const[ue,de]=Z(!1),[Se,Ee]=Z(""),[k,M]=Z(""),[E,L]=Z(""),[z,B]=Z(""),[U,oe]=Z(!1),[G,X]=Z(""),[A,fe]=re([]),[J,me]=re({}),[He,Ke]=re({}),[xe,u]=re({}),[Q,ot]=re({}),[Ae,Me]=Z(0),[ge,_e]=Z(0),[We,pe]=re(),[Ve,$e]=re(),[Ze,ye]=Z(!1),[ie,Ce]=Z(),[je,Be]=re({}),bt=Dn();let rn=bt.pathname;const an=c(e=>/(\s+|\r\n|\r|\n|^)lnbc[a-zA-Z0-9]+/.test(e),"noteHasInvoice"),ln=c(e=>{var o=e.value;e.value="",e._baseScrollHeight=e.scrollHeight,e.value=o},"getScrollHeight"),it=c(e=>{const o=document.documentElement.clientHeight||window.innerHeight||0,t=r,n=se;if(t.nodeName!=="TEXTAREA"||t.id!==`${ct()}new_note_text_area`||!n)return;const s=parseInt(t.getAttribute("data-min-rows")||"0");if(!t._baseScrollHeight&&ln(t),t.scrollHeight>=o/3){t.style.height="46vh";return}t.style.height="auto",t.rows=s;const a=Math.ceil((t.scrollHeight-t._baseScrollHeight)/20);t.rows=s+a},"onExpandableTextareaInput");Y(()=>{G().length>dt&&fe(()=>Vt(G()))}),Y(()=>{U()&&G().length>dt&&Et()});const cn=c(()=>{const e=Ut.sanitize(z());if(!an(e))return(()=>{const a=te(),_=se;return typeof _=="function"?ve(_,a):se=a,a.innerHTML=e,N(()=>v(a,I.editor)),a})();let o=[],n=e.replace(Qn," __LB__ ").replaceAll("<br>"," __LB__ ").replace(/\s+/g," __SP__ ").split(/[\s]+/),s=0;return n.forEach(a=>{const _=Ut.sanitize(a);if(_.startsWith("lnbc"))o[s]&&s++,o[s]=_,s++;else{let f=_;const $=o[s]||"";_==="__SP__"&&(f=$.length===0?"":" "),_==="__LB__"&&(f=$.length===0?"":" <br/>"),o[s]=$+f}}),(()=>{const a=te(),_=se;return typeof _=="function"?ve(_,a):se=a,g(a,m(tt,{each:o,children:f=>m(qn,{get fallback(){return(()=>{const $=te();return $.innerHTML=f,$})()},get children(){return m(Yn,{get when(){return f.startsWith("lnbc")},get children(){return m($s,{lnbc:f,inactive:!0})}})}})})),N(()=>v(a,I.editor)),a})()},"renderMessage"),kt=c(e=>{if(!r)return!1;if(ie())return;r.value[r.selectionStart-1];const o=["Enter","Space","Comma","Tab"];if(e.code==="Enter"&&e.metaKey)return e.preventDefault(),St(),!1;if(!ue()&&!U()&&e.key===":")return r.selectionStart>0&&![" ",`\r
`,"\r",`
`].includes(r.value[r.selectionStart-1])||(he=Jt(r,r.selectionStart),oe(!0)),!1;if(U()){if(e.code==="ArrowDown"){e.preventDefault(),_e(a=>A.length===0?0:a<A.length-9?a+8:0);const s=document.getElementById(`${T}-${ge()}`);return s&&b&&!Ge(s,b)&&s.scrollIntoView({block:"end",behavior:"smooth"}),!1}if(e.code==="ArrowUp"){e.preventDefault(),_e(a=>A.length===0?0:a>=8?a-8:A.length-1);const s=document.getElementById(`${T}-${ge()}`);return s&&b&&!Ge(s,b)&&s.scrollIntoView({block:"start",behavior:"smooth"}),!1}if(e.code==="ArrowRight"){e.preventDefault(),_e(a=>A.length===0?0:a<A.length-1?a+1:0);const s=document.getElementById(`${T}-${ge()}`);return s&&b&&!Ge(s,b)&&s.scrollIntoView({block:"end",behavior:"smooth"}),!1}if(e.code==="ArrowLeft"){e.preventDefault(),_e(a=>A.length===0?0:a>0?a-1:A.length-1);const s=document.getElementById(`${T}-${ge()}`);return s&&b&&!Ge(s,b)&&s.scrollIntoView({block:"start",behavior:"smooth"}),!1}if(o.includes(e.code)||e.code==="Semicolon")return G().trim().length===0?(oe(!1),!1):(e.preventDefault(),A.length===0&&fe(Vt(G())),It(A[ge()]),_e(0),!1);const t=r.selectionStart,n=r.value.slice(0,t).lastIndexOf(":");return e.code==="Backspace"?(X(G().slice(0,-1)),(n<0||t-n<=1)&&(oe(!1),X("")),!1):(["Shift","Control","Meta"].includes(e.key)||X(s=>s+e.key),!1)}if(!ue()&&e.key==="@")return ce=Jt(r,r.selectionStart),r.selectionStart>0&&![" ",`\r
`,"\r",`
`].includes(r.value[r.selectionStart-1])||(Ee(""),M(""),de(!0)),!1;if(!ue()&&e.code==="Backspace"&&r){let t=r.selectionStart;const n=r.value.slice(0,t),s=n.split(/[\s,;\n\r]/).pop();if(s?.startsWith("@`")){const a=n.lastIndexOf(s),_=n.slice(0,a)+r.value.slice(t);L(_),r.value=_,r.selectionEnd=a}}if(ue()){if(e.code==="ArrowDown")return e.preventDefault(),Me(s=>!d?.users||d.users.length===0?0:s<d.users.length-1?s+1:0),!1;if(e.code==="ArrowUp")return e.preventDefault(),Me(s=>!d?.users||d.users.length===0?0:s>0?s-1:d.users.length-1),!1;if(o.includes(e.code))return Se()===" "?(de(!1),!1):(e.preventDefault(),d?.users&&Tt(d.users[Ae()]),de(!1),!1);const t=r.selectionStart,n=r.value.slice(0,t).lastIndexOf("@");if(e.code==="Backspace"){if(Ee(Se().slice(0,-1)),n<0||t-n<=1)return de(!1),!1}else if(!["Shift","Control","Meta"].includes(e.key))return Ee(s=>s+e.key),!1;return!1}return!0},"onKeyDown"),[un,rt]=Z(!1),dn=c(e=>{e.preventDefault(),e.stopPropagation(),rt(!1);let t=e.dataTransfer?.files[0];t&&ut(t)&&Ce(t)},"onDrop"),fn=c(e=>{e.preventDefault(),e.stopPropagation(),rt(!0)},"onDragOver"),gn=c(e=>{if(e.preventDefault(),e.stopPropagation(),!w)return;const o=w.getBoundingClientRect(),t=e.clientX<o.x||e.clientX>o.x+o.width,n=e.clientY<o.y||e.clientY>o.y+o.height;(t||n)&&rt(!1)},"onDragLeave"),_n=c(e=>{if(e.clipboardData?.files&&e.clipboardData.files.length>0){e.preventDefault();const o=e.clipboardData.files[0];return o&&ut(o)&&Ce(o),!1}},"onPaste");Xt(()=>{w?.addEventListener("input",it),w?.addEventListener("keydown",kt)}),en(()=>{w?.removeEventListener("input",it),w?.removeEventListener("keydown",kt)}),Y(()=>{w?.removeEventListener("keyup",yt),Ne()||w?.addEventListener("keyup",yt)}),Y(()=>{bt.pathname!==rn&&Ie()}),Y(()=>{const e=Se();On(()=>{M(()=>e)},500)});const vn=c(e=>{L(o=>{if(!r||!e)return o;let t=r.selectionStart+2;const n=o.length===0,s=n?`\r
\r
${e} `:o.slice(0,t)+e+" "+o.slice(t,o.length);return t=n?0:t+e.length+1,r.value=s,p?.actions.quoteNote(void 0),it(new InputEvent("input")),r?.focus(),r.selectionEnd=t,s})},"addQuote");Y(()=>{if(i.open){const e=zn(p?.publicKey,i.replyToNote?.noteId),o=Un(p?.publicKey,i.replyToNote?.noteId);me(Fn(o)),L(t=>{if(t.length>0)return t;const n=`${t}${e}`;return r&&(r.value=n,r.dispatchEvent(new Event("input",{bubbles:!0})),r.focus()),n}),p?.quotedNote&&vn(p.quotedNote)}else p?.actions.quoteNote(void 0)}),Y(()=>{E().length!==0&&(qe(p?.publicKey,E(),i.replyToNote?.noteId),ft(p?.publicKey,J,i.replyToNote?.noteId))});const yt=c(e=>{if(!Ze()&&(e.stopPropagation(),e.code==="Escape")){if(Ne())return;if(ue()||U()){hn();return}Ct()}},"onEscape"),De=c(()=>{V&&(V.value=""),Ce(void 0)},"resetUpload"),Ie=c(()=>{me({}),L(""),B(""),M(""),de(!1),oe(!1),X(""),fe(()=>[]),De(),i.onClose&&i.onClose()},"clearEditor"),Ct=c(()=>{if(E().trim().length>0){ye(!0);return}qe(p?.publicKey,"",i.replyToNote?.noteId),ft(p?.publicKey,{},i.replyToNote?.noteId),Ie()},"closeEditor"),hn=c(()=>{de(!1),oe(!1),X(""),fe(()=>[])},"closeEmojiAndMentions"),wt=c(e=>{qe(p?.publicKey,e,i.replyToNote?.noteId),ft(p?.publicKey,J,i.replyToNote?.noteId),Ie()},"persistNote"),[mn,Te]=Z(!1),St=c(async()=>{if(!p||!p.hasPublicKey()||ie())return;if(!p.proxyThroughPrimal&&p.relays.length===0){R?.sendWarning(h.formatMessage(Pe.noRelaysConnected));return}const e=E();if(e.trim()==="")return;const o=e.replace(Ft,t=>{const[n,s]=t.split("@"),[a,_]=s.split("`"),f=J[_];return`${n} nostr:${f.npub}`});if(p){let t=Gn(o,je);const n=i.replyToNote;if(n){let f=n.msg.tags.find(y=>y[0]==="e"&&y[3]==="root");const $=n.relayHints&&n.relayHints[n.id]?n.relayHints[n.id]:"";if(f){const y=f.map((C,P)=>P===2?$:C);t.push([...y]),t.push(["e",n.id,$,"reply"])}else t.push(["e",n.id,$,"root"]);const x=n.msg.tags.filter(y=>y[0]==="p");t=[...t,...Xn(x)],t.find(y=>y[0]==="p"&&y[1]===n.pubkey)||t.push(["p",n.pubkey])}Te(!0);const{success:s,reasons:a,note:_}=await es(o,p?.proxyThroughPrimal||!1,p.activeRelays,t,p.relaySettings);if(s){const f=`import_note_${Xe}`,$=Ye(f,{onEose:()=>{_&&(R?.sendSuccess(h.formatMessage(Pe.publishNoteSuccess)),i.onSuccess&&i.onSuccess({success:s,reasons:a,note:_},{noteRefs:He,userRefs:J,articleRefs:xe,highlightRefs:Q,relayHints:je}),Te(!1),qe(p.publicKey,"",n?.noteId),Ie()),$()}});_&&ts([_],f);return}if(a?.includes("no_extension")){R?.sendWarning(h.formatMessage(Pe.noExtension)),Te(!1);return}if(a?.includes("timeout")){R?.sendWarning(h.formatMessage(Pe.publishNoteTimeout)),Te(!1);return}R?.sendWarning(h.formatMessage(Pe.publishNoteFail)),Te(!1);return}Te(!1),Ie()},"postNote"),pn=c(()=>{if(!r||!ae||!w)return;const e=r.getBoundingClientRect(),o=w.getBoundingClientRect();let t=ce.top;r.scrollTop>0&&(t-=r.scrollTop);let n=e.top-o.top+t+22,s=ce.left+16;n>document.documentElement.clientHeight-200&&(n=e.top-400),ae.style.top=`${n}px`,ae.style.left=`${s}px`},"mentionPositionOptions"),Et=c(()=>{if(!r||!b||!w)return;const e=r.getBoundingClientRect(),o=w.getBoundingClientRect();let t=he.top;r.scrollTop>0&&(t-=r.scrollTop);let n=e.top-o.top+t+22,s=he.left;n>document.documentElement.clientHeight-200&&(n=e.top-400),b.style.top=`${n}px`,b.style.left=`${s}px`},"emojiPositionOptions"),$n=c(e=>{const o=/(?:\s|^)#[^\s!@#$%^&*(),.?":{}|<>]+/ig;return e.replace(o,t=>{const[n,s]=t.split("#");return(()=>{const _=To(),f=_.firstChild;return f.firstChild,g(_,n,f),g(f,s,null),N(()=>v(f,I.userReference)),_})().outerHTML})},"highlightHashtags"),bn=c(e=>e.replace(Ft,o=>{const[t,n]=o.split("`"),s=Object.values(J).find(_=>Fe(_)===n);return` ${(s?is({user:s,openInNewTab:!0}):(()=>{const _=No();return _.firstChild,g(_,n,null),_})()).outerHTML}`||` @${n}`}),"parseUserMentions"),xt=c(e=>{const o=z().replace(ms,t=>{const[n,s]=t.split(":");if(!s)return t;try{const a=J[e];return(a?(()=>{const f=Yt(),$=f.firstChild;return g(f,()=>Fe(a),null),N(()=>K(f,"href",`${window.location.origin}${j?.actions.profileLink(a.npub)||""}`)),f})():(()=>{const f=Yt(),$=f.firstChild;return g(f,()=>ps(s),null),N(()=>K(f,"href",`${window.location.origin}${j?.actions.profileLink(s)||""}`)),f})()).outerHTML||t}catch{return`<span class="${I.error}">${t}</span>`}});B(o)},"subUserRef");re({});const kn=c(e=>{let o=[],t;for(;(t=rs.exec(e))!==null;)o.push(t[1]);o.forEach(n=>{if(xe[n]){setTimeout(()=>{Mt(n)},0);return}const s=as(n);if(s.type!=="naddr")return;const{pubkey:a,kind:_,identifier:f}=s.data,$=`naddr_${n}_${Xe}`;$e(n,{messages:[],users:{},postStats:{},mentions:{}});const x=Ye($,{onEvent:(y,C)=>{if(C){if(C.kind===O.Metadata){const P=C;$e(n,"users",F=>({...F,[P.pubkey]:{...P}}));return}if([O.LongForm,O.LongFormShell].includes(C.kind)){const P=C;$e(n,"messages",F=>[...F,{...P}]);return}if(C.kind===O.NoteStats){const F=JSON.parse(C.content);$e(n,"postStats",Re=>({...Re,[F.event_id]:{...F}}));return}if(C.kind===O.Mentions){const F=JSON.parse(C.content);$e(n,"mentions",Re=>({...Re,[F.id]:{...F}}));return}if(C.kind===O.RelayHint){const P=JSON.parse(C.content);Be(()=>({...P}))}}},onEose:()=>{const y=ls(Ve[n])[0];u(C=>({...C,[y.noteId]:y})),Mt(y.noteId),x()}});cs(a,f,_,$)})},"parseNaddr"),Mt=c(e=>{const o=z().replace(us,t=>{const[n,s]=t.split(":");if(!s||s!==e)return t;try{const a=xe[s];return(()=>{const f=te();return g(f,m(Eo,{article:a,noLink:!0})),N(()=>v(f,I.highlight)),f})().outerHTML||t}catch(a){return Kt("Bad Note reference: ",a),`<span class="${I.error}">${t}</span>`}});B(o)},"subNaddrRef"),yn=c(e=>{let o=[],t;for(;(t=ds.exec(e))!==null;)o.push(t[1]);o.forEach(n=>{if(J[n]){setTimeout(()=>{xt(n)},0);return}const s=`nu_${n}_${Xe}`,a=_t.decode(n).data,_=typeof a=="string"?a:a.pubkey,f=Ye(s,{onEvent:($,x)=>{if(x&&x.kind===O.Metadata){const C=fs(x,x.pubkey);me(()=>({[C.pubkey]:C}));return}},onEose:()=>{xt(_),f()}});gs([_],s)})},"parseNpubLinks"),Cn=c(e=>{let o=[],t;for(;(t=Wt.exec(e))!==null;)o.push(t[1]);o.forEach(n=>{if(He[n]){setTimeout(()=>{at(n)},0);return}const s=`nn_${n}_${Xe}`;_t.decode(n);const a=_t.decode(n).data,_=typeof a=="string"?a:a.id;pe(s,{messages:[],users:{},postStats:{},mentions:{}});const f=Ye(s,{onEvent:($,x)=>{if(x){if(x.kind===O.Metadata){const y=x;pe(s,"users",C=>({...C,[y.pubkey]:{...y}}));return}if(x.kind===O.Highlight){ot(n,()=>({...x}));return}if([O.Text,O.Repost].includes(x.kind)){const y=x;pe(s,"messages",C=>[...C,{...y}]);return}if(x.kind===O.NoteStats){const C=JSON.parse(x.content);pe(s,"postStats",P=>({...P,[C.event_id]:{...C}}));return}if(x.kind===O.Mentions){const C=JSON.parse(x.content);pe(s,"mentions",P=>({...P,[C.id]:{...C}}));return}if(x.kind===O.RelayHint){const y=JSON.parse(x.content);Be(()=>({...y}))}}},onEose:()=>{const $=_s(We[s])[0];$?(Ke(x=>({...x,[$.noteId]:$})),at($.noteId)):at(n),f()}});vs(p?.publicKey,[_],s,!0)})},"parseNoteLinks"),at=c(e=>{const o=z().replace(Wt,t=>{const[n,s]=t.split(":");if(!s||s!==e)return t;try{let a=He[s];return a?(a?(()=>{const f=te();return g(f,m(hs,{get children(){return m(bs,{note:a,get mentionedUsers(){return a.mentionedUsers||{}},includeEmbeds:!0,hideFooter:!0,noLinks:"links"})}})),f})():(()=>{const f=Gt();return g(f,t),f})()).outerHTML||t:(a=Q[s],(a?(()=>{const $=te();return g($,m(Io,{highlight:a})),$})():(()=>{const $=Gt();return g($,t),$})()).outerHTML||t)}catch(a){return Kt("Bad Note reference: ",a),`<span class="${I.error}">${t}</span>`}});B(o)},"subNoteRef"),wn=c(async e=>{const o=await ns(bn($n(ss(e,S?.actions.getMediaUrl))));return kn(o),yn(o),Cn(o),o},"parseForReferece"),Sn=c(e=>{if(ie())return e.preventDefault(),!1;r&&L(r.value)},"onInput");let lt=0;Y(()=>{lt&&window.clearTimeout(lt);const e=Kn(E());lt=setTimeout(async()=>{const o=await wn(e);B(o)},500)}),Y(()=>{if(k().length===0){d?.actions.getRecomendedUsers(W?.profileHistory.profiles||[]);return}d?.actions.findUsers(k())}),Y(()=>{ue()&&(pn(),d?.users&&d.users.length>0&&Me(0))}),Y(()=>{U()&&(Et(),A.length>0&&_e(0))});const It=c(e=>{if(!r||!e){oe(!1),X(""),fe(()=>[]);return}p?.actions.saveEmoji(e);const o=E();let t=r.selectionStart;const n=o.slice(0,t).lastIndexOf(":"),s=o.slice(0,n)+`${e.name} `+o.slice(t);L(s),r.value=E(),r.selectionEnd=n+3,r.focus(),oe(!1),X(""),fe(()=>[])},"selectEmoji"),Tt=c(e=>{if(!r||!e)return;de(!1);const o=Fe(e);me(f=>({...f,[o]:e}));const t=E();let n=r.selectionStart;const s=t.slice(0,n).lastIndexOf("@"),a=t.slice(0,s)+`@\`${o}\``+t.slice(n);M(""),L(a),r.value=E(),r.focus(),n=a.slice(0,n).lastIndexOf("@")+o.length+3,r.selectionEnd=n;const _=new Event("input",{bubbles:!0,cancelable:!0});r.dispatchEvent(_)},"selectUser"),En=c(()=>{r&&r.focus()},"focusInput"),ct=c(()=>i.idPrefix??"","prefix"),xn=c(e=>{if(!r)return;const o=E(),t=r.selectionStart,n=o.slice(0,t)+`${e}`+o.slice(t);L(()=>n),r.value=n,r.focus()},"insertAtCursor"),ut=c(e=>!e.type.startsWith("image/")&&!e.type.startsWith("video/")?(R?.sendWarning(h.formatMessage(Pe.fileTypeUpsupported)),!1):!0,"isSupportedFileType"),Mn=c(()=>{if(!V)return;const e=V.files?V.files[0]:null;e&&ut(e)&&Ce(e)},"onUpload"),[Ne,Nt]=Z(!1),In=c(e=>{if(!r||!e)return;p?.actions.saveEmoji(e);const o=E();let t=r.selectionStart;const n=o.slice(0,t)+`${e.name} `+o.slice(t);L(n),r.value=E(),r.selectionEnd=t+3,r.focus()},"addSelectedEmoji"),Tn=c(()=>{const e=os(le),o=326;return(e.y||0)+o<window.innerHeight+window.scrollY?"down":"up"},"determineOrient");return(()=>{const e=Ro(),o=e.firstChild,t=o.firstChild,n=t.firstChild,s=n.nextSibling,a=t.nextSibling,_=a.firstChild,f=o.nextSibling,$=f.firstChild,x=$.firstChild,y=x.firstChild,C=y.nextSibling,P=x.nextSibling,F=$.nextSibling;e.addEventListener("dragleave",gn),e.addEventListener("dragover",fn),e.addEventListener("drop",dn);const Re=w;typeof Re=="function"?ve(Re,e):w=e,g(e,m(ne,{get when(){return un()},get children(){const l=te();return g(l,()=>h.formatMessage(Wn.dropzone)),N(()=>v(l,I.dropOverlay)),l}}),o),o.$$click=En,n.addEventListener("paste",_n);const Rt=r;typeof Rt=="function"?ve(Rt,n):r=n,n.$$input=Sn,g(t,m(ne,{get when(){return i.context},get children(){const l=te();return g(l,()=>i.context),N(()=>v(l,I.context)),l}}),s),g(s,()=>h.formatMessage(Le.newPreview)),g(a,cn,_),g(_,m(Es,{get publicKey(){return p?.publicKey},get nip05(){return p?.activeUser?.nip05},get openSockets(){return i.open},get file(){return ie()},onFail:()=>{R?.sendWarning(h.formatMessage(gt.fail,{file:ie()?.name})),De()},onRefuse:l=>{l==="file_too_big_100"&&R?.sendWarning(h.formatMessage(gt.fileTooBigRegular)),l==="file_too_big_1024"&&R?.sendWarning(h.formatMessage(gt.fileTooBigPremium)),De()},onCancel:()=>{De()},onSuccsess:l=>{xn(` ${l} `),De()}})),g(e,m(ne,{get when(){return ue()},get children(){const l=te(),ee=ae;return typeof ee=="function"?ve(ee,l):ae=l,g(l,m(tt,{get each(){return d?.users},children:(q,we)=>m(ks,{get title(){return Fe(q)},get description(){return Vn(q)},get icon(){return m(sn,{user:q,size:"xs"})},get statNumber(){return W?.profileHistory.stats[q.pubkey]?.followers_count||d?.scores[q.pubkey]},get statLabel(){return h.formatMessage(Jn.followers)},onClick:()=>Tt(q),get highlighted(){return Ae()===we()}})})),N(()=>v(l,I.searchSuggestions)),l}}),f),g(e,m(ne,{get when(){return U()&&G().length>dt&&A.length>0},get children(){const l=te(),ee=b;return typeof ee=="function"?ve(ee,l):b=l,g(l,m(tt,{each:A,children:(q,we)=>(()=>{const be=Lo();return be.$$click=()=>It(q),g(be,()=>q.name),N(ke=>{const Oe=`${T}-${we()}`,ze=`${I.emojiOption} ${ge()===we()?I.highlight:""}`;return Oe!==ke._v$16&&K(be,"id",ke._v$16=Oe),ze!==ke._v$17&&v(be,ke._v$17=ze),ke},{_v$16:void 0,_v$17:void 0}),be})()})),N(()=>v(l,I.emojiSuggestions)),l}}),f),g(e,m(yo,{get open(){return Ze()},get title(){return h.formatMessage(Le.saveNoteDraft.title)},get description(){return h.formatMessage(Le.saveNoteDraft.description)},get confirmLabel(){return h.formatMessage(Le.saveNoteDraft.optionYes)},get abortLabel(){return h.formatMessage(Le.saveNoteDraft.optionNo)},get cancelLabel(){return h.formatMessage(Le.saveNoteDraft.optionCancel)},onConfirm:()=>{wt(E()),ye(!1)},onAbort:()=>{wt(""),ye(!1),Ie()},onCancel:()=>{ye(!1),r?.focus()}}),f);const Lt=V;return typeof Lt=="function"?ve(Lt,y):V=y,y.addEventListener("change",Mn),K(y,"id",`upload-${T}`),y.hidden=!0,K(C,"for",`upload-${T}`),g(P,m(ys,{get highlight(){return Ne()},onClick:()=>{Nt(l=>!l),!Ne()&&r?.focus()},get children(){const l=te(),ee=le;return typeof ee=="function"?ve(ee,l):le=l,N(()=>v(l,`emoji_icon ${I.emojiIcon} ${Ne()?I.highlight:""}`)),l}}),null),g(P,m(ne,{get when(){return Ne()},get children(){return m(po,{onClose:()=>{Nt(!1),r?.focus()},onSelect:In,get orientation(){return Tn()}})}}),null),g(F,m(on,{onClick:St,get disabled(){return mn()||ie()||E().trim().length===0},get children(){return h.formatMessage(zt.notePostNew)}}),null),g(F,m(mt,{onClick:Ct,get children(){return h.formatMessage(zt.cancel)}}),null),N(l=>{const ee=i.id,q=I.noteEditBox,we=I.editorWrap,be=`${ct()}new_note_text_area`,ke=ie()!==void 0,Oe=I.previewCaption,ze=I.editorScroll,Pt=`${ct()}new_note_text_preview`,Ht=I.uploader,At=I.controls,Zt=I.editorOptions,jt=I.editorOption,Bt=`attach_icon ${I.attachIcon}`,Dt=I.editorOption,Ot=I.editorDescision;return ee!==l._v$&&K(e,"id",l._v$=ee),q!==l._v$2&&v(e,l._v$2=q),we!==l._v$3&&v(o,l._v$3=we),be!==l._v$4&&K(n,"id",l._v$4=be),ke!==l._v$5&&(n.readOnly=l._v$5=ke),Oe!==l._v$6&&v(s,l._v$6=Oe),ze!==l._v$7&&v(a,l._v$7=ze),Pt!==l._v$8&&K(a,"id",l._v$8=Pt),Ht!==l._v$9&&v(_,l._v$9=Ht),At!==l._v$10&&v(f,l._v$10=At),Zt!==l._v$11&&v($,l._v$11=Zt),jt!==l._v$12&&v(x,l._v$12=jt),Bt!==l._v$13&&v(C,l._v$13=Bt),Dt!==l._v$14&&v(P,l._v$14=Dt),Ot!==l._v$15&&v(F,l._v$15=Ot),l},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0,_v$10:void 0,_v$11:void 0,_v$12:void 0,_v$13:void 0,_v$14:void 0,_v$15:void 0}),e})()},"EditBox"),qo=st(Po);pt(["click","input"]);export{qo as E};
//# sourceMappingURL=EditBox-1353f619.js.map
