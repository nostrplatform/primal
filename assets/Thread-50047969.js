var gk=Object.defineProperty;var a=(n,e)=>gk(n,"name",{value:e,configurable:!0});import{aZ as fm,h as Ci,e as Gl,g as ls,C as je,u as fn,E as gt,j as H,c as O,k as Pn,q as pm,w as St,l as ne,m as E,S as Se,s as $r,t as le,I as Eu,a_ as yk,d as gc,n as Ou,a$ as ya,F as ln,p as Gd,al as Ee,b0 as yc,b1 as kc,x as hl,T as sn,a2 as Q,b2 as mm,M as kr,H as _u,b3 as gm,b4 as Yd,o as dl,b5 as ym,b6 as kk,b7 as bk,ad as xk,$ as km,B as Du,D as ao,b8 as bm,b9 as wk,ba as Ck,A as bc,bb as xm,a3 as Qd,bc as Sk,bd as vk,be as Nk,bf as Mk,V as wm,b as Tk,U as Cm,N as Ds,as as $k,bg as Ak,bh as _i,bi as Di,a7 as Xd,a5 as ef,bj as Ik,aR as tf,a8 as nf,J as Ek,bk as rf,bl as Ok,bm as _k,R as Dk,bn as ka,bo as Rk,ay as zk,bp as Pk}from"./index-64dc6460.js";import Fk from"./NotFound-c377363a.js";import{N as Rs,a as Lk,b as Bk}from"./Note-f0f70728.js";import{P as Hk}from"./PeopleList-618c041a.js";import{E as Sm}from"./EditBox-1353f619.js";import{W as fl}from"./Wormhole-fa0163d3.js";import{S as vm}from"./Search-c8ce1e29.js";import{P as jk}from"./PageTitle-3d0a9832.js";import{i as Vk}from"./BannerIOS-4372487a.js";import{s as be}from"./Skeleton.module-8b20490e.js";import{T as Nm,f as Mm,E as Wk,g as qk}from"./ParsedNote-9900e3c8.js";import{a as Kk,s as Uk}from"./dates-9bcb2bf7.js";import{B as Ri}from"./ButtonGhost-a0fa1826.js";import{A as Jk,B as Zk,a as Gk}from"./ArticlePreview-3d0aa4c8.js";import{s as It}from"./HomeSidebar.module-aa2a7eab.js";import{A as ba,a as Yk}from"./ArticlePreviewSidebarSkeleton-add7f0b3.js";import{P as Qk}from"./PageCaption-27eb7f4c.js";import"./MissingPage-ff1a5436.js";import"./FollowButton-d935d050.js";import"./ButtonFlip-65663082.js";import"./Buttons.module-e818c1ea.js";import"./5WXHJDCZ-8b9b8e69.js";import"./index-b4296c5e.js";import"./SearchOption-a7f2ab4a.js";import"./index-555a6fe0.js";import"./textArea-802fec28.js";import"./ButtonPrimary-1f64caa8.js";import"./ButtonSecondary-cc5e2282.js";import"./EmojiPickHeader-dfcd5384.js";import"./ConfirmModal.module-73b4314e.js";import"./AdvancedSearchDialog-eff41eef.js";import"./index-a25c8160.js";import"./index-c76cfba2.js";import"./JNCCF6MP-19ab5fd3.js";import"./Uploader-f6bcb09a.js";import"./EMOXVTIZ-81fa338a.js";import"./LR7LBJN3-a1aba763.js";import"./Loader-1ac7e304.js";import"./primal_white-9ad5c7e6.js";import"./open_white-d7ddfa1e.js";var yt=(n=>(n.docTypeError="docTypeError",n.contextNotFound="contextNotFound",n.timerNotFound="timerNotFound",n.ctxCallOutOfScope="ctxCallOutOfScope",n.createNodeInParserFail="createNodeInParserFail",n.stackOverFlow="stackOverFlow",n.parserMatchError="parserMatchError",n.serializerMatchError="serializerMatchError",n.getAtomFromSchemaFail="getAtomFromSchemaFail",n.expectDomTypeError="expectDomTypeError",n.callCommandBeforeEditorView="callCommandBeforeEditorView",n.missingRootElement="missingRootElement",n.missingNodeInSchema="missingNodeInSchema",n.missingMarkInSchema="missingMarkInSchema",n.ctxNotBind="ctxNotBind",n.missingYjsDoc="missingYjsDoc",n))(yt||{}),Vo;let $t=(Vo=class extends Error{constructor(e,t){super(t),this.name="MilkdownError",this.code=e}},a(Vo,"t"),Vo);const Xk=a((n,e)=>typeof e=="function"?"[Function]":e,"u$2"),ci=a(n=>JSON.stringify(n,Xk),"i$2");function eb(n){return new $t(yt.docTypeError,`Doc type error, unsupported type: ${ci(n)}`)}a(eb,"l$2");function tb(n){return new $t(yt.contextNotFound,`Context "${n}" not found, do you forget to inject it?`)}a(tb,"d$4");function nb(n){return new $t(yt.timerNotFound,`Timer "${n}" not found, do you forget to record it?`)}a(nb,"f$1");function Ru(){return new $t(yt.ctxCallOutOfScope,"Should not call a context out of the plugin.")}a(Ru,"p$2");function rb(...n){const e=n.reduce((t,r)=>{if(!r)return t;const i=a(o=>Array.isArray(o)?o.map(s=>i(s)).join(", "):o.toJSON?ci(o.toJSON()):o.spec?ci(o.spec):o.toString(),"s");return`${t}, ${i(r)}`},"Create prosemirror node from remark failed in parser");return new $t(yt.createNodeInParserFail,e)}a(rb,"g$3");function Tm(){return new $t(yt.stackOverFlow,"Stack over flow, cannot pop on an empty stack.")}a(Tm,"h$1");function ib(n){return new $t(yt.parserMatchError,`Cannot match target parser for node: ${ci(n)}.`)}a(ib,"w$5");function ob(n){return new $t(yt.serializerMatchError,`Cannot match target serializer for node: ${ci(n)}.`)}a(ob,"F$2");function Gt(n){return new $t(yt.expectDomTypeError,`Expect to be a dom, but get: ${ci(n)}.`)}a(Gt,"S$5");function sb(){return new $t(yt.callCommandBeforeEditorView,"You're trying to call a command before editor view initialized, make sure to get commandManager from ctx after editor view has been initialized")}a(sb,"y$2");function lb(n){return new $t(yt.missingNodeInSchema,`Missing node in schema, milkdown cannot find "${n}" in schema.`)}a(lb,"M$5");function ab(n){return new $t(yt.missingMarkInSchema,`Missing mark in schema, milkdown cannot find "${n}" in schema.`)}a(ab,"x$5");var $m=a((n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)},"P$2"),G=a((n,e,t)=>($m(n,e,"read from private field"),t?t.call(n):e.get(n)),"e$1"),Ie=a((n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},"a"),me=a((n,e,t,r)=>($m(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),"n$2"),Wo;let Am=(Wo=class{constructor(){this.sliceMap=new Map,this.get=e=>{const t=typeof e=="string"?[...this.sliceMap.values()].find(r=>r.type.name===e):this.sliceMap.get(e.id);if(!t){const r=typeof e=="string"?e:e.name;throw tb(r)}return t},this.remove=e=>{const t=typeof e=="string"?[...this.sliceMap.values()].find(r=>r.type.name===e):this.sliceMap.get(e.id);t&&this.sliceMap.delete(t.type.id)},this.has=e=>typeof e=="string"?[...this.sliceMap.values()].some(t=>t.type.name===e):this.sliceMap.has(e.id)}},a(Wo,"G"),Wo);var Pt,xn,Hi,qo;let cb=(qo=class{constructor(e,t,r){Ie(this,Pt,void 0),Ie(this,xn,void 0),Ie(this,Hi,void 0),me(this,Pt,[]),me(this,Hi,()=>{G(this,Pt).forEach(i=>i(G(this,xn)))}),this.set=i=>{me(this,xn,i),G(this,Hi).call(this)},this.get=()=>G(this,xn),this.update=i=>{me(this,xn,i(G(this,xn))),G(this,Hi).call(this)},this.type=r,me(this,xn,t),e.set(r.id,this)}on(e){return G(this,Pt).push(e),()=>{me(this,Pt,G(this,Pt).filter(t=>t!==e))}}once(e){const t=this.on(r=>{e(r),t()});return t}off(e){me(this,Pt,G(this,Pt).filter(t=>t!==e))}offAll(){me(this,Pt,[])}},a(qo,"V"),qo);Pt=new WeakMap,xn=new WeakMap,Hi=new WeakMap;var Ko;let ub=(Ko=class{constructor(e,t){this.id=Symbol(`Context-${t}`),this.name=t,this._defaultValue=e,this._typeInfo=()=>{throw Ru()}}create(e,t=this._defaultValue){return new cb(e,t,this)}},a(Ko,"W"),Ko);const ke=a((n,e)=>new ub(n,e),"H$4");var zs,Ps,Fs,Br,ji,er,Vi,Wi,qi,Uo;let hb=(Uo=class{constructor(e,t,r){Ie(this,zs,void 0),Ie(this,Ps,void 0),Ie(this,Fs,void 0),Ie(this,Br,void 0),Ie(this,ji,void 0),Ie(this,er,void 0),Ie(this,Vi,void 0),Ie(this,Wi,void 0),Ie(this,qi,void 0),me(this,Br,new Set),me(this,ji,new Set),me(this,er,new Map),me(this,Vi,new Map),this.read=()=>({metadata:G(this,zs),injectedSlices:[...G(this,Br)].map(i=>({name:typeof i=="string"?i:i.name,value:G(this,Wi).call(this,i)})),consumedSlices:[...G(this,ji)].map(i=>({name:typeof i=="string"?i:i.name,value:G(this,Wi).call(this,i)})),recordedTimers:[...G(this,er)].map(([i,{duration:o}])=>({name:i.name,duration:o,status:G(this,qi).call(this,i)})),waitTimers:[...G(this,Vi)].map(([i,{duration:o}])=>({name:i.name,duration:o,status:G(this,qi).call(this,i)}))}),this.onRecord=i=>{G(this,er).set(i,{start:Date.now(),duration:0})},this.onClear=i=>{G(this,er).delete(i)},this.onDone=i=>{const o=G(this,er).get(i);o&&(o.duration=Date.now()-o.start)},this.onWait=(i,o)=>{const s=Date.now();o.finally(()=>{G(this,Vi).set(i,{duration:Date.now()-s})})},this.onInject=i=>{G(this,Br).add(i)},this.onRemove=i=>{G(this,Br).delete(i)},this.onUse=i=>{G(this,ji).add(i)},me(this,Wi,i=>G(this,Ps).get(i).get()),me(this,qi,i=>G(this,Fs).get(i).status),me(this,Ps,e),me(this,Fs,t),me(this,zs,r)}},a(Uo,"_"),Uo);zs=new WeakMap,Ps=new WeakMap,Fs=new WeakMap,Br=new WeakMap,ji=new WeakMap,er=new WeakMap,Vi=new WeakMap,Wi=new WeakMap,qi=new WeakMap;var wn,Cn,Ls,Et,yi;const db=(yi=class{constructor(e,t,r){Ie(this,wn,void 0),Ie(this,Cn,void 0),Ie(this,Ls,void 0),Ie(this,Et,void 0),this.produce=i=>i&&Object.keys(i).length?new yi(G(this,wn),G(this,Cn),{...i}):this,this.inject=(i,o)=>{var s;const l=i.create(G(this,wn).sliceMap);return o!=null&&l.set(o),(s=G(this,Et))==null||s.onInject(i),this},this.remove=i=>{var o;return G(this,wn).remove(i),(o=G(this,Et))==null||o.onRemove(i),this},this.record=i=>{var o;return i.create(G(this,Cn).store),(o=G(this,Et))==null||o.onRecord(i),this},this.clearTimer=i=>{var o;return G(this,Cn).remove(i),(o=G(this,Et))==null||o.onClear(i),this},this.isInjected=i=>G(this,wn).has(i),this.isRecorded=i=>G(this,Cn).has(i),this.use=i=>{var o;return(o=G(this,Et))==null||o.onUse(i),G(this,wn).get(i)},this.get=i=>this.use(i).get(),this.set=(i,o)=>this.use(i).set(o),this.update=(i,o)=>this.use(i).update(o),this.timer=i=>G(this,Cn).get(i),this.done=i=>{var o;this.timer(i).done(),(o=G(this,Et))==null||o.onDone(i)},this.wait=i=>{var o;const s=this.timer(i).start();return(o=G(this,Et))==null||o.onWait(i,s),s},this.waitTimers=async i=>{await Promise.all(this.get(i).map(o=>this.wait(o)))},me(this,wn,e),me(this,Cn,t),me(this,Ls,r),r&&me(this,Et,new hb(e,t,r))}get meta(){return G(this,Ls)}get inspector(){return G(this,Et)}},a(yi,"L"),yi);wn=new WeakMap,Cn=new WeakMap,Ls=new WeakMap,Et=new WeakMap;let fb=db;var Jo;let pb=(Jo=class{constructor(){this.store=new Map,this.get=e=>{const t=this.store.get(e.id);if(!t)throw nb(e.name);return t},this.remove=e=>{this.store.delete(e.id)},this.has=e=>this.store.has(e.id)}},a(Jo,"J"),Jo);var Hr,tr,Ki,Sn,Ui,Bs,Zo;let mb=(Zo=class{constructor(e,t){Ie(this,Hr,void 0),Ie(this,tr,void 0),Ie(this,Ki,void 0),Ie(this,Sn,void 0),Ie(this,Ui,void 0),Ie(this,Bs,void 0),me(this,Hr,null),me(this,tr,null),me(this,Sn,"pending"),this.start=()=>(G(this,Hr)??me(this,Hr,new Promise((r,i)=>{me(this,tr,o=>{o instanceof CustomEvent&&o.detail.id===G(this,Ki)&&(me(this,Sn,"resolved"),G(this,Ui).call(this),o.stopImmediatePropagation(),r())}),G(this,Bs).call(this,()=>{G(this,Sn)==="pending"&&me(this,Sn,"rejected"),G(this,Ui).call(this),i(new Error(`Timing ${this.type.name} timeout.`))}),me(this,Sn,"pending"),addEventListener(this.type.name,G(this,tr))})),G(this,Hr)),this.done=()=>{const r=new CustomEvent(this.type.name,{detail:{id:G(this,Ki)}});dispatchEvent(r)},me(this,Ui,()=>{G(this,tr)&&removeEventListener(this.type.name,G(this,tr))}),me(this,Bs,r=>{setTimeout(()=>{r()},this.type.timeout)}),me(this,Ki,Symbol(t.name)),this.type=t,e.set(t.id,this)}get status(){return G(this,Sn)}},a(Zo,"q"),Zo);Hr=new WeakMap,tr=new WeakMap,Ki=new WeakMap,Sn=new WeakMap,Ui=new WeakMap,Bs=new WeakMap;var Go;let gb=(Go=class{constructor(e,t=3e3){this.create=r=>new mb(r,this),this.id=Symbol(`Timer-${e}`),this.name=e,this.timeout=t}},a(Go,"A"),Go);const jn=a((n,e=3e3)=>new gb(n,e),"K$3");function He(n){this.content=n}a(He,"OrderedMap");He.prototype={constructor:He,find:function(n){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===n)return e;return-1},get:function(n){var e=this.find(n);return e==-1?void 0:this.content[e+1]},update:function(n,e,t){var r=t&&t!=n?this.remove(t):this,i=r.find(n),o=r.content.slice();return i==-1?o.push(t||n,e):(o[i+1]=e,t&&(o[i]=t)),new He(o)},remove:function(n){var e=this.find(n);if(e==-1)return this;var t=this.content.slice();return t.splice(e,2),new He(t)},addToStart:function(n,e){return new He([n,e].concat(this.remove(n).content))},addToEnd:function(n,e){var t=this.remove(n).content.slice();return t.push(n,e),new He(t)},addBefore:function(n,e,t){var r=this.remove(e),i=r.content.slice(),o=r.find(n);return i.splice(o==-1?i.length:o,0,e,t),new He(i)},forEach:function(n){for(var e=0;e<this.content.length;e+=2)n(this.content[e],this.content[e+1])},prepend:function(n){return n=He.from(n),n.size?new He(n.content.concat(this.subtract(n).content)):this},append:function(n){return n=He.from(n),n.size?new He(this.subtract(n).content.concat(n.content)):this},subtract:function(n){var e=this;n=He.from(n);for(var t=0;t<n.content.length;t+=2)e=e.remove(n.content[t]);return e},toObject:function(){var n={};return this.forEach(function(e,t){n[e]=t}),n},get size(){return this.content.length>>1}};He.from=function(n){if(n instanceof He)return n;var e=[];if(n)for(var t in n)e.push(t,n[t]);return new He(e)};function Im(n,e,t){for(let r=0;;r++){if(r==n.childCount||r==e.childCount)return n.childCount==e.childCount?null:t;let i=n.child(r),o=e.child(r);if(i==o){t+=i.nodeSize;continue}if(!i.sameMarkup(o))return t;if(i.isText&&i.text!=o.text){for(let s=0;i.text[s]==o.text[s];s++)t++;return t}if(i.content.size||o.content.size){let s=Im(i.content,o.content,t+1);if(s!=null)return s}t+=i.nodeSize}}a(Im,"findDiffStart");function Em(n,e,t,r){for(let i=n.childCount,o=e.childCount;;){if(i==0||o==0)return i==o?null:{a:t,b:r};let s=n.child(--i),l=e.child(--o),c=s.nodeSize;if(s==l){t-=c,r-=c;continue}if(!s.sameMarkup(l))return{a:t,b:r};if(s.isText&&s.text!=l.text){let u=0,h=Math.min(s.text.length,l.text.length);for(;u<h&&s.text[s.text.length-u-1]==l.text[l.text.length-u-1];)u++,t--,r--;return{a:t,b:r}}if(s.content.size||l.content.size){let u=Em(s.content,l.content,t-1,r-1);if(u)return u}t-=c,r-=c}}a(Em,"findDiffEnd");const Be=class Be{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,t,r,i=0,o){for(let s=0,l=0;l<t;s++){let c=this.content[s],u=l+c.nodeSize;if(u>e&&r(c,i+l,o||null,s)!==!1&&c.content.size){let h=l+1;c.nodesBetween(Math.max(0,e-h),Math.min(c.content.size,t-h),r,i+h)}l=u}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,r,i){let o="",s=!0;return this.nodesBetween(e,t,(l,c)=>{let u=l.isText?l.text.slice(Math.max(e,c)-c,t-c):l.isLeaf?i?typeof i=="function"?i(l):i:l.type.spec.leafText?l.type.spec.leafText(l):"":"";l.isBlock&&(l.isLeaf&&u||l.isTextblock)&&r&&(s?s=!1:o+=r),o+=u},0),o}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,r=e.firstChild,i=this.content.slice(),o=0;for(t.isText&&t.sameMarkup(r)&&(i[i.length-1]=t.withText(t.text+r.text),o=1);o<e.content.length;o++)i.push(e.content[o]);return new Be(i,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let r=[],i=0;if(t>e)for(let o=0,s=0;s<t;o++){let l=this.content[o],c=s+l.nodeSize;c>e&&((s<e||c>t)&&(l.isText?l=l.cut(Math.max(0,e-s),Math.min(l.text.length,t-s)):l=l.cut(Math.max(0,e-s-1),Math.min(l.content.size,t-s-1))),r.push(l),i+=l.nodeSize),s=c}return new Be(r,i)}cutByIndex(e,t){return e==t?Be.empty:e==0&&t==this.content.length?this:new Be(this.content.slice(e,t))}replaceChild(e,t){let r=this.content[e];if(r==t)return this;let i=this.content.slice(),o=this.size+t.nodeSize-r.nodeSize;return i[e]=t,new Be(i,o)}addToStart(e){return new Be([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new Be(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,r=0;t<this.content.length;t++){let i=this.content[t];e(i,r,t),r+=i.nodeSize}}findDiffStart(e,t=0){return Im(this,e,t)}findDiffEnd(e,t=this.size,r=e.size){return Em(this,e,t,r)}findIndex(e,t=-1){if(e==0)return vs(0,e);if(e==this.size)return vs(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let r=0,i=0;;r++){let o=this.child(r),s=i+o.nodeSize;if(s>=e)return s==e||t>0?vs(r+1,s):vs(r,i);i=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return Be.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new Be(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return Be.empty;let t,r=0;for(let i=0;i<e.length;i++){let o=e[i];r+=o.nodeSize,i&&o.isText&&e[i-1].sameMarkup(o)?(t||(t=e.slice(0,i)),t[t.length-1]=o.withText(t[t.length-1].text+o.text)):t&&t.push(o)}return new Be(t||e,r)}static from(e){if(!e)return Be.empty;if(e instanceof Be)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Be([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};a(Be,"Fragment");let P=Be;P.empty=new P([],0);const xa={index:0,offset:0};function vs(n,e){return xa.index=n,xa.offset=e,xa}a(vs,"retIndex");function pl(n,e){if(n===e)return!0;if(!(n&&typeof n=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(n);if(Array.isArray(e)!=t)return!1;if(t){if(n.length!=e.length)return!1;for(let r=0;r<n.length;r++)if(!pl(n[r],e[r]))return!1}else{for(let r in n)if(!(r in e)||!pl(n[r],e[r]))return!1;for(let r in e)if(!(r in n))return!1}return!0}a(pl,"compareDeep");const xo=class xo{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,r=!1;for(let i=0;i<e.length;i++){let o=e[i];if(this.eq(o))return e;if(this.type.excludes(o.type))t||(t=e.slice(0,i));else{if(o.type.excludes(this.type))return e;!r&&o.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),r=!0),t&&t.push(o)}}return t||(t=e.slice()),r||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&pl(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[t.type];if(!r)throw new RangeError(`There is no mark type ${t.type} in this schema`);return r.create(t.attrs)}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(t[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return xo.none;if(e instanceof xo)return[e];let t=e.slice();return t.sort((r,i)=>r.type.rank-i.type.rank),t}};a(xo,"Mark");let fe=xo;fe.none=[];const pd=class pd extends Error{};a(pd,"ReplaceError");let ui=pd;const An=class An{constructor(e,t,r){this.content=e,this.openStart=t,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let r=_m(this.content,e+this.openStart,t);return r&&new An(r,this.openStart,this.openEnd)}removeBetween(e,t){return new An(Om(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return An.empty;let r=t.openStart||0,i=t.openEnd||0;if(typeof r!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new An(P.fromJSON(e,t.content),r,i)}static maxOpen(e,t=!0){let r=0,i=0;for(let o=e.firstChild;o&&!o.isLeaf&&(t||!o.type.spec.isolating);o=o.firstChild)r++;for(let o=e.lastChild;o&&!o.isLeaf&&(t||!o.type.spec.isolating);o=o.lastChild)i++;return new An(e,r,i)}};a(An,"Slice");let U=An;U.empty=new U(P.empty,0,0);function Om(n,e,t){let{index:r,offset:i}=n.findIndex(e),o=n.maybeChild(r),{index:s,offset:l}=n.findIndex(t);if(i==e||o.isText){if(l!=t&&!n.child(s).isText)throw new RangeError("Removing non-flat range");return n.cut(0,e).append(n.cut(t))}if(r!=s)throw new RangeError("Removing non-flat range");return n.replaceChild(r,o.copy(Om(o.content,e-i-1,t-i-1)))}a(Om,"removeRange");function _m(n,e,t,r){let{index:i,offset:o}=n.findIndex(e),s=n.maybeChild(i);if(o==e||s.isText)return r&&!r.canReplace(i,i,t)?null:n.cut(0,e).append(t).append(n.cut(e));let l=_m(s.content,e-o-1,t);return l&&n.replaceChild(i,s.copy(l))}a(_m,"insertInto");function yb(n,e,t){if(t.openStart>n.depth)throw new ui("Inserted content deeper than insertion position");if(n.depth-t.openStart!=e.depth-t.openEnd)throw new ui("Inconsistent open depths");return Dm(n,e,t,0)}a(yb,"replace$1");function Dm(n,e,t,r){let i=n.index(r),o=n.node(r);if(i==e.index(r)&&r<n.depth-t.openStart){let s=Dm(n,e,t,r+1);return o.copy(o.content.replaceChild(i,s))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&n.depth==r&&e.depth==r){let s=n.parent,l=s.content;return xr(s,l.cut(0,n.parentOffset).append(t.content).append(l.cut(e.parentOffset)))}else{let{start:s,end:l}=kb(t,n);return xr(o,zm(n,s,l,e,r))}else return xr(o,ml(n,e,r))}a(Dm,"replaceOuter");function Rm(n,e){if(!e.type.compatibleContent(n.type))throw new ui("Cannot join "+e.type.name+" onto "+n.type.name)}a(Rm,"checkJoin");function xc(n,e,t){let r=n.node(t);return Rm(r,e.node(t)),r}a(xc,"joinable$1");function br(n,e){let t=e.length-1;t>=0&&n.isText&&n.sameMarkup(e[t])?e[t]=n.withText(e[t].text+n.text):e.push(n)}a(br,"addNode");function co(n,e,t,r){let i=(e||n).node(t),o=0,s=e?e.index(t):i.childCount;n&&(o=n.index(t),n.depth>t?o++:n.textOffset&&(br(n.nodeAfter,r),o++));for(let l=o;l<s;l++)br(i.child(l),r);e&&e.depth==t&&e.textOffset&&br(e.nodeBefore,r)}a(co,"addRange");function xr(n,e){return n.type.checkContent(e),n.copy(e)}a(xr,"close");function zm(n,e,t,r,i){let o=n.depth>i&&xc(n,e,i+1),s=r.depth>i&&xc(t,r,i+1),l=[];return co(null,n,i,l),o&&s&&e.index(i)==t.index(i)?(Rm(o,s),br(xr(o,zm(n,e,t,r,i+1)),l)):(o&&br(xr(o,ml(n,e,i+1)),l),co(e,t,i,l),s&&br(xr(s,ml(t,r,i+1)),l)),co(r,null,i,l),new P(l)}a(zm,"replaceThreeWay");function ml(n,e,t){let r=[];if(co(null,n,t,r),n.depth>t){let i=xc(n,e,t+1);br(xr(i,ml(n,e,t+1)),r)}return co(e,null,t,r),new P(r)}a(ml,"replaceTwoWay");function kb(n,e){let t=e.depth-n.openStart,i=e.node(t).copy(n.content);for(let o=t-1;o>=0;o--)i=e.node(o).copy(P.from(i));return{start:i.resolveNoCache(n.openStart+t),end:i.resolveNoCache(i.content.size-n.openEnd-t)}}a(kb,"prepareSliceForReplace");const wo=class wo{constructor(e,t,r){this.pos=e,this.path=t,this.parentOffset=r,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],i=e.child(t);return r?e.child(t).cut(r):i}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let r=this.path[t*3],i=t==0?0:this.path[t*3-1]+1;for(let o=0;o<e;o++)i+=r.child(o).nodeSize;return i}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return fe.none;if(this.textOffset)return e.child(t).marks;let r=e.maybeChild(t-1),i=e.maybeChild(t);if(!r){let l=r;r=i,i=l}let o=r.marks;for(var s=0;s<o.length;s++)o[s].type.spec.inclusive===!1&&(!i||!o[s].isInSet(i.marks))&&(o=o[s--].removeFromSet(o));return o}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let r=t.marks,i=e.parent.maybeChild(e.index());for(var o=0;o<r.length;o++)r[o].type.spec.inclusive===!1&&(!i||!r[o].isInSet(i.marks))&&(r=r[o--].removeFromSet(r));return r}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!t||t(this.node(r))))return new yl(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let r=[],i=0,o=t;for(let s=e;;){let{index:l,offset:c}=s.content.findIndex(o),u=o-c;if(r.push(s,l,i+c),!u||(s=s.child(l),s.isText))break;o=u-1,i+=c+1}return new wo(t,r,o)}static resolveCached(e,t){for(let i=0;i<wa.length;i++){let o=wa[i];if(o.pos==t&&o.doc==e)return o}let r=wa[Ca]=wo.resolve(e,t);return Ca=(Ca+1)%bb,r}};a(wo,"ResolvedPos");let gl=wo,wa=[],Ca=0,bb=12;const md=class md{constructor(e,t,r){this.$from=e,this.$to=t,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}};a(md,"NodeRange");let yl=md;const xb=Object.create(null),Co=class Co{constructor(e,t,r,i=fe.none){this.type=e,this.attrs=t,this.marks=i,this.content=r||P.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,r,i=0){this.content.nodesBetween(e,t,r,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,r,i){return this.content.textBetween(e,t,r,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,r){return this.type==e&&pl(this.attrs,t||e.defaultAttrs||xb)&&fe.sameSet(this.marks,r||fe.none)}copy(e=null){return e==this.content?this:new Co(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new Co(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,r=!1){if(e==t)return U.empty;let i=this.resolve(e),o=this.resolve(t),s=r?0:i.sharedDepth(t),l=i.start(s),u=i.node(s).content.cut(i.pos-l,o.pos-l);return new U(u,i.depth-s,o.depth-s)}replace(e,t,r){return yb(this.resolve(e),this.resolve(t),r)}nodeAt(e){for(let t=this;;){let{index:r,offset:i}=t.content.findIndex(e);if(t=t.maybeChild(r),!t)return null;if(i==e||t.isText)return t;e-=i+1}}childAfter(e){let{index:t,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(t),index:t,offset:r};let i=this.content.child(t-1);return{node:i,index:t-1,offset:r-i.nodeSize}}resolve(e){return gl.resolveCached(this,e)}resolveNoCache(e){return gl.resolve(this,e)}rangeHasMark(e,t,r){let i=!1;return t>e&&this.nodesBetween(e,t,o=>(r.isInSet(o.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),Pm(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,r=P.empty,i=0,o=r.childCount){let s=this.contentMatchAt(e).matchFragment(r,i,o),l=s&&s.matchFragment(this.content,t);if(!l||!l.validEnd)return!1;for(let c=i;c<o;c++)if(!this.type.allowsMarks(r.child(c).marks))return!1;return!0}canReplaceWith(e,t,r,i){if(i&&!this.type.allowsMarks(i))return!1;let o=this.contentMatchAt(e).matchType(r),s=o&&o.matchFragment(this.content,t);return s?s.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content);let e=fe.none;for(let t=0;t<this.marks.length;t++)e=this.marks[t].addToSet(e);if(!fe.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let r=null;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,r)}let i=P.fromJSON(e,t.content);return e.nodeType(t.type).create(t.attrs,i,r)}};a(Co,"Node");let qt=Co;qt.prototype.text=void 0;const So=class So extends qt{constructor(e,t,r,i){if(super(e,t,null,i),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Pm(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new So(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new So(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}};a(So,"TextNode");let wc=So;function Pm(n,e){for(let t=n.length-1;t>=0;t--)e=n[t].type.name+"("+e+")";return e}a(Pm,"wrapMarks");const Bl=class Bl{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let r=new Cc(e,t);if(r.next==null)return Bl.empty;let i=Fm(r);r.next&&r.err("Unexpected trailing text");let o=Tb(Mb(i));return $b(o,r),o}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,r=e.childCount){let i=this;for(let o=t;i&&o<r;o++)i=i.matchType(e.child(o).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let r=0;r<e.next.length;r++)if(this.next[t].type==e.next[r].type)return!0;return!1}fillBefore(e,t=!1,r=0){let i=[this];function o(s,l){let c=s.matchFragment(e,r);if(c&&(!t||c.validEnd))return P.from(l.map(u=>u.createAndFill()));for(let u=0;u<s.next.length;u++){let{type:h,next:d}=s.next[u];if(!(h.isText||h.hasRequiredAttrs())&&i.indexOf(d)==-1){i.push(d);let f=o(d,l.concat(h));if(f)return f}}return null}return a(o,"search"),o(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let i=r.shift(),o=i.match;if(o.matchType(e)){let s=[];for(let l=i;l.type;l=l.via)s.push(l.type);return s.reverse()}for(let s=0;s<o.next.length;s++){let{type:l,next:c}=o.next[s];!l.isLeaf&&!l.hasRequiredAttrs()&&!(l.name in t)&&(!i.type||c.validEnd)&&(r.push({match:l.contentMatch,type:l,via:i}),t[l.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(r){e.push(r);for(let i=0;i<r.next.length;i++)e.indexOf(r.next[i].next)==-1&&t(r.next[i].next)}return a(t,"scan"),t(this),e.map((r,i)=>{let o=i+(r.validEnd?"*":" ")+" ";for(let s=0;s<r.next.length;s++)o+=(s?", ":"")+r.next[s].type.name+"->"+e.indexOf(r.next[s].next);return o}).join(`
`)}};a(Bl,"ContentMatch");let Ar=Bl;Ar.empty=new Ar(!0);const gd=class gd{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}};a(gd,"TokenStream");let Cc=gd;function Fm(n){let e=[];do e.push(wb(n));while(n.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}a(Fm,"parseExpr");function wb(n){let e=[];do e.push(Cb(n));while(n.next&&n.next!=")"&&n.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}a(wb,"parseExprSeq");function Cb(n){let e=Nb(n);for(;;)if(n.eat("+"))e={type:"plus",expr:e};else if(n.eat("*"))e={type:"star",expr:e};else if(n.eat("?"))e={type:"opt",expr:e};else if(n.eat("{"))e=Sb(n,e);else break;return e}a(Cb,"parseExprSubscript");function of(n){/\D/.test(n.next)&&n.err("Expected number, got '"+n.next+"'");let e=Number(n.next);return n.pos++,e}a(of,"parseNum");function Sb(n,e){let t=of(n),r=t;return n.eat(",")&&(n.next!="}"?r=of(n):r=-1),n.eat("}")||n.err("Unclosed braced range"),{type:"range",min:t,max:r,expr:e}}a(Sb,"parseExprRange");function vb(n,e){let t=n.nodeTypes,r=t[e];if(r)return[r];let i=[];for(let o in t){let s=t[o];s.groups.indexOf(e)>-1&&i.push(s)}return i.length==0&&n.err("No node type or group '"+e+"' found"),i}a(vb,"resolveName");function Nb(n){if(n.eat("(")){let e=Fm(n);return n.eat(")")||n.err("Missing closing paren"),e}else if(/\W/.test(n.next))n.err("Unexpected token '"+n.next+"'");else{let e=vb(n,n.next).map(t=>(n.inline==null?n.inline=t.isInline:n.inline!=t.isInline&&n.err("Mixing inline and block content"),{type:"name",value:t}));return n.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}a(Nb,"parseExprAtom");function Mb(n){let e=[[]];return i(o(n,0),t()),e;function t(){return e.push([])-1}a(t,"node");function r(s,l,c){let u={term:c,to:l};return e[s].push(u),u}a(r,"edge");function i(s,l){s.forEach(c=>c.to=l)}a(i,"connect");function o(s,l){if(s.type=="choice")return s.exprs.reduce((c,u)=>c.concat(o(u,l)),[]);if(s.type=="seq")for(let c=0;;c++){let u=o(s.exprs[c],l);if(c==s.exprs.length-1)return u;i(u,l=t())}else if(s.type=="star"){let c=t();return r(l,c),i(o(s.expr,c),c),[r(c)]}else if(s.type=="plus"){let c=t();return i(o(s.expr,l),c),i(o(s.expr,c),c),[r(c)]}else{if(s.type=="opt")return[r(l)].concat(o(s.expr,l));if(s.type=="range"){let c=l;for(let u=0;u<s.min;u++){let h=t();i(o(s.expr,c),h),c=h}if(s.max==-1)i(o(s.expr,c),c);else for(let u=s.min;u<s.max;u++){let h=t();r(c,h),i(o(s.expr,c),h),c=h}return[r(c)]}else{if(s.type=="name")return[r(l,void 0,s.value)];throw new Error("Unknown expr type")}}}a(o,"compile")}a(Mb,"nfa");function Lm(n,e){return e-n}a(Lm,"cmp");function sf(n,e){let t=[];return r(e),t.sort(Lm);function r(i){let o=n[i];if(o.length==1&&!o[0].term)return r(o[0].to);t.push(i);for(let s=0;s<o.length;s++){let{term:l,to:c}=o[s];!l&&t.indexOf(c)==-1&&r(c)}}a(r,"scan")}a(sf,"nullFrom");function Tb(n){let e=Object.create(null);return t(sf(n,0));function t(r){let i=[];r.forEach(s=>{n[s].forEach(({term:l,to:c})=>{if(!l)return;let u;for(let h=0;h<i.length;h++)i[h][0]==l&&(u=i[h][1]);sf(n,c).forEach(h=>{u||i.push([l,u=[]]),u.indexOf(h)==-1&&u.push(h)})})});let o=e[r.join(",")]=new Ar(r.indexOf(n.length-1)>-1);for(let s=0;s<i.length;s++){let l=i[s][1].sort(Lm);o.next.push({type:i[s][0],next:e[l.join(",")]||t(l)})}return o}}a(Tb,"dfa");function $b(n,e){for(let t=0,r=[n];t<r.length;t++){let i=r[t],o=!i.validEnd,s=[];for(let l=0;l<i.next.length;l++){let{type:c,next:u}=i.next[l];s.push(c.name),o&&!(c.isText||c.hasRequiredAttrs())&&(o=!1),r.indexOf(u)==-1&&r.push(u)}o&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}a($b,"checkForDeadEnds");function Bm(n){let e=Object.create(null);for(let t in n){let r=n[t];if(!r.hasDefault)return null;e[t]=r.default}return e}a(Bm,"defaultAttrs");function Hm(n,e){let t=Object.create(null);for(let r in n){let i=e&&e[r];if(i===void 0){let o=n[r];if(o.hasDefault)i=o.default;else throw new RangeError("No value supplied for attribute "+r)}t[r]=i}return t}a(Hm,"computeAttrs");function jm(n){let e=Object.create(null);if(n)for(let t in n)e[t]=new Sc(n[t]);return e}a(jm,"initAttrs");var ki;let lf=(ki=class{constructor(e,t,r){this.name=e,this.schema=t,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=jm(r.attrs),this.defaultAttrs=Bm(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Ar.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:Hm(this.attrs,e)}create(e=null,t,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new qt(this,this.computeAttrs(e),P.from(t),fe.setFrom(r))}createChecked(e=null,t,r){return t=P.from(t),this.checkContent(t),new qt(this,this.computeAttrs(e),t,fe.setFrom(r))}createAndFill(e=null,t,r){if(e=this.computeAttrs(e),t=P.from(t),t.size){let s=this.contentMatch.fillBefore(t);if(!s)return null;t=s.append(t)}let i=this.contentMatch.matchFragment(t),o=i&&i.fillBefore(P.empty,!0);return o?new qt(this,e,t.append(o),fe.setFrom(r)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?t&&t.push(e[r]):t||(t=e.slice(0,r));return t?t.length?t:fe.none:e}static compile(e,t){let r=Object.create(null);e.forEach((o,s)=>r[o]=new ki(o,t,s));let i=t.spec.topNode||"doc";if(!r[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let o in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}},a(ki,"NodeType"),ki);const yd=class yd{constructor(e){this.hasDefault=Object.prototype.hasOwnProperty.call(e,"default"),this.default=e.default}get isRequired(){return!this.hasDefault}};a(yd,"Attribute");let Sc=yd;const Hl=class Hl{constructor(e,t,r,i){this.name=e,this.rank=t,this.schema=r,this.spec=i,this.attrs=jm(i.attrs),this.excluded=null;let o=Bm(this.attrs);this.instance=o?new fe(this,o):null}create(e=null){return!e&&this.instance?this.instance:new fe(this,Hm(this.attrs,e))}static compile(e,t){let r=Object.create(null),i=0;return e.forEach((o,s)=>r[o]=new Hl(o,i++,t,s)),r}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}excludes(e){return this.excluded.indexOf(e)>-1}};a(Hl,"MarkType");let kl=Hl;const kd=class kd{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let i in e)t[i]=e[i];t.nodes=He.from(e.nodes),t.marks=He.from(e.marks||{}),this.nodes=lf.compile(this.spec.nodes,this),this.marks=kl.compile(this.spec.marks,this);let r=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let o=this.nodes[i],s=o.spec.content||"",l=o.spec.marks;if(o.contentMatch=r[s]||(r[s]=Ar.parse(s,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!o.isInline||!o.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=o}o.markSet=l=="_"?null:l?af(this,l.split(" ")):l==""||!o.inlineContent?[]:null}for(let i in this.marks){let o=this.marks[i],s=o.spec.excludes;o.excluded=s==null?[o]:s==""?[]:af(this,s.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,r,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof lf){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,r,i)}text(e,t){let r=this.nodes.text;return new wc(r,r.defaultAttrs,e,fe.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeFromJSON(e){return qt.fromJSON(this,e)}markFromJSON(e){return fe.fromJSON(this,e)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}};a(kd,"Schema");let vc=kd;function af(n,e){let t=[];for(let r=0;r<e.length;r++){let i=e[r],o=n.marks[i],s=o;if(o)t.push(o);else for(let l in n.marks){let c=n.marks[l];(i=="_"||c.spec.group&&c.spec.group.split(" ").indexOf(i)>-1)&&t.push(s=c)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return t}a(af,"gatherMarks");function Ab(n){return n.tag!=null}a(Ab,"isTagRule");function Ib(n){return n.style!=null}a(Ib,"isStyleRule");const vo=class vo{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[],t.forEach(r=>{Ab(r)?this.tags.push(r):Ib(r)&&this.styles.push(r)}),this.normalizeLists=!this.tags.some(r=>{if(!/^(ul|ol)\b/.test(r.tag)||!r.node)return!1;let i=e.nodes[r.node];return i.contentMatch.matchType(i)})}parse(e,t={}){let r=new wl(this,t,!1);return r.addAll(e,t.from,t.to),r.finish()}parseSlice(e,t={}){let r=new wl(this,t,!0);return r.addAll(e,t.from,t.to),U.maxOpen(r.finish())}matchTag(e,t,r){for(let i=r?this.tags.indexOf(r)+1:0;i<this.tags.length;i++){let o=this.tags[i];if(_b(e,o.tag)&&(o.namespace===void 0||e.namespaceURI==o.namespace)&&(!o.context||t.matchesContext(o.context))){if(o.getAttrs){let s=o.getAttrs(e);if(s===!1)continue;o.attrs=s||void 0}return o}}}matchStyle(e,t,r,i){for(let o=i?this.styles.indexOf(i)+1:0;o<this.styles.length;o++){let s=this.styles[o],l=s.style;if(!(l.indexOf(e)!=0||s.context&&!r.matchesContext(s.context)||l.length>e.length&&(l.charCodeAt(e.length)!=61||l.slice(e.length+1)!=t))){if(s.getAttrs){let c=s.getAttrs(t);if(c===!1)continue;s.attrs=c||void 0}return s}}}static schemaRules(e){let t=[];function r(i){let o=i.priority==null?50:i.priority,s=0;for(;s<t.length;s++){let l=t[s];if((l.priority==null?50:l.priority)<o)break}t.splice(s,0,i)}a(r,"insert");for(let i in e.marks){let o=e.marks[i].spec.parseDOM;o&&o.forEach(s=>{r(s=uf(s)),s.mark||s.ignore||s.clearMark||(s.mark=i)})}for(let i in e.nodes){let o=e.nodes[i].spec.parseDOM;o&&o.forEach(s=>{r(s=uf(s)),s.node||s.ignore||s.mark||(s.node=i)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new vo(e,vo.schemaRules(e)))}};a(vo,"DOMParser");let Ao=vo;const Vm={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Eb={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Wm={ol:!0,ul:!0},bl=1,xl=2,uo=4;function cf(n,e,t){return e!=null?(e?bl:0)|(e==="full"?xl:0):n&&n.whitespace=="pre"?bl|xl:t&~uo}a(cf,"wsOptionsFor");const bd=class bd{constructor(e,t,r,i,o,s,l){this.type=e,this.attrs=t,this.marks=r,this.pendingMarks=i,this.solid=o,this.options=l,this.content=[],this.activeMarks=fe.none,this.stashMarks=[],this.match=s||(l&uo?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(P.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let r=this.type.contentMatch,i;return(i=r.findWrapping(e.type))?(this.match=r,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&bl)){let r=this.content[this.content.length-1],i;if(r&&r.isText&&(i=/[ \t\r\n\u000c]+$/.exec(r.text))){let o=r;r.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=o.withText(o.text.slice(0,o.text.length-i[0].length))}}let t=P.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(P.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}popFromStashMark(e){for(let t=this.stashMarks.length-1;t>=0;t--)if(e.eq(this.stashMarks[t]))return this.stashMarks.splice(t,1)[0]}applyPending(e){for(let t=0,r=this.pendingMarks;t<r.length;t++){let i=r[t];(this.type?this.type.allowsMarkType(i.type):Rb(i.type,e))&&!i.isInSet(this.activeMarks)&&(this.activeMarks=i.addToSet(this.activeMarks),this.pendingMarks=i.removeFromSet(this.pendingMarks))}}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Vm.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}};a(bd,"NodeContext");let Qr=bd;const xd=class xd{constructor(e,t,r){this.parser=e,this.options=t,this.isOpen=r,this.open=0;let i=t.topNode,o,s=cf(null,t.preserveWhitespace,0)|(r?uo:0);i?o=new Qr(i.type,i.attrs,fe.none,fe.none,!0,t.topMatch||i.type.contentMatch,s):r?o=new Qr(null,null,fe.none,fe.none,!0,null,s):o=new Qr(e.schema.topNodeType,null,fe.none,fe.none,!0,null,s),this.nodes=[o],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e){e.nodeType==3?this.addTextNode(e):e.nodeType==1&&this.addElement(e)}withStyleRules(e,t){let r=e.getAttribute("style");if(!r)return t();let i=this.readStyles(Db(r));if(!i)return;let[o,s]=i,l=this.top;for(let c=0;c<s.length;c++)this.removePendingMark(s[c],l);for(let c=0;c<o.length;c++)this.addPendingMark(o[c]);t();for(let c=0;c<o.length;c++)this.removePendingMark(o[c],l);for(let c=0;c<s.length;c++)this.addPendingMark(s[c])}addTextNode(e){let t=e.nodeValue,r=this.top;if(r.options&xl||r.inlineContext(e)||/[^ \t\r\n\u000c]/.test(t)){if(r.options&bl)r.options&xl?t=t.replace(/\r\n?/g,`
`):t=t.replace(/\r?\n|\r/g," ");else if(t=t.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(t)&&this.open==this.nodes.length-1){let i=r.content[r.content.length-1],o=e.previousSibling;(!i||o&&o.nodeName=="BR"||i.isText&&/[ \t\r\n\u000c]$/.test(i.text))&&(t=t.slice(1))}t&&this.insertNode(this.parser.schema.text(t)),this.findInText(e)}else this.findInside(e)}addElement(e,t){let r=e.nodeName.toLowerCase(),i;Wm.hasOwnProperty(r)&&this.parser.normalizeLists&&Ob(e);let o=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(i=this.parser.matchTag(e,this,t));if(o?o.ignore:Eb.hasOwnProperty(r))this.findInside(e),this.ignoreFallback(e);else if(!o||o.skip||o.closeParent){o&&o.closeParent?this.open=Math.max(0,this.open-1):o&&o.skip.nodeType&&(e=o.skip);let s,l=this.top,c=this.needsBlock;if(Vm.hasOwnProperty(r))l.content.length&&l.content[0].isInline&&this.open&&(this.open--,l=this.top),s=!0,l.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e);return}o&&o.skip?this.addAll(e):this.withStyleRules(e,()=>this.addAll(e)),s&&this.sync(l),this.needsBlock=c}else this.withStyleRules(e,()=>{this.addElementByRule(e,o,o.consuming===!1?i:void 0)})}leafFallback(e){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`))}ignoreFallback(e){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))}readStyles(e){let t=fe.none,r=fe.none;for(let i=0;i<e.length;i+=2)for(let o=void 0;;){let s=this.parser.matchStyle(e[i],e[i+1],this,o);if(!s)break;if(s.ignore)return null;if(s.clearMark?this.top.pendingMarks.concat(this.top.activeMarks).forEach(l=>{s.clearMark(l)&&(r=l.addToSet(r))}):t=this.parser.schema.marks[s.mark].create(s.attrs).addToSet(t),s.consuming===!1)o=s;else break}return[t,r]}addElementByRule(e,t,r){let i,o,s;t.node?(o=this.parser.schema.nodes[t.node],o.isLeaf?this.insertNode(o.create(t.attrs))||this.leafFallback(e):i=this.enter(o,t.attrs||null,t.preserveWhitespace)):(s=this.parser.schema.marks[t.mark].create(t.attrs),this.addPendingMark(s));let l=this.top;if(o&&o.isLeaf)this.findInside(e);else if(r)this.addElement(e,r);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(c=>this.insertNode(c));else{let c=e;typeof t.contentElement=="string"?c=e.querySelector(t.contentElement):typeof t.contentElement=="function"?c=t.contentElement(e):t.contentElement&&(c=t.contentElement),this.findAround(e,c,!0),this.addAll(c)}i&&this.sync(l)&&this.open--,s&&this.removePendingMark(s,l)}addAll(e,t,r){let i=t||0;for(let o=t?e.childNodes[t]:e.firstChild,s=r==null?null:e.childNodes[r];o!=s;o=o.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(o);this.findAtPoint(e,i)}findPlace(e){let t,r;for(let i=this.open;i>=0;i--){let o=this.nodes[i],s=o.findWrapping(e);if(s&&(!t||t.length>s.length)&&(t=s,r=o,!s.length)||o.solid)break}if(!t)return!1;this.sync(r);for(let i=0;i<t.length;i++)this.enterInner(t[i],null,!1);return!0}insertNode(e){if(e.isInline&&this.needsBlock&&!this.top.type){let t=this.textblockFromContext();t&&this.enterInner(t)}if(this.findPlace(e)){this.closeExtra();let t=this.top;t.applyPending(e.type),t.match&&(t.match=t.match.matchType(e.type));let r=t.activeMarks;for(let i=0;i<e.marks.length;i++)(!t.type||t.type.allowsMarkType(e.marks[i].type))&&(r=e.marks[i].addToSet(r));return t.content.push(e.mark(r)),!0}return!1}enter(e,t,r){let i=this.findPlace(e.create(t));return i&&this.enterInner(e,t,!0,r),i}enterInner(e,t=null,r=!1,i){this.closeExtra();let o=this.top;o.applyPending(e),o.match=o.match&&o.match.matchType(e);let s=cf(e,i,o.options);o.options&uo&&o.content.length==0&&(s|=uo),this.nodes.push(new Qr(e,t,o.activeMarks,o.pendingMarks,r,null,s)),this.open++}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(e){for(let t=this.open;t>=0;t--)if(this.nodes[t]==e)return this.open=t,!0;return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let r=this.nodes[t].content;for(let i=r.length-1;i>=0;i--)e+=r[i].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==t&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,r){if(e!=t&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&t.compareDocumentPosition(this.find[i].node)&(r?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),r=this.options.context,i=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),o=-(r?r.depth+1:0)+(i?0:1),s=a((l,c)=>{for(;l>=0;l--){let u=t[l];if(u==""){if(l==t.length-1||l==0)continue;for(;c>=o;c--)if(s(l-1,c))return!0;return!1}else{let h=c>0||c==0&&i?this.nodes[c].type:r&&c>=o?r.node(c-o).type:null;if(!h||h.name!=u&&h.groups.indexOf(u)==-1)return!1;c--}}return!0},"match");return s(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let r=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let t in this.parser.schema.nodes){let r=this.parser.schema.nodes[t];if(r.isTextblock&&r.defaultAttrs)return r}}addPendingMark(e){let t=zb(e,this.top.pendingMarks);t&&this.top.stashMarks.push(t),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)}removePendingMark(e,t){for(let r=this.open;r>=0;r--){let i=this.nodes[r];if(i.pendingMarks.lastIndexOf(e)>-1)i.pendingMarks=e.removeFromSet(i.pendingMarks);else{i.activeMarks=e.removeFromSet(i.activeMarks);let s=i.popFromStashMark(e);s&&i.type&&i.type.allowsMarkType(s.type)&&(i.activeMarks=s.addToSet(i.activeMarks))}if(i==t)break}}};a(xd,"ParseContext");let wl=xd;function Ob(n){for(let e=n.firstChild,t=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&Wm.hasOwnProperty(r)&&t?(t.appendChild(e),e=t):r=="li"?t=e:r&&(t=null)}}a(Ob,"normalizeList");function _b(n,e){return(n.matches||n.msMatchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector).call(n,e)}a(_b,"matches");function Db(n){let e=/\s*([\w-]+)\s*:\s*([^;]+)/g,t,r=[];for(;t=e.exec(n);)r.push(t[1],t[2].trim());return r}a(Db,"parseStyles");function uf(n){let e={};for(let t in n)e[t]=n[t];return e}a(uf,"copy");function Rb(n,e){let t=e.schema.nodes;for(let r in t){let i=t[r];if(!i.allowsMarkType(n))continue;let o=[],s=a(l=>{o.push(l);for(let c=0;c<l.edgeCount;c++){let{type:u,next:h}=l.edge(c);if(u==e||o.indexOf(h)<0&&s(h))return!0}},"scan");if(s(i.contentMatch))return!0}}a(Rb,"markMayApply");function zb(n,e){for(let t=0;t<e.length;t++)if(n.eq(e[t]))return e[t]}a(zb,"findSameMarkInSet");const sr=class sr{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},r){r||(r=Sa(t).createDocumentFragment());let i=r,o=[];return e.forEach(s=>{if(o.length||s.marks.length){let l=0,c=0;for(;l<o.length&&c<s.marks.length;){let u=s.marks[c];if(!this.marks[u.type.name]){c++;continue}if(!u.eq(o[l][0])||u.type.spec.spanning===!1)break;l++,c++}for(;l<o.length;)i=o.pop()[1];for(;c<s.marks.length;){let u=s.marks[c++],h=this.serializeMark(u,s.isInline,t);h&&(o.push([u,i]),i.appendChild(h.dom),i=h.contentDOM||h.dom)}}i.appendChild(this.serializeNodeInner(s,t))}),r}serializeNodeInner(e,t){let{dom:r,contentDOM:i}=sr.renderSpec(Sa(t),this.nodes[e.type.name](e));if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,i)}return r}serializeNode(e,t={}){let r=this.serializeNodeInner(e,t);for(let i=e.marks.length-1;i>=0;i--){let o=this.serializeMark(e.marks[i],e.isInline,t);o&&((o.contentDOM||o.dom).appendChild(r),r=o.dom)}return r}serializeMark(e,t,r={}){let i=this.marks[e.type.name];return i&&sr.renderSpec(Sa(r),i(e,t))}static renderSpec(e,t,r=null){if(typeof t=="string")return{dom:e.createTextNode(t)};if(t.nodeType!=null)return{dom:t};if(t.dom&&t.dom.nodeType!=null)return t;let i=t[0],o=i.indexOf(" ");o>0&&(r=i.slice(0,o),i=i.slice(o+1));let s,l=r?e.createElementNS(r,i):e.createElement(i),c=t[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let h in c)if(c[h]!=null){let d=h.indexOf(" ");d>0?l.setAttributeNS(h.slice(0,d),h.slice(d+1),c[h]):l.setAttribute(h,c[h])}}for(let h=u;h<t.length;h++){let d=t[h];if(d===0){if(h<t.length-1||h>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:f,contentDOM:p}=sr.renderSpec(e,d,r);if(l.appendChild(f),p){if(s)throw new RangeError("Multiple content holes");s=p}}}return{dom:l,contentDOM:s}}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new sr(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=hf(e.nodes);return t.text||(t.text=r=>r.text),t}static marksFromSchema(e){return hf(e.marks)}};a(sr,"DOMSerializer");let Ir=sr;function hf(n){let e={};for(let t in n){let r=n[t].spec.toDOM;r&&(e[t]=r)}return e}a(hf,"gatherToDOM");function Sa(n){return n.document||window.document}a(Sa,"doc$2");const Pb={};function Fb(n,e){const t=e||Pb,r=typeof t.includeImageAlt=="boolean"?t.includeImageAlt:!0,i=typeof t.includeHtml=="boolean"?t.includeHtml:!0;return qm(n,r,i)}a(Fb,"toString$1");function qm(n,e,t){if(Lb(n)){if("value"in n)return n.type==="html"&&!t?"":n.value;if(e&&"alt"in n&&n.alt)return n.alt;if("children"in n)return df(n.children,e,t)}return Array.isArray(n)?df(n,e,t):""}a(qm,"one$1");function df(n,e,t){const r=[];let i=-1;for(;++i<n.length;)r[i]=qm(n[i],e,t);return r.join("")}a(df,"all$1");function Lb(n){return!!(n&&typeof n=="object")}a(Lb,"node$1");const ff=document.createElement("i");function Yl(n){const e="&"+n+";";ff.innerHTML=e;const t=ff.textContent;return t.charCodeAt(t.length-1)===59&&n!=="semi"||t===e?!1:t}a(Yl,"decodeNamedCharacterReference");function un(n,e,t,r){const i=n.length;let o=0,s;if(e<0?e=-e>i?0:i+e:e=e>i?i:e,t=t>0?t:0,r.length<1e4)s=Array.from(r),s.unshift(e,t),n.splice(...s);else for(t&&n.splice(e,t);o<r.length;)s=r.slice(o,o+1e4),s.unshift(e,0),n.splice(...s),o+=1e4,e+=1e4}a(un,"splice$2");function wt(n,e){return n.length>0?(un(n,n.length,0,e),n):e}a(wt,"push");const pf={}.hasOwnProperty;function Bb(n){const e={};let t=-1;for(;++t<n.length;)Hb(e,n[t]);return e}a(Bb,"combineExtensions$1");function Hb(n,e){let t;for(t in e){const i=(pf.call(n,t)?n[t]:void 0)||(n[t]={}),o=e[t];let s;if(o)for(s in o){pf.call(i,s)||(i[s]=[]);const l=o[s];jb(i[s],Array.isArray(l)?l:l?[l]:[])}}}a(Hb,"syntaxExtension$1");function jb(n,e){let t=-1;const r=[];for(;++t<e.length;)(e[t].add==="after"?n:r).push(e[t]);un(n,0,0,r)}a(jb,"constructs$1");function Km(n,e){const t=Number.parseInt(n,e);return t<9||t===11||t>13&&t<32||t>126&&t<160||t>55295&&t<57344||t>64975&&t<65008||(t&65535)===65535||(t&65535)===65534||t>1114111?"":String.fromCodePoint(t)}a(Km,"decodeNumericCharacterReference$1");function ri(n){return n.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}a(ri,"normalizeIdentifier$2");const Vt=Vn(/[A-Za-z]/),_t=Vn(/[\dA-Za-z]/),Vb=Vn(/[#-'*+\--9=?A-Z^-~]/);function Nc(n){return n!==null&&(n<32||n===127)}a(Nc,"asciiControl$1");const Mc=Vn(/\d/),Wb=Vn(/[\dA-Fa-f]/),qb=Vn(/[!-/:-@[-`{-~]/);function ee(n){return n!==null&&n<-2}a(ee,"markdownLineEnding$3");function st(n){return n!==null&&(n<0||n===32)}a(st,"markdownLineEndingOrSpace$5");function ye(n){return n===-2||n===-1||n===32}a(ye,"markdownSpace$3");const Kb=Vn(/\p{P}|\p{S}/u),Ub=Vn(/\s/);function Vn(n){return e;function e(t){return t!==null&&t>-1&&n.test(String.fromCharCode(t))}}a(Vn,"regexCheck$3");function ve(n,e,t,r){const i=r?r-1:Number.POSITIVE_INFINITY;let o=0;return s;function s(c){return ye(c)?(n.enter(t),l(c)):e(c)}function l(c){return ye(c)&&o++<i?(n.consume(c),l):(n.exit(t),e(c))}}a(ve,"factorySpace$3");const Jb={tokenize:Zb};function Zb(n){const e=n.attempt(this.parser.constructs.contentInitial,r,i);let t;return e;function r(l){if(l===null){n.consume(l);return}return n.enter("lineEnding"),n.consume(l),n.exit("lineEnding"),ve(n,e,"linePrefix")}function i(l){return n.enter("paragraph"),o(l)}function o(l){const c=n.enter("chunkText",{contentType:"text",previous:t});return t&&(t.next=c),t=c,s(l)}function s(l){if(l===null){n.exit("chunkText"),n.exit("paragraph"),n.consume(l);return}return ee(l)?(n.consume(l),n.exit("chunkText"),o):(n.consume(l),s)}}a(Zb,"initializeContent");const Gb={tokenize:Yb},mf={tokenize:Qb};function Yb(n){const e=this,t=[];let r=0,i,o,s;return l;function l(C){if(r<t.length){const N=t[r];return e.containerState=N[1],n.attempt(N[0].continuation,c,u)(C)}return u(C)}function c(C){if(r++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,i&&x();const N=e.events.length;let A=N,S;for(;A--;)if(e.events[A][0]==="exit"&&e.events[A][1].type==="chunkFlow"){S=e.events[A][1].end;break}b(r);let q=N;for(;q<e.events.length;)e.events[q][1].end=Object.assign({},S),q++;return un(e.events,A+1,0,e.events.slice(N)),e.events.length=q,u(C)}return l(C)}function u(C){if(r===t.length){if(!i)return f(C);if(i.currentConstruct&&i.currentConstruct.concrete)return m(C);e.interrupt=!!(i.currentConstruct&&!i._gfmTableDynamicInterruptHack)}return e.containerState={},n.check(mf,h,d)(C)}function h(C){return i&&x(),b(r),f(C)}function d(C){return e.parser.lazy[e.now().line]=r!==t.length,s=e.now().offset,m(C)}function f(C){return e.containerState={},n.attempt(mf,p,m)(C)}function p(C){return r++,t.push([e.currentConstruct,e.containerState]),f(C)}function m(C){if(C===null){i&&x(),b(0),n.consume(C);return}return i=i||e.parser.flow(e.now()),n.enter("chunkFlow",{contentType:"flow",previous:o,_tokenizer:i}),g(C)}function g(C){if(C===null){k(n.exit("chunkFlow"),!0),b(0),n.consume(C);return}return ee(C)?(n.consume(C),k(n.exit("chunkFlow")),r=0,e.interrupt=void 0,l):(n.consume(C),g)}function k(C,N){const A=e.sliceStream(C);if(N&&A.push(null),C.previous=o,o&&(o.next=C),o=C,i.defineSkip(C.start),i.write(A),e.parser.lazy[C.start.line]){let S=i.events.length;for(;S--;)if(i.events[S][1].start.offset<s&&(!i.events[S][1].end||i.events[S][1].end.offset>s))return;const q=e.events.length;let V=q,F,v;for(;V--;)if(e.events[V][0]==="exit"&&e.events[V][1].type==="chunkFlow"){if(F){v=e.events[V][1].end;break}F=!0}for(b(r),S=q;S<e.events.length;)e.events[S][1].end=Object.assign({},v),S++;un(e.events,V+1,0,e.events.slice(q)),e.events.length=S}}function b(C){let N=t.length;for(;N-- >C;){const A=t[N];e.containerState=A[1],A[0].exit.call(e,n)}t.length=C}function x(){i.write([null]),o=void 0,i=void 0,e.containerState._closeFlow=void 0}}a(Yb,"initializeDocument");function Qb(n,e,t){return ve(n,n.attempt(this.parser.constructs.document,e,t),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}a(Qb,"tokenizeContainer");function gf(n){if(n===null||st(n)||Ub(n))return 1;if(Kb(n))return 2}a(gf,"classifyCharacter$1");function zu(n,e,t){const r=[];let i=-1;for(;++i<n.length;){const o=n[i].resolveAll;o&&!r.includes(o)&&(e=o(e,t),r.push(o))}return e}a(zu,"resolveAll$1");const Tc={name:"attention",tokenize:e0,resolveAll:Xb};function Xb(n,e){let t=-1,r,i,o,s,l,c,u,h;for(;++t<n.length;)if(n[t][0]==="enter"&&n[t][1].type==="attentionSequence"&&n[t][1]._close){for(r=t;r--;)if(n[r][0]==="exit"&&n[r][1].type==="attentionSequence"&&n[r][1]._open&&e.sliceSerialize(n[r][1]).charCodeAt(0)===e.sliceSerialize(n[t][1]).charCodeAt(0)){if((n[r][1]._close||n[t][1]._open)&&(n[t][1].end.offset-n[t][1].start.offset)%3&&!((n[r][1].end.offset-n[r][1].start.offset+n[t][1].end.offset-n[t][1].start.offset)%3))continue;c=n[r][1].end.offset-n[r][1].start.offset>1&&n[t][1].end.offset-n[t][1].start.offset>1?2:1;const d=Object.assign({},n[r][1].end),f=Object.assign({},n[t][1].start);yf(d,-c),yf(f,c),s={type:c>1?"strongSequence":"emphasisSequence",start:d,end:Object.assign({},n[r][1].end)},l={type:c>1?"strongSequence":"emphasisSequence",start:Object.assign({},n[t][1].start),end:f},o={type:c>1?"strongText":"emphasisText",start:Object.assign({},n[r][1].end),end:Object.assign({},n[t][1].start)},i={type:c>1?"strong":"emphasis",start:Object.assign({},s.start),end:Object.assign({},l.end)},n[r][1].end=Object.assign({},s.start),n[t][1].start=Object.assign({},l.end),u=[],n[r][1].end.offset-n[r][1].start.offset&&(u=wt(u,[["enter",n[r][1],e],["exit",n[r][1],e]])),u=wt(u,[["enter",i,e],["enter",s,e],["exit",s,e],["enter",o,e]]),u=wt(u,zu(e.parser.constructs.insideSpan.null,n.slice(r+1,t),e)),u=wt(u,[["exit",o,e],["enter",l,e],["exit",l,e],["exit",i,e]]),n[t][1].end.offset-n[t][1].start.offset?(h=2,u=wt(u,[["enter",n[t][1],e],["exit",n[t][1],e]])):h=0,un(n,r-1,t-r+3,u),t=r+u.length-h-2;break}}for(t=-1;++t<n.length;)n[t][1].type==="attentionSequence"&&(n[t][1].type="data");return n}a(Xb,"resolveAllAttention");function e0(n,e){const t=this.parser.constructs.attentionMarkers.null,r=this.previous,i=gf(r);let o;return s;function s(c){return o=c,n.enter("attentionSequence"),l(c)}function l(c){if(c===o)return n.consume(c),l;const u=n.exit("attentionSequence"),h=gf(c),d=!h||h===2&&i||t.includes(c),f=!i||i===2&&h||t.includes(r);return u._open=!!(o===42?d:d&&(i||!f)),u._close=!!(o===42?f:f&&(h||!d)),e(c)}}a(e0,"tokenizeAttention");function yf(n,e){n.column+=e,n.offset+=e,n._bufferIndex+=e}a(yf,"movePoint");const t0={name:"autolink",tokenize:n0};function n0(n,e,t){let r=0;return i;function i(p){return n.enter("autolink"),n.enter("autolinkMarker"),n.consume(p),n.exit("autolinkMarker"),n.enter("autolinkProtocol"),o}function o(p){return Vt(p)?(n.consume(p),s):p===64?t(p):u(p)}function s(p){return p===43||p===45||p===46||_t(p)?(r=1,l(p)):u(p)}function l(p){return p===58?(n.consume(p),r=0,c):(p===43||p===45||p===46||_t(p))&&r++<32?(n.consume(p),l):(r=0,u(p))}function c(p){return p===62?(n.exit("autolinkProtocol"),n.enter("autolinkMarker"),n.consume(p),n.exit("autolinkMarker"),n.exit("autolink"),e):p===null||p===32||p===60||Nc(p)?t(p):(n.consume(p),c)}function u(p){return p===64?(n.consume(p),h):Vb(p)?(n.consume(p),u):t(p)}function h(p){return _t(p)?d(p):t(p)}function d(p){return p===46?(n.consume(p),r=0,h):p===62?(n.exit("autolinkProtocol").type="autolinkEmail",n.enter("autolinkMarker"),n.consume(p),n.exit("autolinkMarker"),n.exit("autolink"),e):f(p)}function f(p){if((p===45||_t(p))&&r++<63){const m=p===45?f:d;return n.consume(p),m}return t(p)}}a(n0,"tokenizeAutolink");const Ql={tokenize:r0,partial:!0};function r0(n,e,t){return r;function r(o){return ye(o)?ve(n,i,"linePrefix")(o):i(o)}function i(o){return o===null||ee(o)?e(o):t(o)}}a(r0,"tokenizeBlankLine$1");const Um={name:"blockQuote",tokenize:i0,continuation:{tokenize:o0},exit:s0};function i0(n,e,t){const r=this;return i;function i(s){if(s===62){const l=r.containerState;return l.open||(n.enter("blockQuote",{_container:!0}),l.open=!0),n.enter("blockQuotePrefix"),n.enter("blockQuoteMarker"),n.consume(s),n.exit("blockQuoteMarker"),o}return t(s)}function o(s){return ye(s)?(n.enter("blockQuotePrefixWhitespace"),n.consume(s),n.exit("blockQuotePrefixWhitespace"),n.exit("blockQuotePrefix"),e):(n.exit("blockQuotePrefix"),e(s))}}a(i0,"tokenizeBlockQuoteStart");function o0(n,e,t){const r=this;return i;function i(s){return ye(s)?ve(n,o,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(s):o(s)}function o(s){return n.attempt(Um,e,t)(s)}}a(o0,"tokenizeBlockQuoteContinuation");function s0(n){n.exit("blockQuote")}a(s0,"exit$1");const Jm={name:"characterEscape",tokenize:l0};function l0(n,e,t){return r;function r(o){return n.enter("characterEscape"),n.enter("escapeMarker"),n.consume(o),n.exit("escapeMarker"),i}function i(o){return qb(o)?(n.enter("characterEscapeValue"),n.consume(o),n.exit("characterEscapeValue"),n.exit("characterEscape"),e):t(o)}}a(l0,"tokenizeCharacterEscape");const Zm={name:"characterReference",tokenize:a0};function a0(n,e,t){const r=this;let i=0,o,s;return l;function l(d){return n.enter("characterReference"),n.enter("characterReferenceMarker"),n.consume(d),n.exit("characterReferenceMarker"),c}function c(d){return d===35?(n.enter("characterReferenceMarkerNumeric"),n.consume(d),n.exit("characterReferenceMarkerNumeric"),u):(n.enter("characterReferenceValue"),o=31,s=_t,h(d))}function u(d){return d===88||d===120?(n.enter("characterReferenceMarkerHexadecimal"),n.consume(d),n.exit("characterReferenceMarkerHexadecimal"),n.enter("characterReferenceValue"),o=6,s=Wb,h):(n.enter("characterReferenceValue"),o=7,s=Mc,h(d))}function h(d){if(d===59&&i){const f=n.exit("characterReferenceValue");return s===_t&&!Yl(r.sliceSerialize(f))?t(d):(n.enter("characterReferenceMarker"),n.consume(d),n.exit("characterReferenceMarker"),n.exit("characterReference"),e)}return s(d)&&i++<o?(n.consume(d),h):t(d)}}a(a0,"tokenizeCharacterReference");const kf={tokenize:u0,partial:!0},bf={name:"codeFenced",tokenize:c0,concrete:!0};function c0(n,e,t){const r=this,i={tokenize:A,partial:!0};let o=0,s=0,l;return c;function c(S){return u(S)}function u(S){const q=r.events[r.events.length-1];return o=q&&q[1].type==="linePrefix"?q[2].sliceSerialize(q[1],!0).length:0,l=S,n.enter("codeFenced"),n.enter("codeFencedFence"),n.enter("codeFencedFenceSequence"),h(S)}function h(S){return S===l?(s++,n.consume(S),h):s<3?t(S):(n.exit("codeFencedFenceSequence"),ye(S)?ve(n,d,"whitespace")(S):d(S))}function d(S){return S===null||ee(S)?(n.exit("codeFencedFence"),r.interrupt?e(S):n.check(kf,g,N)(S)):(n.enter("codeFencedFenceInfo"),n.enter("chunkString",{contentType:"string"}),f(S))}function f(S){return S===null||ee(S)?(n.exit("chunkString"),n.exit("codeFencedFenceInfo"),d(S)):ye(S)?(n.exit("chunkString"),n.exit("codeFencedFenceInfo"),ve(n,p,"whitespace")(S)):S===96&&S===l?t(S):(n.consume(S),f)}function p(S){return S===null||ee(S)?d(S):(n.enter("codeFencedFenceMeta"),n.enter("chunkString",{contentType:"string"}),m(S))}function m(S){return S===null||ee(S)?(n.exit("chunkString"),n.exit("codeFencedFenceMeta"),d(S)):S===96&&S===l?t(S):(n.consume(S),m)}function g(S){return n.attempt(i,N,k)(S)}function k(S){return n.enter("lineEnding"),n.consume(S),n.exit("lineEnding"),b}function b(S){return o>0&&ye(S)?ve(n,x,"linePrefix",o+1)(S):x(S)}function x(S){return S===null||ee(S)?n.check(kf,g,N)(S):(n.enter("codeFlowValue"),C(S))}function C(S){return S===null||ee(S)?(n.exit("codeFlowValue"),x(S)):(n.consume(S),C)}function N(S){return n.exit("codeFenced"),e(S)}function A(S,q,V){let F=0;return v;function v(se){return S.enter("lineEnding"),S.consume(se),S.exit("lineEnding"),j}function j(se){return S.enter("codeFencedFence"),ye(se)?ve(S,J,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(se):J(se)}function J(se){return se===l?(S.enter("codeFencedFenceSequence"),ce(se)):V(se)}function ce(se){return se===l?(F++,S.consume(se),ce):F>=s?(S.exit("codeFencedFenceSequence"),ye(se)?ve(S,pe,"whitespace")(se):pe(se)):V(se)}function pe(se){return se===null||ee(se)?(S.exit("codeFencedFence"),q(se)):V(se)}}}a(c0,"tokenizeCodeFenced");function u0(n,e,t){const r=this;return i;function i(s){return s===null?t(s):(n.enter("lineEnding"),n.consume(s),n.exit("lineEnding"),o)}function o(s){return r.parser.lazy[r.now().line]?t(s):e(s)}}a(u0,"tokenizeNonLazyContinuation");const va={name:"codeIndented",tokenize:d0},h0={tokenize:f0,partial:!0};function d0(n,e,t){const r=this;return i;function i(u){return n.enter("codeIndented"),ve(n,o,"linePrefix",4+1)(u)}function o(u){const h=r.events[r.events.length-1];return h&&h[1].type==="linePrefix"&&h[2].sliceSerialize(h[1],!0).length>=4?s(u):t(u)}function s(u){return u===null?c(u):ee(u)?n.attempt(h0,s,c)(u):(n.enter("codeFlowValue"),l(u))}function l(u){return u===null||ee(u)?(n.exit("codeFlowValue"),s(u)):(n.consume(u),l)}function c(u){return n.exit("codeIndented"),e(u)}}a(d0,"tokenizeCodeIndented");function f0(n,e,t){const r=this;return i;function i(s){return r.parser.lazy[r.now().line]?t(s):ee(s)?(n.enter("lineEnding"),n.consume(s),n.exit("lineEnding"),i):ve(n,o,"linePrefix",4+1)(s)}function o(s){const l=r.events[r.events.length-1];return l&&l[1].type==="linePrefix"&&l[2].sliceSerialize(l[1],!0).length>=4?e(s):ee(s)?i(s):t(s)}}a(f0,"tokenizeFurtherStart");const p0={name:"codeText",tokenize:y0,resolve:m0,previous:g0};function m0(n){let e=n.length-4,t=3,r,i;if((n[t][1].type==="lineEnding"||n[t][1].type==="space")&&(n[e][1].type==="lineEnding"||n[e][1].type==="space")){for(r=t;++r<e;)if(n[r][1].type==="codeTextData"){n[t][1].type="codeTextPadding",n[e][1].type="codeTextPadding",t+=2,e-=2;break}}for(r=t-1,e++;++r<=e;)i===void 0?r!==e&&n[r][1].type!=="lineEnding"&&(i=r):(r===e||n[r][1].type==="lineEnding")&&(n[i][1].type="codeTextData",r!==i+2&&(n[i][1].end=n[r-1][1].end,n.splice(i+2,r-i-2),e-=r-i-2,r=i+2),i=void 0);return n}a(m0,"resolveCodeText");function g0(n){return n!==96||this.events[this.events.length-1][1].type==="characterEscape"}a(g0,"previous$1");function y0(n,e,t){let r=0,i,o;return s;function s(d){return n.enter("codeText"),n.enter("codeTextSequence"),l(d)}function l(d){return d===96?(n.consume(d),r++,l):(n.exit("codeTextSequence"),c(d))}function c(d){return d===null?t(d):d===32?(n.enter("space"),n.consume(d),n.exit("space"),c):d===96?(o=n.enter("codeTextSequence"),i=0,h(d)):ee(d)?(n.enter("lineEnding"),n.consume(d),n.exit("lineEnding"),c):(n.enter("codeTextData"),u(d))}function u(d){return d===null||d===32||d===96||ee(d)?(n.exit("codeTextData"),c(d)):(n.consume(d),u)}function h(d){return d===96?(n.consume(d),i++,h):i===r?(n.exit("codeTextSequence"),n.exit("codeText"),e(d)):(o.type="codeTextData",u(d))}}a(y0,"tokenizeCodeText");const wd=class wd{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,t){const r=t??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(e,r):e>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(e,t,r){const i=t||0;this.setCursor(Math.trunc(e));const o=this.right.splice(this.right.length-i,Number.POSITIVE_INFINITY);return r&&zi(this.left,r),o.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),zi(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),zi(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const t=this.left.splice(e,Number.POSITIVE_INFINITY);zi(this.right,t.reverse())}else{const t=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);zi(this.left,t.reverse())}}};a(wd,"SpliceBuffer");let $c=wd;function zi(n,e){let t=0;if(e.length<1e4)n.push(...e);else for(;t<e.length;)n.push(...e.slice(t,t+1e4)),t+=1e4}a(zi,"chunkedPush");function Gm(n){const e={};let t=-1,r,i,o,s,l,c,u;const h=new $c(n);for(;++t<h.length;){for(;t in e;)t=e[t];if(r=h.get(t),t&&r[1].type==="chunkFlow"&&h.get(t-1)[1].type==="listItemPrefix"&&(c=r[1]._tokenizer.events,o=0,o<c.length&&c[o][1].type==="lineEndingBlank"&&(o+=2),o<c.length&&c[o][1].type==="content"))for(;++o<c.length&&c[o][1].type!=="content";)c[o][1].type==="chunkText"&&(c[o][1]._isInFirstContentOfListItem=!0,o++);if(r[0]==="enter")r[1].contentType&&(Object.assign(e,k0(h,t)),t=e[t],u=!0);else if(r[1]._container){for(o=t,i=void 0;o--&&(s=h.get(o),s[1].type==="lineEnding"||s[1].type==="lineEndingBlank");)s[0]==="enter"&&(i&&(h.get(i)[1].type="lineEndingBlank"),s[1].type="lineEnding",i=o);i&&(r[1].end=Object.assign({},h.get(i)[1].start),l=h.slice(i,t),l.unshift(r),h.splice(i,t-i+1,l))}}return un(n,0,Number.POSITIVE_INFINITY,h.slice(0)),!u}a(Gm,"subtokenize");function k0(n,e){const t=n.get(e)[1],r=n.get(e)[2];let i=e-1;const o=[],s=t._tokenizer||r.parser[t.contentType](t.start),l=s.events,c=[],u={};let h,d,f=-1,p=t,m=0,g=0;const k=[g];for(;p;){for(;n.get(++i)[1]!==p;);o.push(i),p._tokenizer||(h=r.sliceStream(p),p.next||h.push(null),d&&s.defineSkip(p.start),p._isInFirstContentOfListItem&&(s._gfmTasklistFirstContentOfListItem=!0),s.write(h),p._isInFirstContentOfListItem&&(s._gfmTasklistFirstContentOfListItem=void 0)),d=p,p=p.next}for(p=t;++f<l.length;)l[f][0]==="exit"&&l[f-1][0]==="enter"&&l[f][1].type===l[f-1][1].type&&l[f][1].start.line!==l[f][1].end.line&&(g=f+1,k.push(g),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(s.events=[],p?(p._tokenizer=void 0,p.previous=void 0):k.pop(),f=k.length;f--;){const b=l.slice(k[f],k[f+1]),x=o.pop();c.push([x,x+b.length-1]),n.splice(x,2,b)}for(c.reverse(),f=-1;++f<c.length;)u[m+c[f][0]]=m+c[f][1],m+=c[f][1]-c[f][0]-1;return u}a(k0,"subcontent");const b0={tokenize:C0,resolve:w0},x0={tokenize:S0,partial:!0};function w0(n){return Gm(n),n}a(w0,"resolveContent");function C0(n,e){let t;return r;function r(l){return n.enter("content"),t=n.enter("chunkContent",{contentType:"content"}),i(l)}function i(l){return l===null?o(l):ee(l)?n.check(x0,s,o)(l):(n.consume(l),i)}function o(l){return n.exit("chunkContent"),n.exit("content"),e(l)}function s(l){return n.consume(l),n.exit("chunkContent"),t.next=n.enter("chunkContent",{contentType:"content",previous:t}),t=t.next,i}}a(C0,"tokenizeContent");function S0(n,e,t){const r=this;return i;function i(s){return n.exit("chunkContent"),n.enter("lineEnding"),n.consume(s),n.exit("lineEnding"),ve(n,o,"linePrefix")}function o(s){if(s===null||ee(s))return t(s);const l=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&l&&l[1].type==="linePrefix"&&l[2].sliceSerialize(l[1],!0).length>=4?e(s):n.interrupt(r.parser.constructs.flow,t,e)(s)}}a(S0,"tokenizeContinuation");function Ym(n,e,t,r,i,o,s,l,c){const u=c||Number.POSITIVE_INFINITY;let h=0;return d;function d(b){return b===60?(n.enter(r),n.enter(i),n.enter(o),n.consume(b),n.exit(o),f):b===null||b===32||b===41||Nc(b)?t(b):(n.enter(r),n.enter(s),n.enter(l),n.enter("chunkString",{contentType:"string"}),g(b))}function f(b){return b===62?(n.enter(o),n.consume(b),n.exit(o),n.exit(i),n.exit(r),e):(n.enter(l),n.enter("chunkString",{contentType:"string"}),p(b))}function p(b){return b===62?(n.exit("chunkString"),n.exit(l),f(b)):b===null||b===60||ee(b)?t(b):(n.consume(b),b===92?m:p)}function m(b){return b===60||b===62||b===92?(n.consume(b),p):p(b)}function g(b){return!h&&(b===null||b===41||st(b))?(n.exit("chunkString"),n.exit(l),n.exit(s),n.exit(r),e(b)):h<u&&b===40?(n.consume(b),h++,g):b===41?(n.consume(b),h--,g):b===null||b===32||b===40||Nc(b)?t(b):(n.consume(b),b===92?k:g)}function k(b){return b===40||b===41||b===92?(n.consume(b),g):g(b)}}a(Ym,"factoryDestination");function Qm(n,e,t,r,i,o){const s=this;let l=0,c;return u;function u(p){return n.enter(r),n.enter(i),n.consume(p),n.exit(i),n.enter(o),h}function h(p){return l>999||p===null||p===91||p===93&&!c||p===94&&!l&&"_hiddenFootnoteSupport"in s.parser.constructs?t(p):p===93?(n.exit(o),n.enter(i),n.consume(p),n.exit(i),n.exit(r),e):ee(p)?(n.enter("lineEnding"),n.consume(p),n.exit("lineEnding"),h):(n.enter("chunkString",{contentType:"string"}),d(p))}function d(p){return p===null||p===91||p===93||ee(p)||l++>999?(n.exit("chunkString"),h(p)):(n.consume(p),c||(c=!ye(p)),p===92?f:d)}function f(p){return p===91||p===92||p===93?(n.consume(p),l++,d):d(p)}}a(Qm,"factoryLabel");function Xm(n,e,t,r,i,o){let s;return l;function l(f){return f===34||f===39||f===40?(n.enter(r),n.enter(i),n.consume(f),n.exit(i),s=f===40?41:f,c):t(f)}function c(f){return f===s?(n.enter(i),n.consume(f),n.exit(i),n.exit(r),e):(n.enter(o),u(f))}function u(f){return f===s?(n.exit(o),c(s)):f===null?t(f):ee(f)?(n.enter("lineEnding"),n.consume(f),n.exit("lineEnding"),ve(n,u,"linePrefix")):(n.enter("chunkString",{contentType:"string"}),h(f))}function h(f){return f===s||f===null||ee(f)?(n.exit("chunkString"),u(f)):(n.consume(f),f===92?d:h)}function d(f){return f===s||f===92?(n.consume(f),h):h(f)}}a(Xm,"factoryTitle");function ho(n,e){let t;return r;function r(i){return ee(i)?(n.enter("lineEnding"),n.consume(i),n.exit("lineEnding"),t=!0,r):ye(i)?ve(n,r,t?"linePrefix":"lineSuffix")(i):e(i)}}a(ho,"factoryWhitespace");const v0={name:"definition",tokenize:M0},N0={tokenize:T0,partial:!0};function M0(n,e,t){const r=this;let i;return o;function o(p){return n.enter("definition"),s(p)}function s(p){return Qm.call(r,n,l,t,"definitionLabel","definitionLabelMarker","definitionLabelString")(p)}function l(p){return i=ri(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),p===58?(n.enter("definitionMarker"),n.consume(p),n.exit("definitionMarker"),c):t(p)}function c(p){return st(p)?ho(n,u)(p):u(p)}function u(p){return Ym(n,h,t,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(p)}function h(p){return n.attempt(N0,d,d)(p)}function d(p){return ye(p)?ve(n,f,"whitespace")(p):f(p)}function f(p){return p===null||ee(p)?(n.exit("definition"),r.parser.defined.push(i),e(p)):t(p)}}a(M0,"tokenizeDefinition");function T0(n,e,t){return r;function r(l){return st(l)?ho(n,i)(l):t(l)}function i(l){return Xm(n,o,t,"definitionTitle","definitionTitleMarker","definitionTitleString")(l)}function o(l){return ye(l)?ve(n,s,"whitespace")(l):s(l)}function s(l){return l===null||ee(l)?e(l):t(l)}}a(T0,"tokenizeTitleBefore");const $0={name:"hardBreakEscape",tokenize:A0};function A0(n,e,t){return r;function r(o){return n.enter("hardBreakEscape"),n.consume(o),i}function i(o){return ee(o)?(n.exit("hardBreakEscape"),e(o)):t(o)}}a(A0,"tokenizeHardBreakEscape");const I0={name:"headingAtx",tokenize:O0,resolve:E0};function E0(n,e){let t=n.length-2,r=3,i,o;return n[r][1].type==="whitespace"&&(r+=2),t-2>r&&n[t][1].type==="whitespace"&&(t-=2),n[t][1].type==="atxHeadingSequence"&&(r===t-1||t-4>r&&n[t-2][1].type==="whitespace")&&(t-=r+1===t?2:4),t>r&&(i={type:"atxHeadingText",start:n[r][1].start,end:n[t][1].end},o={type:"chunkText",start:n[r][1].start,end:n[t][1].end,contentType:"text"},un(n,r,t-r+1,[["enter",i,e],["enter",o,e],["exit",o,e],["exit",i,e]])),n}a(E0,"resolveHeadingAtx");function O0(n,e,t){let r=0;return i;function i(h){return n.enter("atxHeading"),o(h)}function o(h){return n.enter("atxHeadingSequence"),s(h)}function s(h){return h===35&&r++<6?(n.consume(h),s):h===null||st(h)?(n.exit("atxHeadingSequence"),l(h)):t(h)}function l(h){return h===35?(n.enter("atxHeadingSequence"),c(h)):h===null||ee(h)?(n.exit("atxHeading"),e(h)):ye(h)?ve(n,l,"whitespace")(h):(n.enter("atxHeadingText"),u(h))}function c(h){return h===35?(n.consume(h),c):(n.exit("atxHeadingSequence"),l(h))}function u(h){return h===null||h===35||st(h)?(n.exit("atxHeadingText"),l(h)):(n.consume(h),u)}}a(O0,"tokenizeHeadingAtx");const _0=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],xf=["pre","script","style","textarea"],D0={name:"htmlFlow",tokenize:F0,resolveTo:P0,concrete:!0},R0={tokenize:B0,partial:!0},z0={tokenize:L0,partial:!0};function P0(n){let e=n.length;for(;e--&&!(n[e][0]==="enter"&&n[e][1].type==="htmlFlow"););return e>1&&n[e-2][1].type==="linePrefix"&&(n[e][1].start=n[e-2][1].start,n[e+1][1].start=n[e-2][1].start,n.splice(e-2,2)),n}a(P0,"resolveToHtmlFlow");function F0(n,e,t){const r=this;let i,o,s,l,c;return u;function u(y){return h(y)}function h(y){return n.enter("htmlFlow"),n.enter("htmlFlowData"),n.consume(y),d}function d(y){return y===33?(n.consume(y),f):y===47?(n.consume(y),o=!0,g):y===63?(n.consume(y),i=3,r.interrupt?e:w):Vt(y)?(n.consume(y),s=String.fromCharCode(y),k):t(y)}function f(y){return y===45?(n.consume(y),i=2,p):y===91?(n.consume(y),i=5,l=0,m):Vt(y)?(n.consume(y),i=4,r.interrupt?e:w):t(y)}function p(y){return y===45?(n.consume(y),r.interrupt?e:w):t(y)}function m(y){const _="CDATA[";return y===_.charCodeAt(l++)?(n.consume(y),l===_.length?r.interrupt?e:J:m):t(y)}function g(y){return Vt(y)?(n.consume(y),s=String.fromCharCode(y),k):t(y)}function k(y){if(y===null||y===47||y===62||st(y)){const _=y===47,z=s.toLowerCase();return!_&&!o&&xf.includes(z)?(i=1,r.interrupt?e(y):J(y)):_0.includes(s.toLowerCase())?(i=6,_?(n.consume(y),b):r.interrupt?e(y):J(y)):(i=7,r.interrupt&&!r.parser.lazy[r.now().line]?t(y):o?x(y):C(y))}return y===45||_t(y)?(n.consume(y),s+=String.fromCharCode(y),k):t(y)}function b(y){return y===62?(n.consume(y),r.interrupt?e:J):t(y)}function x(y){return ye(y)?(n.consume(y),x):v(y)}function C(y){return y===47?(n.consume(y),v):y===58||y===95||Vt(y)?(n.consume(y),N):ye(y)?(n.consume(y),C):v(y)}function N(y){return y===45||y===46||y===58||y===95||_t(y)?(n.consume(y),N):A(y)}function A(y){return y===61?(n.consume(y),S):ye(y)?(n.consume(y),A):C(y)}function S(y){return y===null||y===60||y===61||y===62||y===96?t(y):y===34||y===39?(n.consume(y),c=y,q):ye(y)?(n.consume(y),S):V(y)}function q(y){return y===c?(n.consume(y),c=null,F):y===null||ee(y)?t(y):(n.consume(y),q)}function V(y){return y===null||y===34||y===39||y===47||y===60||y===61||y===62||y===96||st(y)?A(y):(n.consume(y),V)}function F(y){return y===47||y===62||ye(y)?C(y):t(y)}function v(y){return y===62?(n.consume(y),j):t(y)}function j(y){return y===null||ee(y)?J(y):ye(y)?(n.consume(y),j):t(y)}function J(y){return y===45&&i===2?(n.consume(y),Ae):y===60&&i===1?(n.consume(y),Ne):y===62&&i===4?(n.consume(y),R):y===63&&i===3?(n.consume(y),w):y===93&&i===5?(n.consume(y),dt):ee(y)&&(i===6||i===7)?(n.exit("htmlFlowData"),n.check(R0,K,ce)(y)):y===null||ee(y)?(n.exit("htmlFlowData"),ce(y)):(n.consume(y),J)}function ce(y){return n.check(z0,pe,K)(y)}function pe(y){return n.enter("lineEnding"),n.consume(y),n.exit("lineEnding"),se}function se(y){return y===null||ee(y)?ce(y):(n.enter("htmlFlowData"),J(y))}function Ae(y){return y===45?(n.consume(y),w):J(y)}function Ne(y){return y===47?(n.consume(y),s="",Oe):J(y)}function Oe(y){if(y===62){const _=s.toLowerCase();return xf.includes(_)?(n.consume(y),R):J(y)}return Vt(y)&&s.length<8?(n.consume(y),s+=String.fromCharCode(y),Oe):J(y)}function dt(y){return y===93?(n.consume(y),w):J(y)}function w(y){return y===62?(n.consume(y),R):y===45&&i===2?(n.consume(y),w):J(y)}function R(y){return y===null||ee(y)?(n.exit("htmlFlowData"),K(y)):(n.consume(y),R)}function K(y){return n.exit("htmlFlow"),e(y)}}a(F0,"tokenizeHtmlFlow");function L0(n,e,t){const r=this;return i;function i(s){return ee(s)?(n.enter("lineEnding"),n.consume(s),n.exit("lineEnding"),o):t(s)}function o(s){return r.parser.lazy[r.now().line]?t(s):e(s)}}a(L0,"tokenizeNonLazyContinuationStart");function B0(n,e,t){return r;function r(i){return n.enter("lineEnding"),n.consume(i),n.exit("lineEnding"),n.attempt(Ql,e,t)}}a(B0,"tokenizeBlankLineBefore");const H0={name:"htmlText",tokenize:j0};function j0(n,e,t){const r=this;let i,o,s;return l;function l(w){return n.enter("htmlText"),n.enter("htmlTextData"),n.consume(w),c}function c(w){return w===33?(n.consume(w),u):w===47?(n.consume(w),A):w===63?(n.consume(w),C):Vt(w)?(n.consume(w),V):t(w)}function u(w){return w===45?(n.consume(w),h):w===91?(n.consume(w),o=0,m):Vt(w)?(n.consume(w),x):t(w)}function h(w){return w===45?(n.consume(w),p):t(w)}function d(w){return w===null?t(w):w===45?(n.consume(w),f):ee(w)?(s=d,Ne(w)):(n.consume(w),d)}function f(w){return w===45?(n.consume(w),p):d(w)}function p(w){return w===62?Ae(w):w===45?f(w):d(w)}function m(w){const R="CDATA[";return w===R.charCodeAt(o++)?(n.consume(w),o===R.length?g:m):t(w)}function g(w){return w===null?t(w):w===93?(n.consume(w),k):ee(w)?(s=g,Ne(w)):(n.consume(w),g)}function k(w){return w===93?(n.consume(w),b):g(w)}function b(w){return w===62?Ae(w):w===93?(n.consume(w),b):g(w)}function x(w){return w===null||w===62?Ae(w):ee(w)?(s=x,Ne(w)):(n.consume(w),x)}function C(w){return w===null?t(w):w===63?(n.consume(w),N):ee(w)?(s=C,Ne(w)):(n.consume(w),C)}function N(w){return w===62?Ae(w):C(w)}function A(w){return Vt(w)?(n.consume(w),S):t(w)}function S(w){return w===45||_t(w)?(n.consume(w),S):q(w)}function q(w){return ee(w)?(s=q,Ne(w)):ye(w)?(n.consume(w),q):Ae(w)}function V(w){return w===45||_t(w)?(n.consume(w),V):w===47||w===62||st(w)?F(w):t(w)}function F(w){return w===47?(n.consume(w),Ae):w===58||w===95||Vt(w)?(n.consume(w),v):ee(w)?(s=F,Ne(w)):ye(w)?(n.consume(w),F):Ae(w)}function v(w){return w===45||w===46||w===58||w===95||_t(w)?(n.consume(w),v):j(w)}function j(w){return w===61?(n.consume(w),J):ee(w)?(s=j,Ne(w)):ye(w)?(n.consume(w),j):F(w)}function J(w){return w===null||w===60||w===61||w===62||w===96?t(w):w===34||w===39?(n.consume(w),i=w,ce):ee(w)?(s=J,Ne(w)):ye(w)?(n.consume(w),J):(n.consume(w),pe)}function ce(w){return w===i?(n.consume(w),i=void 0,se):w===null?t(w):ee(w)?(s=ce,Ne(w)):(n.consume(w),ce)}function pe(w){return w===null||w===34||w===39||w===60||w===61||w===96?t(w):w===47||w===62||st(w)?F(w):(n.consume(w),pe)}function se(w){return w===47||w===62||st(w)?F(w):t(w)}function Ae(w){return w===62?(n.consume(w),n.exit("htmlTextData"),n.exit("htmlText"),e):t(w)}function Ne(w){return n.exit("htmlTextData"),n.enter("lineEnding"),n.consume(w),n.exit("lineEnding"),Oe}function Oe(w){return ye(w)?ve(n,dt,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(w):dt(w)}function dt(w){return n.enter("htmlTextData"),s(w)}}a(j0,"tokenizeHtmlText");const Pu={name:"labelEnd",tokenize:J0,resolveTo:U0,resolveAll:K0},V0={tokenize:Z0},W0={tokenize:G0},q0={tokenize:Y0};function K0(n){let e=-1;for(;++e<n.length;){const t=n[e][1];(t.type==="labelImage"||t.type==="labelLink"||t.type==="labelEnd")&&(n.splice(e+1,t.type==="labelImage"?4:2),t.type="data",e++)}return n}a(K0,"resolveAllLabelEnd");function U0(n,e){let t=n.length,r=0,i,o,s,l;for(;t--;)if(i=n[t][1],o){if(i.type==="link"||i.type==="labelLink"&&i._inactive)break;n[t][0]==="enter"&&i.type==="labelLink"&&(i._inactive=!0)}else if(s){if(n[t][0]==="enter"&&(i.type==="labelImage"||i.type==="labelLink")&&!i._balanced&&(o=t,i.type!=="labelLink")){r=2;break}}else i.type==="labelEnd"&&(s=t);const c={type:n[o][1].type==="labelLink"?"link":"image",start:Object.assign({},n[o][1].start),end:Object.assign({},n[n.length-1][1].end)},u={type:"label",start:Object.assign({},n[o][1].start),end:Object.assign({},n[s][1].end)},h={type:"labelText",start:Object.assign({},n[o+r+2][1].end),end:Object.assign({},n[s-2][1].start)};return l=[["enter",c,e],["enter",u,e]],l=wt(l,n.slice(o+1,o+r+3)),l=wt(l,[["enter",h,e]]),l=wt(l,zu(e.parser.constructs.insideSpan.null,n.slice(o+r+4,s-3),e)),l=wt(l,[["exit",h,e],n[s-2],n[s-1],["exit",u,e]]),l=wt(l,n.slice(s+1)),l=wt(l,[["exit",c,e]]),un(n,o,n.length,l),n}a(U0,"resolveToLabelEnd");function J0(n,e,t){const r=this;let i=r.events.length,o,s;for(;i--;)if((r.events[i][1].type==="labelImage"||r.events[i][1].type==="labelLink")&&!r.events[i][1]._balanced){o=r.events[i][1];break}return l;function l(f){return o?o._inactive?d(f):(s=r.parser.defined.includes(ri(r.sliceSerialize({start:o.end,end:r.now()}))),n.enter("labelEnd"),n.enter("labelMarker"),n.consume(f),n.exit("labelMarker"),n.exit("labelEnd"),c):t(f)}function c(f){return f===40?n.attempt(V0,h,s?h:d)(f):f===91?n.attempt(W0,h,s?u:d)(f):s?h(f):d(f)}function u(f){return n.attempt(q0,h,d)(f)}function h(f){return e(f)}function d(f){return o._balanced=!0,t(f)}}a(J0,"tokenizeLabelEnd");function Z0(n,e,t){return r;function r(d){return n.enter("resource"),n.enter("resourceMarker"),n.consume(d),n.exit("resourceMarker"),i}function i(d){return st(d)?ho(n,o)(d):o(d)}function o(d){return d===41?h(d):Ym(n,s,l,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(d)}function s(d){return st(d)?ho(n,c)(d):h(d)}function l(d){return t(d)}function c(d){return d===34||d===39||d===40?Xm(n,u,t,"resourceTitle","resourceTitleMarker","resourceTitleString")(d):h(d)}function u(d){return st(d)?ho(n,h)(d):h(d)}function h(d){return d===41?(n.enter("resourceMarker"),n.consume(d),n.exit("resourceMarker"),n.exit("resource"),e):t(d)}}a(Z0,"tokenizeResource");function G0(n,e,t){const r=this;return i;function i(l){return Qm.call(r,n,o,s,"reference","referenceMarker","referenceString")(l)}function o(l){return r.parser.defined.includes(ri(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?e(l):t(l)}function s(l){return t(l)}}a(G0,"tokenizeReferenceFull");function Y0(n,e,t){return r;function r(o){return n.enter("reference"),n.enter("referenceMarker"),n.consume(o),n.exit("referenceMarker"),i}function i(o){return o===93?(n.enter("referenceMarker"),n.consume(o),n.exit("referenceMarker"),n.exit("reference"),e):t(o)}}a(Y0,"tokenizeReferenceCollapsed");const Q0={name:"labelStartImage",tokenize:X0,resolveAll:Pu.resolveAll};function X0(n,e,t){const r=this;return i;function i(l){return n.enter("labelImage"),n.enter("labelImageMarker"),n.consume(l),n.exit("labelImageMarker"),o}function o(l){return l===91?(n.enter("labelMarker"),n.consume(l),n.exit("labelMarker"),n.exit("labelImage"),s):t(l)}function s(l){return l===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(l):e(l)}}a(X0,"tokenizeLabelStartImage");const ex={name:"labelStartLink",tokenize:tx,resolveAll:Pu.resolveAll};function tx(n,e,t){const r=this;return i;function i(s){return n.enter("labelLink"),n.enter("labelMarker"),n.consume(s),n.exit("labelMarker"),n.exit("labelLink"),o}function o(s){return s===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(s):e(s)}}a(tx,"tokenizeLabelStartLink");const Na={name:"lineEnding",tokenize:nx};function nx(n,e){return t;function t(r){return n.enter("lineEnding"),n.consume(r),n.exit("lineEnding"),ve(n,e,"linePrefix")}}a(nx,"tokenizeLineEnding");const Hs={name:"thematicBreak",tokenize:rx};function rx(n,e,t){let r=0,i;return o;function o(u){return n.enter("thematicBreak"),s(u)}function s(u){return i=u,l(u)}function l(u){return u===i?(n.enter("thematicBreakSequence"),c(u)):r>=3&&(u===null||ee(u))?(n.exit("thematicBreak"),e(u)):t(u)}function c(u){return u===i?(n.consume(u),r++,c):(n.exit("thematicBreakSequence"),ye(u)?ve(n,l,"whitespace")(u):l(u))}}a(rx,"tokenizeThematicBreak");const it={name:"list",tokenize:sx,continuation:{tokenize:lx},exit:cx},ix={tokenize:ux,partial:!0},ox={tokenize:ax,partial:!0};function sx(n,e,t){const r=this,i=r.events[r.events.length-1];let o=i&&i[1].type==="linePrefix"?i[2].sliceSerialize(i[1],!0).length:0,s=0;return l;function l(p){const m=r.containerState.type||(p===42||p===43||p===45?"listUnordered":"listOrdered");if(m==="listUnordered"?!r.containerState.marker||p===r.containerState.marker:Mc(p)){if(r.containerState.type||(r.containerState.type=m,n.enter(m,{_container:!0})),m==="listUnordered")return n.enter("listItemPrefix"),p===42||p===45?n.check(Hs,t,u)(p):u(p);if(!r.interrupt||p===49)return n.enter("listItemPrefix"),n.enter("listItemValue"),c(p)}return t(p)}function c(p){return Mc(p)&&++s<10?(n.consume(p),c):(!r.interrupt||s<2)&&(r.containerState.marker?p===r.containerState.marker:p===41||p===46)?(n.exit("listItemValue"),u(p)):t(p)}function u(p){return n.enter("listItemMarker"),n.consume(p),n.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||p,n.check(Ql,r.interrupt?t:h,n.attempt(ix,f,d))}function h(p){return r.containerState.initialBlankLine=!0,o++,f(p)}function d(p){return ye(p)?(n.enter("listItemPrefixWhitespace"),n.consume(p),n.exit("listItemPrefixWhitespace"),f):t(p)}function f(p){return r.containerState.size=o+r.sliceSerialize(n.exit("listItemPrefix"),!0).length,e(p)}}a(sx,"tokenizeListStart");function lx(n,e,t){const r=this;return r.containerState._closeFlow=void 0,n.check(Ql,i,o);function i(l){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,ve(n,e,"listItemIndent",r.containerState.size+1)(l)}a(i,"onBlank");function o(l){return r.containerState.furtherBlankLines||!ye(l)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,s(l)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,n.attempt(ox,e,s)(l))}a(o,"notBlank");function s(l){return r.containerState._closeFlow=!0,r.interrupt=void 0,ve(n,n.attempt(it,e,t),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(l)}a(s,"notInCurrentItem")}a(lx,"tokenizeListContinuation");function ax(n,e,t){const r=this;return ve(n,i,"listItemIndent",r.containerState.size+1);function i(o){const s=r.events[r.events.length-1];return s&&s[1].type==="listItemIndent"&&s[2].sliceSerialize(s[1],!0).length===r.containerState.size?e(o):t(o)}}a(ax,"tokenizeIndent$1");function cx(n){n.exit(this.containerState.type)}a(cx,"tokenizeListEnd");function ux(n,e,t){const r=this;return ve(n,i,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4+1);function i(o){const s=r.events[r.events.length-1];return!ye(o)&&s&&s[1].type==="listItemPrefixWhitespace"?e(o):t(o)}}a(ux,"tokenizeListItemPrefixWhitespace");const wf={name:"setextUnderline",tokenize:dx,resolveTo:hx};function hx(n,e){let t=n.length,r,i,o;for(;t--;)if(n[t][0]==="enter"){if(n[t][1].type==="content"){r=t;break}n[t][1].type==="paragraph"&&(i=t)}else n[t][1].type==="content"&&n.splice(t,1),!o&&n[t][1].type==="definition"&&(o=t);const s={type:"setextHeading",start:Object.assign({},n[i][1].start),end:Object.assign({},n[n.length-1][1].end)};return n[i][1].type="setextHeadingText",o?(n.splice(i,0,["enter",s,e]),n.splice(o+1,0,["exit",n[r][1],e]),n[r][1].end=Object.assign({},n[o][1].end)):n[r][1]=s,n.push(["exit",s,e]),n}a(hx,"resolveToSetextUnderline");function dx(n,e,t){const r=this;let i;return o;function o(u){let h=r.events.length,d;for(;h--;)if(r.events[h][1].type!=="lineEnding"&&r.events[h][1].type!=="linePrefix"&&r.events[h][1].type!=="content"){d=r.events[h][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||d)?(n.enter("setextHeadingLine"),i=u,s(u)):t(u)}function s(u){return n.enter("setextHeadingLineSequence"),l(u)}function l(u){return u===i?(n.consume(u),l):(n.exit("setextHeadingLineSequence"),ye(u)?ve(n,c,"lineSuffix")(u):c(u))}function c(u){return u===null||ee(u)?(n.exit("setextHeadingLine"),e(u)):t(u)}}a(dx,"tokenizeSetextUnderline");const fx={tokenize:px};function px(n){const e=this,t=n.attempt(Ql,r,n.attempt(this.parser.constructs.flowInitial,i,ve(n,n.attempt(this.parser.constructs.flow,i,n.attempt(b0,i)),"linePrefix")));return t;function r(o){if(o===null){n.consume(o);return}return n.enter("lineEndingBlank"),n.consume(o),n.exit("lineEndingBlank"),e.currentConstruct=void 0,t}function i(o){if(o===null){n.consume(o);return}return n.enter("lineEnding"),n.consume(o),n.exit("lineEnding"),e.currentConstruct=void 0,t}}a(px,"initializeFlow");const mx={resolveAll:tg()},gx=eg("string"),yx=eg("text");function eg(n){return{tokenize:e,resolveAll:tg(n==="text"?kx:void 0)};function e(t){const r=this,i=this.parser.constructs[n],o=t.attempt(i,s,l);return s;function s(h){return u(h)?o(h):l(h)}function l(h){if(h===null){t.consume(h);return}return t.enter("data"),t.consume(h),c}function c(h){return u(h)?(t.exit("data"),o(h)):(t.consume(h),c)}function u(h){if(h===null)return!0;const d=i[h];let f=-1;if(d)for(;++f<d.length;){const p=d[f];if(!p.previous||p.previous.call(r,r.previous))return!0}return!1}}}a(eg,"initializeFactory");function tg(n){return e;function e(t,r){let i=-1,o;for(;++i<=t.length;)o===void 0?t[i]&&t[i][1].type==="data"&&(o=i,i++):(!t[i]||t[i][1].type!=="data")&&(i!==o+2&&(t[o][1].end=t[i-1][1].end,t.splice(o+2,i-o-2),i=o+2),o=void 0);return n?n(t,r):t}}a(tg,"createResolver");function kx(n,e){let t=0;for(;++t<=n.length;)if((t===n.length||n[t][1].type==="lineEnding")&&n[t-1][1].type==="data"){const r=n[t-1][1],i=e.sliceStream(r);let o=i.length,s=-1,l=0,c;for(;o--;){const u=i[o];if(typeof u=="string"){for(s=u.length;u.charCodeAt(s-1)===32;)l++,s--;if(s)break;s=-1}else if(u===-2)c=!0,l++;else if(u!==-1){o++;break}}if(l){const u={type:t===n.length||c||l<2?"lineSuffix":"hardBreakTrailing",start:{line:r.end.line,column:r.end.column-l,offset:r.end.offset-l,_index:r.start._index+o,_bufferIndex:o?s:r.start._bufferIndex+s},end:Object.assign({},r.end)};r.end=Object.assign({},u.start),r.start.offset===r.end.offset?Object.assign(r,u):(n.splice(t,0,["enter",u,e],["exit",u,e]),t+=2)}t++}return n}a(kx,"resolveAllLineSuffixes");function bx(n,e,t){let r=Object.assign(t?Object.assign({},t):{line:1,column:1,offset:0},{_index:0,_bufferIndex:-1});const i={},o=[];let s=[],l=[];const c={consume:x,enter:C,exit:N,attempt:q(A),check:q(S),interrupt:q(S,{interrupt:!0})},u={previous:null,code:null,containerState:{},events:[],parser:n,sliceStream:p,sliceSerialize:f,now:m,defineSkip:g,write:d};let h=e.tokenize.call(u,c);return e.resolveAll&&o.push(e),u;function d(j){return s=wt(s,j),k(),s[s.length-1]!==null?[]:(V(e,0),u.events=zu(o,u.events,u),u.events)}a(d,"write");function f(j,J){return wx(p(j),J)}a(f,"sliceSerialize");function p(j){return xx(s,j)}a(p,"sliceStream");function m(){const{line:j,column:J,offset:ce,_index:pe,_bufferIndex:se}=r;return{line:j,column:J,offset:ce,_index:pe,_bufferIndex:se}}a(m,"now");function g(j){i[j.line]=j.column,v()}a(g,"defineSkip");function k(){let j;for(;r._index<s.length;){const J=s[r._index];if(typeof J=="string")for(j=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===j&&r._bufferIndex<J.length;)b(J.charCodeAt(r._bufferIndex));else b(J)}}a(k,"main");function b(j){h=h(j)}a(b,"go");function x(j){ee(j)?(r.line++,r.column=1,r.offset+=j===-3?2:1,v()):j!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===s[r._index].length&&(r._bufferIndex=-1,r._index++)),u.previous=j}a(x,"consume");function C(j,J){const ce=J||{};return ce.type=j,ce.start=m(),u.events.push(["enter",ce,u]),l.push(ce),ce}a(C,"enter");function N(j){const J=l.pop();return J.end=m(),u.events.push(["exit",J,u]),J}a(N,"exit");function A(j,J){V(j,J.from)}a(A,"onsuccessfulconstruct");function S(j,J){J.restore()}a(S,"onsuccessfulcheck");function q(j,J){return ce;function ce(pe,se,Ae){let Ne,Oe,dt,w;return Array.isArray(pe)?K(pe):"tokenize"in pe?K([pe]):R(pe);function R(D){return B;function B(I){const M=I!==null&&D[I],L=I!==null&&D.null,Z=[...Array.isArray(M)?M:M?[M]:[],...Array.isArray(L)?L:L?[L]:[]];return K(Z)(I)}}function K(D){return Ne=D,Oe=0,D.length===0?Ae:y(D[Oe])}function y(D){return B;function B(I){return w=F(),dt=D,D.partial||(u.currentConstruct=D),D.name&&u.parser.constructs.disable.null.includes(D.name)?z():D.tokenize.call(J?Object.assign(Object.create(u),J):u,c,_,z)(I)}}function _(D){return j(dt,w),se}function z(D){return w.restore(),++Oe<Ne.length?y(Ne[Oe]):Ae}}}a(q,"constructFactory");function V(j,J){j.resolveAll&&!o.includes(j)&&o.push(j),j.resolve&&un(u.events,J,u.events.length-J,j.resolve(u.events.slice(J),u)),j.resolveTo&&(u.events=j.resolveTo(u.events,u))}a(V,"addResult");function F(){const j=m(),J=u.previous,ce=u.currentConstruct,pe=u.events.length,se=Array.from(l);return{restore:Ae,from:pe};function Ae(){r=j,u.previous=J,u.currentConstruct=ce,u.events.length=pe,l=se,v()}}a(F,"store");function v(){r.line in i&&r.column<2&&(r.column=i[r.line],r.offset+=i[r.line]-1)}a(v,"accountForPotentialSkip")}a(bx,"createTokenizer");function xx(n,e){const t=e.start._index,r=e.start._bufferIndex,i=e.end._index,o=e.end._bufferIndex;let s;if(t===i)s=[n[t].slice(r,o)];else{if(s=n.slice(t,i),r>-1){const l=s[0];typeof l=="string"?s[0]=l.slice(r):s.shift()}o>0&&s.push(n[i].slice(0,o))}return s}a(xx,"sliceChunks");function wx(n,e){let t=-1;const r=[];let i;for(;++t<n.length;){const o=n[t];let s;if(typeof o=="string")s=o;else switch(o){case-5:{s="\r";break}case-4:{s=`
`;break}case-3:{s=`\r
`;break}case-2:{s=e?" ":"	";break}case-1:{if(!e&&i)continue;s=" ";break}default:s=String.fromCharCode(o)}i=o===-2,r.push(s)}return r.join("")}a(wx,"serializeChunks");const Cx={42:it,43:it,45:it,48:it,49:it,50:it,51:it,52:it,53:it,54:it,55:it,56:it,57:it,62:Um},Sx={91:v0},vx={[-2]:va,[-1]:va,32:va},Nx={35:I0,42:Hs,45:[wf,Hs],60:D0,61:wf,95:Hs,96:bf,126:bf},Mx={38:Zm,92:Jm},Tx={[-5]:Na,[-4]:Na,[-3]:Na,33:Q0,38:Zm,42:Tc,60:[t0,H0],91:ex,92:[$0,Jm],93:Pu,95:Tc,96:p0},$x={null:[Tc,mx]},Ax={null:[42,95]},Ix={null:[]},Ex=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:Ax,contentInitial:Sx,disable:Ix,document:Cx,flow:Nx,flowInitial:vx,insideSpan:$x,string:Mx,text:Tx},Symbol.toStringTag,{value:"Module"}));function Ox(n){const t=Bb([Ex,...(n||{}).extensions||[]]),r={defined:[],lazy:{},constructs:t,content:i(Jb),document:i(Gb),flow:i(fx),string:i(gx),text:i(yx)};return r;function i(o){return s;function s(l){return bx(r,o,l)}}}a(Ox,"parse");function _x(n){for(;!Gm(n););return n}a(_x,"postprocess");const Cf=/[\0\t\n\r]/g;function Dx(){let n=1,e="",t=!0,r;return i;function i(o,s,l){const c=[];let u,h,d,f,p;for(o=e+(typeof o=="string"?o.toString():new TextDecoder(s||void 0).decode(o)),d=0,e="",t&&(o.charCodeAt(0)===65279&&d++,t=void 0);d<o.length;){if(Cf.lastIndex=d,u=Cf.exec(o),f=u&&u.index!==void 0?u.index:o.length,p=o.charCodeAt(f),!u){e=o.slice(d);break}if(p===10&&d===f&&r)c.push(-3),r=void 0;else switch(r&&(c.push(-5),r=void 0),d<f&&(c.push(o.slice(d,f)),n+=f-d),p){case 0:{c.push(65533),n++;break}case 9:{for(h=Math.ceil(n/4)*4,c.push(-2);n++<h;)c.push(-1);break}case 10:{c.push(-4),n=1;break}default:r=!0,n=1}d=f+1}return l&&(r&&c.push(-5),e&&c.push(e),c.push(null)),c}}a(Dx,"preprocess");const Rx=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function zx(n){return n.replace(Rx,Px)}a(zx,"decodeString$1");function Px(n,e,t){if(e)return e;if(t.charCodeAt(0)===35){const i=t.charCodeAt(1),o=i===120||i===88;return Km(t.slice(o?2:1),o?16:10)}return Yl(t)||n}a(Px,"decode$1");function js(n){return!n||typeof n!="object"?"":"position"in n||"type"in n?Sf(n.position):"start"in n||"end"in n?Sf(n):"line"in n||"column"in n?Ac(n):""}a(js,"stringifyPosition$1");function Ac(n){return vf(n&&n.line)+":"+vf(n&&n.column)}a(Ac,"point$2");function Sf(n){return Ac(n&&n.start)+"-"+Ac(n&&n.end)}a(Sf,"position$1");function vf(n){return n&&typeof n=="number"?n:1}a(vf,"index$1");const ng={}.hasOwnProperty;function Fx(n,e,t){return typeof e!="string"&&(t=e,e=void 0),Lx(t)(_x(Ox(t).document().write(Dx()(n,e,!0))))}a(Fx,"fromMarkdown");function Lx(n){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:o(Zn),autolinkProtocol:F,autolinkEmail:F,atxHeading:o(Fe),blockQuote:o(M),characterEscape:F,characterReference:F,codeFenced:o(L),codeFencedFenceInfo:s,codeFencedFenceMeta:s,codeIndented:o(L,s),codeText:o(Z,s),codeTextData:F,data:F,codeFlowValue:F,definition:o(X),definitionDestinationString:s,definitionLabelString:s,definitionTitleString:s,emphasis:o(_e),hardBreakEscape:o(Ye),hardBreakTrailing:o(Ye),htmlFlow:o(Jn,s),htmlFlowData:F,htmlText:o(Jn,s),htmlTextData:F,image:o(kt),label:s,link:o(Zn),listItem:o(hk),listItemValue:f,listOrdered:o(Ss,d),listUnordered:o(Ss),paragraph:o(dk),reference:y,referenceString:s,resourceDestinationString:s,resourceTitleString:s,setextHeading:o(Fe),strong:o(fk),thematicBreak:o(mk)},exit:{atxHeading:c(),atxHeadingSequence:A,autolink:c(),autolinkEmail:I,autolinkProtocol:B,blockQuote:c(),characterEscapeValue:v,characterReferenceMarkerHexadecimal:z,characterReferenceMarkerNumeric:z,characterReferenceValue:D,codeFenced:c(k),codeFencedFence:g,codeFencedFenceInfo:p,codeFencedFenceMeta:m,codeFlowValue:v,codeIndented:c(b),codeText:c(se),codeTextData:v,data:v,definition:c(),definitionDestinationString:N,definitionLabelString:x,definitionTitleString:C,emphasis:c(),hardBreakEscape:c(J),hardBreakTrailing:c(J),htmlFlow:c(ce),htmlFlowData:v,htmlText:c(pe),htmlTextData:v,image:c(Ne),label:dt,labelText:Oe,lineEnding:j,link:c(Ae),listItem:c(),listOrdered:c(),listUnordered:c(),paragraph:c(),referenceString:_,resourceDestinationString:w,resourceTitleString:R,resource:K,setextHeading:c(V),setextHeadingLineSequence:q,setextHeadingText:S,strong:c(),thematicBreak:c()}};rg(e,(n||{}).mdastExtensions||[]);const t={};return r;function r($){let W={type:"root",children:[]};const ie={stack:[W],tokenStack:[],config:e,enter:l,exit:u,buffer:s,resume:h,data:t},ue=[];let we=-1;for(;++we<$.length;)if($[we][1].type==="listOrdered"||$[we][1].type==="listUnordered")if($[we][0]==="enter")ue.push(we);else{const At=ue.pop();we=i($,At,we)}for(we=-1;++we<$.length;){const At=e[$[we][0]];ng.call(At,$[we][1].type)&&At[$[we][1].type].call(Object.assign({sliceSerialize:$[we][2].sliceSerialize},ie),$[we][1])}if(ie.tokenStack.length>0){const At=ie.tokenStack[ie.tokenStack.length-1];(At[1]||Nf).call(ie,void 0,At[0])}for(W.position={start:kn($.length>0?$[0][1].start:{line:1,column:1,offset:0}),end:kn($.length>0?$[$.length-2][1].end:{line:1,column:1,offset:0})},we=-1;++we<e.transforms.length;)W=e.transforms[we](W)||W;return W}function i($,W,ie){let ue=W-1,we=-1,At=!1,Gn,Qt,Ei,Oi;for(;++ue<=ie;){const ft=$[ue];switch(ft[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{ft[0]==="enter"?we++:we--,Oi=void 0;break}case"lineEndingBlank":{ft[0]==="enter"&&(Gn&&!Oi&&!we&&!Ei&&(Ei=ue),Oi=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:Oi=void 0}if(!we&&ft[0]==="enter"&&ft[1].type==="listItemPrefix"||we===-1&&ft[0]==="exit"&&(ft[1].type==="listUnordered"||ft[1].type==="listOrdered")){if(Gn){let Pr=ue;for(Qt=void 0;Pr--;){const Xt=$[Pr];if(Xt[1].type==="lineEnding"||Xt[1].type==="lineEndingBlank"){if(Xt[0]==="exit")continue;Qt&&($[Qt][1].type="lineEndingBlank",At=!0),Xt[1].type="lineEnding",Qt=Pr}else if(!(Xt[1].type==="linePrefix"||Xt[1].type==="blockQuotePrefix"||Xt[1].type==="blockQuotePrefixWhitespace"||Xt[1].type==="blockQuoteMarker"||Xt[1].type==="listItemIndent"))break}Ei&&(!Qt||Ei<Qt)&&(Gn._spread=!0),Gn.end=Object.assign({},Qt?$[Qt][1].start:ft[1].end),$.splice(Qt||ue,0,["exit",Gn,ft[2]]),ue++,ie++}if(ft[1].type==="listItemPrefix"){const Pr={type:"listItem",_spread:!1,start:Object.assign({},ft[1].start),end:void 0};Gn=Pr,$.splice(ue,0,["enter",Pr,ft[2]]),ue++,ie++,Ei=void 0,Oi=!0}}}return $[W][1]._spread=At,ie}function o($,W){return ie;function ie(ue){l.call(this,$(ue),ue),W&&W.call(this,ue)}}function s(){this.stack.push({type:"fragment",children:[]})}function l($,W,ie){this.stack[this.stack.length-1].children.push($),this.stack.push($),this.tokenStack.push([W,ie]),$.position={start:kn(W.start),end:void 0}}function c($){return W;function W(ie){$&&$.call(this,ie),u.call(this,ie)}}function u($,W){const ie=this.stack.pop(),ue=this.tokenStack.pop();if(ue)ue[0].type!==$.type&&(W?W.call(this,$,ue[0]):(ue[1]||Nf).call(this,$,ue[0]));else throw new Error("Cannot close `"+$.type+"` ("+js({start:$.start,end:$.end})+"): its not open");ie.position.end=kn($.end)}function h(){return Fb(this.stack.pop())}function d(){this.data.expectingFirstListItemValue=!0}function f($){if(this.data.expectingFirstListItemValue){const W=this.stack[this.stack.length-2];W.start=Number.parseInt(this.sliceSerialize($),10),this.data.expectingFirstListItemValue=void 0}}function p(){const $=this.resume(),W=this.stack[this.stack.length-1];W.lang=$}function m(){const $=this.resume(),W=this.stack[this.stack.length-1];W.meta=$}function g(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function k(){const $=this.resume(),W=this.stack[this.stack.length-1];W.value=$.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function b(){const $=this.resume(),W=this.stack[this.stack.length-1];W.value=$.replace(/(\r?\n|\r)$/g,"")}function x($){const W=this.resume(),ie=this.stack[this.stack.length-1];ie.label=W,ie.identifier=ri(this.sliceSerialize($)).toLowerCase()}function C(){const $=this.resume(),W=this.stack[this.stack.length-1];W.title=$}function N(){const $=this.resume(),W=this.stack[this.stack.length-1];W.url=$}function A($){const W=this.stack[this.stack.length-1];if(!W.depth){const ie=this.sliceSerialize($).length;W.depth=ie}}function S(){this.data.setextHeadingSlurpLineEnding=!0}function q($){const W=this.stack[this.stack.length-1];W.depth=this.sliceSerialize($).codePointAt(0)===61?1:2}function V(){this.data.setextHeadingSlurpLineEnding=void 0}function F($){const ie=this.stack[this.stack.length-1].children;let ue=ie[ie.length-1];(!ue||ue.type!=="text")&&(ue=pk(),ue.position={start:kn($.start),end:void 0},ie.push(ue)),this.stack.push(ue)}function v($){const W=this.stack.pop();W.value+=this.sliceSerialize($),W.position.end=kn($.end)}function j($){const W=this.stack[this.stack.length-1];if(this.data.atHardBreak){const ie=W.children[W.children.length-1];ie.position.end=kn($.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(W.type)&&(F.call(this,$),v.call(this,$))}function J(){this.data.atHardBreak=!0}function ce(){const $=this.resume(),W=this.stack[this.stack.length-1];W.value=$}function pe(){const $=this.resume(),W=this.stack[this.stack.length-1];W.value=$}function se(){const $=this.resume(),W=this.stack[this.stack.length-1];W.value=$}function Ae(){const $=this.stack[this.stack.length-1];if(this.data.inReference){const W=this.data.referenceType||"shortcut";$.type+="Reference",$.referenceType=W,delete $.url,delete $.title}else delete $.identifier,delete $.label;this.data.referenceType=void 0}function Ne(){const $=this.stack[this.stack.length-1];if(this.data.inReference){const W=this.data.referenceType||"shortcut";$.type+="Reference",$.referenceType=W,delete $.url,delete $.title}else delete $.identifier,delete $.label;this.data.referenceType=void 0}function Oe($){const W=this.sliceSerialize($),ie=this.stack[this.stack.length-2];ie.label=zx(W),ie.identifier=ri(W).toLowerCase()}function dt(){const $=this.stack[this.stack.length-1],W=this.resume(),ie=this.stack[this.stack.length-1];if(this.data.inReference=!0,ie.type==="link"){const ue=$.children;ie.children=ue}else ie.alt=W}function w(){const $=this.resume(),W=this.stack[this.stack.length-1];W.url=$}function R(){const $=this.resume(),W=this.stack[this.stack.length-1];W.title=$}function K(){this.data.inReference=void 0}function y(){this.data.referenceType="collapsed"}function _($){const W=this.resume(),ie=this.stack[this.stack.length-1];ie.label=W,ie.identifier=ri(this.sliceSerialize($)).toLowerCase(),this.data.referenceType="full"}function z($){this.data.characterReferenceType=$.type}function D($){const W=this.sliceSerialize($),ie=this.data.characterReferenceType;let ue;ie?(ue=Km(W,ie==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):ue=Yl(W);const we=this.stack.pop();we.value+=ue,we.position.end=kn($.end)}function B($){v.call(this,$);const W=this.stack[this.stack.length-1];W.url=this.sliceSerialize($)}function I($){v.call(this,$);const W=this.stack[this.stack.length-1];W.url="mailto:"+this.sliceSerialize($)}function M(){return{type:"blockquote",children:[]}}function L(){return{type:"code",lang:null,meta:null,value:""}}function Z(){return{type:"inlineCode",value:""}}function X(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function _e(){return{type:"emphasis",children:[]}}function Fe(){return{type:"heading",depth:0,children:[]}}function Ye(){return{type:"break"}}function Jn(){return{type:"html",value:""}}function kt(){return{type:"image",title:null,url:"",alt:null}}function Zn(){return{type:"link",title:null,url:"",children:[]}}function Ss($){return{type:"list",ordered:$.type==="listOrdered",start:null,spread:$._spread,children:[]}}function hk($){return{type:"listItem",spread:$._spread,checked:null,children:[]}}function dk(){return{type:"paragraph",children:[]}}function fk(){return{type:"strong",children:[]}}function pk(){return{type:"text",value:""}}function mk(){return{type:"thematicBreak"}}}a(Lx,"compiler");function kn(n){return{line:n.line,column:n.column,offset:n.offset}}a(kn,"point$1");function rg(n,e){let t=-1;for(;++t<e.length;){const r=e[t];Array.isArray(r)?rg(n,r):Bx(n,r)}}a(rg,"configure$1");function Bx(n,e){let t;for(t in e)if(ng.call(e,t))switch(t){case"canContainEols":{const r=e[t];r&&n[t].push(...r);break}case"transforms":{const r=e[t];r&&n[t].push(...r);break}case"enter":case"exit":{const r=e[t];r&&Object.assign(n[t],r);break}}}a(Bx,"extension");function Nf(n,e){throw n?new Error("Cannot close `"+n.type+"` ("+js({start:n.start,end:n.end})+"): a different token (`"+e.type+"`, "+js({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+js({start:e.start,end:e.end})+") is still open")}a(Nf,"defaultOnError");function Ic(n){const e=this;e.parser=t;function t(r){return Fx(r,{...e.data("settings"),...n,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}a(t,"parser")}a(Ic,"remarkParse");const Mf={}.hasOwnProperty;function Hx(n,e){const t=e||{};function r(i,...o){let s=r.invalid;const l=r.handlers;if(i&&Mf.call(i,n)){const c=String(i[n]);s=Mf.call(l,c)?l[c]:r.unknown}if(s)return s.call(this,i,...o)}return a(r,"one"),r.handlers=t.handlers||{},r.invalid=t.invalid,r.unknown=t.unknown,r}a(Hx,"zwitch");const jx={}.hasOwnProperty;function ig(n,e){let t=-1,r;if(e.extensions)for(;++t<e.extensions.length;)ig(n,e.extensions[t]);for(r in e)if(jx.call(e,r))switch(r){case"extensions":break;case"unsafe":{Tf(n[r],e[r]);break}case"join":{Tf(n[r],e[r]);break}case"handlers":{Vx(n[r],e[r]);break}default:n.options[r]=e[r]}return n}a(ig,"configure");function Tf(n,e){e&&n.push(...e)}a(Tf,"list$1");function Vx(n,e){e&&Object.assign(n,e)}a(Vx,"map$3");function Wx(n,e,t,r){const i=t.enter("blockquote"),o=t.createTracker(r);o.move("> "),o.shift(2);const s=t.indentLines(t.containerFlow(n,o.current()),qx);return i(),s}a(Wx,"blockquote");function qx(n,e,t){return">"+(t?"":" ")+n}a(qx,"map$2");function og(n,e){return $f(n,e.inConstruct,!0)&&!$f(n,e.notInConstruct,!1)}a(og,"patternInScope");function $f(n,e,t){if(typeof e=="string"&&(e=[e]),!e||e.length===0)return t;let r=-1;for(;++r<e.length;)if(n.includes(e[r]))return!0;return!1}a($f,"listInScope");function Af(n,e,t,r){let i=-1;for(;++i<t.unsafe.length;)if(t.unsafe[i].character===`
`&&og(t.stack,t.unsafe[i]))return/[ \t]/.test(r.before)?"":" ";return`\\
`}a(Af,"hardBreak");function Kx(n,e){const t=String(n);let r=t.indexOf(e),i=r,o=0,s=0;if(typeof e!="string")throw new TypeError("Expected substring");for(;r!==-1;)r===i?++o>s&&(s=o):o=1,i=r+e.length,r=t.indexOf(e,i);return s}a(Kx,"longestStreak");function Ec(n,e){return!!(e.options.fences===!1&&n.value&&!n.lang&&/[^ \r\n]/.test(n.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(n.value))}a(Ec,"formatCodeAsIndented");function Ux(n){const e=n.options.fence||"`";if(e!=="`"&&e!=="~")throw new Error("Cannot serialize code with `"+e+"` for `options.fence`, expected `` ` `` or `~`");return e}a(Ux,"checkFence");function Jx(n,e,t,r){const i=Ux(t),o=n.value||"",s=i==="`"?"GraveAccent":"Tilde";if(Ec(n,t)){const d=t.enter("codeIndented"),f=t.indentLines(o,Zx);return d(),f}const l=t.createTracker(r),c=i.repeat(Math.max(Kx(o,i)+1,3)),u=t.enter("codeFenced");let h=l.move(c);if(n.lang){const d=t.enter(`codeFencedLang${s}`);h+=l.move(t.safe(n.lang,{before:h,after:" ",encode:["`"],...l.current()})),d()}if(n.lang&&n.meta){const d=t.enter(`codeFencedMeta${s}`);h+=l.move(" "),h+=l.move(t.safe(n.meta,{before:h,after:`
`,encode:["`"],...l.current()})),d()}return h+=l.move(`
`),o&&(h+=l.move(o+`
`)),h+=l.move(c),u(),h}a(Jx,"code$2");function Zx(n,e,t){return(t?"":"    ")+n}a(Zx,"map$1");function Fu(n){const e=n.options.quote||'"';if(e!=='"'&&e!=="'")throw new Error("Cannot serialize title with `"+e+"` for `options.quote`, expected `\"`, or `'`");return e}a(Fu,"checkQuote");function Gx(n,e,t,r){const i=Fu(t),o=i==='"'?"Quote":"Apostrophe",s=t.enter("definition");let l=t.enter("label");const c=t.createTracker(r);let u=c.move("[");return u+=c.move(t.safe(t.associationId(n),{before:u,after:"]",...c.current()})),u+=c.move("]: "),l(),!n.url||/[\0- \u007F]/.test(n.url)?(l=t.enter("destinationLiteral"),u+=c.move("<"),u+=c.move(t.safe(n.url,{before:u,after:">",...c.current()})),u+=c.move(">")):(l=t.enter("destinationRaw"),u+=c.move(t.safe(n.url,{before:u,after:n.title?" ":`
`,...c.current()}))),l(),n.title&&(l=t.enter(`title${o}`),u+=c.move(" "+i),u+=c.move(t.safe(n.title,{before:u,after:i,...c.current()})),u+=c.move(i),l()),s(),u}a(Gx,"definition");function Yx(n){const e=n.options.emphasis||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize emphasis with `"+e+"` for `options.emphasis`, expected `*`, or `_`");return e}a(Yx,"checkEmphasis");sg.peek=Qx;function sg(n,e,t,r){const i=Yx(t),o=t.enter("emphasis"),s=t.createTracker(r);let l=s.move(i);return l+=s.move(t.containerPhrasing(n,{before:l,after:i,...s.current()})),l+=s.move(i),o(),l}a(sg,"emphasis");function Qx(n,e,t){return t.options.emphasis||"*"}a(Qx,"emphasisPeek");const lg=a(function(n){if(n==null)return nw;if(typeof n=="function")return Xl(n);if(typeof n=="object")return Array.isArray(n)?Xx(n):ew(n);if(typeof n=="string")return tw(n);throw new Error("Expected function, string, or object as test")},"convert$2");function Xx(n){const e=[];let t=-1;for(;++t<n.length;)e[t]=lg(n[t]);return Xl(r);function r(...i){let o=-1;for(;++o<e.length;)if(e[o].apply(this,i))return!0;return!1}}a(Xx,"anyFactory$2");function ew(n){const e=n;return Xl(t);function t(r){const i=r;let o;for(o in n)if(i[o]!==e[o])return!1;return!0}}a(ew,"propsFactory$2");function tw(n){return Xl(e);function e(t){return t&&t.type===n}}a(tw,"typeFactory$2");function Xl(n){return e;function e(t,r,i){return!!(rw(t)&&n.call(this,t,typeof r=="number"?r:void 0,i||void 0))}}a(Xl,"castFactory$2");function nw(){return!0}a(nw,"ok$3");function rw(n){return n!==null&&typeof n=="object"&&"type"in n}a(rw,"looksLikeANode$2");const ag=[],iw=!0,Oc=!1,_c="skip";function ow(n,e,t,r){let i;typeof e=="function"&&typeof t!="function"?(r=t,t=e):i=e;const o=lg(i),s=r?-1:1;l(n,void 0,[])();function l(c,u,h){const d=c&&typeof c=="object"?c:{};if(typeof d.type=="string"){const p=typeof d.tagName=="string"?d.tagName:typeof d.name=="string"?d.name:void 0;Object.defineProperty(f,"name",{value:"node ("+(c.type+(p?"<"+p+">":""))+")"})}return f;function f(){let p=ag,m,g,k;if((!e||o(c,u,h[h.length-1]||void 0))&&(p=sw(t(c,h)),p[0]===Oc))return p;if("children"in c&&c.children){const b=c;if(b.children&&p[0]!==_c)for(g=(r?b.children.length:-1)+s,k=h.concat(b);g>-1&&g<b.children.length;){const x=b.children[g];if(m=l(x,g,k)(),m[0]===Oc)return m;g=typeof m[1]=="number"?m[1]:g+s}}return p}}a(l,"factory")}a(ow,"visitParents$1");function sw(n){return Array.isArray(n)?n:typeof n=="number"?[iw,n]:n==null?ag:[n]}a(sw,"toResult$1");function Si(n,e,t,r){let i,o,s;typeof e=="function"&&typeof t!="function"?(o=void 0,s=e,i=t):(o=e,s=t,i=r),ow(n,o,l,i);function l(c,u){const h=u[u.length-1],d=h?h.children.indexOf(c):void 0;return s(c,d,h)}a(l,"overload")}a(Si,"visit");const lw={};function cg(n,e){const t=e||lw,r=typeof t.includeImageAlt=="boolean"?t.includeImageAlt:!0,i=typeof t.includeHtml=="boolean"?t.includeHtml:!0;return ug(n,r,i)}a(cg,"toString");function ug(n,e,t){if(aw(n)){if("value"in n)return n.type==="html"&&!t?"":n.value;if(e&&"alt"in n&&n.alt)return n.alt;if("children"in n)return If(n.children,e,t)}return Array.isArray(n)?If(n,e,t):""}a(ug,"one");function If(n,e,t){const r=[];let i=-1;for(;++i<n.length;)r[i]=ug(n[i],e,t);return r.join("")}a(If,"all");function aw(n){return!!(n&&typeof n=="object")}a(aw,"node");function hg(n,e){let t=!1;return Si(n,function(r){if("value"in r&&/\r?\n|\r/.test(r.value)||r.type==="break")return t=!0,Oc}),!!((!n.depth||n.depth<3)&&cg(n)&&(e.options.setext||t))}a(hg,"formatHeadingAsSetext");function cw(n,e,t,r){const i=Math.max(Math.min(6,n.depth||1),1),o=t.createTracker(r);if(hg(n,t)){const h=t.enter("headingSetext"),d=t.enter("phrasing"),f=t.containerPhrasing(n,{...o.current(),before:`
`,after:`
`});return d(),h(),f+`
`+(i===1?"=":"-").repeat(f.length-(Math.max(f.lastIndexOf("\r"),f.lastIndexOf(`
`))+1))}const s="#".repeat(i),l=t.enter("headingAtx"),c=t.enter("phrasing");o.move(s+" ");let u=t.containerPhrasing(n,{before:"# ",after:`
`,...o.current()});return/^[\t ]/.test(u)&&(u="&#x"+u.charCodeAt(0).toString(16).toUpperCase()+";"+u.slice(1)),u=u?s+" "+u:s,t.options.closeAtx&&(u+=" "+s),c(),l(),u}a(cw,"heading");dg.peek=uw;function dg(n){return n.value||""}a(dg,"html");function uw(){return"<"}a(uw,"htmlPeek");fg.peek=hw;function fg(n,e,t,r){const i=Fu(t),o=i==='"'?"Quote":"Apostrophe",s=t.enter("image");let l=t.enter("label");const c=t.createTracker(r);let u=c.move("![");return u+=c.move(t.safe(n.alt,{before:u,after:"]",...c.current()})),u+=c.move("]("),l(),!n.url&&n.title||/[\0- \u007F]/.test(n.url)?(l=t.enter("destinationLiteral"),u+=c.move("<"),u+=c.move(t.safe(n.url,{before:u,after:">",...c.current()})),u+=c.move(">")):(l=t.enter("destinationRaw"),u+=c.move(t.safe(n.url,{before:u,after:n.title?" ":")",...c.current()}))),l(),n.title&&(l=t.enter(`title${o}`),u+=c.move(" "+i),u+=c.move(t.safe(n.title,{before:u,after:i,...c.current()})),u+=c.move(i),l()),u+=c.move(")"),s(),u}a(fg,"image$1");function hw(){return"!"}a(hw,"imagePeek");pg.peek=dw;function pg(n,e,t,r){const i=n.referenceType,o=t.enter("imageReference");let s=t.enter("label");const l=t.createTracker(r);let c=l.move("![");const u=t.safe(n.alt,{before:c,after:"]",...l.current()});c+=l.move(u+"]["),s();const h=t.stack;t.stack=[],s=t.enter("reference");const d=t.safe(t.associationId(n),{before:c,after:"]",...l.current()});return s(),t.stack=h,o(),i==="full"||!u||u!==d?c+=l.move(d+"]"):i==="shortcut"?c=c.slice(0,-1):c+=l.move("]"),c}a(pg,"imageReference");function dw(){return"!"}a(dw,"imageReferencePeek");mg.peek=fw;function mg(n,e,t){let r=n.value||"",i="`",o=-1;for(;new RegExp("(^|[^`])"+i+"([^`]|$)").test(r);)i+="`";for(/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^`|`$/.test(r))&&(r=" "+r+" ");++o<t.unsafe.length;){const s=t.unsafe[o],l=t.compilePattern(s);let c;if(s.atBreak)for(;c=l.exec(r);){let u=c.index;r.charCodeAt(u)===10&&r.charCodeAt(u-1)===13&&u--,r=r.slice(0,u)+" "+r.slice(c.index+1)}}return i+r+i}a(mg,"inlineCode");function fw(){return"`"}a(fw,"inlineCodePeek");function gg(n,e){const t=cg(n);return!!(!e.options.resourceLink&&n.url&&!n.title&&n.children&&n.children.length===1&&n.children[0].type==="text"&&(t===n.url||"mailto:"+t===n.url)&&/^[a-z][a-z+.-]+:/i.test(n.url)&&!/[\0- <>\u007F]/.test(n.url))}a(gg,"formatLinkAsAutolink");yg.peek=pw;function yg(n,e,t,r){const i=Fu(t),o=i==='"'?"Quote":"Apostrophe",s=t.createTracker(r);let l,c;if(gg(n,t)){const h=t.stack;t.stack=[],l=t.enter("autolink");let d=s.move("<");return d+=s.move(t.containerPhrasing(n,{before:d,after:">",...s.current()})),d+=s.move(">"),l(),t.stack=h,d}l=t.enter("link"),c=t.enter("label");let u=s.move("[");return u+=s.move(t.containerPhrasing(n,{before:u,after:"](",...s.current()})),u+=s.move("]("),c(),!n.url&&n.title||/[\0- \u007F]/.test(n.url)?(c=t.enter("destinationLiteral"),u+=s.move("<"),u+=s.move(t.safe(n.url,{before:u,after:">",...s.current()})),u+=s.move(">")):(c=t.enter("destinationRaw"),u+=s.move(t.safe(n.url,{before:u,after:n.title?" ":")",...s.current()}))),c(),n.title&&(c=t.enter(`title${o}`),u+=s.move(" "+i),u+=s.move(t.safe(n.title,{before:u,after:i,...s.current()})),u+=s.move(i),c()),u+=s.move(")"),l(),u}a(yg,"link");function pw(n,e,t){return gg(n,t)?"<":"["}a(pw,"linkPeek");kg.peek=mw;function kg(n,e,t,r){const i=n.referenceType,o=t.enter("linkReference");let s=t.enter("label");const l=t.createTracker(r);let c=l.move("[");const u=t.containerPhrasing(n,{before:c,after:"]",...l.current()});c+=l.move(u+"]["),s();const h=t.stack;t.stack=[],s=t.enter("reference");const d=t.safe(t.associationId(n),{before:c,after:"]",...l.current()});return s(),t.stack=h,o(),i==="full"||!u||u!==d?c+=l.move(d+"]"):i==="shortcut"?c=c.slice(0,-1):c+=l.move("]"),c}a(kg,"linkReference");function mw(){return"["}a(mw,"linkReferencePeek");function Lu(n){const e=n.options.bullet||"*";if(e!=="*"&&e!=="+"&&e!=="-")throw new Error("Cannot serialize items with `"+e+"` for `options.bullet`, expected `*`, `+`, or `-`");return e}a(Lu,"checkBullet");function gw(n){const e=Lu(n),t=n.options.bulletOther;if(!t)return e==="*"?"-":"*";if(t!=="*"&&t!=="+"&&t!=="-")throw new Error("Cannot serialize items with `"+t+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(t===e)throw new Error("Expected `bullet` (`"+e+"`) and `bulletOther` (`"+t+"`) to be different");return t}a(gw,"checkBulletOther");function yw(n){const e=n.options.bulletOrdered||".";if(e!=="."&&e!==")")throw new Error("Cannot serialize items with `"+e+"` for `options.bulletOrdered`, expected `.` or `)`");return e}a(yw,"checkBulletOrdered");function bg(n){const e=n.options.rule||"*";if(e!=="*"&&e!=="-"&&e!=="_")throw new Error("Cannot serialize rules with `"+e+"` for `options.rule`, expected `*`, `-`, or `_`");return e}a(bg,"checkRule");function kw(n,e,t,r){const i=t.enter("list"),o=t.bulletCurrent;let s=n.ordered?yw(t):Lu(t);const l=n.ordered?s==="."?")":".":gw(t);let c=e&&t.bulletLastUsed?s===t.bulletLastUsed:!1;if(!n.ordered){const h=n.children?n.children[0]:void 0;if((s==="*"||s==="-")&&h&&(!h.children||!h.children[0])&&t.stack[t.stack.length-1]==="list"&&t.stack[t.stack.length-2]==="listItem"&&t.stack[t.stack.length-3]==="list"&&t.stack[t.stack.length-4]==="listItem"&&t.indexStack[t.indexStack.length-1]===0&&t.indexStack[t.indexStack.length-2]===0&&t.indexStack[t.indexStack.length-3]===0&&(c=!0),bg(t)===s&&h){let d=-1;for(;++d<n.children.length;){const f=n.children[d];if(f&&f.type==="listItem"&&f.children&&f.children[0]&&f.children[0].type==="thematicBreak"){c=!0;break}}}}c&&(s=l),t.bulletCurrent=s;const u=t.containerFlow(n,r);return t.bulletLastUsed=s,t.bulletCurrent=o,i(),u}a(kw,"list");function bw(n){const e=n.options.listItemIndent||"one";if(e!=="tab"&&e!=="one"&&e!=="mixed")throw new Error("Cannot serialize items with `"+e+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return e}a(bw,"checkListItemIndent");function xw(n,e,t,r){const i=bw(t);let o=t.bulletCurrent||Lu(t);e&&e.type==="list"&&e.ordered&&(o=(typeof e.start=="number"&&e.start>-1?e.start:1)+(t.options.incrementListMarker===!1?0:e.children.indexOf(n))+o);let s=o.length+1;(i==="tab"||i==="mixed"&&(e&&e.type==="list"&&e.spread||n.spread))&&(s=Math.ceil(s/4)*4);const l=t.createTracker(r);l.move(o+" ".repeat(s-o.length)),l.shift(s);const c=t.enter("listItem"),u=t.indentLines(t.containerFlow(n,l.current()),h);return c(),u;function h(d,f,p){return f?(p?"":" ".repeat(s))+d:(p?o:o+" ".repeat(s-o.length))+d}a(h,"map")}a(xw,"listItem");function ww(n,e,t,r){const i=t.enter("paragraph"),o=t.enter("phrasing"),s=t.containerPhrasing(n,r);return o(),i(),s}a(ww,"paragraph");const xg=a(function(n){if(n==null)return Nw;if(typeof n=="function")return ea(n);if(typeof n=="object")return Array.isArray(n)?Cw(n):Sw(n);if(typeof n=="string")return vw(n);throw new Error("Expected function, string, or object as test")},"convert$1");function Cw(n){const e=[];let t=-1;for(;++t<n.length;)e[t]=xg(n[t]);return ea(r);function r(...i){let o=-1;for(;++o<e.length;)if(e[o].apply(this,i))return!0;return!1}}a(Cw,"anyFactory$1");function Sw(n){const e=n;return ea(t);function t(r){const i=r;let o;for(o in n)if(i[o]!==e[o])return!1;return!0}}a(Sw,"propsFactory$1");function vw(n){return ea(e);function e(t){return t&&t.type===n}}a(vw,"typeFactory$1");function ea(n){return e;function e(t,r,i){return!!(Mw(t)&&n.call(this,t,typeof r=="number"?r:void 0,i||void 0))}}a(ea,"castFactory$1");function Nw(){return!0}a(Nw,"ok$2");function Mw(n){return n!==null&&typeof n=="object"&&"type"in n}a(Mw,"looksLikeANode$1");const Tw=xg(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function $w(n,e,t,r){return(n.children.some(function(s){return Tw(s)})?t.containerPhrasing:t.containerFlow).call(t,n,r)}a($w,"root");function Aw(n){const e=n.options.strong||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize strong with `"+e+"` for `options.strong`, expected `*`, or `_`");return e}a(Aw,"checkStrong");wg.peek=Iw;function wg(n,e,t,r){const i=Aw(t),o=t.enter("strong"),s=t.createTracker(r);let l=s.move(i+i);return l+=s.move(t.containerPhrasing(n,{before:l,after:i,...s.current()})),l+=s.move(i+i),o(),l}a(wg,"strong");function Iw(n,e,t){return t.options.strong||"*"}a(Iw,"strongPeek");function Ew(n,e,t,r){return t.safe(n.value,r)}a(Ew,"text$2");function Ow(n){const e=n.options.ruleRepetition||3;if(e<3)throw new Error("Cannot serialize rules with repetition `"+e+"` for `options.ruleRepetition`, expected `3` or more");return e}a(Ow,"checkRuleRepetition");function _w(n,e,t){const r=(bg(t)+(t.options.ruleSpaces?" ":"")).repeat(Ow(t));return t.options.ruleSpaces?r.slice(0,-1):r}a(_w,"thematicBreak");const Bu={blockquote:Wx,break:Af,code:Jx,definition:Gx,emphasis:sg,hardBreak:Af,heading:cw,html:dg,image:fg,imageReference:pg,inlineCode:mg,link:yg,linkReference:kg,list:kw,listItem:xw,paragraph:ww,root:$w,strong:wg,text:Ew,thematicBreak:_w},Dw=[Rw];function Rw(n,e,t,r){if(e.type==="code"&&Ec(e,r)&&(n.type==="list"||n.type===e.type&&Ec(n,r)))return!1;if("spread"in t&&typeof t.spread=="boolean")return n.type==="paragraph"&&(n.type===e.type||e.type==="definition"||e.type==="heading"&&hg(e,r))?void 0:t.spread?1:0}a(Rw,"joinDefaults");const Yn=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"],zw=[{character:"	",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",before:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"\r",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:`
`,inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:" ",after:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",before:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"!",after:"\\[",inConstruct:"phrasing",notInConstruct:Yn},{character:'"',inConstruct:"titleQuote"},{atBreak:!0,character:"#"},{character:"#",inConstruct:"headingAtx",after:`(?:[\r
]|$)`},{character:"&",after:"[#A-Za-z]",inConstruct:"phrasing"},{character:"'",inConstruct:"titleApostrophe"},{character:"(",inConstruct:"destinationRaw"},{before:"\\]",character:"(",inConstruct:"phrasing",notInConstruct:Yn},{atBreak:!0,before:"\\d+",character:")"},{character:")",inConstruct:"destinationRaw"},{atBreak:!0,character:"*",after:`(?:[ 	\r
*])`},{character:"*",inConstruct:"phrasing",notInConstruct:Yn},{atBreak:!0,character:"+",after:`(?:[ 	\r
])`},{atBreak:!0,character:"-",after:`(?:[ 	\r
-])`},{atBreak:!0,before:"\\d+",character:".",after:`(?:[ 	\r
]|$)`},{atBreak:!0,character:"<",after:"[!/?A-Za-z]"},{character:"<",after:"[!/?A-Za-z]",inConstruct:"phrasing",notInConstruct:Yn},{character:"<",inConstruct:"destinationLiteral"},{atBreak:!0,character:"="},{atBreak:!0,character:">"},{character:">",inConstruct:"destinationLiteral"},{atBreak:!0,character:"["},{character:"[",inConstruct:"phrasing",notInConstruct:Yn},{character:"[",inConstruct:["label","reference"]},{character:"\\",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"]",inConstruct:["label","reference"]},{atBreak:!0,character:"_"},{character:"_",inConstruct:"phrasing",notInConstruct:Yn},{atBreak:!0,character:"`"},{character:"`",inConstruct:["codeFencedLangGraveAccent","codeFencedMetaGraveAccent"]},{character:"`",inConstruct:"phrasing",notInConstruct:Yn},{atBreak:!0,character:"~"}];function Pw(n,e){const t=Number.parseInt(n,e);return t<9||t===11||t>13&&t<32||t>126&&t<160||t>55295&&t<57344||t>64975&&t<65008||(t&65535)===65535||(t&65535)===65534||t>1114111?"":String.fromCodePoint(t)}a(Pw,"decodeNumericCharacterReference");const Fw=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function Lw(n){return n.replace(Fw,Bw)}a(Lw,"decodeString");function Bw(n,e,t){if(e)return e;if(t.charCodeAt(0)===35){const i=t.charCodeAt(1),o=i===120||i===88;return Pw(t.slice(o?2:1),o?16:10)}return Yl(t)||n}a(Bw,"decode");function Hw(n){return n.label||!n.identifier?n.label||"":Lw(n.identifier)}a(Hw,"association");function jw(n){if(!n._compiled){const e=(n.atBreak?"[\\r\\n][\\t ]*":"")+(n.before?"(?:"+n.before+")":"");n._compiled=new RegExp((e?"("+e+")":"")+(/[|\\{}()[\]^$+*?.-]/.test(n.character)?"\\":"")+n.character+(n.after?"(?:"+n.after+")":""),"g")}return n._compiled}a(jw,"compilePattern");function Vw(n,e,t){const r=e.indexStack,i=n.children||[],o=[];let s=-1,l=t.before;r.push(-1);let c=e.createTracker(t);for(;++s<i.length;){const u=i[s];let h;if(r[r.length-1]=s,s+1<i.length){let d=e.handle.handlers[i[s+1].type];d&&d.peek&&(d=d.peek),h=d?d(i[s+1],n,e,{before:"",after:"",...c.current()}).charAt(0):""}else h=t.after;o.length>0&&(l==="\r"||l===`
`)&&u.type==="html"&&(o[o.length-1]=o[o.length-1].replace(/(\r?\n|\r)$/," "),l=" ",c=e.createTracker(t),c.move(o.join(""))),o.push(c.move(e.handle(u,n,e,{...c.current(),before:l,after:h}))),l=o[o.length-1].slice(-1)}return r.pop(),o.join("")}a(Vw,"containerPhrasing");function Ww(n,e,t){const r=e.indexStack,i=n.children||[],o=e.createTracker(t),s=[];let l=-1;for(r.push(-1);++l<i.length;){const c=i[l];r[r.length-1]=l,s.push(o.move(e.handle(c,n,e,{before:`
`,after:`
`,...o.current()}))),c.type!=="list"&&(e.bulletLastUsed=void 0),l<i.length-1&&s.push(o.move(qw(c,i[l+1],n,e)))}return r.pop(),s.join("")}a(Ww,"containerFlow");function qw(n,e,t,r){let i=r.join.length;for(;i--;){const o=r.join[i](n,e,t,r);if(o===!0||o===1)break;if(typeof o=="number")return`
`.repeat(1+o);if(o===!1)return`

<!---->

`}return`

`}a(qw,"between");const Kw=/\r?\n|\r/g;function Uw(n,e){const t=[];let r=0,i=0,o;for(;o=Kw.exec(n);)s(n.slice(r,o.index)),t.push(o[0]),r=o.index+o[0].length,i++;return s(n.slice(r)),t.join("");function s(l){t.push(e(l,i,!l))}a(s,"one")}a(Uw,"indentLines");function Jw(n,e,t){const r=(t.before||"")+(e||"")+(t.after||""),i=[],o=[],s={};let l=-1;for(;++l<n.unsafe.length;){const h=n.unsafe[l];if(!og(n.stack,h))continue;const d=n.compilePattern(h);let f;for(;f=d.exec(r);){const p="before"in h||!!h.atBreak,m="after"in h,g=f.index+(p?f[1].length:0);i.includes(g)?(s[g].before&&!p&&(s[g].before=!1),s[g].after&&!m&&(s[g].after=!1)):(i.push(g),s[g]={before:p,after:m})}}i.sort(Zw);let c=t.before?t.before.length:0;const u=r.length-(t.after?t.after.length:0);for(l=-1;++l<i.length;){const h=i[l];h<c||h>=u||h+1<u&&i[l+1]===h+1&&s[h].after&&!s[h+1].before&&!s[h+1].after||i[l-1]===h-1&&s[h].before&&!s[h-1].before&&!s[h-1].after||(c!==h&&o.push(Ef(r.slice(c,h),"\\")),c=h,/[!-/:-@[-`{-~]/.test(r.charAt(h))&&(!t.encode||!t.encode.includes(r.charAt(h)))?o.push("\\"):(o.push("&#x"+r.charCodeAt(h).toString(16).toUpperCase()+";"),c++))}return o.push(Ef(r.slice(c,u),t.after)),o.join("")}a(Jw,"safe");function Zw(n,e){return n-e}a(Zw,"numerical");function Ef(n,e){const t=/\\(?=[!-/:-@[-`{-~])/g,r=[],i=[],o=n+e;let s=-1,l=0,c;for(;c=t.exec(o);)r.push(c.index);for(;++s<r.length;)l!==r[s]&&i.push(n.slice(l,r[s])),i.push("\\"),l=r[s];return i.push(n.slice(l)),i.join("")}a(Ef,"escapeBackslashes");function Gw(n){const e=n||{},t=e.now||{};let r=e.lineShift||0,i=t.line||1,o=t.column||1;return{move:c,current:s,shift:l};function s(){return{now:{line:i,column:o},lineShift:r}}function l(u){r+=u}function c(u){const h=u||"",d=h.split(/\r?\n|\r/g),f=d[d.length-1];return i+=d.length-1,o=d.length===1?o+f.length:1+f.length+r,h}}a(Gw,"track");function Yw(n,e={}){const t={enter:i,indentLines:Uw,associationId:Hw,containerPhrasing:tC,containerFlow:nC,createTracker:Gw,compilePattern:jw,safe:rC,stack:[],unsafe:[...zw],join:[...Dw],handlers:{...Bu},options:{},indexStack:[],handle:void 0};ig(t,e),t.options.tightDefinitions&&t.join.push(eC),t.handle=Hx("type",{invalid:Qw,unknown:Xw,handlers:t.handlers});let r=t.handle(n,void 0,t,{before:`
`,after:`
`,now:{line:1,column:1},lineShift:0});return r&&r.charCodeAt(r.length-1)!==10&&r.charCodeAt(r.length-1)!==13&&(r+=`
`),r;function i(o){return t.stack.push(o),s;function s(){t.stack.pop()}a(s,"exit")}a(i,"enter")}a(Yw,"toMarkdown");function Qw(n){throw new Error("Cannot handle value `"+n+"`, expected node")}a(Qw,"invalid");function Xw(n){const e=n;throw new Error("Cannot handle unknown node `"+e.type+"`")}a(Xw,"unknown");function eC(n,e){if(n.type==="definition"&&n.type===e.type)return 0}a(eC,"joinDefinition");function tC(n,e){return Vw(n,this,e)}a(tC,"containerPhrasingBound");function nC(n,e){return Ww(n,this,e)}a(nC,"containerFlowBound");function rC(n,e){return Jw(this,n,e)}a(rC,"safeBound");function Dc(n){const e=this;e.compiler=t;function t(r){return Yw(r,{...e.data("settings"),...n,extensions:e.data("toMarkdownExtensions")||[]})}a(t,"compiler")}a(Dc,"remarkStringify");function Of(n){if(n)throw n}a(Of,"bail");var Vs=Object.prototype.hasOwnProperty,Cg=Object.prototype.toString,_f=Object.defineProperty,Df=Object.getOwnPropertyDescriptor,Rf=a(function(e){return typeof Array.isArray=="function"?Array.isArray(e):Cg.call(e)==="[object Array]"},"isArray"),zf=a(function(e){if(!e||Cg.call(e)!=="[object Object]")return!1;var t=Vs.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&Vs.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!r)return!1;var i;for(i in e);return typeof i>"u"||Vs.call(e,i)},"isPlainObject"),Pf=a(function(e,t){_f&&t.name==="__proto__"?_f(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},"setProperty"),Ff=a(function(e,t){if(t==="__proto__")if(Vs.call(e,t)){if(Df)return Df(e,t).value}else return;return e[t]},"getProperty"),iC=a(function n(){var e,t,r,i,o,s,l=arguments[0],c=1,u=arguments.length,h=!1;for(typeof l=="boolean"&&(h=l,l=arguments[1]||{},c=2),(l==null||typeof l!="object"&&typeof l!="function")&&(l={});c<u;++c)if(e=arguments[c],e!=null)for(t in e)r=Ff(l,t),i=Ff(e,t),l!==i&&(h&&i&&(zf(i)||(o=Rf(i)))?(o?(o=!1,s=r&&Rf(r)?r:[]):s=r&&zf(r)?r:{},Pf(l,{name:t,newValue:n(h,s,i)})):typeof i<"u"&&Pf(l,{name:t,newValue:i}));return l},"extend");const Ma=fm(iC);function Rc(n){if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)}a(Rc,"isPlainObject");function oC(){const n=[],e={run:t,use:r};return e;function t(...i){let o=-1;const s=i.pop();if(typeof s!="function")throw new TypeError("Expected function as last argument, not "+s);l(null,...i);function l(c,...u){const h=n[++o];let d=-1;if(c){s(c);return}for(;++d<i.length;)(u[d]===null||u[d]===void 0)&&(u[d]=i[d]);i=u,h?sC(h,l)(...u):s(null,...u)}a(l,"next")}function r(i){if(typeof i!="function")throw new TypeError("Expected `middelware` to be a function, not "+i);return n.push(i),e}}a(oC,"trough");function sC(n,e){let t;return r;function r(...s){const l=n.length>s.length;let c;l&&s.push(i);try{c=n.apply(this,s)}catch(u){const h=u;if(l&&t)throw h;return i(h)}l||(c&&c.then&&typeof c.then=="function"?c.then(o,i):c instanceof Error?i(c):o(c))}function i(s,...l){t||(t=!0,e(s,...l))}function o(s){i(null,s)}}a(sC,"wrap$1");function lC(n){return!n||typeof n!="object"?"":"position"in n||"type"in n?Lf(n.position):"start"in n||"end"in n?Lf(n):"line"in n||"column"in n?zc(n):""}a(lC,"stringifyPosition");function zc(n){return Bf(n&&n.line)+":"+Bf(n&&n.column)}a(zc,"point");function Lf(n){return zc(n&&n.start)+"-"+zc(n&&n.end)}a(Lf,"position");function Bf(n){return n&&typeof n=="number"?n:1}a(Bf,"index");const Cd=class Cd extends Error{constructor(e,t,r){super(),typeof t=="string"&&(r=t,t=void 0);let i="",o={},s=!1;if(t&&("line"in t&&"column"in t?o={place:t}:"start"in t&&"end"in t?o={place:t}:"type"in t?o={ancestors:[t],place:t.position}:o={...t}),typeof e=="string"?i=e:!o.cause&&e&&(s=!0,i=e.message,o.cause=e),!o.ruleId&&!o.source&&typeof r=="string"){const c=r.indexOf(":");c===-1?o.ruleId=r:(o.source=r.slice(0,c),o.ruleId=r.slice(c+1))}if(!o.place&&o.ancestors&&o.ancestors){const c=o.ancestors[o.ancestors.length-1];c&&(o.place=c.position)}const l=o.place&&"start"in o.place?o.place.start:o.place;this.ancestors=o.ancestors||void 0,this.cause=o.cause||void 0,this.column=l?l.column:void 0,this.fatal=void 0,this.file,this.message=i,this.line=l?l.line:void 0,this.name=lC(o.place)||"1:1",this.place=o.place||void 0,this.reason=this.message,this.ruleId=o.ruleId||void 0,this.source=o.source||void 0,this.stack=s&&o.cause&&typeof o.cause.stack=="string"?o.cause.stack:"",this.actual,this.expected,this.note,this.url}};a(Cd,"VFileMessage");let Ze=Cd;Ze.prototype.file="";Ze.prototype.name="";Ze.prototype.reason="";Ze.prototype.message="";Ze.prototype.stack="";Ze.prototype.column=void 0;Ze.prototype.line=void 0;Ze.prototype.ancestors=void 0;Ze.prototype.cause=void 0;Ze.prototype.fatal=void 0;Ze.prototype.place=void 0;Ze.prototype.ruleId=void 0;Ze.prototype.source=void 0;const Lt={basename:aC,dirname:cC,extname:uC,join:hC,sep:"/"};function aC(n,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');as(n);let t=0,r=-1,i=n.length,o;if(e===void 0||e.length===0||e.length>n.length){for(;i--;)if(n.codePointAt(i)===47){if(o){t=i+1;break}}else r<0&&(o=!0,r=i+1);return r<0?"":n.slice(t,r)}if(e===n)return"";let s=-1,l=e.length-1;for(;i--;)if(n.codePointAt(i)===47){if(o){t=i+1;break}}else s<0&&(o=!0,s=i+1),l>-1&&(n.codePointAt(i)===e.codePointAt(l--)?l<0&&(r=i):(l=-1,r=s));return t===r?r=s:r<0&&(r=n.length),n.slice(t,r)}a(aC,"basename");function cC(n){if(as(n),n.length===0)return".";let e=-1,t=n.length,r;for(;--t;)if(n.codePointAt(t)===47){if(r){e=t;break}}else r||(r=!0);return e<0?n.codePointAt(0)===47?"/":".":e===1&&n.codePointAt(0)===47?"//":n.slice(0,e)}a(cC,"dirname");function uC(n){as(n);let e=n.length,t=-1,r=0,i=-1,o=0,s;for(;e--;){const l=n.codePointAt(e);if(l===47){if(s){r=e+1;break}continue}t<0&&(s=!0,t=e+1),l===46?i<0?i=e:o!==1&&(o=1):i>-1&&(o=-1)}return i<0||t<0||o===0||o===1&&i===t-1&&i===r+1?"":n.slice(i,t)}a(uC,"extname");function hC(...n){let e=-1,t;for(;++e<n.length;)as(n[e]),n[e]&&(t=t===void 0?n[e]:t+"/"+n[e]);return t===void 0?".":dC(t)}a(hC,"join$1");function dC(n){as(n);const e=n.codePointAt(0)===47;let t=fC(n,!e);return t.length===0&&!e&&(t="."),t.length>0&&n.codePointAt(n.length-1)===47&&(t+="/"),e?"/"+t:t}a(dC,"normalize$1");function fC(n,e){let t="",r=0,i=-1,o=0,s=-1,l,c;for(;++s<=n.length;){if(s<n.length)l=n.codePointAt(s);else{if(l===47)break;l=47}if(l===47){if(!(i===s-1||o===1))if(i!==s-1&&o===2){if(t.length<2||r!==2||t.codePointAt(t.length-1)!==46||t.codePointAt(t.length-2)!==46){if(t.length>2){if(c=t.lastIndexOf("/"),c!==t.length-1){c<0?(t="",r=0):(t=t.slice(0,c),r=t.length-1-t.lastIndexOf("/")),i=s,o=0;continue}}else if(t.length>0){t="",r=0,i=s,o=0;continue}}e&&(t=t.length>0?t+"/..":"..",r=2)}else t.length>0?t+="/"+n.slice(i+1,s):t=n.slice(i+1,s),r=s-i-1;i=s,o=0}else l===46&&o>-1?o++:o=-1}return t}a(fC,"normalizeString");function as(n){if(typeof n!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(n))}a(as,"assertPath$1");const pC={cwd:mC};function mC(){return"/"}a(mC,"cwd");function Pc(n){return!!(n!==null&&typeof n=="object"&&"href"in n&&n.href&&"protocol"in n&&n.protocol&&n.auth===void 0)}a(Pc,"isUrl");function gC(n){if(typeof n=="string")n=new URL(n);else if(!Pc(n)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+n+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(n.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return yC(n)}a(gC,"urlToPath");function yC(n){if(n.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const e=n.pathname;let t=-1;for(;++t<e.length;)if(e.codePointAt(t)===37&&e.codePointAt(t+1)===50){const r=e.codePointAt(t+2);if(r===70||r===102){const i=new TypeError("File URL path must not include encoded / characters");throw i.code="ERR_INVALID_FILE_URL_PATH",i}}return decodeURIComponent(e)}a(yC,"getPathFromURLPosix");const Ta=["history","path","basename","stem","extname","dirname"],Sd=class Sd{constructor(e){let t;e?Pc(e)?t={path:e}:typeof e=="string"||kC(e)?t={value:e}:t=e:t={},this.cwd=pC.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<Ta.length;){const o=Ta[r];o in t&&t[o]!==void 0&&t[o]!==null&&(this[o]=o==="history"?[...t[o]]:t[o])}let i;for(i in t)Ta.includes(i)||(this[i]=t[i])}get basename(){return typeof this.path=="string"?Lt.basename(this.path):void 0}set basename(e){Aa(e,"basename"),$a(e,"basename"),this.path=Lt.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?Lt.dirname(this.path):void 0}set dirname(e){Hf(this.basename,"dirname"),this.path=Lt.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?Lt.extname(this.path):void 0}set extname(e){if($a(e,"extname"),Hf(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Lt.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){Pc(e)&&(e=gC(e)),Aa(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?Lt.basename(this.path,this.extname):void 0}set stem(e){Aa(e,"stem"),$a(e,"stem"),this.path=Lt.join(this.dirname||"",e+(this.extname||""))}fail(e,t,r){const i=this.message(e,t,r);throw i.fatal=!0,i}info(e,t,r){const i=this.message(e,t,r);return i.fatal=void 0,i}message(e,t,r){const i=new Ze(e,t,r);return this.path&&(i.name=this.path+":"+i.name,i.file=this.path),i.fatal=!1,this.messages.push(i),i}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}};a(Sd,"VFile");let Fc=Sd;function $a(n,e){if(n&&n.includes(Lt.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+Lt.sep+"`")}a($a,"assertPart");function Aa(n,e){if(!n)throw new Error("`"+e+"` cannot be empty")}a(Aa,"assertNonEmpty");function Hf(n,e){if(!n)throw new Error("Setting `"+e+"` requires `path` to be set too")}a(Hf,"assertPath");function kC(n){return!!(n&&typeof n=="object"&&"byteLength"in n&&"byteOffset"in n)}a(kC,"isUint8Array$1");const bC=a(function(n){const r=this.constructor.prototype,i=r[n],o=a(function(){return i.apply(o,arguments)},"apply");Object.setPrototypeOf(o,r);const s=Object.getOwnPropertyNames(i);for(const l of s){const c=Object.getOwnPropertyDescriptor(i,l);c&&Object.defineProperty(o,l,c)}return o},"CallableInstance"),xC={}.hasOwnProperty,jl=class jl extends bC{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=oC()}copy(){const e=new jl;let t=-1;for(;++t<this.attachers.length;){const r=this.attachers[t];e.use(...r)}return e.data(Ma(!0,{},this.namespace)),e}data(e,t){return typeof e=="string"?arguments.length===2?(Oa("data",this.frozen),this.namespace[e]=t,this):xC.call(this.namespace,e)&&this.namespace[e]||void 0:e?(Oa("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[t,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const i=t.call(e,...r);typeof i=="function"&&this.transformers.use(i)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const t=Ns(e),r=this.parser||this.Parser;return Ia("parse",r),r(String(t),t)}process(e,t){const r=this;return this.freeze(),Ia("process",this.parser||this.Parser),Ea("process",this.compiler||this.Compiler),t?i(void 0,t):new Promise(i);function i(o,s){const l=Ns(e),c=r.parse(l);r.run(c,l,function(h,d,f){if(h||!d||!f)return u(h);const p=d,m=r.stringify(p,f);CC(m)?f.value=m:f.result=m,u(h,f)});function u(h,d){h||!d?s(h):o?o(d):t(void 0,d)}a(u,"realDone")}a(i,"executor")}processSync(e){let t=!1,r;return this.freeze(),Ia("processSync",this.parser||this.Parser),Ea("processSync",this.compiler||this.Compiler),this.process(e,i),Vf("processSync","process",t),r;function i(o,s){t=!0,Of(o),r=s}a(i,"realDone")}run(e,t,r){jf(e),this.freeze();const i=this.transformers;return!r&&typeof t=="function"&&(r=t,t=void 0),r?o(void 0,r):new Promise(o);function o(s,l){const c=Ns(t);i.run(e,c,u);function u(h,d,f){const p=d||e;h?l(h):s?s(p):r(void 0,p,f)}a(u,"realDone")}a(o,"executor")}runSync(e,t){let r=!1,i;return this.run(e,t,o),Vf("runSync","run",r),i;function o(s,l){Of(s),i=l,r=!0}a(o,"realDone")}stringify(e,t){this.freeze();const r=Ns(t),i=this.compiler||this.Compiler;return Ea("stringify",i),jf(e),i(e,r)}use(e,...t){const r=this.attachers,i=this.namespace;if(Oa("use",this.frozen),e!=null)if(typeof e=="function")c(e,t);else if(typeof e=="object")Array.isArray(e)?l(e):s(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function o(u){if(typeof u=="function")c(u,[]);else if(typeof u=="object")if(Array.isArray(u)){const[h,...d]=u;c(h,d)}else s(u);else throw new TypeError("Expected usable value, not `"+u+"`")}function s(u){if(!("plugins"in u)&&!("settings"in u))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");l(u.plugins),u.settings&&(i.settings=Ma(!0,i.settings,u.settings))}function l(u){let h=-1;if(u!=null)if(Array.isArray(u))for(;++h<u.length;){const d=u[h];o(d)}else throw new TypeError("Expected a list of plugins, not `"+u+"`")}function c(u,h){let d=-1,f=-1;for(;++d<r.length;)if(r[d][0]===u){f=d;break}if(f===-1)r.push([u,...h]);else if(h.length>0){let[p,...m]=h;const g=r[f][1];Rc(g)&&Rc(p)&&(p=Ma(!0,g,p)),r[f]=[u,p,...m]}}}};a(jl,"Processor");let Lc=jl;const Bc=new Lc().freeze();function Ia(n,e){if(typeof e!="function")throw new TypeError("Cannot `"+n+"` without `parser`")}a(Ia,"assertParser");function Ea(n,e){if(typeof e!="function")throw new TypeError("Cannot `"+n+"` without `compiler`")}a(Ea,"assertCompiler");function Oa(n,e){if(e)throw new Error("Cannot call `"+n+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}a(Oa,"assertUnfrozen");function jf(n){if(!Rc(n)||typeof n.type!="string")throw new TypeError("Expected node, got `"+n+"`")}a(jf,"assertNode");function Vf(n,e,t){if(!t)throw new Error("`"+n+"` finished async. Use `"+e+"` instead")}a(Vf,"assertDone");function Ns(n){return wC(n)?n:new Fc(n)}a(Ns,"vfile");function wC(n){return!!(n&&typeof n=="object"&&"message"in n&&"messages"in n)}a(wC,"looksLikeAVFile");function CC(n){return typeof n=="string"||SC(n)}a(CC,"looksLikeAValue");function SC(n){return!!(n&&typeof n=="object"&&"byteLength"in n&&"byteOffset"in n)}a(SC,"isUint8Array");var Sg=a((n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)},"G$2"),he=a((n,e,t)=>(Sg(n,e,"read from private field"),t?t.call(n):e.get(n)),"r"),Re=a((n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},"c$1"),Te=a((n,e,t,r)=>(Sg(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),"o"),Yo;let vg=(Yo=class{},a(Yo,"Q"),Yo);var Qo;let Ng=(Qo=class{constructor(){this.elements=[],this.size=()=>this.elements.length,this.top=()=>this.elements.at(-1),this.push=e=>{var t;(t=this.top())==null||t.push(e)},this.open=e=>{this.elements.push(e)},this.close=()=>{const e=this.elements.pop();if(!e)throw Tm();return e}}},a(Qo,"U"),Qo);var bi;let vC=(bi=class extends vg{constructor(e,t,r){super(),this.type=e,this.content=t,this.attrs=r}push(e,...t){this.content.push(e,...t)}pop(){return this.content.pop()}static create(e,t,r){return new bi(e,t,r)}},a(bi,"B"),bi);var Ft,Ji,Ws,qs,Ks,Zi,Gi,Xo;const Hc=(Xo=class extends Ng{constructor(e){super(),Re(this,Ft,void 0),Re(this,Ji,void 0),Re(this,Ws,void 0),Re(this,qs,void 0),Re(this,Ks,void 0),Re(this,Zi,void 0),Re(this,Gi,void 0),Te(this,Ft,fe.none),Te(this,Ji,t=>t.isText),Te(this,Ws,(t,r)=>{if(he(this,Ji).call(this,t)&&he(this,Ji).call(this,r)&&fe.sameSet(t.marks,r.marks))return this.schema.text(t.text+r.text,t.marks)}),Te(this,qs,t=>{const r=Object.values({...this.schema.nodes,...this.schema.marks}).find(i=>i.spec.parseMarkdown.match(t));if(!r)throw ib(t);return r}),Te(this,Ks,t=>{const r=he(this,qs).call(this,t);r.spec.parseMarkdown.runner(this,t,r)}),this.injectRoot=(t,r,i)=>(this.openNode(r,i),this.next(t.children),this),this.openNode=(t,r)=>(this.open(vC.create(t,[],r)),this),Te(this,Zi,()=>{Te(this,Ft,fe.none);const t=this.close();return he(this,Gi).call(this,t.type,t.attrs,t.content)}),this.closeNode=()=>(he(this,Zi).call(this),this),Te(this,Gi,(t,r,i)=>{const o=t.createAndFill(r,i,he(this,Ft));if(!o)throw rb(t,r,i);return this.push(o),o}),this.addNode=(t,r,i)=>(he(this,Gi).call(this,t,r,i),this),this.openMark=(t,r)=>{const i=t.create(r);return Te(this,Ft,i.addToSet(he(this,Ft))),this},this.closeMark=t=>(Te(this,Ft,t.removeFromSet(he(this,Ft))),this),this.addText=t=>{const r=this.top();if(!r)throw Tm();const i=r.pop(),o=this.schema.text(t,he(this,Ft));if(!i)return r.push(o),this;const s=he(this,Ws).call(this,i,o);return s?(r.push(s),this):(r.push(i,o),this)},this.build=()=>{let t;do t=he(this,Zi).call(this);while(this.size());return t},this.next=(t=[])=>([t].flat().forEach(r=>he(this,Ks).call(this,r)),this),this.toDoc=()=>this.build(),this.run=(t,r)=>{const i=t.runSync(t.parse(r),r);return this.next(i),this},this.schema=e}},a(Xo,"S"),Xo);Ft=new WeakMap,Ji=new WeakMap,Ws=new WeakMap,qs=new WeakMap,Ks=new WeakMap,Zi=new WeakMap,Gi=new WeakMap,Hc.create=(n,e)=>{const t=new Hc(n);return r=>(t.run(e,r),t.toDoc())};let NC=Hc;var es;const jc=(es=class extends vg{constructor(e,t,r,i={}){super(),this.type=e,this.children=t,this.value=r,this.props=i,this.push=(o,...s)=>{this.children||(this.children=[]),this.children.push(o,...s)},this.pop=()=>{var o;return(o=this.children)==null?void 0:o.pop()}}},a(es,"q"),es);jc.create=(n,e,t,r={})=>new jc(n,e,t,r);let Wf=jc;const MC=a(n=>Object.prototype.hasOwnProperty.call(n,"size"),"Z$3");var tn,Yi,Us,Js,Qi,Zs,Xi,Gs,jr,eo,Ys,to,ts;const Vc=(ts=class extends Ng{constructor(e){super(),Re(this,tn,void 0),Re(this,Yi,void 0),Re(this,Us,void 0),Re(this,Js,void 0),Re(this,Qi,void 0),Re(this,Zs,void 0),Re(this,Xi,void 0),Re(this,Gs,void 0),Re(this,jr,void 0),Re(this,eo,void 0),Re(this,Ys,void 0),Re(this,to,void 0),Te(this,tn,fe.none),Te(this,Yi,t=>{const r=Object.values({...this.schema.nodes,...this.schema.marks}).find(i=>i.spec.toMarkdown.match(t));if(!r)throw ob(t.type);return r}),Te(this,Us,t=>he(this,Yi).call(this,t).spec.toMarkdown.runner(this,t)),Te(this,Js,(t,r)=>he(this,Yi).call(this,t).spec.toMarkdown.runner(this,t,r)),Te(this,Qi,t=>{const{marks:r}=t,i=a(o=>o.type.spec.priority??50,"e");[...r].sort((o,s)=>i(o)-i(s)).every(o=>!he(this,Js).call(this,o,t))&&he(this,Us).call(this,t),r.forEach(o=>he(this,to).call(this,o))}),Te(this,Zs,(t,r)=>{var i;if(t.type===r||((i=t.children)==null?void 0:i.length)!==1)return t;const o=a(u=>{var h;if(u.type===r)return u;if(((h=u.children)==null?void 0:h.length)!==1)return null;const[d]=u.children;return d?o(d):null},"e"),s=o(t);if(!s)return t;const l=s.children?[...s.children]:void 0,c={...t,children:l};return c.children=l,s.children=[c],s}),Te(this,Xi,t=>{const{children:r}=t;return r&&(t.children=r.reduce((i,o,s)=>{if(s===0)return[o];const l=i.at(-1);if(l&&l.isMark&&o.isMark){o=he(this,Zs).call(this,o,l.type);const{children:c,...u}=o,{children:h,...d}=l;if(o.type===l.type&&c&&h&&JSON.stringify(u)===JSON.stringify(d)){const f={...d,children:[...h,...c]};return i.slice(0,-1).concat(he(this,Xi).call(this,f))}}return i.concat(o)},[])),t}),Te(this,Gs,t=>{const r={...t.props,type:t.type};return t.children&&(r.children=t.children),t.value&&(r.value=t.value),r}),this.openNode=(t,r,i)=>(this.open(Wf.create(t,void 0,r,i)),this),Te(this,jr,()=>{const t=this.close();return he(this,eo).call(this,t.type,t.children,t.value,t.props)}),this.closeNode=()=>(he(this,jr).call(this),this),Te(this,eo,(t,r,i,o)=>{const s=Wf.create(t,r,i,o),l=he(this,Xi).call(this,he(this,Gs).call(this,s));return this.push(l),l}),this.addNode=(t,r,i,o)=>(he(this,eo).call(this,t,r,i,o),this),Te(this,Ys,(t,r,i,o)=>t.isInSet(he(this,tn))?this:(Te(this,tn,t.addToSet(he(this,tn))),this.openNode(r,i,{...o,isMark:!0}))),Te(this,to,t=>{t.isInSet(he(this,tn))&&(Te(this,tn,t.type.removeFromSet(he(this,tn))),he(this,jr).call(this))}),this.withMark=(t,r,i,o)=>(he(this,Ys).call(this,t,r,i,o),this),this.closeMark=t=>(he(this,to).call(this,t),this),this.build=()=>{let t=null;do t=he(this,jr).call(this);while(this.size());return t},this.next=t=>MC(t)?(t.forEach(r=>{he(this,Qi).call(this,r)}),this):(he(this,Qi).call(this,t),this),this.toString=t=>t.stringify(this.build()),this.run=t=>(this.next(t),this),this.schema=e}},a(ts,"z"),ts);tn=new WeakMap,Yi=new WeakMap,Us=new WeakMap,Js=new WeakMap,Qi=new WeakMap,Zs=new WeakMap,Xi=new WeakMap,Gs=new WeakMap,jr=new WeakMap,eo=new WeakMap,Ys=new WeakMap,to=new WeakMap,Vc.create=(n,e)=>{const t=new Vc(n);return r=>(t.run(r),t.toString(e))};let TC=Vc;const Mg=65535,Tg=Math.pow(2,16);function $C(n,e){return n+e*Tg}a($C,"makeRecover");function qf(n){return n&Mg}a(qf,"recoverIndex");function AC(n){return(n-(n&Mg))/Tg}a(AC,"recoverOffset");const $g=1,Ag=2,Qs=4,Ig=8,vd=class vd{constructor(e,t,r){this.pos=e,this.delInfo=t,this.recover=r}get deleted(){return(this.delInfo&Ig)>0}get deletedBefore(){return(this.delInfo&($g|Qs))>0}get deletedAfter(){return(this.delInfo&(Ag|Qs))>0}get deletedAcross(){return(this.delInfo&Qs)>0}};a(vd,"MapResult");let Io=vd;const In=class In{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&In.empty)return In.empty}recover(e){let t=0,r=qf(e);if(!this.inverted)for(let i=0;i<r;i++)t+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[r*3]+t+AC(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,r){let i=0,o=this.inverted?2:1,s=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let c=this.ranges[l]-(this.inverted?i:0);if(c>e)break;let u=this.ranges[l+o],h=this.ranges[l+s],d=c+u;if(e<=d){let f=u?e==c?-1:e==d?1:t:t,p=c+i+(f<0?0:h);if(r)return p;let m=e==(t<0?c:d)?null:$C(l/3,e-c),g=e==c?Ag:e==d?$g:Qs;return(t<0?e!=c:e!=d)&&(g|=Ig),new Io(p,g,m)}i+=h-u}return r?e+i:new Io(e+i,0,null)}touches(e,t){let r=0,i=qf(t),o=this.inverted?2:1,s=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let c=this.ranges[l]-(this.inverted?r:0);if(c>e)break;let u=this.ranges[l+o],h=c+u;if(e<=h&&l==i*3)return!0;r+=this.ranges[l+s]-u}return!1}forEach(e){let t=this.inverted?2:1,r=this.inverted?1:2;for(let i=0,o=0;i<this.ranges.length;i+=3){let s=this.ranges[i],l=s-(this.inverted?o:0),c=s+(this.inverted?0:o),u=this.ranges[i+t],h=this.ranges[i+r];e(l,l+u,c,c+h),o+=h-u}}invert(){return new In(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?In.empty:new In(e<0?[0,-e,0]:[0,0,e])}};a(In,"StepMap");let hn=In;hn.empty=new hn([]);const Xr=class Xr{constructor(e=[],t,r=0,i=e.length){this.maps=e,this.mirror=t,this.from=r,this.to=i}slice(e=0,t=this.maps.length){return new Xr(this.maps,this.mirror,e,t)}copy(){return new Xr(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(e,t){this.to=this.maps.push(e),t!=null&&this.setMirror(this.maps.length-1,t)}appendMapping(e){for(let t=0,r=this.maps.length;t<e.maps.length;t++){let i=e.getMirror(t);this.appendMap(e.maps[t],i!=null&&i<t?r+i:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,r=this.maps.length+e.maps.length;t>=0;t--){let i=e.getMirror(t);this.appendMap(e.maps[t].invert(),i!=null&&i>t?r-i-1:void 0)}}invert(){let e=new Xr;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let r=this.from;r<this.to;r++)e=this.maps[r].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,r){let i=0;for(let o=this.from;o<this.to;o++){let s=this.maps[o],l=s.mapResult(e,t);if(l.recover!=null){let c=this.getMirror(o);if(c!=null&&c>o&&c<this.to){o=c,e=this.maps[c].recover(l.recover);continue}}i|=l.delInfo,e=l.pos}return r?e:new Io(e,i,null)}};a(Xr,"Mapping");let Cl=Xr;const _a=Object.create(null),Nd=class Nd{getMap(){return hn.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=_a[t.stepType];if(!r)throw new RangeError(`No step type ${t.stepType} defined`);return r.fromJSON(e,t)}static jsonID(e,t){if(e in _a)throw new RangeError("Duplicate use of step JSON ID "+e);return _a[e]=t,t.prototype.jsonID=e,t}};a(Nd,"Step");let Pe=Nd;const lr=class lr{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new lr(e,null)}static fail(e){return new lr(null,e)}static fromReplace(e,t,r,i){try{return lr.ok(e.replace(t,r,i))}catch(o){if(o instanceof ui)return lr.fail(o.message);throw o}}};a(lr,"StepResult");let qe=lr;function Hu(n,e,t){let r=[];for(let i=0;i<n.childCount;i++){let o=n.child(i);o.content.size&&(o=o.copy(Hu(o.content,e,o))),o.isInline&&(o=e(o,t,i)),r.push(o)}return P.fromArray(r)}a(Hu,"mapFragment");const ar=class ar extends Pe{constructor(e,t,r){super(),this.from=e,this.to=t,this.mark=r}apply(e){let t=e.slice(this.from,this.to),r=e.resolve(this.from),i=r.node(r.sharedDepth(this.to)),o=new U(Hu(t.content,(s,l)=>!s.isAtom||!l.type.allowsMarkType(this.mark.type)?s:s.mark(this.mark.addToSet(s.marks)),i),t.openStart,t.openEnd);return qe.fromReplace(e,this.from,this.to,o)}invert(){return new Er(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deleted&&r.deleted||t.pos>=r.pos?null:new ar(t.pos,r.pos,this.mark)}merge(e){return e instanceof ar&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new ar(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new ar(t.from,t.to,e.markFromJSON(t.mark))}};a(ar,"AddMarkStep");let hi=ar;Pe.jsonID("addMark",hi);const cr=class cr extends Pe{constructor(e,t,r){super(),this.from=e,this.to=t,this.mark=r}apply(e){let t=e.slice(this.from,this.to),r=new U(Hu(t.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),t.openStart,t.openEnd);return qe.fromReplace(e,this.from,this.to,r)}invert(){return new hi(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deleted&&r.deleted||t.pos>=r.pos?null:new cr(t.pos,r.pos,this.mark)}merge(e){return e instanceof cr&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new cr(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new cr(t.from,t.to,e.markFromJSON(t.mark))}};a(cr,"RemoveMarkStep");let Er=cr;Pe.jsonID("removeMark",Er);const ur=class ur extends Pe{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return qe.fail("No node at mark step's position");let r=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return qe.fromReplace(e,this.pos,this.pos+1,new U(P.from(r),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let r=this.mark.addToSet(t.marks);if(r.length==t.marks.length){for(let i=0;i<t.marks.length;i++)if(!t.marks[i].isInSet(r))return new ur(this.pos,t.marks[i]);return new ur(this.pos,this.mark)}}return new Oo(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new ur(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new ur(t.pos,e.markFromJSON(t.mark))}};a(ur,"AddNodeMarkStep");let Eo=ur;Pe.jsonID("addNodeMark",Eo);const No=class No extends Pe{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return qe.fail("No node at mark step's position");let r=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return qe.fromReplace(e,this.pos,this.pos+1,new U(P.from(r),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new Eo(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new No(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new No(t.pos,e.markFromJSON(t.mark))}};a(No,"RemoveNodeMarkStep");let Oo=No;Pe.jsonID("removeNodeMark",Oo);const rn=class rn extends Pe{constructor(e,t,r,i=!1){super(),this.from=e,this.to=t,this.slice=r,this.structure=i}apply(e){return this.structure&&Wc(e,this.from,this.to)?qe.fail("Structure replace would overwrite content"):qe.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new hn([this.from,this.to-this.from,this.slice.size])}invert(e){return new rn(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deletedAcross&&r.deletedAcross?null:new rn(t.pos,Math.max(t.pos,r.pos),this.slice)}merge(e){if(!(e instanceof rn)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?U.empty:new U(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new rn(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?U.empty:new U(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new rn(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new rn(t.from,t.to,U.fromJSON(e,t.slice),!!t.structure)}};a(rn,"ReplaceStep");let Nt=rn;Pe.jsonID("replace",Nt);const ei=class ei extends Pe{constructor(e,t,r,i,o,s,l=!1){super(),this.from=e,this.to=t,this.gapFrom=r,this.gapTo=i,this.slice=o,this.insert=s,this.structure=l}apply(e){if(this.structure&&(Wc(e,this.from,this.gapFrom)||Wc(e,this.gapTo,this.to)))return qe.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return qe.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,t.content);return r?qe.fromReplace(e,this.from,this.to,r):qe.fail("Content does not fit in gap")}getMap(){return new hn([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new ei(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),i=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),o=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return t.deletedAcross&&r.deletedAcross||i<t.pos||o>r.pos?null:new ei(t.pos,r.pos,i,o,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ei(t.from,t.to,t.gapFrom,t.gapTo,U.fromJSON(e,t.slice),t.insert,!!t.structure)}};a(ei,"ReplaceAroundStep");let at=ei;Pe.jsonID("replaceAround",at);function Wc(n,e,t){let r=n.resolve(e),i=t-e,o=r.depth;for(;i>0&&o>0&&r.indexAfter(o)==r.node(o).childCount;)o--,i--;if(i>0){let s=r.node(o).maybeChild(r.indexAfter(o));for(;i>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,i--}}return!1}a(Wc,"contentBetween");function IC(n,e,t,r){let i=[],o=[],s,l;n.doc.nodesBetween(e,t,(c,u,h)=>{if(!c.isInline)return;let d=c.marks;if(!r.isInSet(d)&&h.type.allowsMarkType(r.type)){let f=Math.max(u,e),p=Math.min(u+c.nodeSize,t),m=r.addToSet(d);for(let g=0;g<d.length;g++)d[g].isInSet(m)||(s&&s.to==f&&s.mark.eq(d[g])?s.to=p:i.push(s=new Er(f,p,d[g])));l&&l.to==f?l.to=p:o.push(l=new hi(f,p,r))}}),i.forEach(c=>n.step(c)),o.forEach(c=>n.step(c))}a(IC,"addMark");function EC(n,e,t,r){let i=[],o=0;n.doc.nodesBetween(e,t,(s,l)=>{if(!s.isInline)return;o++;let c=null;if(r instanceof kl){let u=s.marks,h;for(;h=r.isInSet(u);)(c||(c=[])).push(h),u=h.removeFromSet(u)}else r?r.isInSet(s.marks)&&(c=[r]):c=s.marks;if(c&&c.length){let u=Math.min(l+s.nodeSize,t);for(let h=0;h<c.length;h++){let d=c[h],f;for(let p=0;p<i.length;p++){let m=i[p];m.step==o-1&&d.eq(i[p].style)&&(f=m)}f?(f.to=u,f.step=o):i.push({style:d,from:Math.max(l,e),to:u,step:o})}}}),i.forEach(s=>n.step(new Er(s.from,s.to,s.style)))}a(EC,"removeMark");function Eg(n,e,t,r=t.contentMatch,i=!0){let o=n.doc.nodeAt(e),s=[],l=e+1;for(let c=0;c<o.childCount;c++){let u=o.child(c),h=l+u.nodeSize,d=r.matchType(u.type);if(!d)s.push(new Nt(l,h,U.empty));else{r=d;for(let f=0;f<u.marks.length;f++)t.allowsMarkType(u.marks[f].type)||n.step(new Er(l,h,u.marks[f]));if(i&&u.isText&&t.whitespace!="pre"){let f,p=/\r?\n|\r/g,m;for(;f=p.exec(u.text);)m||(m=new U(P.from(t.schema.text(" ",t.allowedMarks(u.marks))),0,0)),s.push(new Nt(l+f.index,l+f.index+f[0].length,m))}}l=h}if(!r.validEnd){let c=r.fillBefore(P.empty,!0);n.replace(l,l,new U(c,0,0))}for(let c=s.length-1;c>=0;c--)n.step(s[c])}a(Eg,"clearIncompatible");function OC(n,e,t){return(e==0||n.canReplace(e,n.childCount))&&(t==n.childCount||n.canReplace(0,t))}a(OC,"canCut");function ta(n){let t=n.parent.content.cutByIndex(n.startIndex,n.endIndex);for(let r=n.depth;;--r){let i=n.$from.node(r),o=n.$from.index(r),s=n.$to.indexAfter(r);if(r<n.depth&&i.canReplace(o,s,t))return r;if(r==0||i.type.spec.isolating||!OC(i,o,s))break}return null}a(ta,"liftTarget");function _C(n,e,t){let{$from:r,$to:i,depth:o}=e,s=r.before(o+1),l=i.after(o+1),c=s,u=l,h=P.empty,d=0;for(let m=o,g=!1;m>t;m--)g||r.index(m)>0?(g=!0,h=P.from(r.node(m).copy(h)),d++):c--;let f=P.empty,p=0;for(let m=o,g=!1;m>t;m--)g||i.after(m+1)<i.end(m)?(g=!0,f=P.from(i.node(m).copy(f)),p++):u++;n.step(new at(c,u,s,l,new U(h.append(f),d,p),h.size-d,!0))}a(_C,"lift");function Og(n,e,t=null,r=n){let i=DC(n,e),o=i&&RC(r,e);return o?i.map(Kf).concat({type:e,attrs:t}).concat(o.map(Kf)):null}a(Og,"findWrapping");function Kf(n){return{type:n,attrs:null}}a(Kf,"withAttrs");function DC(n,e){let{parent:t,startIndex:r,endIndex:i}=n,o=t.contentMatchAt(r).findWrapping(e);if(!o)return null;let s=o.length?o[0]:e;return t.canReplaceWith(r,i,s)?o:null}a(DC,"findWrappingOutside");function RC(n,e){let{parent:t,startIndex:r,endIndex:i}=n,o=t.child(r),s=e.contentMatch.findWrapping(o.type);if(!s)return null;let c=(s.length?s[s.length-1]:e).contentMatch;for(let u=r;c&&u<i;u++)c=c.matchType(t.child(u).type);return!c||!c.validEnd?null:s}a(RC,"findWrappingInside");function zC(n,e,t){let r=P.empty;for(let s=t.length-1;s>=0;s--){if(r.size){let l=t[s].type.contentMatch.matchFragment(r);if(!l||!l.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=P.from(t[s].type.create(t[s].attrs,r))}let i=e.start,o=e.end;n.step(new at(i,o,i,o,new U(r,0,0),t.length,!0))}a(zC,"wrap");function PC(n,e,t,r,i){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let o=n.steps.length;n.doc.nodesBetween(e,t,(s,l)=>{if(s.isTextblock&&!s.hasMarkup(r,i)&&BC(n.doc,n.mapping.slice(o).map(l),r)){let c=null;if(r.schema.linebreakReplacement){let f=r.whitespace=="pre",p=!!r.contentMatch.matchType(r.schema.linebreakReplacement);f&&!p?c=!1:!f&&p&&(c=!0)}c===!1&&LC(n,s,l,o),Eg(n,n.mapping.slice(o).map(l,1),r,void 0,c===null);let u=n.mapping.slice(o),h=u.map(l,1),d=u.map(l+s.nodeSize,1);return n.step(new at(h,d,h+1,d-1,new U(P.from(r.create(i,null,s.marks)),0,0),1,!0)),c===!0&&FC(n,s,l,o),!1}})}a(PC,"setBlockType$1");function FC(n,e,t,r){e.forEach((i,o)=>{if(i.isText){let s,l=/\r?\n|\r/g;for(;s=l.exec(i.text);){let c=n.mapping.slice(r).map(t+1+o+s.index);n.replaceWith(c,c+1,e.type.schema.linebreakReplacement.create())}}})}a(FC,"replaceNewlines");function LC(n,e,t,r){e.forEach((i,o)=>{if(i.type==i.type.schema.linebreakReplacement){let s=n.mapping.slice(r).map(t+1+o);n.replaceWith(s,s+1,e.type.schema.text(`
`))}})}a(LC,"replaceLinebreaks");function BC(n,e,t){let r=n.resolve(e),i=r.index();return r.parent.canReplaceWith(i,i+1,t)}a(BC,"canChangeType");function HC(n,e,t,r,i){let o=n.doc.nodeAt(e);if(!o)throw new RangeError("No node at given position");t||(t=o.type);let s=t.create(r,null,i||o.marks);if(o.isLeaf)return n.replaceWith(e,e+o.nodeSize,s);if(!t.validContent(o.content))throw new RangeError("Invalid content for node type "+t.name);n.step(new at(e,e+o.nodeSize,e+1,e+o.nodeSize-1,new U(P.from(s),0,0),1,!0))}a(HC,"setNodeMarkup");function fo(n,e,t=1,r){let i=n.resolve(e),o=i.depth-t,s=r&&r[r.length-1]||i.parent;if(o<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!s.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let u=i.depth-1,h=t-2;u>o;u--,h--){let d=i.node(u),f=i.index(u);if(d.type.spec.isolating)return!1;let p=d.content.cutByIndex(f,d.childCount),m=r&&r[h+1];m&&(p=p.replaceChild(0,m.type.create(m.attrs)));let g=r&&r[h]||d;if(!d.canReplace(f+1,d.childCount)||!g.type.validContent(p))return!1}let l=i.indexAfter(o),c=r&&r[0];return i.node(o).canReplaceWith(l,l,c?c.type:i.node(o+1).type)}a(fo,"canSplit");function jC(n,e,t=1,r){let i=n.doc.resolve(e),o=P.empty,s=P.empty;for(let l=i.depth,c=i.depth-t,u=t-1;l>c;l--,u--){o=P.from(i.node(l).copy(o));let h=r&&r[u];s=P.from(h?h.type.create(h.attrs,s):i.node(l).copy(s))}n.step(new Nt(e,e,new U(o.append(s),t,t),!0))}a(jC,"split");function na(n,e){let t=n.resolve(e),r=t.index();return VC(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(r,r+1)}a(na,"canJoin");function VC(n,e){return!!(n&&e&&!n.isLeaf&&n.canAppend(e))}a(VC,"joinable");function WC(n,e,t){let r=new Nt(e-t,e+t,U.empty,!0);n.step(r)}a(WC,"join");function qC(n,e,t){let r=n.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),t))return e;if(r.parentOffset==0)for(let i=r.depth-1;i>=0;i--){let o=r.index(i);if(r.node(i).canReplaceWith(o,o,t))return r.before(i+1);if(o>0)return null}if(r.parentOffset==r.parent.content.size)for(let i=r.depth-1;i>=0;i--){let o=r.indexAfter(i);if(r.node(i).canReplaceWith(o,o,t))return r.after(i+1);if(o<r.node(i).childCount)return null}return null}a(qC,"insertPoint");function KC(n,e,t){let r=n.resolve(e);if(!t.content.size)return e;let i=t.content;for(let o=0;o<t.openStart;o++)i=i.firstChild.content;for(let o=1;o<=(t.openStart==0&&t.size?2:1);o++)for(let s=r.depth;s>=0;s--){let l=s==r.depth?0:r.pos<=(r.start(s+1)+r.end(s+1))/2?-1:1,c=r.index(s)+(l>0?1:0),u=r.node(s),h=!1;if(o==1)h=u.canReplace(c,c,i);else{let d=u.contentMatchAt(c).findWrapping(i.firstChild.type);h=d&&u.canReplaceWith(c,c,d[0])}if(h)return l==0?r.pos:l<0?r.before(s+1):r.after(s+1)}return null}a(KC,"dropPoint");function ju(n,e,t=e,r=U.empty){if(e==t&&!r.size)return null;let i=n.resolve(e),o=n.resolve(t);return _g(i,o,r)?new Nt(e,t,r):new qc(i,o,r).fit()}a(ju,"replaceStep");function _g(n,e,t){return!t.openStart&&!t.openEnd&&n.start()==e.start()&&n.parent.canReplace(n.index(),e.index(),t.content)}a(_g,"fitsTrivially");const Md=class Md{constructor(e,t,r){this.$from=e,this.$to=t,this.unplaced=r,this.frontier=[],this.placed=P.empty;for(let i=0;i<=e.depth;i++){let o=e.node(i);this.frontier.push({type:o.type,match:o.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=P.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,r=this.$from,i=this.close(e<0?this.$to:r.doc.resolve(e));if(!i)return null;let o=this.placed,s=r.depth,l=i.depth;for(;s&&l&&o.childCount==1;)o=o.firstChild.content,s--,l--;let c=new U(o,s,l);return e>-1?new at(r.pos,e,this.$to.pos,this.$to.end(),c,t):c.size||r.pos!=this.$to.pos?new Nt(r.pos,i.pos,c):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,r=0,i=this.unplaced.openEnd;r<e;r++){let o=t.firstChild;if(t.childCount>1&&(i=0),o.type.spec.isolating&&i<=r){e=r;break}t=o.content}for(let t=1;t<=2;t++)for(let r=t==1?e:this.unplaced.openStart;r>=0;r--){let i,o=null;r?(o=Da(this.unplaced.content,r-1).firstChild,i=o.content):i=this.unplaced.content;let s=i.firstChild;for(let l=this.depth;l>=0;l--){let{type:c,match:u}=this.frontier[l],h,d=null;if(t==1&&(s?u.matchType(s.type)||(d=u.fillBefore(P.from(s),!1)):o&&c.compatibleContent(o.type)))return{sliceDepth:r,frontierDepth:l,parent:o,inject:d};if(t==2&&s&&(h=u.findWrapping(s.type)))return{sliceDepth:r,frontierDepth:l,parent:o,wrap:h};if(o&&u.matchType(o.type))break}}}openMore(){let{content:e,openStart:t,openEnd:r}=this.unplaced,i=Da(e,t);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new U(e,t+1,Math.max(r,i.size+t>=e.size-r?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:r}=this.unplaced,i=Da(e,t);if(i.childCount<=1&&t>0){let o=e.size-t<=t+i.size;this.unplaced=new U(no(e,t-1,1),t-1,o?t-1:r)}else this.unplaced=new U(no(e,t,1),t,r)}placeNodes({sliceDepth:e,frontierDepth:t,parent:r,inject:i,wrap:o}){for(;this.depth>t;)this.closeFrontierNode();if(o)for(let g=0;g<o.length;g++)this.openFrontierNode(o[g]);let s=this.unplaced,l=r?r.content:s.content,c=s.openStart-e,u=0,h=[],{match:d,type:f}=this.frontier[t];if(i){for(let g=0;g<i.childCount;g++)h.push(i.child(g));d=d.matchFragment(i)}let p=l.size+e-(s.content.size-s.openEnd);for(;u<l.childCount;){let g=l.child(u),k=d.matchType(g.type);if(!k)break;u++,(u>1||c==0||g.content.size)&&(d=k,h.push(Dg(g.mark(f.allowedMarks(g.marks)),u==1?c:0,u==l.childCount?p:-1)))}let m=u==l.childCount;m||(p=-1),this.placed=ro(this.placed,t,P.from(h)),this.frontier[t].match=d,m&&p<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let g=0,k=l;g<p;g++){let b=k.lastChild;this.frontier.push({type:b.type,match:b.contentMatchAt(b.childCount)}),k=b.content}this.unplaced=m?e==0?U.empty:new U(no(s.content,e-1,1),e-1,p<0?s.openEnd:e-1):new U(no(s.content,e,u),s.openStart,s.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!Ra(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:r}=this.$to,i=this.$to.after(r);for(;r>1&&i==this.$to.end(--r);)++i;return i}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:r,type:i}=this.frontier[t],o=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),s=Ra(e,t,i,r,o);if(s){for(let l=t-1;l>=0;l--){let{match:c,type:u}=this.frontier[l],h=Ra(e,l,u,c,!0);if(!h||h.childCount)continue e}return{depth:t,fit:s,move:o?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=ro(this.placed,t.depth,t.fit)),e=t.move;for(let r=t.depth+1;r<=e.depth;r++){let i=e.node(r),o=i.type.contentMatch.fillBefore(i.content,!0,e.index(r));this.openFrontierNode(i.type,i.attrs,o)}return e}openFrontierNode(e,t=null,r){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=ro(this.placed,this.depth,P.from(e.create(t,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(P.empty,!0);t.childCount&&(this.placed=ro(this.placed,this.frontier.length,t))}};a(Md,"Fitter");let qc=Md;function no(n,e,t){return e==0?n.cutByIndex(t,n.childCount):n.replaceChild(0,n.firstChild.copy(no(n.firstChild.content,e-1,t)))}a(no,"dropFromFragment");function ro(n,e,t){return e==0?n.append(t):n.replaceChild(n.childCount-1,n.lastChild.copy(ro(n.lastChild.content,e-1,t)))}a(ro,"addToFragment");function Da(n,e){for(let t=0;t<e;t++)n=n.firstChild.content;return n}a(Da,"contentAt");function Dg(n,e,t){if(e<=0)return n;let r=n.content;return e>1&&(r=r.replaceChild(0,Dg(r.firstChild,e-1,r.childCount==1?t-1:0))),e>0&&(r=n.type.contentMatch.fillBefore(r).append(r),t<=0&&(r=r.append(n.type.contentMatch.matchFragment(r).fillBefore(P.empty,!0)))),n.copy(r)}a(Dg,"closeNodeStart");function Ra(n,e,t,r,i){let o=n.node(e),s=i?n.indexAfter(e):n.index(e);if(s==o.childCount&&!t.compatibleContent(o.type))return null;let l=r.fillBefore(o.content,!0,s);return l&&!UC(t,o.content,s)?l:null}a(Ra,"contentAfterFits");function UC(n,e,t){for(let r=t;r<e.childCount;r++)if(!n.allowsMarks(e.child(r).marks))return!0;return!1}a(UC,"invalidMarks");function JC(n){return n.spec.defining||n.spec.definingForContent}a(JC,"definesContent");function ZC(n,e,t,r){if(!r.size)return n.deleteRange(e,t);let i=n.doc.resolve(e),o=n.doc.resolve(t);if(_g(i,o,r))return n.step(new Nt(e,t,r));let s=zg(i,n.doc.resolve(t));s[s.length-1]==0&&s.pop();let l=-(i.depth+1);s.unshift(l);for(let f=i.depth,p=i.pos-1;f>0;f--,p--){let m=i.node(f).type.spec;if(m.defining||m.definingAsContext||m.isolating)break;s.indexOf(f)>-1?l=f:i.before(f)==p&&s.splice(1,0,-f)}let c=s.indexOf(l),u=[],h=r.openStart;for(let f=r.content,p=0;;p++){let m=f.firstChild;if(u.push(m),p==r.openStart)break;f=m.content}for(let f=h-1;f>=0;f--){let p=u[f],m=JC(p.type);if(m&&!p.sameMarkup(i.node(Math.abs(l)-1)))h=f;else if(m||!p.type.isTextblock)break}for(let f=r.openStart;f>=0;f--){let p=(f+h+1)%(r.openStart+1),m=u[p];if(m)for(let g=0;g<s.length;g++){let k=s[(g+c)%s.length],b=!0;k<0&&(b=!1,k=-k);let x=i.node(k-1),C=i.index(k-1);if(x.canReplaceWith(C,C,m.type,m.marks))return n.replace(i.before(k),b?o.after(k):t,new U(Rg(r.content,0,r.openStart,p),p,r.openEnd))}}let d=n.steps.length;for(let f=s.length-1;f>=0&&(n.replace(e,t,r),!(n.steps.length>d));f--){let p=s[f];p<0||(e=i.before(p),t=o.after(p))}}a(ZC,"replaceRange");function Rg(n,e,t,r,i){if(e<t){let o=n.firstChild;n=n.replaceChild(0,o.copy(Rg(o.content,e+1,t,r,o)))}if(e>r){let o=i.contentMatchAt(0),s=o.fillBefore(n).append(n);n=s.append(o.matchFragment(s).fillBefore(P.empty,!0))}return n}a(Rg,"closeFragment");function GC(n,e,t,r){if(!r.isInline&&e==t&&n.doc.resolve(e).parent.content.size){let i=qC(n.doc,e,r.type);i!=null&&(e=t=i)}n.replaceRange(e,t,new U(P.from(r),0,0))}a(GC,"replaceRangeWith");function YC(n,e,t){let r=n.doc.resolve(e),i=n.doc.resolve(t),o=zg(r,i);for(let s=0;s<o.length;s++){let l=o[s],c=s==o.length-1;if(c&&l==0||r.node(l).type.contentMatch.validEnd)return n.delete(r.start(l),i.end(l));if(l>0&&(c||r.node(l-1).canReplace(r.index(l-1),i.indexAfter(l-1))))return n.delete(r.before(l),i.after(l))}for(let s=1;s<=r.depth&&s<=i.depth;s++)if(e-r.start(s)==r.depth-s&&t>r.end(s)&&i.end(s)-t!=i.depth-s)return n.delete(r.before(s),t);n.delete(e,t)}a(YC,"deleteRange");function zg(n,e){let t=[],r=Math.min(n.depth,e.depth);for(let i=r;i>=0;i--){let o=n.start(i);if(o<n.pos-(n.depth-i)||e.end(i)>e.pos+(e.depth-i)||n.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(o==e.start(i)||i==n.depth&&i==e.depth&&n.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==o-1)&&t.push(i)}return t}a(zg,"coveredDepths");const ti=class ti extends Pe{constructor(e,t,r){super(),this.pos=e,this.attr=t,this.value=r}apply(e){let t=e.nodeAt(this.pos);if(!t)return qe.fail("No node at attribute step's position");let r=Object.create(null);for(let o in t.attrs)r[o]=t.attrs[o];r[this.attr]=this.value;let i=t.type.create(r,null,t.marks);return qe.fromReplace(e,this.pos,this.pos+1,new U(P.from(i),0,t.isLeaf?0:1))}getMap(){return hn.empty}invert(e){return new ti(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new ti(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new ti(t.pos,t.attr,t.value)}};a(ti,"AttrStep");let Sl=ti;Pe.jsonID("attr",Sl);const Mo=class Mo extends Pe{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let i in e.attrs)t[i]=e.attrs[i];t[this.attr]=this.value;let r=e.type.create(t,e.content,e.marks);return qe.ok(r)}getMap(){return hn.empty}invert(e){return new Mo(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Mo(t.attr,t.value)}};a(Mo,"DocAttrStep");let vl=Mo;Pe.jsonID("docAttr",vl);var ns;let di=(ns=class extends Error{},a(ns,"TransformError"),ns);di=a(function n(e){let t=Error.call(this,e);return t.__proto__=n.prototype,t},"TransformError");di.prototype=Object.create(Error.prototype);di.prototype.constructor=di;di.prototype.name="TransformError";const Td=class Td{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Cl}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new di(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,r=U.empty){let i=ju(this.doc,e,t,r);return i&&this.step(i),this}replaceWith(e,t,r){return this.replace(e,t,new U(P.from(r),0,0))}delete(e,t){return this.replace(e,t,U.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,r){return ZC(this,e,t,r),this}replaceRangeWith(e,t,r){return GC(this,e,t,r),this}deleteRange(e,t){return YC(this,e,t),this}lift(e,t){return _C(this,e,t),this}join(e,t=1){return WC(this,e,t),this}wrap(e,t){return zC(this,e,t),this}setBlockType(e,t=e,r,i=null){return PC(this,e,t,r,i),this}setNodeMarkup(e,t,r=null,i){return HC(this,e,t,r,i),this}setNodeAttribute(e,t,r){return this.step(new Sl(e,t,r)),this}setDocAttribute(e,t){return this.step(new vl(e,t)),this}addNodeMark(e,t){return this.step(new Eo(e,t)),this}removeNodeMark(e,t){if(!(t instanceof fe)){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(t=t.isInSet(r.marks),!t)return this}return this.step(new Oo(e,t)),this}split(e,t=1,r){return jC(this,e,t,r),this}addMark(e,t,r){return IC(this,e,t,r),this}removeMark(e,t,r){return EC(this,e,t,r),this}clearIncompatible(e,t,r){return Eg(this,e,t,r),this}};a(Td,"Transform");let Nl=Td;const za=Object.create(null),$d=class $d{constructor(e,t,r){this.$anchor=e,this.$head=t,this.ranges=r||[new Ml(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=U.empty){let r=t.content.lastChild,i=null;for(let l=0;l<t.openEnd;l++)i=r,r=r.lastChild;let o=e.steps.length,s=this.ranges;for(let l=0;l<s.length;l++){let{$from:c,$to:u}=s[l],h=e.mapping.slice(o);e.replaceRange(h.map(c.pos),h.map(u.pos),l?U.empty:t),l==0&&Zf(e,o,(r?r.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let r=e.steps.length,i=this.ranges;for(let o=0;o<i.length;o++){let{$from:s,$to:l}=i[o],c=e.mapping.slice(r),u=c.map(s.pos),h=c.map(l.pos);o?e.deleteRange(u,h):(e.replaceRangeWith(u,h,t),Zf(e,r,t.isInline?-1:1))}}static findFrom(e,t,r=!1){let i=e.parent.inlineContent?new de(e):Vr(e.node(0),e.parent,e.pos,e.index(),t,r);if(i)return i;for(let o=e.depth-1;o>=0;o--){let s=t<0?Vr(e.node(0),e.node(o),e.before(o+1),e.index(o),t,r):Vr(e.node(0),e.node(o),e.after(o+1),e.index(o)+1,t,r);if(s)return s}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new Dt(e.node(0))}static atStart(e){return Vr(e,e,0,0,1)||new Dt(e)}static atEnd(e){return Vr(e,e,e.content.size,e.childCount,-1)||new Dt(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=za[t.type];if(!r)throw new RangeError(`No selection type ${t.type} defined`);return r.fromJSON(e,t)}static jsonID(e,t){if(e in za)throw new RangeError("Duplicate use of selection JSON ID "+e);return za[e]=t,t.prototype.jsonID=e,t}getBookmark(){return de.between(this.$anchor,this.$head).getBookmark()}};a($d,"Selection");let te=$d;te.prototype.visible=!0;const Ad=class Ad{constructor(e,t){this.$from=e,this.$to=t}};a(Ad,"SelectionRange");let Ml=Ad,Uf=!1;function Jf(n){!Uf&&!n.parent.inlineContent&&(Uf=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+n.parent.type.name+")"))}a(Jf,"checkTextSelection");const hr=class hr extends te{constructor(e,t=e){Jf(e),Jf(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let r=e.resolve(t.map(this.head));if(!r.parent.inlineContent)return te.near(r);let i=e.resolve(t.map(this.anchor));return new hr(i.parent.inlineContent?i:r,r)}replace(e,t=U.empty){if(super.replace(e,t),t==U.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof hr&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Tl(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new hr(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,r=t){let i=e.resolve(t);return new this(i,r==t?i:e.resolve(r))}static between(e,t,r){let i=e.pos-t.pos;if((!r||i)&&(r=i>=0?1:-1),!t.parent.inlineContent){let o=te.findFrom(t,r,!0)||te.findFrom(t,-r,!0);if(o)t=o.$head;else return te.near(t,r)}return e.parent.inlineContent||(i==0?e=t:(e=(te.findFrom(e,-r,!0)||te.findFrom(e,r,!0)).$anchor,e.pos<t.pos!=i<0&&(e=t))),new hr(e,t)}};a(hr,"TextSelection");let de=hr;te.jsonID("text",de);const Vl=class Vl{constructor(e,t){this.anchor=e,this.head=t}map(e){return new Vl(e.map(this.anchor),e.map(this.head))}resolve(e){return de.between(e.resolve(this.anchor),e.resolve(this.head))}};a(Vl,"TextBookmark");let Tl=Vl;const dr=class dr extends te{constructor(e){let t=e.nodeAfter,r=e.node(0).resolve(e.pos+t.nodeSize);super(e,r),this.node=t}map(e,t){let{deleted:r,pos:i}=t.mapResult(this.anchor),o=e.resolve(i);return r?te.near(o):new dr(o)}content(){return new U(P.from(this.node),0,0)}eq(e){return e instanceof dr&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Kc(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new dr(e.resolve(t.anchor))}static create(e,t){return new dr(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}};a(dr,"NodeSelection");let oe=dr;oe.prototype.visible=!1;te.jsonID("node",oe);const Wl=class Wl{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:r}=e.mapResult(this.anchor);return t?new Tl(r,r):new Wl(r)}resolve(e){let t=e.resolve(this.anchor),r=t.nodeAfter;return r&&oe.isSelectable(r)?new oe(t):te.near(t)}};a(Wl,"NodeBookmark");let Kc=Wl;const ni=class ni extends te{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=U.empty){if(t==U.empty){e.delete(0,e.doc.content.size);let r=te.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new ni(e)}map(e){return new ni(e)}eq(e){return e instanceof ni}getBookmark(){return QC}};a(ni,"AllSelection");let Dt=ni;te.jsonID("all",Dt);const QC={map(){return this},resolve(n){return new Dt(n)}};function Vr(n,e,t,r,i,o=!1){if(e.inlineContent)return de.create(n,t);for(let s=r-(i>0?0:1);i>0?s<e.childCount:s>=0;s+=i){let l=e.child(s);if(l.isAtom){if(!o&&oe.isSelectable(l))return oe.create(n,t-(i<0?l.nodeSize:0))}else{let c=Vr(n,l,t+i,i<0?l.childCount:0,i,o);if(c)return c}t+=l.nodeSize*i}return null}a(Vr,"findSelectionIn");function Zf(n,e,t){let r=n.steps.length-1;if(r<e)return;let i=n.steps[r];if(!(i instanceof Nt||i instanceof at))return;let o=n.mapping.maps[r],s;o.forEach((l,c,u,h)=>{s==null&&(s=h)}),n.setSelection(te.near(n.doc.resolve(s),t))}a(Zf,"selectionToInsertionEnd");const Gf=1,Ms=2,Yf=4,Id=class Id extends Nl{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|Gf)&~Ms,this.storedMarks=null,this}get selectionSet(){return(this.updated&Gf)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Ms,this}ensureMarks(e){return fe.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Ms)>0}addStep(e,t){super.addStep(e,t),this.updated=this.updated&~Ms,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let r=this.selection;return t&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||fe.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,r){let i=this.doc.type.schema;if(t==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(r==null&&(r=t),r=r??t,!e)return this.deleteRange(t,r);let o=this.storedMarks;if(!o){let s=this.doc.resolve(t);o=r==t?s.marks():s.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(t,r,i.text(e,o)),this.selection.empty||this.setSelection(te.near(this.selection.$to)),this}}setMeta(e,t){return this.meta[typeof e=="string"?e:e.key]=t,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=Yf,this}get scrolledIntoView(){return(this.updated&Yf)>0}};a(Id,"Transaction");let Uc=Id;function Qf(n,e){return!e||!n?n:n.bind(e)}a(Qf,"bind");const Ed=class Ed{constructor(e,t,r){this.name=e,this.init=Qf(t.init,r),this.apply=Qf(t.apply,r)}};a(Ed,"FieldDesc");let mr=Ed;const XC=[new mr("doc",{init(n){return n.doc||n.schema.topNodeType.createAndFill()},apply(n){return n.doc}}),new mr("selection",{init(n,e){return n.selection||te.atStart(e.doc)},apply(n){return n.selection}}),new mr("storedMarks",{init(n){return n.storedMarks||null},apply(n,e,t,r){return r.selection.$cursor?n.storedMarks:null}}),new mr("scrollToSelection",{init(){return 0},apply(n,e){return n.scrolledIntoView?e+1:e}})],Od=class Od{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=XC.slice(),t&&t.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new mr(r.key,r.spec.state,r))})}};a(Od,"Configuration");let po=Od;const fr=class fr{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=t){let i=this.config.plugins[r];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],r=this.applyInner(e),i=null;for(;;){let o=!1;for(let s=0;s<this.config.plugins.length;s++){let l=this.config.plugins[s];if(l.spec.appendTransaction){let c=i?i[s].n:0,u=i?i[s].state:this,h=c<t.length&&l.spec.appendTransaction.call(l,c?t.slice(c):t,u,r);if(h&&r.filterTransaction(h,s)){if(h.setMeta("appendedTransaction",e),!i){i=[];for(let d=0;d<this.config.plugins.length;d++)i.push(d<s?{state:r,n:t.length}:{state:this,n:0})}t.push(h),r=r.applyInner(h),o=!0}i&&(i[s]={state:r,n:t.length})}}if(!o)return{state:r,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new fr(this.config),r=this.config.fields;for(let i=0;i<r.length;i++){let o=r[i];t[o.name]=o.apply(e,this[o.name],this,t)}return t}get tr(){return new Uc(this)}static create(e){let t=new po(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new fr(t);for(let i=0;i<t.fields.length;i++)r[t.fields[i].name]=t.fields[i].init(e,r);return r}reconfigure(e){let t=new po(this.schema,e.plugins),r=t.fields,i=new fr(t);for(let o=0;o<r.length;o++){let s=r[o].name;i[s]=this.hasOwnProperty(s)?this[s]:r[o].init(e,i)}return i}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[r],o=i.spec.state;o&&o.toJSON&&(t[r]=o.toJSON.call(i,this[i.key]))}return t}static fromJSON(e,t,r){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new po(e.schema,e.plugins),o=new fr(i);return i.fields.forEach(s=>{if(s.name=="doc")o.doc=qt.fromJSON(e.schema,t.doc);else if(s.name=="selection")o.selection=te.fromJSON(o.doc,t.selection);else if(s.name=="storedMarks")t.storedMarks&&(o.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let l in r){let c=r[l],u=c.spec.state;if(c.key==s.name&&u&&u.fromJSON&&Object.prototype.hasOwnProperty.call(t,l)){o[s.name]=u.fromJSON.call(c,e,t[l],o);return}}o[s.name]=s.init(e,o)}}),o}};a(fr,"EditorState");let Jc=fr;function Pg(n,e,t){for(let r in n){let i=n[r];i instanceof Function?i=i.bind(e):r=="handleDOMEvents"&&(i=Pg(i,e,{})),t[r]=i}return t}a(Pg,"bindProps");const _d=class _d{constructor(e){this.spec=e,this.props={},e.props&&Pg(e.props,this,this.props),this.key=e.key?e.key.key:Fg("plugin")}getState(e){return e[this.key]}};a(_d,"Plugin");let Xe=_d;const Pa=Object.create(null);function Fg(n){return n in Pa?n+"$"+ ++Pa[n]:(Pa[n]=0,n+"$")}a(Fg,"createKey");const Dd=class Dd{constructor(e="key"){this.key=Fg(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}};a(Dd,"PluginKey");let Ge=Dd;const Ve=a(function(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e},"domIndex"),_o=a(function(n){let e=n.assignedSlot||n.parentNode;return e&&e.nodeType==11?e.host:e},"parentNode");let Zc=null;const nn=a(function(n,e,t){let r=Zc||(Zc=document.createRange());return r.setEnd(n,t??n.nodeValue.length),r.setStart(n,e||0),r},"textRange"),eS=a(function(){Zc=null},"clearReusedRange"),Or=a(function(n,e,t,r){return t&&(Xf(n,e,t,r,-1)||Xf(n,e,t,r,1))},"isEquivalentPosition"),tS=/^(img|br|input|textarea|hr)$/i;function Xf(n,e,t,r,i){for(;;){if(n==t&&e==r)return!0;if(e==(i<0?0:Wt(n))){let o=n.parentNode;if(!o||o.nodeType!=1||cs(n)||tS.test(n.nodeName)||n.contentEditable=="false")return!1;e=Ve(n)+(i<0?0:1),n=o}else if(n.nodeType==1){if(n=n.childNodes[e+(i<0?-1:0)],n.contentEditable=="false")return!1;e=i<0?Wt(n):0}else return!1}}a(Xf,"scanFor");function Wt(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}a(Wt,"nodeSize");function nS(n,e){for(;;){if(n.nodeType==3&&e)return n;if(n.nodeType==1&&e>0){if(n.contentEditable=="false")return null;n=n.childNodes[e-1],e=Wt(n)}else if(n.parentNode&&!cs(n))e=Ve(n),n=n.parentNode;else return null}}a(nS,"textNodeBefore$1");function rS(n,e){for(;;){if(n.nodeType==3&&e<n.nodeValue.length)return n;if(n.nodeType==1&&e<n.childNodes.length){if(n.contentEditable=="false")return null;n=n.childNodes[e],e=0}else if(n.parentNode&&!cs(n))e=Ve(n)+1,n=n.parentNode;else return null}}a(rS,"textNodeAfter$1");function iS(n,e,t){for(let r=e==0,i=e==Wt(n);r||i;){if(n==t)return!0;let o=Ve(n);if(n=n.parentNode,!n)return!1;r=r&&o==0,i=i&&o==Wt(n)}}a(iS,"isOnEdge");function cs(n){let e;for(let t=n;t&&!(e=t.pmViewDesc);t=t.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==n||e.contentDOM==n)}a(cs,"hasBlockDesc");const ra=a(function(n){return n.focusNode&&Or(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)},"selectionCollapsed");function ir(n,e){let t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=n,t.key=t.code=e,t}a(ir,"keyEvent");function oS(n){let e=n.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}a(oS,"deepActiveElement");function sS(n,e,t){if(n.caretPositionFromPoint)try{let r=n.caretPositionFromPoint(e,t);if(r)return{node:r.offsetNode,offset:r.offset}}catch{}if(n.caretRangeFromPoint){let r=n.caretRangeFromPoint(e,t);if(r)return{node:r.startContainer,offset:r.startOffset}}}a(sS,"caretFromPoint");const Ut=typeof navigator<"u"?navigator:null,ep=typeof document<"u"?document:null,Wn=Ut&&Ut.userAgent||"",Gc=/Edge\/(\d+)/.exec(Wn),Lg=/MSIE \d/.exec(Wn),Yc=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Wn),lt=!!(Lg||Yc||Gc),Fn=Lg?document.documentMode:Yc?+Yc[1]:Gc?+Gc[1]:0,Rt=!lt&&/gecko\/(\d+)/i.test(Wn);Rt&&+(/Firefox\/(\d+)/.exec(Wn)||[0,0])[1];const Qc=!lt&&/Chrome\/(\d+)/.exec(Wn),Qe=!!Qc,lS=Qc?+Qc[1]:0,et=!lt&&!!Ut&&/Apple Computer/.test(Ut.vendor),fi=et&&(/Mobile\/\w+/.test(Wn)||!!Ut&&Ut.maxTouchPoints>2),xt=fi||(Ut?/Mac/.test(Ut.platform):!1),aS=Ut?/Win/.test(Ut.platform):!1,Ot=/Android \d/.test(Wn),us=!!ep&&"webkitFontSmoothing"in ep.documentElement.style,cS=us?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function uS(n){let e=n.defaultView&&n.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:n.documentElement.clientWidth,top:0,bottom:n.documentElement.clientHeight}}a(uS,"windowRect");function en(n,e){return typeof n=="number"?n:n[e]}a(en,"getSide");function hS(n){let e=n.getBoundingClientRect(),t=e.width/n.offsetWidth||1,r=e.height/n.offsetHeight||1;return{left:e.left,right:e.left+n.clientWidth*t,top:e.top,bottom:e.top+n.clientHeight*r}}a(hS,"clientRect");function tp(n,e,t){let r=n.someProp("scrollThreshold")||0,i=n.someProp("scrollMargin")||5,o=n.dom.ownerDocument;for(let s=t||n.dom;s;s=_o(s)){if(s.nodeType!=1)continue;let l=s,c=l==o.body,u=c?uS(o):hS(l),h=0,d=0;if(e.top<u.top+en(r,"top")?d=-(u.top-e.top+en(i,"top")):e.bottom>u.bottom-en(r,"bottom")&&(d=e.bottom-e.top>u.bottom-u.top?e.top+en(i,"top")-u.top:e.bottom-u.bottom+en(i,"bottom")),e.left<u.left+en(r,"left")?h=-(u.left-e.left+en(i,"left")):e.right>u.right-en(r,"right")&&(h=e.right-u.right+en(i,"right")),h||d)if(c)o.defaultView.scrollBy(h,d);else{let f=l.scrollLeft,p=l.scrollTop;d&&(l.scrollTop+=d),h&&(l.scrollLeft+=h);let m=l.scrollLeft-f,g=l.scrollTop-p;e={left:e.left-m,top:e.top-g,right:e.right-m,bottom:e.bottom-g}}if(c||/^(fixed|sticky)$/.test(getComputedStyle(s).position))break}}a(tp,"scrollRectIntoView");function dS(n){let e=n.dom.getBoundingClientRect(),t=Math.max(0,e.top),r,i;for(let o=(e.left+e.right)/2,s=t+1;s<Math.min(innerHeight,e.bottom);s+=5){let l=n.root.elementFromPoint(o,s);if(!l||l==n.dom||!n.dom.contains(l))continue;let c=l.getBoundingClientRect();if(c.top>=t-20){r=l,i=c.top;break}}return{refDOM:r,refTop:i,stack:Bg(n.dom)}}a(dS,"storeScrollPos");function Bg(n){let e=[],t=n.ownerDocument;for(let r=n;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),n!=t);r=_o(r));return e}a(Bg,"scrollStack");function fS({refDOM:n,refTop:e,stack:t}){let r=n?n.getBoundingClientRect().top:0;Hg(t,r==0?0:r-e)}a(fS,"resetScrollPos");function Hg(n,e){for(let t=0;t<n.length;t++){let{dom:r,top:i,left:o}=n[t];r.scrollTop!=i+e&&(r.scrollTop=i+e),r.scrollLeft!=o&&(r.scrollLeft=o)}}a(Hg,"restoreScrollStack");let Fr=null;function pS(n){if(n.setActive)return n.setActive();if(Fr)return n.focus(Fr);let e=Bg(n);n.focus(Fr==null?{get preventScroll(){return Fr={preventScroll:!0},!0}}:void 0),Fr||(Fr=!1,Hg(e,0))}a(pS,"focusPreventScroll");function jg(n,e){let t,r=2e8,i,o=0,s=e.top,l=e.top,c,u;for(let h=n.firstChild,d=0;h;h=h.nextSibling,d++){let f;if(h.nodeType==1)f=h.getClientRects();else if(h.nodeType==3)f=nn(h).getClientRects();else continue;for(let p=0;p<f.length;p++){let m=f[p];if(m.top<=s&&m.bottom>=l){s=Math.max(m.bottom,s),l=Math.min(m.top,l);let g=m.left>e.left?m.left-e.left:m.right<e.left?e.left-m.right:0;if(g<r){t=h,r=g,i=g&&t.nodeType==3?{left:m.right<e.left?m.right:m.left,top:e.top}:e,h.nodeType==1&&g&&(o=d+(e.left>=(m.left+m.right)/2?1:0));continue}}else m.top>e.top&&!c&&m.left<=e.left&&m.right>=e.left&&(c=h,u={left:Math.max(m.left,Math.min(m.right,e.left)),top:m.top});!t&&(e.left>=m.right&&e.top>=m.top||e.left>=m.left&&e.top>=m.bottom)&&(o=d+1)}}return!t&&c&&(t=c,i=u,r=0),t&&t.nodeType==3?mS(t,i):!t||r&&t.nodeType==1?{node:n,offset:o}:jg(t,i)}a(jg,"findOffsetInNode");function mS(n,e){let t=n.nodeValue.length,r=document.createRange();for(let i=0;i<t;i++){r.setEnd(n,i+1),r.setStart(n,i);let o=vn(r,1);if(o.top!=o.bottom&&Vu(e,o))return{node:n,offset:i+(e.left>=(o.left+o.right)/2?1:0)}}return{node:n,offset:0}}a(mS,"findOffsetInText");function Vu(n,e){return n.left>=e.left-1&&n.left<=e.right+1&&n.top>=e.top-1&&n.top<=e.bottom+1}a(Vu,"inRect");function gS(n,e){let t=n.parentNode;return t&&/^li$/i.test(t.nodeName)&&e.left<n.getBoundingClientRect().left?t:n}a(gS,"targetKludge");function yS(n,e,t){let{node:r,offset:i}=jg(e,t),o=-1;if(r.nodeType==1&&!r.firstChild){let s=r.getBoundingClientRect();o=s.left!=s.right&&t.left>(s.left+s.right)/2?1:-1}return n.docView.posFromDOM(r,i,o)}a(yS,"posFromElement");function kS(n,e,t,r){let i=-1;for(let o=e,s=!1;o!=n.dom;){let l=n.docView.nearestDesc(o,!0);if(!l)return null;if(l.dom.nodeType==1&&(l.node.isBlock&&l.parent&&!s||!l.contentDOM)){let c=l.dom.getBoundingClientRect();if(l.node.isBlock&&l.parent&&!s&&(s=!0,c.left>r.left||c.top>r.top?i=l.posBefore:(c.right<r.left||c.bottom<r.top)&&(i=l.posAfter)),!l.contentDOM&&i<0&&!l.node.isText)return(l.node.isBlock?r.top<(c.top+c.bottom)/2:r.left<(c.left+c.right)/2)?l.posBefore:l.posAfter}o=l.dom.parentNode}return i>-1?i:n.docView.posFromDOM(e,t,-1)}a(kS,"posFromCaret");function Vg(n,e,t){let r=n.childNodes.length;if(r&&t.top<t.bottom)for(let i=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-t.top)/(t.bottom-t.top))-2)),o=i;;){let s=n.childNodes[o];if(s.nodeType==1){let l=s.getClientRects();for(let c=0;c<l.length;c++){let u=l[c];if(Vu(e,u))return Vg(s,e,u)}}if((o=(o+1)%r)==i)break}return n}a(Vg,"elementFromPoint");function bS(n,e){let t=n.dom.ownerDocument,r,i=0,o=sS(t,e.left,e.top);o&&({node:r,offset:i}=o);let s=(n.root.elementFromPoint?n.root:t).elementFromPoint(e.left,e.top),l;if(!s||!n.dom.contains(s.nodeType!=1?s.parentNode:s)){let u=n.dom.getBoundingClientRect();if(!Vu(e,u)||(s=Vg(n.dom,e,u),!s))return null}if(et)for(let u=s;r&&u;u=_o(u))u.draggable&&(r=void 0);if(s=gS(s,e),r){if(Rt&&r.nodeType==1&&(i=Math.min(i,r.childNodes.length),i<r.childNodes.length)){let h=r.childNodes[i],d;h.nodeName=="IMG"&&(d=h.getBoundingClientRect()).right<=e.left&&d.bottom>e.top&&i++}let u;us&&i&&r.nodeType==1&&(u=r.childNodes[i-1]).nodeType==1&&u.contentEditable=="false"&&u.getBoundingClientRect().top>=e.top&&i--,r==n.dom&&i==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?l=n.state.doc.content.size:(i==0||r.nodeType!=1||r.childNodes[i-1].nodeName!="BR")&&(l=kS(n,r,i,e))}l==null&&(l=yS(n,s,e));let c=n.docView.nearestDesc(s,!0);return{pos:l,inside:c?c.posAtStart-c.border:-1}}a(bS,"posAtCoords");function np(n){return n.top<n.bottom||n.left<n.right}a(np,"nonZero");function vn(n,e){let t=n.getClientRects();if(t.length){let r=t[e<0?0:t.length-1];if(np(r))return r}return Array.prototype.find.call(t,np)||n.getBoundingClientRect()}a(vn,"singleRect");const xS=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Wg(n,e,t){let{node:r,offset:i,atom:o}=n.docView.domFromPos(e,t<0?-1:1),s=us||Rt;if(r.nodeType==3)if(s&&(xS.test(r.nodeValue)||(t<0?!i:i==r.nodeValue.length))){let c=vn(nn(r,i,i),t);if(Rt&&i&&/\s/.test(r.nodeValue[i-1])&&i<r.nodeValue.length){let u=vn(nn(r,i-1,i-1),-1);if(u.top==c.top){let h=vn(nn(r,i,i+1),-1);if(h.top!=c.top)return Pi(h,h.left<u.left)}}return c}else{let c=i,u=i,h=t<0?1:-1;return t<0&&!i?(u++,h=-1):t>=0&&i==r.nodeValue.length?(c--,h=1):t<0?c--:u++,Pi(vn(nn(r,c,u),h),h<0)}if(!n.state.doc.resolve(e-(o||0)).parent.inlineContent){if(o==null&&i&&(t<0||i==Wt(r))){let c=r.childNodes[i-1];if(c.nodeType==1)return Fa(c.getBoundingClientRect(),!1)}if(o==null&&i<Wt(r)){let c=r.childNodes[i];if(c.nodeType==1)return Fa(c.getBoundingClientRect(),!0)}return Fa(r.getBoundingClientRect(),t>=0)}if(o==null&&i&&(t<0||i==Wt(r))){let c=r.childNodes[i-1],u=c.nodeType==3?nn(c,Wt(c)-(s?0:1)):c.nodeType==1&&(c.nodeName!="BR"||!c.nextSibling)?c:null;if(u)return Pi(vn(u,1),!1)}if(o==null&&i<Wt(r)){let c=r.childNodes[i];for(;c.pmViewDesc&&c.pmViewDesc.ignoreForCoords;)c=c.nextSibling;let u=c?c.nodeType==3?nn(c,0,s?0:1):c.nodeType==1?c:null:null;if(u)return Pi(vn(u,-1),!0)}return Pi(vn(r.nodeType==3?nn(r):r,-t),t>=0)}a(Wg,"coordsAtPos");function Pi(n,e){if(n.width==0)return n;let t=e?n.left:n.right;return{top:n.top,bottom:n.bottom,left:t,right:t}}a(Pi,"flattenV");function Fa(n,e){if(n.height==0)return n;let t=e?n.top:n.bottom;return{top:t,bottom:t,left:n.left,right:n.right}}a(Fa,"flattenH");function qg(n,e,t){let r=n.state,i=n.root.activeElement;r!=e&&n.updateState(e),i!=n.dom&&n.focus();try{return t()}finally{r!=e&&n.updateState(r),i!=n.dom&&i&&i.focus()}}a(qg,"withFlushedState");function wS(n,e,t){let r=e.selection,i=t=="up"?r.$from:r.$to;return qg(n,e,()=>{let{node:o}=n.docView.domFromPos(i.pos,t=="up"?-1:1);for(;;){let l=n.docView.nearestDesc(o,!0);if(!l)break;if(l.node.isBlock){o=l.contentDOM||l.dom;break}o=l.dom.parentNode}let s=Wg(n,i.pos,1);for(let l=o.firstChild;l;l=l.nextSibling){let c;if(l.nodeType==1)c=l.getClientRects();else if(l.nodeType==3)c=nn(l,0,l.nodeValue.length).getClientRects();else continue;for(let u=0;u<c.length;u++){let h=c[u];if(h.bottom>h.top+1&&(t=="up"?s.top-h.top>(h.bottom-s.top)*2:h.bottom-s.bottom>(s.bottom-h.top)*2))return!1}}return!0})}a(wS,"endOfTextblockVertical");const CS=/[\u0590-\u08ac]/;function SS(n,e,t){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let i=r.parentOffset,o=!i,s=i==r.parent.content.size,l=n.domSelection();return!CS.test(r.parent.textContent)||!l.modify?t=="left"||t=="backward"?o:s:qg(n,e,()=>{let{focusNode:c,focusOffset:u,anchorNode:h,anchorOffset:d}=n.domSelectionRange(),f=l.caretBidiLevel;l.modify("move",t,"character");let p=r.depth?n.docView.domAfterPos(r.before()):n.dom,{focusNode:m,focusOffset:g}=n.domSelectionRange(),k=m&&!p.contains(m.nodeType==1?m:m.parentNode)||c==m&&u==g;try{l.collapse(h,d),c&&(c!=h||u!=d)&&l.extend&&l.extend(c,u)}catch{}return f!=null&&(l.caretBidiLevel=f),k})}a(SS,"endOfTextblockHorizontal");let rp=null,ip=null,op=!1;function vS(n,e,t){return rp==e&&ip==t?op:(rp=e,ip=t,op=t=="up"||t=="down"?wS(n,e,t):SS(n,e,t))}a(vS,"endOfTextblock");const vt=0,sp=1,gr=2,Jt=3,Rd=class Rd{constructor(e,t,r,i){this.parent=e,this.children=t,this.dom=r,this.contentDOM=i,this.dirty=vt,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,r=this.posAtStart;;t++){let i=this.children[t];if(i==e)return r;r+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let o,s;if(e==this.contentDOM)o=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;o=e.previousSibling}for(;o&&!((s=o.pmViewDesc)&&s.parent==this);)o=o.previousSibling;return o?this.posBeforeChild(s)+s.size:this.posAtStart}else{let o,s;if(e==this.contentDOM)o=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;o=e.nextSibling}for(;o&&!((s=o.pmViewDesc)&&s.parent==this);)o=o.nextSibling;return o?this.posBeforeChild(s):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=t>Ve(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(t==0)for(let o=e;;o=o.parentNode){if(o==this.dom){i=!1;break}if(o.previousSibling)break}if(i==null&&t==e.childNodes.length)for(let o=e;;o=o.parentNode){if(o==this.dom){i=!0;break}if(o.nextSibling)break}}return i??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let r=!0,i=e;i;i=i.parentNode){let o=this.getDesc(i),s;if(o&&(!t||o.node))if(r&&(s=o.nodeDOM)&&!(s.nodeType==1?s.contains(e.nodeType==1?e:e.parentNode):s==e))r=!1;else return o}}getDesc(e){let t=e.pmViewDesc;for(let r=t;r;r=r.parent)if(r==this)return t}posFromDOM(e,t,r){for(let i=e;i;i=i.parentNode){let o=this.getDesc(i);if(o)return o.localPosFromDOM(e,t,r)}return-1}descAt(e){for(let t=0,r=0;t<this.children.length;t++){let i=this.children[t],o=r+i.size;if(r==e&&o!=r){for(;!i.border&&i.children.length;)i=i.children[0];return i}if(e<o)return i.descAt(e-r-i.border);r=o}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,i=0;for(let o=0;r<this.children.length;r++){let s=this.children[r],l=o+s.size;if(l>e||s instanceof Il){i=e-o;break}o=l}if(i)return this.children[r].domFromPos(i-this.children[r].border,t);for(let o;r&&!(o=this.children[r-1]).size&&o instanceof $l&&o.side>=0;r--);if(t<=0){let o,s=!0;for(;o=r?this.children[r-1]:null,!(!o||o.dom.parentNode==this.contentDOM);r--,s=!1);return o&&t&&s&&!o.border&&!o.domAtom?o.domFromPos(o.size,t):{node:this.contentDOM,offset:o?Ve(o.dom)+1:0}}else{let o,s=!0;for(;o=r<this.children.length?this.children[r]:null,!(!o||o.dom.parentNode==this.contentDOM);r++,s=!1);return o&&s&&!o.border&&!o.domAtom?o.domFromPos(0,t):{node:this.contentDOM,offset:o?Ve(o.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,o=-1;for(let s=r,l=0;;l++){let c=this.children[l],u=s+c.size;if(i==-1&&e<=u){let h=s+c.border;if(e>=h&&t<=u-c.border&&c.node&&c.contentDOM&&this.contentDOM.contains(c.contentDOM))return c.parseRange(e,t,h);e=s;for(let d=l;d>0;d--){let f=this.children[d-1];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(1)){i=Ve(f.dom)+1;break}e-=f.size}i==-1&&(i=0)}if(i>-1&&(u>t||l==this.children.length-1)){t=u;for(let h=l+1;h<this.children.length;h++){let d=this.children[h];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(-1)){o=Ve(d.dom);break}t+=d.size}o==-1&&(o=this.contentDOM.childNodes.length);break}s=u}return{node:this.contentDOM,from:e,to:t,fromOffset:i,toOffset:o}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return t.size==0||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:r}=this.domFromPos(e,0);if(t.nodeType!=1||r==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[r]}setSelection(e,t,r,i=!1){let o=Math.min(e,t),s=Math.max(e,t);for(let f=0,p=0;f<this.children.length;f++){let m=this.children[f],g=p+m.size;if(o>p&&s<g)return m.setSelection(e-p-m.border,t-p-m.border,r,i);p=g}let l=this.domFromPos(e,e?-1:1),c=t==e?l:this.domFromPos(t,t?-1:1),u=r.getSelection(),h=!1;if((Rt||et)&&e==t){let{node:f,offset:p}=l;if(f.nodeType==3){if(h=!!(p&&f.nodeValue[p-1]==`
`),h&&p==f.nodeValue.length)for(let m=f,g;m;m=m.parentNode){if(g=m.nextSibling){g.nodeName=="BR"&&(l=c={node:g.parentNode,offset:Ve(g)+1});break}let k=m.pmViewDesc;if(k&&k.node&&k.node.isBlock)break}}else{let m=f.childNodes[p-1];h=m&&(m.nodeName=="BR"||m.contentEditable=="false")}}if(Rt&&u.focusNode&&u.focusNode!=c.node&&u.focusNode.nodeType==1){let f=u.focusNode.childNodes[u.focusOffset];f&&f.contentEditable=="false"&&(i=!0)}if(!(i||h&&et)&&Or(l.node,l.offset,u.anchorNode,u.anchorOffset)&&Or(c.node,c.offset,u.focusNode,u.focusOffset))return;let d=!1;if((u.extend||e==t)&&!h){u.collapse(l.node,l.offset);try{e!=t&&u.extend(c.node,c.offset),d=!0}catch{}}if(!d){if(e>t){let p=l;l=c,c=p}let f=document.createRange();f.setEnd(c.node,c.offset),f.setStart(l.node,l.offset),u.removeAllRanges(),u.addRange(f)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let r=0,i=0;i<this.children.length;i++){let o=this.children[i],s=r+o.size;if(r==s?e<=s&&t>=r:e<s&&t>r){let l=r+o.border,c=s-o.border;if(e>=l&&t<=c){this.dirty=e==r||t==s?gr:sp,e==l&&t==c&&(o.contentLost||o.dom.parentNode!=this.contentDOM)?o.dirty=Jt:o.markDirty(e-l,t-l);return}else o.dirty=o.dom==o.contentDOM&&o.dom.parentNode==this.contentDOM&&!o.children.length?gr:Jt}r=s}this.dirty=gr}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let r=e==1?gr:sp;t.dirty<r&&(t.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}isText(e){return!1}};a(Rd,"ViewDesc");let _r=Rd;const zd=class zd extends _r{constructor(e,t,r,i){let o,s=t.type.toDOM;if(typeof s=="function"&&(s=s(r,()=>{if(!o)return i;if(o.parent)return o.parent.posBeforeChild(o)})),!t.type.spec.raw){if(s.nodeType!=1){let l=document.createElement("span");l.appendChild(s),s=l}s.contentEditable="false",s.classList.add("ProseMirror-widget")}super(e,[],s,null),this.widget=t,this.widget=t,o=this}matchesWidget(e){return this.dirty==vt&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return t?t(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}};a(zd,"WidgetViewDesc");let $l=zd;const Pd=class Pd extends _r{constructor(e,t,r,i){super(e,[],t,null),this.textDOM=r,this.text=i}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}};a(Pd,"CompositionViewDesc");let Xc=Pd;const To=class To extends _r{constructor(e,t,r,i){super(e,[],r,i),this.mark=t}static create(e,t,r,i){let o=i.nodeViews[t.type.name],s=o&&o(t,i,r);return(!s||!s.dom)&&(s=Ir.renderSpec(document,t.type.spec.toDOM(t,r))),new To(e,t,s.dom,s.contentDOM||s.dom)}parseRule(){return this.dirty&Jt||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=Jt&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),this.dirty!=vt){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=vt}}slice(e,t,r){let i=To.create(this.parent,this.mark,!0,r),o=this.children,s=this.size;t<s&&(o=iu(o,t,s,r)),e>0&&(o=iu(o,0,e,r));for(let l=0;l<o.length;l++)o[l].parent=i;return i.children=o,i}};a(To,"MarkViewDesc");let pi=To;const ql=class ql extends _r{constructor(e,t,r,i,o,s,l,c,u){super(e,[],o,s),this.node=t,this.outerDeco=r,this.innerDeco=i,this.nodeDOM=l}static create(e,t,r,i,o,s){let l=o.nodeViews[t.type.name],c,u=l&&l(t,o,()=>{if(!c)return s;if(c.parent)return c.parent.posBeforeChild(c)},r,i),h=u&&u.dom,d=u&&u.contentDOM;if(t.isText){if(!h)h=document.createTextNode(t.text);else if(h.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else h||({dom:h,contentDOM:d}=Ir.renderSpec(document,t.type.spec.toDOM(t)));!d&&!t.isText&&h.nodeName!="BR"&&(h.hasAttribute("contenteditable")||(h.contentEditable="false"),t.type.spec.draggable&&(h.draggable=!0));let f=h;return h=Jg(h,r,t),u?c=new eu(e,t,r,i,h,d||null,f,u,o,s+1):t.isText?new Al(e,t,r,i,h,f,o):new ql(e,t,r,i,h,d||null,f,o,s+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let t=this.children.length-1;t>=0;t--){let r=this.children[t];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>P.empty)}return e}matchesNode(e,t,r){return this.dirty==vt&&e.eq(this.node)&&nu(t,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let r=this.node.inlineContent,i=t,o=e.composing?this.localCompositionInfo(e,t):null,s=o&&o.pos>-1?o:null,l=o&&o.pos<0,c=new ru(this,s&&s.node,e);$S(this.node,this.innerDeco,(u,h,d)=>{u.spec.marks?c.syncToMarks(u.spec.marks,r,e):u.type.side>=0&&!d&&c.syncToMarks(h==this.node.childCount?fe.none:this.node.child(h).marks,r,e),c.placeWidget(u,e,i)},(u,h,d,f)=>{c.syncToMarks(u.marks,r,e);let p;c.findNodeMatch(u,h,d,f)||l&&e.state.selection.from>i&&e.state.selection.to<i+u.nodeSize&&(p=c.findIndexWithChild(o.node))>-1&&c.updateNodeAt(u,h,d,p,e)||c.updateNextNode(u,h,d,e,f,i)||c.addNode(u,h,d,e,i),i+=u.nodeSize}),c.syncToMarks([],r,e),this.node.isTextblock&&c.addTextblockHacks(),c.destroyRest(),(c.changed||this.dirty==gr)&&(s&&this.protectLocalComposition(e,s),Kg(this.contentDOM,this.children,e),fi&&AS(this.dom))}localCompositionInfo(e,t){let{from:r,to:i}=e.state.selection;if(!(e.state.selection instanceof de)||r<t||i>t+this.node.content.size)return null;let o=e.input.compositionNode;if(!o||!this.dom.contains(o.parentNode))return null;if(this.node.inlineContent){let s=o.nodeValue,l=IS(this.node.content,s,r-t,i-t);return l<0?null:{node:o,pos:l,text:s}}else return{node:o,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:r,text:i}){if(this.getDesc(t))return;let o=t;for(;o.parentNode!=this.contentDOM;o=o.parentNode){for(;o.previousSibling;)o.parentNode.removeChild(o.previousSibling);for(;o.nextSibling;)o.parentNode.removeChild(o.nextSibling);o.pmViewDesc&&(o.pmViewDesc=void 0)}let s=new Xc(this,o,t,i);e.input.compositionNodes.push(s),this.children=iu(this.children,r,r+i.length,e,s)}update(e,t,r,i){return this.dirty==Jt||!e.sameMarkup(this.node)?!1:(this.updateInner(e,t,r,i),!0)}updateInner(e,t,r,i){this.updateOuterDeco(t),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=vt}updateOuterDeco(e){if(nu(e,this.outerDeco))return;let t=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=Ug(this.dom,this.nodeDOM,tu(this.outerDeco,this.node,t),tu(e,this.node,t)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable")}get domAtom(){return this.node.isAtom}};a(ql,"NodeViewDesc");let Ln=ql;function lp(n,e,t,r,i){Jg(r,e,n);let o=new Ln(void 0,n,e,t,r,r,r,i,0);return o.contentDOM&&o.updateChildren(i,0),o}a(lp,"docViewDesc");const Kl=class Kl extends Ln{constructor(e,t,r,i,o,s,l){super(e,t,r,i,o,null,s,l,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,r,i){return this.dirty==Jt||this.dirty!=vt&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(t),(this.dirty!=vt||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=vt,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,r){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,t,r){let i=this.node.cut(e,t),o=document.createTextNode(i.text);return new Kl(this.parent,i,this.outerDeco,this.innerDeco,o,o,r)}markDirty(e,t){super.markDirty(e,t),this.dom!=this.nodeDOM&&(e==0||t==this.nodeDOM.nodeValue.length)&&(this.dirty=Jt)}get domAtom(){return!1}isText(e){return this.node.text==e}};a(Kl,"TextViewDesc");let Al=Kl;const Fd=class Fd extends _r{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==vt&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}};a(Fd,"TrailingHackViewDesc");let Il=Fd;const Ld=class Ld extends Ln{constructor(e,t,r,i,o,s,l,c,u,h){super(e,t,r,i,o,s,l,u,h),this.spec=c}update(e,t,r,i){if(this.dirty==Jt)return!1;if(this.spec.update){let o=this.spec.update(e,t,r);return o&&this.updateInner(e,t,r,i),o}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,t,r,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,r,i){this.spec.setSelection?this.spec.setSelection(e,t,r):super.setSelection(e,t,r,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}};a(Ld,"CustomNodeViewDesc");let eu=Ld;function Kg(n,e,t){let r=n.firstChild,i=!1;for(let o=0;o<e.length;o++){let s=e[o],l=s.dom;if(l.parentNode==n){for(;l!=r;)r=ap(r),i=!0;r=r.nextSibling}else i=!0,n.insertBefore(l,r);if(s instanceof pi){let c=r?r.previousSibling:n.lastChild;Kg(s.contentDOM,s.children,t),r=c?c.nextSibling:n.firstChild}}for(;r;)r=ap(r),i=!0;i&&t.trackWrites==n&&(t.trackWrites=null)}a(Kg,"renderDescs");const mo=a(function(n){n&&(this.nodeName=n)},"OuterDecoLevel");mo.prototype=Object.create(null);const yr=[new mo];function tu(n,e,t){if(n.length==0)return yr;let r=t?yr[0]:new mo,i=[r];for(let o=0;o<n.length;o++){let s=n[o].type.attrs;if(s){s.nodeName&&i.push(r=new mo(s.nodeName));for(let l in s){let c=s[l];c!=null&&(t&&i.length==1&&i.push(r=new mo(e.isInline?"span":"div")),l=="class"?r.class=(r.class?r.class+" ":"")+c:l=="style"?r.style=(r.style?r.style+";":"")+c:l!="nodeName"&&(r[l]=c))}}}return i}a(tu,"computeOuterDeco");function Ug(n,e,t,r){if(t==yr&&r==yr)return e;let i=e;for(let o=0;o<r.length;o++){let s=r[o],l=t[o];if(o){let c;l&&l.nodeName==s.nodeName&&i!=n&&(c=i.parentNode)&&c.nodeName.toLowerCase()==s.nodeName||(c=document.createElement(s.nodeName),c.pmIsDeco=!0,c.appendChild(i),l=yr[0]),i=c}NS(i,l||yr[0],s)}return i}a(Ug,"patchOuterDeco");function NS(n,e,t){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in t)&&n.removeAttribute(r);for(let r in t)r!="class"&&r!="style"&&r!="nodeName"&&t[r]!=e[r]&&n.setAttribute(r,t[r]);if(e.class!=t.class){let r=e.class?e.class.split(" ").filter(Boolean):[],i=t.class?t.class.split(" ").filter(Boolean):[];for(let o=0;o<r.length;o++)i.indexOf(r[o])==-1&&n.classList.remove(r[o]);for(let o=0;o<i.length;o++)r.indexOf(i[o])==-1&&n.classList.add(i[o]);n.classList.length==0&&n.removeAttribute("class")}if(e.style!=t.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=r.exec(e.style);)n.style.removeProperty(i[1])}t.style&&(n.style.cssText+=t.style)}}a(NS,"patchAttributes");function Jg(n,e,t){return Ug(n,n,yr,tu(e,t,n.nodeType!=1))}a(Jg,"applyOuterDeco");function nu(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(!n[t].type.eq(e[t].type))return!1;return!0}a(nu,"sameOuterDeco");function ap(n){let e=n.nextSibling;return n.parentNode.removeChild(n),e}a(ap,"rm");const Bd=class Bd{constructor(e,t,r){this.lock=t,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=MS(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let r=e;r<t;r++)this.top.children[r].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,r){let i=0,o=this.stack.length>>1,s=Math.min(o,e.length);for(;i<s&&(i==o-1?this.top:this.stack[i+1<<1]).matchesMark(e[i])&&e[i].type.spec.spanning!==!1;)i++;for(;i<o;)this.destroyRest(),this.top.dirty=vt,this.index=this.stack.pop(),this.top=this.stack.pop(),o--;for(;o<e.length;){this.stack.push(this.top,this.index+1);let l=-1;for(let c=this.index;c<Math.min(this.index+3,this.top.children.length);c++){let u=this.top.children[c];if(u.matchesMark(e[o])&&!this.isLocked(u.dom)){l=c;break}}if(l>-1)l>this.index&&(this.changed=!0,this.destroyBetween(this.index,l)),this.top=this.top.children[this.index];else{let c=pi.create(this.top,e[o],t,r);this.top.children.splice(this.index,0,c),this.top=c,this.changed=!0}this.index=0,o++}}findNodeMatch(e,t,r,i){let o=-1,s;if(i>=this.preMatch.index&&(s=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&s.matchesNode(e,t,r))o=this.top.children.indexOf(s,this.index);else for(let l=this.index,c=Math.min(this.top.children.length,l+5);l<c;l++){let u=this.top.children[l];if(u.matchesNode(e,t,r)&&!this.preMatch.matched.has(u)){o=l;break}}return o<0?!1:(this.destroyBetween(this.index,o),this.index++,!0)}updateNodeAt(e,t,r,i,o){let s=this.top.children[i];return s.dirty==Jt&&s.dom==s.contentDOM&&(s.dirty=gr),s.update(e,t,r,o)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==r)return i}return-1}e=t}}updateNextNode(e,t,r,i,o,s){for(let l=this.index;l<this.top.children.length;l++){let c=this.top.children[l];if(c instanceof Ln){let u=this.preMatch.matched.get(c);if(u!=null&&u!=o)return!1;let h=c.dom,d,f=this.isLocked(h)&&!(e.isText&&c.node&&c.node.isText&&c.nodeDOM.nodeValue==e.text&&c.dirty!=Jt&&nu(t,c.outerDeco));if(!f&&c.update(e,t,r,i))return this.destroyBetween(this.index,l),c.dom!=h&&(this.changed=!0),this.index++,!0;if(!f&&(d=this.recreateWrapper(c,e,t,r,i,s)))return this.top.children[this.index]=d,d.contentDOM&&(d.dirty=gr,d.updateChildren(i,s+1),d.dirty=vt),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,r,i,o,s){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content))return null;let l=Ln.create(this.top,t,r,i,o,s);if(l.contentDOM){l.children=e.children,e.children=[];for(let c of l.children)c.parent=l}return e.destroy(),l}addNode(e,t,r,i,o){let s=Ln.create(this.top,e,t,r,i,o);s.contentDOM&&s.updateChildren(i,o+1),this.top.children.splice(this.index++,0,s),this.changed=!0}placeWidget(e,t,r){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let o=new $l(this.top,e,t,r);this.top.children.splice(this.index++,0,o),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof pi;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof Al)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((et||Qe)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let i=new Il(this.top,[],r,null);t!=this.top?t.children.push(i):t.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}};a(Bd,"ViewTreeUpdater");let ru=Bd;function MS(n,e){let t=e,r=t.children.length,i=n.childCount,o=new Map,s=[];e:for(;i>0;){let l;for(;;)if(r){let u=t.children[r-1];if(u instanceof pi)t=u,r=u.children.length;else{l=u,r--;break}}else{if(t==e)break e;r=t.parent.children.indexOf(t),t=t.parent}let c=l.node;if(c){if(c!=n.child(i-1))break;--i,o.set(l,i),s.push(l)}}return{index:i,matched:o,matches:s.reverse()}}a(MS,"preMatch");function TS(n,e){return n.type.side-e.type.side}a(TS,"compareSide");function $S(n,e,t,r){let i=e.locals(n),o=0;if(i.length==0){for(let u=0;u<n.childCount;u++){let h=n.child(u);r(h,i,e.forChild(o,h),u),o+=h.nodeSize}return}let s=0,l=[],c=null;for(let u=0;;){let h,d;for(;s<i.length&&i[s].to==o;){let k=i[s++];k.widget&&(h?(d||(d=[h])).push(k):h=k)}if(h)if(d){d.sort(TS);for(let k=0;k<d.length;k++)t(d[k],u,!!c)}else t(h,u,!!c);let f,p;if(c)p=-1,f=c,c=null;else if(u<n.childCount)p=u,f=n.child(u++);else break;for(let k=0;k<l.length;k++)l[k].to<=o&&l.splice(k--,1);for(;s<i.length&&i[s].from<=o&&i[s].to>o;)l.push(i[s++]);let m=o+f.nodeSize;if(f.isText){let k=m;s<i.length&&i[s].from<k&&(k=i[s].from);for(let b=0;b<l.length;b++)l[b].to<k&&(k=l[b].to);k<m&&(c=f.cut(k-o),f=f.cut(0,k-o),m=k,p=-1)}else for(;s<i.length&&i[s].to<m;)s++;let g=f.isInline&&!f.isLeaf?l.filter(k=>!k.inline):l.slice();r(f,g,e.forChild(o,f),p),o=m}}a($S,"iterDeco");function AS(n){if(n.nodeName=="UL"||n.nodeName=="OL"){let e=n.style.cssText;n.style.cssText=e+"; list-style: square !important",window.getComputedStyle(n).listStyle,n.style.cssText=e}}a(AS,"iosHacks");function IS(n,e,t,r){for(let i=0,o=0;i<n.childCount&&o<=r;){let s=n.child(i++),l=o;if(o+=s.nodeSize,!s.isText)continue;let c=s.text;for(;i<n.childCount;){let u=n.child(i++);if(o+=u.nodeSize,!u.isText)break;c+=u.text}if(o>=t){if(o>=r&&c.slice(r-e.length-l,r-l)==e)return r-e.length;let u=l<r?c.lastIndexOf(e,r-l-1):-1;if(u>=0&&u+e.length+l>=t)return l+u;if(t==r&&c.length>=r+e.length-l&&c.slice(r-l,r-l+e.length)==e)return r}}return-1}a(IS,"findTextInFragment");function iu(n,e,t,r,i){let o=[];for(let s=0,l=0;s<n.length;s++){let c=n[s],u=l,h=l+=c.size;u>=t||h<=e?o.push(c):(u<e&&o.push(c.slice(0,e-u,r)),i&&(o.push(i),i=void 0),h>t&&o.push(c.slice(t-u,c.size,r)))}return o}a(iu,"replaceNodes");function Wu(n,e=null){let t=n.domSelectionRange(),r=n.state.doc;if(!t.focusNode)return null;let i=n.docView.nearestDesc(t.focusNode),o=i&&i.size==0,s=n.docView.posFromDOM(t.focusNode,t.focusOffset,1);if(s<0)return null;let l=r.resolve(s),c,u;if(ra(t)){for(c=l;i&&!i.node;)i=i.parent;let h=i.node;if(i&&h.isAtom&&oe.isSelectable(h)&&i.parent&&!(h.isInline&&iS(t.focusNode,t.focusOffset,i.dom))){let d=i.posBefore;u=new oe(s==d?l:r.resolve(d))}}else{let h=n.docView.posFromDOM(t.anchorNode,t.anchorOffset,1);if(h<0)return null;c=r.resolve(h)}if(!u){let h=e=="pointer"||n.state.selection.head<l.pos&&!o?1:-1;u=qu(n,c,l,h)}return u}a(Wu,"selectionFromDOM");function Zg(n){return n.editable?n.hasFocus():Yg(n)&&document.activeElement&&document.activeElement.contains(n.dom)}a(Zg,"editorOwnsSelection");function an(n,e=!1){let t=n.state.selection;if(Gg(n,t),!!Zg(n)){if(!e&&n.input.mouseDown&&n.input.mouseDown.allowDefault&&Qe){let r=n.domSelectionRange(),i=n.domObserver.currentSelection;if(r.anchorNode&&i.anchorNode&&Or(r.anchorNode,r.anchorOffset,i.anchorNode,i.anchorOffset)){n.input.mouseDown.delayedSelectionSync=!0,n.domObserver.setCurSelection();return}}if(n.domObserver.disconnectSelection(),n.cursorWrapper)OS(n);else{let{anchor:r,head:i}=t,o,s;cp&&!(t instanceof de)&&(t.$from.parent.inlineContent||(o=up(n,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(s=up(n,t.to))),n.docView.setSelection(r,i,n.root,e),cp&&(o&&hp(o),s&&hp(s)),t.visible?n.dom.classList.remove("ProseMirror-hideselection"):(n.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&ES(n))}n.domObserver.setCurSelection(),n.domObserver.connectSelection()}}a(an,"selectionToDOM");const cp=et||Qe&&lS<63;function up(n,e){let{node:t,offset:r}=n.docView.domFromPos(e,0),i=r<t.childNodes.length?t.childNodes[r]:null,o=r?t.childNodes[r-1]:null;if(et&&i&&i.contentEditable=="false")return La(i);if((!i||i.contentEditable=="false")&&(!o||o.contentEditable=="false")){if(i)return La(i);if(o)return La(o)}}a(up,"temporarilyEditableNear");function La(n){return n.contentEditable="true",et&&n.draggable&&(n.draggable=!1,n.wasDraggable=!0),n}a(La,"setEditable");function hp(n){n.contentEditable="false",n.wasDraggable&&(n.draggable=!0,n.wasDraggable=null)}a(hp,"resetEditable");function ES(n){let e=n.dom.ownerDocument;e.removeEventListener("selectionchange",n.input.hideSelectionGuard);let t=n.domSelectionRange(),r=t.anchorNode,i=t.anchorOffset;e.addEventListener("selectionchange",n.input.hideSelectionGuard=()=>{(t.anchorNode!=r||t.anchorOffset!=i)&&(e.removeEventListener("selectionchange",n.input.hideSelectionGuard),setTimeout(()=>{(!Zg(n)||n.state.selection.visible)&&n.dom.classList.remove("ProseMirror-hideselection")},20))})}a(ES,"removeClassOnSelectionChange");function OS(n){let e=n.domSelection(),t=document.createRange(),r=n.cursorWrapper.dom,i=r.nodeName=="IMG";i?t.setEnd(r.parentNode,Ve(r)+1):t.setEnd(r,0),t.collapse(!1),e.removeAllRanges(),e.addRange(t),!i&&!n.state.selection.visible&&lt&&Fn<=11&&(r.disabled=!0,r.disabled=!1)}a(OS,"selectCursorWrapper");function Gg(n,e){if(e instanceof oe){let t=n.docView.descAt(e.from);t!=n.lastSelectedViewDesc&&(dp(n),t&&t.selectNode(),n.lastSelectedViewDesc=t)}else dp(n)}a(Gg,"syncNodeSelection");function dp(n){n.lastSelectedViewDesc&&(n.lastSelectedViewDesc.parent&&n.lastSelectedViewDesc.deselectNode(),n.lastSelectedViewDesc=void 0)}a(dp,"clearNodeSelection");function qu(n,e,t,r){return n.someProp("createSelectionBetween",i=>i(n,e,t))||de.between(e,t,r)}a(qu,"selectionBetween");function fp(n){return n.editable&&!n.hasFocus()?!1:Yg(n)}a(fp,"hasFocusAndSelection");function Yg(n){let e=n.domSelectionRange();if(!e.anchorNode)return!1;try{return n.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(n.editable||n.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}a(Yg,"hasSelection");function _S(n){let e=n.docView.domFromPos(n.state.selection.anchor,0),t=n.domSelectionRange();return Or(e.node,e.offset,t.anchorNode,t.anchorOffset)}a(_S,"anchorInRightPlace");function ou(n,e){let{$anchor:t,$head:r}=n.selection,i=e>0?t.max(r):t.min(r),o=i.parent.inlineContent?i.depth?n.doc.resolve(e>0?i.after():i.before()):null:i;return o&&te.findFrom(o,e)}a(ou,"moveSelectionBlock");function Tn(n,e){return n.dispatch(n.state.tr.setSelection(e).scrollIntoView()),!0}a(Tn,"apply");function pp(n,e,t){let r=n.state.selection;if(r instanceof de)if(t.indexOf("s")>-1){let{$head:i}=r,o=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!o||o.isText||!o.isLeaf)return!1;let s=n.state.doc.resolve(i.pos+o.nodeSize*(e<0?-1:1));return Tn(n,new de(r.$anchor,s))}else if(r.empty){if(n.endOfTextblock(e>0?"forward":"backward")){let i=ou(n.state,e);return i&&i instanceof oe?Tn(n,i):!1}else if(!(xt&&t.indexOf("m")>-1)){let i=r.$head,o=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,s;if(!o||o.isText)return!1;let l=e<0?i.pos-o.nodeSize:i.pos;return o.isAtom||(s=n.docView.descAt(l))&&!s.contentDOM?oe.isSelectable(o)?Tn(n,new oe(e<0?n.state.doc.resolve(i.pos-o.nodeSize):i)):us?Tn(n,new de(n.state.doc.resolve(e<0?l:l+o.nodeSize))):!1:!1}}else return!1;else{if(r instanceof oe&&r.node.isInline)return Tn(n,new de(e>0?r.$to:r.$from));{let i=ou(n.state,e);return i?Tn(n,i):!1}}}a(pp,"selectHorizontally");function El(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}a(El,"nodeLen");function go(n,e){let t=n.pmViewDesc;return t&&t.size==0&&(e<0||n.nextSibling||n.nodeName!="BR")}a(go,"isIgnorable");function Lr(n,e){return e<0?DS(n):RS(n)}a(Lr,"skipIgnoredNodes");function DS(n){let e=n.domSelectionRange(),t=e.focusNode,r=e.focusOffset;if(!t)return;let i,o,s=!1;for(Rt&&t.nodeType==1&&r<El(t)&&go(t.childNodes[r],-1)&&(s=!0);;)if(r>0){if(t.nodeType!=1)break;{let l=t.childNodes[r-1];if(go(l,-1))i=t,o=--r;else if(l.nodeType==3)t=l,r=t.nodeValue.length;else break}}else{if(Qg(t))break;{let l=t.previousSibling;for(;l&&go(l,-1);)i=t.parentNode,o=Ve(l),l=l.previousSibling;if(l)t=l,r=El(t);else{if(t=t.parentNode,t==n.dom)break;r=0}}}s?su(n,t,r):i&&su(n,i,o)}a(DS,"skipIgnoredNodesBefore");function RS(n){let e=n.domSelectionRange(),t=e.focusNode,r=e.focusOffset;if(!t)return;let i=El(t),o,s;for(;;)if(r<i){if(t.nodeType!=1)break;let l=t.childNodes[r];if(go(l,1))o=t,s=++r;else break}else{if(Qg(t))break;{let l=t.nextSibling;for(;l&&go(l,1);)o=l.parentNode,s=Ve(l)+1,l=l.nextSibling;if(l)t=l,r=0,i=El(t);else{if(t=t.parentNode,t==n.dom)break;r=i=0}}}o&&su(n,o,s)}a(RS,"skipIgnoredNodesAfter");function Qg(n){let e=n.pmViewDesc;return e&&e.node&&e.node.isBlock}a(Qg,"isBlockNode");function zS(n,e){for(;n&&e==n.childNodes.length&&!cs(n);)e=Ve(n)+1,n=n.parentNode;for(;n&&e<n.childNodes.length;){let t=n.childNodes[e];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;n=t,e=0}}a(zS,"textNodeAfter");function PS(n,e){for(;n&&!e&&!cs(n);)e=Ve(n),n=n.parentNode;for(;n&&e;){let t=n.childNodes[e-1];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;n=t,e=n.childNodes.length}}a(PS,"textNodeBefore");function su(n,e,t){if(e.nodeType!=3){let o,s;(s=zS(e,t))?(e=s,t=0):(o=PS(e,t))&&(e=o,t=o.nodeValue.length)}let r=n.domSelection();if(ra(r)){let o=document.createRange();o.setEnd(e,t),o.setStart(e,t),r.removeAllRanges(),r.addRange(o)}else r.extend&&r.extend(e,t);n.domObserver.setCurSelection();let{state:i}=n;setTimeout(()=>{n.state==i&&an(n)},50)}a(su,"setSelFocus");function mp(n,e){let t=n.state.doc.resolve(e);if(!(Qe||aS)&&t.parent.inlineContent){let i=n.coordsAtPos(e);if(e>t.start()){let o=n.coordsAtPos(e-1),s=(o.top+o.bottom)/2;if(s>i.top&&s<i.bottom&&Math.abs(o.left-i.left)>1)return o.left<i.left?"ltr":"rtl"}if(e<t.end()){let o=n.coordsAtPos(e+1),s=(o.top+o.bottom)/2;if(s>i.top&&s<i.bottom&&Math.abs(o.left-i.left)>1)return o.left>i.left?"ltr":"rtl"}}return getComputedStyle(n.dom).direction=="rtl"?"rtl":"ltr"}a(mp,"findDirection");function gp(n,e,t){let r=n.state.selection;if(r instanceof de&&!r.empty||t.indexOf("s")>-1||xt&&t.indexOf("m")>-1)return!1;let{$from:i,$to:o}=r;if(!i.parent.inlineContent||n.endOfTextblock(e<0?"up":"down")){let s=ou(n.state,e);if(s&&s instanceof oe)return Tn(n,s)}if(!i.parent.inlineContent){let s=e<0?i:o,l=r instanceof Dt?te.near(s,e):te.findFrom(s,e);return l?Tn(n,l):!1}return!1}a(gp,"selectVertically");function yp(n,e){if(!(n.state.selection instanceof de))return!0;let{$head:t,$anchor:r,empty:i}=n.state.selection;if(!t.sameParent(r))return!0;if(!i)return!1;if(n.endOfTextblock(e>0?"forward":"backward"))return!0;let o=!t.textOffset&&(e<0?t.nodeBefore:t.nodeAfter);if(o&&!o.isText){let s=n.state.tr;return e<0?s.delete(t.pos-o.nodeSize,t.pos):s.delete(t.pos,t.pos+o.nodeSize),n.dispatch(s),!0}return!1}a(yp,"stopNativeHorizontalDelete");function kp(n,e,t){n.domObserver.stop(),e.contentEditable=t,n.domObserver.start()}a(kp,"switchEditable");function FS(n){if(!et||n.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:t}=n.domSelectionRange();if(e&&e.nodeType==1&&t==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;kp(n,r,"true"),setTimeout(()=>kp(n,r,"false"),20)}return!1}a(FS,"safariDownArrowBug");function LS(n){let e="";return n.ctrlKey&&(e+="c"),n.metaKey&&(e+="m"),n.altKey&&(e+="a"),n.shiftKey&&(e+="s"),e}a(LS,"getMods");function BS(n,e){let t=e.keyCode,r=LS(e);if(t==8||xt&&t==72&&r=="c")return yp(n,-1)||Lr(n,-1);if(t==46&&!e.shiftKey||xt&&t==68&&r=="c")return yp(n,1)||Lr(n,1);if(t==13||t==27)return!0;if(t==37||xt&&t==66&&r=="c"){let i=t==37?mp(n,n.state.selection.from)=="ltr"?-1:1:-1;return pp(n,i,r)||Lr(n,i)}else if(t==39||xt&&t==70&&r=="c"){let i=t==39?mp(n,n.state.selection.from)=="ltr"?1:-1:1;return pp(n,i,r)||Lr(n,i)}else{if(t==38||xt&&t==80&&r=="c")return gp(n,-1,r)||Lr(n,-1);if(t==40||xt&&t==78&&r=="c")return FS(n)||gp(n,1,r)||Lr(n,1);if(r==(xt?"m":"c")&&(t==66||t==73||t==89||t==90))return!0}return!1}a(BS,"captureKeyDown");function Xg(n,e){n.someProp("transformCopied",p=>{e=p(e,n)});let t=[],{content:r,openStart:i,openEnd:o}=e;for(;i>1&&o>1&&r.childCount==1&&r.firstChild.childCount==1;){i--,o--;let p=r.firstChild;t.push(p.type.name,p.attrs!=p.type.defaultAttrs?p.attrs:null),r=p.content}let s=n.someProp("clipboardSerializer")||Ir.fromSchema(n.state.schema),l=oy(),c=l.createElement("div");c.appendChild(s.serializeFragment(r,{document:l}));let u=c.firstChild,h,d=0;for(;u&&u.nodeType==1&&(h=iy[u.nodeName.toLowerCase()]);){for(let p=h.length-1;p>=0;p--){let m=l.createElement(h[p]);for(;c.firstChild;)m.appendChild(c.firstChild);c.appendChild(m),d++}u=c.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",`${i} ${o}${d?` -${d}`:""} ${JSON.stringify(t)}`);let f=n.someProp("clipboardTextSerializer",p=>p(e,n))||e.content.textBetween(0,e.content.size,`

`);return{dom:c,text:f,slice:e}}a(Xg,"serializeForClipboard");function ey(n,e,t,r,i){let o=i.parent.type.spec.code,s,l;if(!t&&!e)return null;let c=e&&(r||o||!t);if(c){if(n.someProp("transformPastedText",f=>{e=f(e,o||r,n)}),o)return e?new U(P.from(n.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):U.empty;let d=n.someProp("clipboardTextParser",f=>f(e,i,r,n));if(d)l=d;else{let f=i.marks(),{schema:p}=n.state,m=Ir.fromSchema(p);s=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(g=>{let k=s.appendChild(document.createElement("p"));g&&k.appendChild(m.serializeNode(p.text(g,f)))})}}else n.someProp("transformPastedHTML",d=>{t=d(t,n)}),s=VS(t),us&&WS(s);let u=s&&s.querySelector("[data-pm-slice]"),h=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(h&&h[3])for(let d=+h[3];d>0;d--){let f=s.firstChild;for(;f&&f.nodeType!=1;)f=f.nextSibling;if(!f)break;s=f}if(l||(l=(n.someProp("clipboardParser")||n.someProp("domParser")||Ao.fromSchema(n.state.schema)).parseSlice(s,{preserveWhitespace:!!(c||h),context:i,ruleFromNode(f){return f.nodeName=="BR"&&!f.nextSibling&&f.parentNode&&!HS.test(f.parentNode.nodeName)?{ignore:!0}:null}})),h)l=qS(bp(l,+h[1],+h[2]),h[4]);else if(l=U.maxOpen(jS(l.content,i),!0),l.openStart||l.openEnd){let d=0,f=0;for(let p=l.content.firstChild;d<l.openStart&&!p.type.spec.isolating;d++,p=p.firstChild);for(let p=l.content.lastChild;f<l.openEnd&&!p.type.spec.isolating;f++,p=p.lastChild);l=bp(l,d,f)}return n.someProp("transformPasted",d=>{l=d(l,n)}),l}a(ey,"parseFromClipboard");const HS=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function jS(n,e){if(n.childCount<2)return n;for(let t=e.depth;t>=0;t--){let i=e.node(t).contentMatchAt(e.index(t)),o,s=[];if(n.forEach(l=>{if(!s)return;let c=i.findWrapping(l.type),u;if(!c)return s=null;if(u=s.length&&o.length&&ny(c,o,l,s[s.length-1],0))s[s.length-1]=u;else{s.length&&(s[s.length-1]=ry(s[s.length-1],o.length));let h=ty(l,c);s.push(h),i=i.matchType(h.type),o=c}}),s)return P.from(s)}return n}a(jS,"normalizeSiblings");function ty(n,e,t=0){for(let r=e.length-1;r>=t;r--)n=e[r].create(null,P.from(n));return n}a(ty,"withWrappers");function ny(n,e,t,r,i){if(i<n.length&&i<e.length&&n[i]==e[i]){let o=ny(n,e,t,r.lastChild,i+1);if(o)return r.copy(r.content.replaceChild(r.childCount-1,o));if(r.contentMatchAt(r.childCount).matchType(i==n.length-1?t.type:n[i+1]))return r.copy(r.content.append(P.from(ty(t,n,i+1))))}}a(ny,"addToSibling");function ry(n,e){if(e==0)return n;let t=n.content.replaceChild(n.childCount-1,ry(n.lastChild,e-1)),r=n.contentMatchAt(n.childCount).fillBefore(P.empty,!0);return n.copy(t.append(r))}a(ry,"closeRight");function lu(n,e,t,r,i,o){let s=e<0?n.firstChild:n.lastChild,l=s.content;return n.childCount>1&&(o=0),i<r-1&&(l=lu(l,e,t,r,i+1,o)),i>=t&&(l=e<0?s.contentMatchAt(0).fillBefore(l,o<=i).append(l):l.append(s.contentMatchAt(s.childCount).fillBefore(P.empty,!0))),n.replaceChild(e<0?0:n.childCount-1,s.copy(l))}a(lu,"closeRange");function bp(n,e,t){return e<n.openStart&&(n=new U(lu(n.content,-1,e,n.openStart,0,n.openEnd),e,n.openEnd)),t<n.openEnd&&(n=new U(lu(n.content,1,t,n.openEnd,0,0),n.openStart,t)),n}a(bp,"closeSlice");const iy={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let xp=null;function oy(){return xp||(xp=document.implementation.createHTMLDocument("title"))}a(oy,"detachedDoc");function VS(n){let e=/^(\s*<meta [^>]*>)*/.exec(n);e&&(n=n.slice(e[0].length));let t=oy().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(n),i;if((i=r&&iy[r[1].toLowerCase()])&&(n=i.map(o=>"<"+o+">").join("")+n+i.map(o=>"</"+o+">").reverse().join("")),t.innerHTML=n,i)for(let o=0;o<i.length;o++)t=t.querySelector(i[o])||t;return t}a(VS,"readHTML");function WS(n){let e=n.querySelectorAll(Qe?"span:not([class]):not([style])":"span.Apple-converted-space");for(let t=0;t<e.length;t++){let r=e[t];r.childNodes.length==1&&r.textContent==""&&r.parentNode&&r.parentNode.replaceChild(n.ownerDocument.createTextNode(" "),r)}}a(WS,"restoreReplacedSpaces");function qS(n,e){if(!n.size)return n;let t=n.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return n}let{content:i,openStart:o,openEnd:s}=n;for(let l=r.length-2;l>=0;l-=2){let c=t.nodes[r[l]];if(!c||c.hasRequiredAttrs())break;i=P.from(c.create(r[l+1],i)),o++,s++}return new U(i,o,s)}a(qS,"addContext");const tt={},nt={},KS={touchstart:!0,touchmove:!0},Hd=class Hd{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}};a(Hd,"InputState");let au=Hd;function US(n){for(let e in tt){let t=tt[e];n.dom.addEventListener(e,n.input.eventHandlers[e]=r=>{ZS(n,r)&&!Ku(n,r)&&(n.editable||!(r.type in nt))&&t(n,r)},KS[e]?{passive:!0}:void 0)}et&&n.dom.addEventListener("input",()=>null),cu(n)}a(US,"initInput");function Dn(n,e){n.input.lastSelectionOrigin=e,n.input.lastSelectionTime=Date.now()}a(Dn,"setSelectionOrigin");function JS(n){n.domObserver.stop();for(let e in n.input.eventHandlers)n.dom.removeEventListener(e,n.input.eventHandlers[e]);clearTimeout(n.input.composingTimeout),clearTimeout(n.input.lastIOSEnterFallbackTimeout)}a(JS,"destroyInput");function cu(n){n.someProp("handleDOMEvents",e=>{for(let t in e)n.input.eventHandlers[t]||n.dom.addEventListener(t,n.input.eventHandlers[t]=r=>Ku(n,r))})}a(cu,"ensureListeners");function Ku(n,e){return n.someProp("handleDOMEvents",t=>{let r=t[e.type];return r?r(n,e)||e.defaultPrevented:!1})}a(Ku,"runCustomHandler");function ZS(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target;t!=n.dom;t=t.parentNode)if(!t||t.nodeType==11||t.pmViewDesc&&t.pmViewDesc.stopEvent(e))return!1;return!0}a(ZS,"eventBelongsToView");function GS(n,e){!Ku(n,e)&&tt[e.type]&&(n.editable||!(e.type in nt))&&tt[e.type](n,e)}a(GS,"dispatchEvent$1");nt.keydown=(n,e)=>{let t=e;if(n.input.shiftKey=t.keyCode==16||t.shiftKey,!ly(n,t)&&(n.input.lastKeyCode=t.keyCode,n.input.lastKeyCodeTime=Date.now(),!(Ot&&Qe&&t.keyCode==13)))if(t.keyCode!=229&&n.domObserver.forceFlush(),fi&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){let r=Date.now();n.input.lastIOSEnter=r,n.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{n.input.lastIOSEnter==r&&(n.someProp("handleKeyDown",i=>i(n,ir(13,"Enter"))),n.input.lastIOSEnter=0)},200)}else n.someProp("handleKeyDown",r=>r(n,t))||BS(n,t)?t.preventDefault():Dn(n,"key")};nt.keyup=(n,e)=>{e.keyCode==16&&(n.input.shiftKey=!1)};nt.keypress=(n,e)=>{let t=e;if(ly(n,t)||!t.charCode||t.ctrlKey&&!t.altKey||xt&&t.metaKey)return;if(n.someProp("handleKeyPress",i=>i(n,t))){t.preventDefault();return}let r=n.state.selection;if(!(r instanceof de)||!r.$from.sameParent(r.$to)){let i=String.fromCharCode(t.charCode);!/[\r\n]/.test(i)&&!n.someProp("handleTextInput",o=>o(n,r.$from.pos,r.$to.pos,i))&&n.dispatch(n.state.tr.insertText(i).scrollIntoView()),t.preventDefault()}};function ia(n){return{left:n.clientX,top:n.clientY}}a(ia,"eventCoords");function YS(n,e){let t=e.x-n.clientX,r=e.y-n.clientY;return t*t+r*r<100}a(YS,"isNear");function Uu(n,e,t,r,i){if(r==-1)return!1;let o=n.state.doc.resolve(r);for(let s=o.depth+1;s>0;s--)if(n.someProp(e,l=>s>o.depth?l(n,t,o.nodeAfter,o.before(s),i,!0):l(n,t,o.node(s),o.before(s),i,!1)))return!0;return!1}a(Uu,"runHandlerOnContext");function ii(n,e,t){n.focused||n.focus();let r=n.state.tr.setSelection(e);t=="pointer"&&r.setMeta("pointer",!0),n.dispatch(r)}a(ii,"updateSelection");function QS(n,e){if(e==-1)return!1;let t=n.state.doc.resolve(e),r=t.nodeAfter;return r&&r.isAtom&&oe.isSelectable(r)?(ii(n,new oe(t),"pointer"),!0):!1}a(QS,"selectClickedLeaf");function XS(n,e){if(e==-1)return!1;let t=n.state.selection,r,i;t instanceof oe&&(r=t.node);let o=n.state.doc.resolve(e);for(let s=o.depth+1;s>0;s--){let l=s>o.depth?o.nodeAfter:o.node(s);if(oe.isSelectable(l)){r&&t.$from.depth>0&&s>=t.$from.depth&&o.before(t.$from.depth+1)==t.$from.pos?i=o.before(t.$from.depth):i=o.before(s);break}}return i!=null?(ii(n,oe.create(n.state.doc,i),"pointer"),!0):!1}a(XS,"selectClickedNode");function ev(n,e,t,r,i){return Uu(n,"handleClickOn",e,t,r)||n.someProp("handleClick",o=>o(n,e,r))||(i?XS(n,t):QS(n,t))}a(ev,"handleSingleClick");function tv(n,e,t,r){return Uu(n,"handleDoubleClickOn",e,t,r)||n.someProp("handleDoubleClick",i=>i(n,e,r))}a(tv,"handleDoubleClick");function nv(n,e,t,r){return Uu(n,"handleTripleClickOn",e,t,r)||n.someProp("handleTripleClick",i=>i(n,e,r))||rv(n,t,r)}a(nv,"handleTripleClick$1");function rv(n,e,t){if(t.button!=0)return!1;let r=n.state.doc;if(e==-1)return r.inlineContent?(ii(n,de.create(r,0,r.content.size),"pointer"),!0):!1;let i=r.resolve(e);for(let o=i.depth+1;o>0;o--){let s=o>i.depth?i.nodeAfter:i.node(o),l=i.before(o);if(s.inlineContent)ii(n,de.create(r,l+1,l+1+s.content.size),"pointer");else if(oe.isSelectable(s))ii(n,oe.create(r,l),"pointer");else continue;return!0}}a(rv,"defaultTripleClick");function Ju(n){return Ol(n)}a(Ju,"forceDOMFlush");const sy=xt?"metaKey":"ctrlKey";tt.mousedown=(n,e)=>{let t=e;n.input.shiftKey=t.shiftKey;let r=Ju(n),i=Date.now(),o="singleClick";i-n.input.lastClick.time<500&&YS(t,n.input.lastClick)&&!t[sy]&&(n.input.lastClick.type=="singleClick"?o="doubleClick":n.input.lastClick.type=="doubleClick"&&(o="tripleClick")),n.input.lastClick={time:i,x:t.clientX,y:t.clientY,type:o};let s=n.posAtCoords(ia(t));s&&(o=="singleClick"?(n.input.mouseDown&&n.input.mouseDown.done(),n.input.mouseDown=new uu(n,s,t,!!r)):(o=="doubleClick"?tv:nv)(n,s.pos,s.inside,t)?t.preventDefault():Dn(n,"pointer"))};const jd=class jd{constructor(e,t,r,i){this.view=e,this.pos=t,this.event=r,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[sy],this.allowDefault=r.shiftKey;let o,s;if(t.inside>-1)o=e.state.doc.nodeAt(t.inside),s=t.inside;else{let h=e.state.doc.resolve(t.pos);o=h.parent,s=h.depth?h.before():0}const l=i?null:r.target,c=l?e.docView.nearestDesc(l,!0):null;this.target=c?c.dom:null;let{selection:u}=e.state;(r.button==0&&o.type.spec.draggable&&o.type.spec.selectable!==!1||u instanceof oe&&u.from<=s&&u.to>s)&&(this.mightDrag={node:o,pos:s,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Rt&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Dn(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>an(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(ia(e))),this.updateAllowDefault(e),this.allowDefault||!t?Dn(this.view,"pointer"):ev(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||et&&this.mightDrag&&!this.mightDrag.node.isAtom||Qe&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(ii(this.view,te.near(this.view.state.doc.resolve(t.pos)),"pointer"),e.preventDefault()):Dn(this.view,"pointer")}move(e){this.updateAllowDefault(e),Dn(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}};a(jd,"MouseDown");let uu=jd;tt.touchstart=n=>{n.input.lastTouch=Date.now(),Ju(n),Dn(n,"pointer")};tt.touchmove=n=>{n.input.lastTouch=Date.now(),Dn(n,"pointer")};tt.contextmenu=n=>Ju(n);function ly(n,e){return n.composing?!0:et&&Math.abs(e.timeStamp-n.input.compositionEndedAt)<500?(n.input.compositionEndedAt=-2e8,!0):!1}a(ly,"inOrNearComposition");const iv=Ot?5e3:-1;nt.compositionstart=nt.compositionupdate=n=>{if(!n.composing){n.domObserver.flush();let{state:e}=n,t=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)))n.markCursor=n.state.storedMarks||t.marks(),Ol(n,!0),n.markCursor=null;else if(Ol(n),Rt&&e.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length){let r=n.domSelectionRange();for(let i=r.focusNode,o=r.focusOffset;i&&i.nodeType==1&&o!=0;){let s=o<0?i.lastChild:i.childNodes[o-1];if(!s)break;if(s.nodeType==3){n.domSelection().collapse(s,s.nodeValue.length);break}else i=s,o=-1}}n.input.composing=!0}ay(n,iv)};nt.compositionend=(n,e)=>{n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=e.timeStamp,n.input.compositionPendingChanges=n.domObserver.pendingRecords().length?n.input.compositionID:0,n.input.compositionNode=null,n.input.compositionPendingChanges&&Promise.resolve().then(()=>n.domObserver.flush()),n.input.compositionID++,ay(n,20))};function ay(n,e){clearTimeout(n.input.composingTimeout),e>-1&&(n.input.composingTimeout=setTimeout(()=>Ol(n),e))}a(ay,"scheduleComposeEnd");function cy(n){for(n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=sv());n.input.compositionNodes.length>0;)n.input.compositionNodes.pop().markParentsDirty()}a(cy,"clearComposition");function ov(n){let e=n.domSelectionRange();if(!e.focusNode)return null;let t=nS(e.focusNode,e.focusOffset),r=rS(e.focusNode,e.focusOffset);if(t&&r&&t!=r){let i=r.pmViewDesc;if(!i||!i.isText(r.nodeValue))return r;if(n.input.compositionNode==r){let o=t.pmViewDesc;if(!(!o||!o.isText(t.nodeValue)))return r}}return t||r}a(ov,"findCompositionNode");function sv(){let n=document.createEvent("Event");return n.initEvent("event",!0,!0),n.timeStamp}a(sv,"timestampFromCustomEvent");function Ol(n,e=!1){if(!(Ot&&n.domObserver.flushingSoon>=0)){if(n.domObserver.forceFlush(),cy(n),e||n.docView&&n.docView.dirty){let t=Wu(n);return t&&!t.eq(n.state.selection)?n.dispatch(n.state.tr.setSelection(t)):n.updateState(n.state),!0}return!1}}a(Ol,"endComposition");function lv(n,e){if(!n.dom.parentNode)return;let t=n.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(e),t.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),i=document.createRange();i.selectNodeContents(e),n.dom.blur(),r.removeAllRanges(),r.addRange(i),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),n.focus()},50)}a(lv,"captureCopy");const Do=lt&&Fn<15||fi&&cS<604;tt.copy=nt.cut=(n,e)=>{let t=e,r=n.state.selection,i=t.type=="cut";if(r.empty)return;let o=Do?null:t.clipboardData,s=r.content(),{dom:l,text:c}=Xg(n,s);o?(t.preventDefault(),o.clearData(),o.setData("text/html",l.innerHTML),o.setData("text/plain",c)):lv(n,l),i&&n.dispatch(n.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function av(n){return n.openStart==0&&n.openEnd==0&&n.content.childCount==1?n.content.firstChild:null}a(av,"sliceSingleNode");function cv(n,e){if(!n.dom.parentNode)return;let t=n.input.shiftKey||n.state.selection.$from.parent.type.spec.code,r=n.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let i=n.input.shiftKey&&n.input.lastKeyCode!=45;setTimeout(()=>{n.focus(),r.parentNode&&r.parentNode.removeChild(r),t?Ro(n,r.value,null,i,e):Ro(n,r.textContent,r.innerHTML,i,e)},50)}a(cv,"capturePaste");function Ro(n,e,t,r,i){let o=ey(n,e,t,r,n.state.selection.$from);if(n.someProp("handlePaste",c=>c(n,i,o||U.empty)))return!0;if(!o)return!1;let s=av(o),l=s?n.state.tr.replaceSelectionWith(s,r):n.state.tr.replaceSelection(o);return n.dispatch(l.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}a(Ro,"doPaste");function uy(n){let e=n.getData("text/plain")||n.getData("Text");if(e)return e;let t=n.getData("text/uri-list");return t?t.replace(/\r?\n/g," "):""}a(uy,"getText");nt.paste=(n,e)=>{let t=e;if(n.composing&&!Ot)return;let r=Do?null:t.clipboardData,i=n.input.shiftKey&&n.input.lastKeyCode!=45;r&&Ro(n,uy(r),r.getData("text/html"),i,t)?t.preventDefault():cv(n,t)};const Vd=class Vd{constructor(e,t,r){this.slice=e,this.move=t,this.node=r}};a(Vd,"Dragging");let _l=Vd;const hy=xt?"altKey":"ctrlKey";tt.dragstart=(n,e)=>{let t=e,r=n.input.mouseDown;if(r&&r.done(),!t.dataTransfer)return;let i=n.state.selection,o=i.empty?null:n.posAtCoords(ia(t)),s;if(!(o&&o.pos>=i.from&&o.pos<=(i instanceof oe?i.to-1:i.to))){if(r&&r.mightDrag)s=oe.create(n.state.doc,r.mightDrag.pos);else if(t.target&&t.target.nodeType==1){let d=n.docView.nearestDesc(t.target,!0);d&&d.node.type.spec.draggable&&d!=n.docView&&(s=oe.create(n.state.doc,d.posBefore))}}let l=(s||n.state.selection).content(),{dom:c,text:u,slice:h}=Xg(n,l);t.dataTransfer.clearData(),t.dataTransfer.setData(Do?"Text":"text/html",c.innerHTML),t.dataTransfer.effectAllowed="copyMove",Do||t.dataTransfer.setData("text/plain",u),n.dragging=new _l(h,!t[hy],s)};tt.dragend=n=>{let e=n.dragging;window.setTimeout(()=>{n.dragging==e&&(n.dragging=null)},50)};nt.dragover=nt.dragenter=(n,e)=>e.preventDefault();nt.drop=(n,e)=>{let t=e,r=n.dragging;if(n.dragging=null,!t.dataTransfer)return;let i=n.posAtCoords(ia(t));if(!i)return;let o=n.state.doc.resolve(i.pos),s=r&&r.slice;s?n.someProp("transformPasted",m=>{s=m(s,n)}):s=ey(n,uy(t.dataTransfer),Do?null:t.dataTransfer.getData("text/html"),!1,o);let l=!!(r&&!t[hy]);if(n.someProp("handleDrop",m=>m(n,t,s||U.empty,l))){t.preventDefault();return}if(!s)return;t.preventDefault();let c=s?KC(n.state.doc,o.pos,s):o.pos;c==null&&(c=o.pos);let u=n.state.tr;if(l){let{node:m}=r;m?m.replace(u):u.deleteSelection()}let h=u.mapping.map(c),d=s.openStart==0&&s.openEnd==0&&s.content.childCount==1,f=u.doc;if(d?u.replaceRangeWith(h,h,s.content.firstChild):u.replaceRange(h,h,s),u.doc.eq(f))return;let p=u.doc.resolve(h);if(d&&oe.isSelectable(s.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(s.content.firstChild))u.setSelection(new oe(p));else{let m=u.mapping.map(c);u.mapping.maps[u.mapping.maps.length-1].forEach((g,k,b,x)=>m=x),u.setSelection(qu(n,p,u.doc.resolve(m)))}n.focus(),n.dispatch(u.setMeta("uiEvent","drop"))};tt.focus=n=>{n.input.lastFocus=Date.now(),n.focused||(n.domObserver.stop(),n.dom.classList.add("ProseMirror-focused"),n.domObserver.start(),n.focused=!0,setTimeout(()=>{n.docView&&n.hasFocus()&&!n.domObserver.currentSelection.eq(n.domSelectionRange())&&an(n)},20))};tt.blur=(n,e)=>{let t=e;n.focused&&(n.domObserver.stop(),n.dom.classList.remove("ProseMirror-focused"),n.domObserver.start(),t.relatedTarget&&n.dom.contains(t.relatedTarget)&&n.domObserver.currentSelection.clear(),n.focused=!1)};tt.beforeinput=(n,e)=>{if(Qe&&Ot&&e.inputType=="deleteContentBackward"){n.domObserver.flushSoon();let{domChangeCount:r}=n.input;setTimeout(()=>{if(n.input.domChangeCount!=r||(n.dom.blur(),n.focus(),n.someProp("handleKeyDown",o=>o(n,ir(8,"Backspace")))))return;let{$cursor:i}=n.state.selection;i&&i.pos>0&&n.dispatch(n.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let n in nt)tt[n]=nt[n];function zo(n,e){if(n==e)return!0;for(let t in n)if(n[t]!==e[t])return!1;for(let t in e)if(!(t in n))return!1;return!0}a(zo,"compareObjs");const Ul=class Ul{constructor(e,t){this.toDOM=e,this.spec=t||Cr,this.side=this.spec.side||0}map(e,t,r,i){let{pos:o,deleted:s}=e.mapResult(t.from+i,this.side<0?-1:1);return s?null:new Mt(o-r,o-r,this)}valid(){return!0}eq(e){return this==e||e instanceof Ul&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&zo(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}};a(Ul,"WidgetType");let Dl=Ul;const $o=class $o{constructor(e,t){this.attrs=e,this.spec=t||Cr}map(e,t,r,i){let o=e.map(t.from+i,this.spec.inclusiveStart?-1:1)-r,s=e.map(t.to+i,this.spec.inclusiveEnd?1:-1)-r;return o>=s?null:new Mt(o,s,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof $o&&zo(this.attrs,e.attrs)&&zo(this.spec,e.spec)}static is(e){return e.type instanceof $o}destroy(){}};a($o,"InlineType");let wr=$o;const Jl=class Jl{constructor(e,t){this.attrs=e,this.spec=t||Cr}map(e,t,r,i){let o=e.mapResult(t.from+i,1);if(o.deleted)return null;let s=e.mapResult(t.to+i,-1);return s.deleted||s.pos<=o.pos?null:new Mt(o.pos-r,s.pos-r,this)}valid(e,t){let{index:r,offset:i}=e.content.findIndex(t.from),o;return i==t.from&&!(o=e.child(r)).isText&&i+o.nodeSize==t.to}eq(e){return this==e||e instanceof Jl&&zo(this.attrs,e.attrs)&&zo(this.spec,e.spec)}destroy(){}};a(Jl,"NodeType");let hu=Jl;const pr=class pr{constructor(e,t,r){this.from=e,this.to=t,this.type=r}copy(e,t){return new pr(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,r){return this.type.map(e,this,t,r)}static widget(e,t,r){return new pr(e,e,new Dl(t,r))}static inline(e,t,r,i){return new pr(e,t,new wr(r,i))}static node(e,t,r,i){return new pr(e,t,new hu(r,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof wr}get widget(){return this.type instanceof Dl}};a(pr,"Decoration");let Mt=pr;const Wr=[],Cr={},Ht=class Ht{constructor(e,t){this.local=e.length?e:Wr,this.children=t.length?t:Wr}static create(e,t){return t.length?zl(t,e,0,Cr):Je}find(e,t,r){let i=[];return this.findInner(e??0,t??1e9,i,0,r),i}findInner(e,t,r,i,o){for(let s=0;s<this.local.length;s++){let l=this.local[s];l.from<=t&&l.to>=e&&(!o||o(l.spec))&&r.push(l.copy(l.from+i,l.to+i))}for(let s=0;s<this.children.length;s+=3)if(this.children[s]<t&&this.children[s+1]>e){let l=this.children[s]+1;this.children[s+2].findInner(e-l,t-l,r,i+l,o)}}map(e,t,r){return this==Je||e.maps.length==0?this:this.mapInner(e,t,0,0,r||Cr)}mapInner(e,t,r,i,o){let s;for(let l=0;l<this.local.length;l++){let c=this.local[l].map(e,r,i);c&&c.type.valid(t,c)?(s||(s=[])).push(c):o.onRemove&&o.onRemove(this.local[l].spec)}return this.children.length?uv(this.children,s||[],e,t,r,i,o):s?new Ht(s.sort(Sr),Wr):Je}add(e,t){return t.length?this==Je?Ht.create(e,t):this.addInner(e,t,0):this}addInner(e,t,r){let i,o=0;e.forEach((l,c)=>{let u=c+r,h;if(h=fy(t,l,u)){for(i||(i=this.children.slice());o<i.length&&i[o]<c;)o+=3;i[o]==c?i[o+2]=i[o+2].addInner(l,h,u+1):i.splice(o,0,c,c+l.nodeSize,zl(h,l,u+1,Cr)),o+=3}});let s=dy(o?py(t):t,-r);for(let l=0;l<s.length;l++)s[l].type.valid(e,s[l])||s.splice(l--,1);return new Ht(s.length?this.local.concat(s).sort(Sr):this.local,i||this.children)}remove(e){return e.length==0||this==Je?this:this.removeInner(e,0)}removeInner(e,t){let r=this.children,i=this.local;for(let o=0;o<r.length;o+=3){let s,l=r[o]+t,c=r[o+1]+t;for(let h=0,d;h<e.length;h++)(d=e[h])&&d.from>l&&d.to<c&&(e[h]=null,(s||(s=[])).push(d));if(!s)continue;r==this.children&&(r=this.children.slice());let u=r[o+2].removeInner(s,l+1);u!=Je?r[o+2]=u:(r.splice(o,3),o-=3)}if(i.length){for(let o=0,s;o<e.length;o++)if(s=e[o])for(let l=0;l<i.length;l++)i[l].eq(s,t)&&(i==this.local&&(i=this.local.slice()),i.splice(l--,1))}return r==this.children&&i==this.local?this:i.length||r.length?new Ht(i,r):Je}forChild(e,t){if(this==Je)return this;if(t.isLeaf)return Ht.empty;let r,i;for(let l=0;l<this.children.length;l+=3)if(this.children[l]>=e){this.children[l]==e&&(r=this.children[l+2]);break}let o=e+1,s=o+t.content.size;for(let l=0;l<this.local.length;l++){let c=this.local[l];if(c.from<s&&c.to>o&&c.type instanceof wr){let u=Math.max(o,c.from)-o,h=Math.min(s,c.to)-o;u<h&&(i||(i=[])).push(c.copy(u,h))}}if(i){let l=new Ht(i.sort(Sr),Wr);return r?new Rl([l,r]):l}return r||Je}eq(e){if(this==e)return!0;if(!(e instanceof Ht)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return Zu(this.localsInner(e))}localsInner(e){if(this==Je)return Wr;if(e.inlineContent||!this.local.some(wr.is))return this.local;let t=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof wr||t.push(this.local[r]);return t}};a(Ht,"DecorationSet");let Ke=Ht;Ke.empty=new Ke([],[]);Ke.removeOverlap=Zu;const Je=Ke.empty,En=class En{constructor(e){this.members=e}map(e,t){const r=this.members.map(i=>i.map(e,t,Cr));return En.from(r)}forChild(e,t){if(t.isLeaf)return Ke.empty;let r=[];for(let i=0;i<this.members.length;i++){let o=this.members[i].forChild(e,t);o!=Je&&(o instanceof En?r=r.concat(o.members):r.push(o))}return En.from(r)}eq(e){if(!(e instanceof En)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,r=!0;for(let i=0;i<this.members.length;i++){let o=this.members[i].localsInner(e);if(o.length)if(!t)t=o;else{r&&(t=t.slice(),r=!1);for(let s=0;s<o.length;s++)t.push(o[s])}}return t?Zu(r?t:t.sort(Sr)):Wr}static from(e){switch(e.length){case 0:return Je;case 1:return e[0];default:return new En(e.every(t=>t instanceof Ke)?e:e.reduce((t,r)=>t.concat(r instanceof Ke?r:r.members),[]))}}};a(En,"DecorationGroup");let Rl=En;function uv(n,e,t,r,i,o,s){let l=n.slice();for(let u=0,h=o;u<t.maps.length;u++){let d=0;t.maps[u].forEach((f,p,m,g)=>{let k=g-m-(p-f);for(let b=0;b<l.length;b+=3){let x=l[b+1];if(x<0||f>x+h-d)continue;let C=l[b]+h-d;p>=C?l[b+1]=f<=C?-2:-1:f>=h&&k&&(l[b]+=k,l[b+1]+=k)}d+=k}),h=t.maps[u].map(h,-1)}let c=!1;for(let u=0;u<l.length;u+=3)if(l[u+1]<0){if(l[u+1]==-2){c=!0,l[u+1]=-1;continue}let h=t.map(n[u]+o),d=h-i;if(d<0||d>=r.content.size){c=!0;continue}let f=t.map(n[u+1]+o,-1),p=f-i,{index:m,offset:g}=r.content.findIndex(d),k=r.maybeChild(m);if(k&&g==d&&g+k.nodeSize==p){let b=l[u+2].mapInner(t,k,h+1,n[u]+o+1,s);b!=Je?(l[u]=d,l[u+1]=p,l[u+2]=b):(l[u+1]=-2,c=!0)}else c=!0}if(c){let u=hv(l,n,e,t,i,o,s),h=zl(u,r,0,s);e=h.local;for(let d=0;d<l.length;d+=3)l[d+1]<0&&(l.splice(d,3),d-=3);for(let d=0,f=0;d<h.children.length;d+=3){let p=h.children[d];for(;f<l.length&&l[f]<p;)f+=3;l.splice(f,0,h.children[d],h.children[d+1],h.children[d+2])}}return new Ke(e.sort(Sr),l)}a(uv,"mapChildren");function dy(n,e){if(!e||!n.length)return n;let t=[];for(let r=0;r<n.length;r++){let i=n[r];t.push(new Mt(i.from+e,i.to+e,i.type))}return t}a(dy,"moveSpans");function hv(n,e,t,r,i,o,s){function l(c,u){for(let h=0;h<c.local.length;h++){let d=c.local[h].map(r,i,u);d?t.push(d):s.onRemove&&s.onRemove(c.local[h].spec)}for(let h=0;h<c.children.length;h+=3)l(c.children[h+2],c.children[h]+u+1)}a(l,"gather");for(let c=0;c<n.length;c+=3)n[c+1]==-1&&l(n[c+2],e[c]+o+1);return t}a(hv,"mapAndGatherRemainingDecorations");function fy(n,e,t){if(e.isLeaf)return null;let r=t+e.nodeSize,i=null;for(let o=0,s;o<n.length;o++)(s=n[o])&&s.from>t&&s.to<r&&((i||(i=[])).push(s),n[o]=null);return i}a(fy,"takeSpansForNode");function py(n){let e=[];for(let t=0;t<n.length;t++)n[t]!=null&&e.push(n[t]);return e}a(py,"withoutNulls");function zl(n,e,t,r){let i=[],o=!1;e.forEach((l,c)=>{let u=fy(n,l,c+t);if(u){o=!0;let h=zl(u,l,t+c+1,r);h!=Je&&i.push(c,c+l.nodeSize,h)}});let s=dy(o?py(n):n,-t).sort(Sr);for(let l=0;l<s.length;l++)s[l].type.valid(e,s[l])||(r.onRemove&&r.onRemove(s[l].spec),s.splice(l--,1));return s.length||i.length?new Ke(s,i):Je}a(zl,"buildTree");function Sr(n,e){return n.from-e.from||n.to-e.to}a(Sr,"byPos");function Zu(n){let e=n;for(let t=0;t<e.length-1;t++){let r=e[t];if(r.from!=r.to)for(let i=t+1;i<e.length;i++){let o=e[i];if(o.from==r.from){o.to!=r.to&&(e==n&&(e=n.slice()),e[i]=o.copy(o.from,r.to),wp(e,i+1,o.copy(r.to,o.to)));continue}else{o.from<r.to&&(e==n&&(e=n.slice()),e[t]=r.copy(r.from,o.from),wp(e,i,r.copy(o.from,r.to)));break}}}return e}a(Zu,"removeOverlap");function wp(n,e,t){for(;e<n.length&&Sr(t,n[e])>0;)e++;n.splice(e,0,t)}a(wp,"insertAhead");function Ba(n){let e=[];return n.someProp("decorations",t=>{let r=t(n.state);r&&r!=Je&&e.push(r)}),n.cursorWrapper&&e.push(Ke.create(n.state.doc,[n.cursorWrapper.deco])),Rl.from(e)}a(Ba,"viewDecorations");const dv={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},fv=lt&&Fn<=11,Wd=class Wd{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}};a(Wd,"SelectionState");let du=Wd;const qd=class qd{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new du,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let i=0;i<r.length;i++)this.queue.push(r[i]);lt&&Fn<=11&&r.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),fv&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,dv)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(fp(this.view)){if(this.suppressingSelectionUpdates)return an(this.view);if(lt&&Fn<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&Or(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t=new Set,r;for(let o=e.focusNode;o;o=_o(o))t.add(o);for(let o=e.anchorNode;o;o=_o(o))if(t.has(o)){r=o;break}let i=r&&this.view.docView.nearestDesc(r);if(i&&i.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.pendingRecords();t.length&&(this.queue=[]);let r=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&fp(e)&&!this.ignoreSelectionChange(r),o=-1,s=-1,l=!1,c=[];if(e.editable)for(let h=0;h<t.length;h++){let d=this.registerMutation(t[h],c);d&&(o=o<0?d.from:Math.min(d.from,o),s=s<0?d.to:Math.max(d.to,s),d.typeOver&&(l=!0))}if(Rt&&c.length>1){let h=c.filter(d=>d.nodeName=="BR");if(h.length==2){let d=h[0],f=h[1];d.parentNode&&d.parentNode.parentNode==f.parentNode?f.remove():d.remove()}}let u=null;o<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&ra(r)&&(u=Wu(e))&&u.eq(te.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,an(e),this.currentSelection.set(r),e.scrollToSelection()):(o>-1||i)&&(o>-1&&(e.docView.markDirty(o,s),pv(e)),this.handleDOMChange(o,s,l,c),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||an(e),this.currentSelection.set(r))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let h=0;h<e.addedNodes.length;h++)t.push(e.addedNodes[h]);if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let i=e.previousSibling,o=e.nextSibling;if(lt&&Fn<=11&&e.addedNodes.length)for(let h=0;h<e.addedNodes.length;h++){let{previousSibling:d,nextSibling:f}=e.addedNodes[h];(!d||Array.prototype.indexOf.call(e.addedNodes,d)<0)&&(i=d),(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(o=f)}let s=i&&i.parentNode==e.target?Ve(i)+1:0,l=r.localPosFromDOM(e.target,s,-1),c=o&&o.parentNode==e.target?Ve(o):e.target.childNodes.length,u=r.localPosFromDOM(e.target,c,1);return{from:l,to:u}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}}};a(qd,"DOMObserver");let fu=qd,Cp=new WeakMap,Sp=!1;function pv(n){if(!Cp.has(n)&&(Cp.set(n,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(n.dom).whiteSpace)!==-1)){if(n.requiresGeckoHackNode=Rt,Sp)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),Sp=!0}}a(pv,"checkCSS");function vp(n,e){let t=e.startContainer,r=e.startOffset,i=e.endContainer,o=e.endOffset,s=n.domAtPos(n.state.selection.anchor);return Or(s.node,s.offset,i,o)&&([t,r,i,o]=[i,o,t,r]),{anchorNode:t,anchorOffset:r,focusNode:i,focusOffset:o}}a(vp,"rangeToSelectionRange");function mv(n,e){if(e.getComposedRanges){let i=e.getComposedRanges(n.root)[0];if(i)return vp(n,i)}let t;function r(i){i.preventDefault(),i.stopImmediatePropagation(),t=i.getTargetRanges()[0]}return a(r,"read"),n.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),n.dom.removeEventListener("beforeinput",r,!0),t?vp(n,t):null}a(mv,"safariShadowSelectionRange");function gv(n,e,t){let{node:r,fromOffset:i,toOffset:o,from:s,to:l}=n.docView.parseRange(e,t),c=n.domSelectionRange(),u,h=c.anchorNode;if(h&&n.dom.contains(h.nodeType==1?h:h.parentNode)&&(u=[{node:h,offset:c.anchorOffset}],ra(c)||u.push({node:c.focusNode,offset:c.focusOffset})),Qe&&n.input.lastKeyCode===8)for(let k=o;k>i;k--){let b=r.childNodes[k-1],x=b.pmViewDesc;if(b.nodeName=="BR"&&!x){o=k;break}if(!x||x.size)break}let d=n.state.doc,f=n.someProp("domParser")||Ao.fromSchema(n.state.schema),p=d.resolve(s),m=null,g=f.parse(r,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:i,to:o,preserveWhitespace:p.parent.type.whitespace=="pre"?"full":!0,findPositions:u,ruleFromNode:yv,context:p});if(u&&u[0].pos!=null){let k=u[0].pos,b=u[1]&&u[1].pos;b==null&&(b=k),m={anchor:k+s,head:b+s}}return{doc:g,sel:m,from:s,to:l}}a(gv,"parseBetween");function yv(n){let e=n.pmViewDesc;if(e)return e.parseRule();if(n.nodeName=="BR"&&n.parentNode){if(et&&/^(ul|ol)$/i.test(n.parentNode.nodeName)){let t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}else if(n.parentNode.lastChild==n||et&&/^(tr|table)$/i.test(n.parentNode.nodeName))return{ignore:!0}}else if(n.nodeName=="IMG"&&n.getAttribute("mark-placeholder"))return{ignore:!0};return null}a(yv,"ruleFromNode");const kv=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function bv(n,e,t,r,i){let o=n.input.compositionPendingChanges||(n.composing?n.input.compositionID:0);if(n.input.compositionPendingChanges=0,e<0){let F=n.input.lastSelectionTime>Date.now()-50?n.input.lastSelectionOrigin:null,v=Wu(n,F);if(v&&!n.state.selection.eq(v)){if(Qe&&Ot&&n.input.lastKeyCode===13&&Date.now()-100<n.input.lastKeyCodeTime&&n.someProp("handleKeyDown",J=>J(n,ir(13,"Enter"))))return;let j=n.state.tr.setSelection(v);F=="pointer"?j.setMeta("pointer",!0):F=="key"&&j.scrollIntoView(),o&&j.setMeta("composition",o),n.dispatch(j)}return}let s=n.state.doc.resolve(e),l=s.sharedDepth(t);e=s.before(l+1),t=n.state.doc.resolve(t).after(l+1);let c=n.state.selection,u=gv(n,e,t),h=n.state.doc,d=h.slice(u.from,u.to),f,p;n.input.lastKeyCode===8&&Date.now()-100<n.input.lastKeyCodeTime?(f=n.state.selection.to,p="end"):(f=n.state.selection.from,p="start"),n.input.lastKeyCode=null;let m=Cv(d.content,u.doc.content,u.from,f,p);if((fi&&n.input.lastIOSEnter>Date.now()-225||Ot)&&i.some(F=>F.nodeType==1&&!kv.test(F.nodeName))&&(!m||m.endA>=m.endB)&&n.someProp("handleKeyDown",F=>F(n,ir(13,"Enter")))){n.input.lastIOSEnter=0;return}if(!m)if(r&&c instanceof de&&!c.empty&&c.$head.sameParent(c.$anchor)&&!n.composing&&!(u.sel&&u.sel.anchor!=u.sel.head))m={start:c.from,endA:c.to,endB:c.to};else{if(u.sel){let F=Np(n,n.state.doc,u.sel);if(F&&!F.eq(n.state.selection)){let v=n.state.tr.setSelection(F);o&&v.setMeta("composition",o),n.dispatch(v)}}return}n.input.domChangeCount++,n.state.selection.from<n.state.selection.to&&m.start==m.endB&&n.state.selection instanceof de&&(m.start>n.state.selection.from&&m.start<=n.state.selection.from+2&&n.state.selection.from>=u.from?m.start=n.state.selection.from:m.endA<n.state.selection.to&&m.endA>=n.state.selection.to-2&&n.state.selection.to<=u.to&&(m.endB+=n.state.selection.to-m.endA,m.endA=n.state.selection.to)),lt&&Fn<=11&&m.endB==m.start+1&&m.endA==m.start&&m.start>u.from&&u.doc.textBetween(m.start-u.from-1,m.start-u.from+1)==" "&&(m.start--,m.endA--,m.endB--);let g=u.doc.resolveNoCache(m.start-u.from),k=u.doc.resolveNoCache(m.endB-u.from),b=h.resolve(m.start),x=g.sameParent(k)&&g.parent.inlineContent&&b.end()>=m.endA,C;if((fi&&n.input.lastIOSEnter>Date.now()-225&&(!x||i.some(F=>F.nodeName=="DIV"||F.nodeName=="P"))||!x&&g.pos<u.doc.content.size&&!g.sameParent(k)&&(C=te.findFrom(u.doc.resolve(g.pos+1),1,!0))&&C.head==k.pos)&&n.someProp("handleKeyDown",F=>F(n,ir(13,"Enter")))){n.input.lastIOSEnter=0;return}if(n.state.selection.anchor>m.start&&wv(h,m.start,m.endA,g,k)&&n.someProp("handleKeyDown",F=>F(n,ir(8,"Backspace")))){Ot&&Qe&&n.domObserver.suppressSelectionUpdates();return}Qe&&Ot&&m.endB==m.start&&(n.input.lastAndroidDelete=Date.now()),Ot&&!x&&g.start()!=k.start()&&k.parentOffset==0&&g.depth==k.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==m.endA&&(m.endB-=2,k=u.doc.resolveNoCache(m.endB-u.from),setTimeout(()=>{n.someProp("handleKeyDown",function(F){return F(n,ir(13,"Enter"))})},20));let N=m.start,A=m.endA,S,q,V;if(x){if(g.pos==k.pos)lt&&Fn<=11&&g.parentOffset==0&&(n.domObserver.suppressSelectionUpdates(),setTimeout(()=>an(n),20)),S=n.state.tr.delete(N,A),q=h.resolve(m.start).marksAcross(h.resolve(m.endA));else if(m.endA==m.endB&&(V=xv(g.parent.content.cut(g.parentOffset,k.parentOffset),b.parent.content.cut(b.parentOffset,m.endA-b.start()))))S=n.state.tr,V.type=="add"?S.addMark(N,A,V.mark):S.removeMark(N,A,V.mark);else if(g.parent.child(g.index()).isText&&g.index()==k.index()-(k.textOffset?0:1)){let F=g.parent.textBetween(g.parentOffset,k.parentOffset);if(n.someProp("handleTextInput",v=>v(n,N,A,F)))return;S=n.state.tr.insertText(F,N,A)}}if(S||(S=n.state.tr.replace(N,A,u.doc.slice(m.start-u.from,m.endB-u.from))),u.sel){let F=Np(n,S.doc,u.sel);F&&!(Qe&&Ot&&n.composing&&F.empty&&(m.start!=m.endB||n.input.lastAndroidDelete<Date.now()-100)&&(F.head==N||F.head==S.mapping.map(A)-1)||lt&&F.empty&&F.head==N)&&S.setSelection(F)}q&&S.ensureMarks(q),o&&S.setMeta("composition",o),n.dispatch(S.scrollIntoView())}a(bv,"readDOMChange");function Np(n,e,t){return Math.max(t.anchor,t.head)>e.content.size?null:qu(n,e.resolve(t.anchor),e.resolve(t.head))}a(Np,"resolveSelection");function xv(n,e){let t=n.firstChild.marks,r=e.firstChild.marks,i=t,o=r,s,l,c;for(let h=0;h<r.length;h++)i=r[h].removeFromSet(i);for(let h=0;h<t.length;h++)o=t[h].removeFromSet(o);if(i.length==1&&o.length==0)l=i[0],s="add",c=a(h=>h.mark(l.addToSet(h.marks)),"update");else if(i.length==0&&o.length==1)l=o[0],s="remove",c=a(h=>h.mark(l.removeFromSet(h.marks)),"update");else return null;let u=[];for(let h=0;h<e.childCount;h++)u.push(c(e.child(h)));if(P.from(u).eq(n))return{mark:l,type:s}}a(xv,"isMarkChange");function wv(n,e,t,r,i){if(t-e<=i.pos-r.pos||Ha(r,!0,!1)<i.pos)return!1;let o=n.resolve(e);if(!r.parent.isTextblock){let l=o.nodeAfter;return l!=null&&t==e+l.nodeSize}if(o.parentOffset<o.parent.content.size||!o.parent.isTextblock)return!1;let s=n.resolve(Ha(o,!0,!0));return!s.parent.isTextblock||s.pos>t||Ha(s,!0,!1)<t?!1:r.parent.content.cut(r.parentOffset).eq(s.parent.content)}a(wv,"looksLikeBackspace");function Ha(n,e,t){let r=n.depth,i=e?n.end():n.pos;for(;r>0&&(e||n.indexAfter(r)==n.node(r).childCount);)r--,i++,e=!1;if(t){let o=n.node(r).maybeChild(n.indexAfter(r));for(;o&&!o.isLeaf;)o=o.firstChild,i++}return i}a(Ha,"skipClosingAndOpening");function Cv(n,e,t,r,i){let o=n.findDiffStart(e,t);if(o==null)return null;let{a:s,b:l}=n.findDiffEnd(e,t+n.size,t+e.size);if(i=="end"){let c=Math.max(0,o-Math.min(s,l));r-=s+c-o}if(s<o&&n.size<e.size){let c=r<=o&&r>=s?o-r:0;o-=c,o&&o<e.size&&Mp(e.textBetween(o-1,o+1))&&(o+=c?1:-1),l=o+(l-s),s=o}else if(l<o){let c=r<=o&&r>=l?o-r:0;o-=c,o&&o<n.size&&Mp(n.textBetween(o-1,o+1))&&(o+=c?1:-1),s=o+(s-l),l=o}return{start:o,endA:s,endB:l}}a(Cv,"findDiff");function Mp(n){if(n.length!=2)return!1;let e=n.charCodeAt(0),t=n.charCodeAt(1);return e>=56320&&e<=57343&&t>=55296&&t<=56319}a(Mp,"isSurrogatePair");const Kd=class Kd{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new au,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(Ep),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=Ap(this),$p(this),this.nodeViews=Ip(this),this.docView=lp(this.state.doc,Tp(this),Ba(this),this.dom,this),this.domObserver=new fu(this,(r,i,o,s)=>bv(this,r,i,o,s)),this.domObserver.start(),US(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&cu(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(Ep),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let r in this._props)t[r]=this._props[r];t.state=this.state;for(let r in e)t[r]=e[r];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){var r;let i=this.state,o=!1,s=!1;e.storedMarks&&this.composing&&(cy(this),s=!0),this.state=e;let l=i.plugins!=e.plugins||this._props.plugins!=t.plugins;if(l||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let p=Ip(this);vv(p,this.nodeViews)&&(this.nodeViews=p,o=!0)}(l||t.handleDOMEvents!=this._props.handleDOMEvents)&&cu(this),this.editable=Ap(this),$p(this);let c=Ba(this),u=Tp(this),h=i.plugins!=e.plugins&&!i.doc.eq(e.doc)?"reset":e.scrollToSelection>i.scrollToSelection?"to selection":"preserve",d=o||!this.docView.matchesNode(e.doc,u,c);(d||!e.selection.eq(i.selection))&&(s=!0);let f=h=="preserve"&&s&&this.dom.style.overflowAnchor==null&&dS(this);if(s){this.domObserver.stop();let p=d&&(lt||Qe)&&!this.composing&&!i.selection.empty&&!e.selection.empty&&Sv(i.selection,e.selection);if(d){let m=Qe?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=ov(this)),(o||!this.docView.update(e.doc,u,c,this))&&(this.docView.updateOuterDeco(u),this.docView.destroy(),this.docView=lp(e.doc,u,c,this.dom,this)),m&&!this.trackWrites&&(p=!0)}p||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&_S(this))?an(this,p):(Gg(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((r=this.dragging)===null||r===void 0)&&r.node&&!i.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,i),h=="reset"?this.dom.scrollTop=0:h=="to selection"?this.scrollToSelection():f&&fS(f)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!this.someProp("handleScrollToSelection",t=>t(this)))if(this.state.selection instanceof oe){let t=this.docView.domAfterPos(this.state.selection.from);t.nodeType==1&&tp(this,t.getBoundingClientRect(),e)}else tp(this,this.coordsAtPos(this.state.selection.head,1),e)}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let t=0;t<this.directPlugins.length;t++){let r=this.directPlugins[t];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let t=0;t<this.state.plugins.length;t++){let r=this.state.plugins[t];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let t=0;t<this.pluginViews.length;t++){let r=this.pluginViews[t];r.update&&r.update(this,e)}}updateDraggedNode(e,t){let r=e.node,i=-1;if(this.state.doc.nodeAt(r.from)==r.node)i=r.from;else{let o=r.from+(this.state.doc.content.size-t.doc.content.size);(o>0&&this.state.doc.nodeAt(o))==r.node&&(i=o)}this.dragging=new _l(e.slice,e.move,i<0?void 0:oe.create(this.state.doc,i))}someProp(e,t){let r=this._props&&this._props[e],i;if(r!=null&&(i=t?t(r):r))return i;for(let s=0;s<this.directPlugins.length;s++){let l=this.directPlugins[s].props[e];if(l!=null&&(i=t?t(l):l))return i}let o=this.state.plugins;if(o)for(let s=0;s<o.length;s++){let l=o[s].props[e];if(l!=null&&(i=t?t(l):l))return i}}hasFocus(){if(lt){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&pS(this.dom),an(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let t=this.dom.parentNode;t;t=t.parentNode)if(t.nodeType==9||t.nodeType==11&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t}return e||document}updateRoot(){this._root=null}posAtCoords(e){return bS(this,e)}coordsAtPos(e,t=1){return Wg(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,r=-1){let i=this.docView.posFromDOM(e,t,r);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,t){return vS(this,t||this.state,e)}pasteHTML(e,t){return Ro(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return Ro(this,e,null,!0,t||new ClipboardEvent("paste"))}destroy(){this.docView&&(JS(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Ba(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,eS())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return GS(this,e)}dispatch(e){let t=this._props.dispatchTransaction;t?t.call(this,e):this.updateState(this.state.apply(e))}domSelectionRange(){let e=this.domSelection();return et&&this.root.nodeType===11&&oS(this.dom.ownerDocument)==this.dom&&mv(this,e)||e}domSelection(){return this.root.getSelection()}};a(Kd,"EditorView");let pu=Kd;function Tp(n){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(n.editable),n.someProp("attributes",t=>{if(typeof t=="function"&&(t=t(n.state)),t)for(let r in t)r=="class"?e.class+=" "+t[r]:r=="style"?e.style=(e.style?e.style+";":"")+t[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(t[r]))}),e.translate||(e.translate="no"),[Mt.node(0,n.state.doc.content.size,e)]}a(Tp,"computeDocDeco");function $p(n){if(n.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),n.cursorWrapper={dom:e,deco:Mt.widget(n.state.selection.head,e,{raw:!0,marks:n.markCursor})}}else n.cursorWrapper=null}a($p,"updateCursorWrapper");function Ap(n){return!n.someProp("editable",e=>e(n.state)===!1)}a(Ap,"getEditable");function Sv(n,e){let t=Math.min(n.$anchor.sharedDepth(n.head),e.$anchor.sharedDepth(e.head));return n.$anchor.start(t)!=e.$anchor.start(t)}a(Sv,"selectionContextChanged");function Ip(n){let e=Object.create(null);function t(r){for(let i in r)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=r[i])}return a(t,"add"),n.someProp("nodeViews",t),n.someProp("markViews",t),e}a(Ip,"buildNodeViews");function vv(n,e){let t=0,r=0;for(let i in n){if(n[i]!=e[i])return!0;t++}for(let i in e)r++;return t!=r}a(vv,"changedNodeViews");function Ep(n){if(n.spec.state||n.spec.filterTransaction||n.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}a(Ep,"checkStateComponent");const Ud=class Ud{constructor(e,t,r={}){this.match=e,this.match=e,this.handler=typeof t=="string"?Nv(t):t,this.undoable=r.undoable!==!1,this.inCode=r.inCode||!1}};a(Ud,"InputRule");let rt=Ud;function Nv(n){return function(e,t,r,i){let o=n;if(t[1]){let s=t[0].lastIndexOf(t[1]);o+=t[0].slice(s+t[1].length),r+=s;let l=r-i;l>0&&(o=t[0].slice(s-l,s)+o,r=i)}return e.tr.insertText(o,r,i)}}a(Nv,"stringHandler");const Mv=a((n,e)=>{let t=n.plugins;for(let r=0;r<t.length;r++){let i=t[r],o;if(i.spec.isInputRules&&(o=i.getState(n))){if(e){let s=n.tr,l=o.transform;for(let c=l.steps.length-1;c>=0;c--)s.step(l.steps[c].invert(l.docs[c]));if(o.text){let c=s.doc.resolve(o.from).marks();s.replaceWith(o.from,o.to,n.schema.text(o.text,c))}else s.delete(o.from,o.to);e(s)}return!0}}return!1},"undoInputRule");new rt(/--$/,"");new rt(/\.\.\.$/,"");new rt(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"");new rt(/"$/,"");new rt(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"");new rt(/'$/,"");function Gu(n,e,t=null,r){return new rt(n,(i,o,s,l)=>{let c=t instanceof Function?t(o):t,u=i.tr.delete(s,l),h=u.doc.resolve(s),d=h.blockRange(),f=d&&Og(d,e,c);if(!f)return null;u.wrap(d,f);let p=u.doc.resolve(s-1).nodeBefore;return p&&p.type==e&&na(u.doc,s-1)&&(!r||r(o,p))&&u.join(s-1),u})}a(Gu,"wrappingInputRule");function my(n,e,t=null){return new rt(n,(r,i,o,s)=>{let l=r.doc.resolve(o),c=t instanceof Function?t(i):t;return l.node(-1).canReplaceWith(l.index(-1),l.indexAfter(-1),e)?r.tr.delete(o,s).setBlockType(o,o,e,c):null})}a(my,"textblockTypeInputRule");const Bn=typeof navigator<"u"?navigator:null,Op=typeof document<"u"?document:null,qn=Bn&&Bn.userAgent||"",mu=/Edge\/(\d+)/.exec(qn),gy=/MSIE \d/.exec(qn),gu=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(qn),oa=!!(gy||gu||mu),Tv=gy?document.documentMode:gu?+gu[1]:mu?+mu[1]:0,yy=!oa&&/gecko\/(\d+)/i.test(qn),$v=yy&&+(/Firefox\/(\d+)/.exec(qn)||[0,0])[1],yu=!oa&&/Chrome\/(\d+)/.exec(qn),Av=!!yu,Iv=yu?+yu[1]:0,ky=!oa&&!!Bn&&/Apple Computer/.test(Bn.vendor),by=ky&&(/Mobile\/\w+/.test(qn)||!!Bn&&Bn.maxTouchPoints>2),Ev=by||(Bn?/Mac/.test(Bn.platform):!1),Ov=/Android \d/.test(qn),xy=!!Op&&"webkitFontSmoothing"in Op.documentElement.style,_v=xy?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;var _p=Object.freeze({__proto__:null,android:Ov,chrome:Av,chrome_version:Iv,gecko:yy,gecko_version:$v,ie:oa,ie_version:Tv,ios:by,mac:Ev,safari:ky,webkit:xy,webkit_version:_v});function ja(n,e,t,r,i,o){if(n.composing)return!1;const s=n.state,l=s.doc.resolve(e);if(l.parent.type.spec.code)return!1;const c=l.parent.textBetween(Math.max(0,l.parentOffset-500),l.parentOffset,void 0,"")+r;for(let u=0;u<i.length;u++){const h=i[u].match.exec(c),d=h&&h[0]&&i[u].handler(s,h,e-(h[0].length-r.length),t);if(d)return n.dispatch(d.setMeta(o,{transform:d,from:e,to:t,text:r})),!0}return!1}a(ja,"run");const Dv=new Ge("MILKDOWN_CUSTOM_INPUTRULES");function Rv({rules:n}){const e=new Xe({key:Dv,isInputRules:!0,state:{init(){return null},apply(t,r){const i=t.getMeta(this);return i||(t.selectionSet||t.docChanged?null:r)}},props:{handleTextInput(t,r,i,o){return ja(t,r,i,o,n,e)},handleDOMEvents:{compositionend:t=>(setTimeout(()=>{const{$cursor:r}=t.state.selection;r&&ja(t,r.pos,r.pos,"",n,e)}),!1)},handleKeyDown(t,r){if(r.key!=="Enter")return!1;const{$cursor:i}=t.state.selection;return i?ja(t,i.pos,i.pos,`
`,n,e):!1}}});return e}a(Rv,"customInputRules");function hs(n,e,t={}){return new rt(n,(r,i,o,s)=>{var l,c,u,h;const{tr:d}=r,f=i.length;let p=i[f-1],m=i[0],g=[],k=s;const b={group:p,fullMatch:m,start:o,end:s},x=(l=t.updateCaptured)==null?void 0:l.call(t,b);if(Object.assign(b,x),{group:p,fullMatch:m,start:o,end:s}=b,m===null||p?.trim()==="")return null;if(p){const C=m.search(/\S/),N=o+m.indexOf(p),A=N+p.length;g=(c=d.storedMarks)!=null?c:[],A<s&&d.delete(A,s),N>o&&d.delete(o+C,N),k=o+C+p.length;const S=(u=t.getAttr)==null?void 0:u.call(t,i);d.addMark(o,k,e.create(S)),d.setStoredMarks(g),(h=t.beforeDispatch)==null||h.call(t,{match:i,start:o,end:s,tr:d})}return d})}a(hs,"markRule");function sa(n){return Object.assign(Object.create(n),n).setTime(Date.now())}a(sa,"cloneTr");function zv(n,e){return Array.isArray(n)&&n.includes(e.type)||e.type===n}a(zv,"equalNodeType");function Pv(n){return e=>{for(let t=e.depth;t>0;t--){const r=e.node(t);if(n(r))return{pos:t>0?e.before(t):0,start:e.start(t),depth:t,node:r}}}}a(Pv,"findParentNodeClosestToPos");function Fv(n){return e=>Pv(n)(e.$from)}a(Fv,"findParentNode");function Lv(n,e){if(!(n instanceof oe))return;const{node:t,$from:r}=n;if(zv(e,t))return{node:t,pos:r.pos,start:r.start(r.depth),depth:r.depth}}a(Lv,"findSelectedNodeOfType");const Yu=a((n,e)=>n.selection.empty?!1:(e&&e(n.tr.deleteSelection().scrollIntoView()),!0),"deleteSelection");function Bv(n,e){let{$cursor:t}=n.selection;return!t||(e?!e.endOfTextblock("backward",n):t.parentOffset>0)?null:t}a(Bv,"atBlockStart");const wy=a((n,e,t)=>{let r=Bv(n,t);if(!r)return!1;let i=Sy(r);if(!i){let s=r.blockRange(),l=s&&ta(s);return l==null?!1:(e&&e(n.tr.lift(s,l).scrollIntoView()),!0)}let o=i.nodeBefore;if(!o.type.spec.isolating&&Ny(n,i,e))return!0;if(r.parent.content.size==0&&(mi(o,"end")||oe.isSelectable(o))){let s=ju(n.doc,r.before(),r.after(),U.empty);if(s&&s.slice.size<s.to-s.from){if(e){let l=n.tr.step(s);l.setSelection(mi(o,"end")?te.findFrom(l.doc.resolve(l.mapping.map(i.pos,-1)),-1):oe.create(l.doc,i.pos-o.nodeSize)),e(l.scrollIntoView())}return!0}}return o.isAtom&&i.depth==r.depth-1?(e&&e(n.tr.delete(i.pos-o.nodeSize,i.pos).scrollIntoView()),!0):!1},"joinBackward");function mi(n,e,t=!1){for(let r=n;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(t&&r.childCount!=1)return!1}return!1}a(mi,"textblockAt");const Cy=a((n,e,t)=>{let{$head:r,empty:i}=n.selection,o=r;if(!i)return!1;if(r.parent.isTextblock){if(t?!t.endOfTextblock("backward",n):r.parentOffset>0)return!1;o=Sy(r)}let s=o&&o.nodeBefore;return!s||!oe.isSelectable(s)?!1:(e&&e(n.tr.setSelection(oe.create(n.doc,o.pos-s.nodeSize)).scrollIntoView()),!0)},"selectNodeBackward");function Sy(n){if(!n.parent.type.spec.isolating)for(let e=n.depth-1;e>=0;e--){if(n.index(e)>0)return n.doc.resolve(n.before(e+1));if(n.node(e).type.spec.isolating)break}return null}a(Sy,"findCutBefore");function Hv(n,e){let{$cursor:t}=n.selection;return!t||(e?!e.endOfTextblock("forward",n):t.parentOffset<t.parent.content.size)?null:t}a(Hv,"atBlockEnd");const jv=a((n,e,t)=>{let r=Hv(n,t);if(!r)return!1;let i=vy(r);if(!i)return!1;let o=i.nodeAfter;if(Ny(n,i,e))return!0;if(r.parent.content.size==0&&(mi(o,"start")||oe.isSelectable(o))){let s=ju(n.doc,r.before(),r.after(),U.empty);if(s&&s.slice.size<s.to-s.from){if(e){let l=n.tr.step(s);l.setSelection(mi(o,"start")?te.findFrom(l.doc.resolve(l.mapping.map(i.pos)),1):oe.create(l.doc,l.mapping.map(i.pos))),e(l.scrollIntoView())}return!0}}return o.isAtom&&i.depth==r.depth-1?(e&&e(n.tr.delete(i.pos,i.pos+o.nodeSize).scrollIntoView()),!0):!1},"joinForward"),Vv=a((n,e,t)=>{let{$head:r,empty:i}=n.selection,o=r;if(!i)return!1;if(r.parent.isTextblock){if(t?!t.endOfTextblock("forward",n):r.parentOffset<r.parent.content.size)return!1;o=vy(r)}let s=o&&o.nodeAfter;return!s||!oe.isSelectable(s)?!1:(e&&e(n.tr.setSelection(oe.create(n.doc,o.pos)).scrollIntoView()),!0)},"selectNodeForward");function vy(n){if(!n.parent.type.spec.isolating)for(let e=n.depth-1;e>=0;e--){let t=n.node(e);if(n.index(e)+1<t.childCount)return n.doc.resolve(n.after(e+1));if(t.type.spec.isolating)break}return null}a(vy,"findCutAfter");const Wv=a((n,e)=>{let{$head:t,$anchor:r}=n.selection;return!t.parent.type.spec.code||!t.sameParent(r)?!1:(e&&e(n.tr.insertText(`
`).scrollIntoView()),!0)},"newlineInCode");function Qu(n){for(let e=0;e<n.edgeCount;e++){let{type:t}=n.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}a(Qu,"defaultBlockAt");const qv=a((n,e)=>{let{$head:t,$anchor:r}=n.selection;if(!t.parent.type.spec.code||!t.sameParent(r))return!1;let i=t.node(-1),o=t.indexAfter(-1),s=Qu(i.contentMatchAt(o));if(!s||!i.canReplaceWith(o,o,s))return!1;if(e){let l=t.after(),c=n.tr.replaceWith(l,l,s.createAndFill());c.setSelection(te.near(c.doc.resolve(l),1)),e(c.scrollIntoView())}return!0},"exitCode"),Kv=a((n,e)=>{let t=n.selection,{$from:r,$to:i}=t;if(t instanceof Dt||r.parent.inlineContent||i.parent.inlineContent)return!1;let o=Qu(i.parent.contentMatchAt(i.indexAfter()));if(!o||!o.isTextblock)return!1;if(e){let s=(!r.parentOffset&&i.index()<i.parent.childCount?r:i).pos,l=n.tr.insert(s,o.createAndFill());l.setSelection(de.create(l.doc,s+1)),e(l.scrollIntoView())}return!0},"createParagraphNear"),Uv=a((n,e)=>{let{$cursor:t}=n.selection;if(!t||t.parent.content.size)return!1;if(t.depth>1&&t.after()!=t.end(-1)){let o=t.before();if(fo(n.doc,o))return e&&e(n.tr.split(o).scrollIntoView()),!0}let r=t.blockRange(),i=r&&ta(r);return i==null?!1:(e&&e(n.tr.lift(r,i).scrollIntoView()),!0)},"liftEmptyBlock");function Jv(n){return(e,t)=>{let{$from:r,$to:i}=e.selection;if(e.selection instanceof oe&&e.selection.node.isBlock)return!r.parentOffset||!fo(e.doc,r.pos)?!1:(t&&t(e.tr.split(r.pos).scrollIntoView()),!0);if(!r.parent.isBlock)return!1;if(t){let o=i.parentOffset==i.parent.content.size,s=e.tr;(e.selection instanceof de||e.selection instanceof Dt)&&s.deleteSelection();let l=r.depth==0?null:Qu(r.node(-1).contentMatchAt(r.indexAfter(-1))),c=n&&n(i.parent,o),u=c?[c]:o&&l?[{type:l}]:void 0,h=fo(s.doc,s.mapping.map(r.pos),1,u);if(!u&&!h&&fo(s.doc,s.mapping.map(r.pos),1,l?[{type:l}]:void 0)&&(l&&(u=[{type:l}]),h=!0),h&&(s.split(s.mapping.map(r.pos),1,u),!o&&!r.parentOffset&&r.parent.type!=l)){let d=s.mapping.map(r.before()),f=s.doc.resolve(d);l&&r.node(-1).canReplaceWith(f.index(),f.index()+1,l)&&s.setNodeMarkup(s.mapping.map(r.before()),l)}t(s.scrollIntoView())}return!0}}a(Jv,"splitBlockAs");const Zv=Jv(),Gv=a((n,e)=>(e&&e(n.tr.setSelection(new Dt(n.doc))),!0),"selectAll");function Yv(n,e,t){let r=e.nodeBefore,i=e.nodeAfter,o=e.index();return!r||!i||!r.type.compatibleContent(i.type)?!1:!r.content.size&&e.parent.canReplace(o-1,o)?(t&&t(n.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(o,o+1)||!(i.isTextblock||na(n.doc,e.pos))?!1:(t&&t(n.tr.clearIncompatible(e.pos,r.type,r.contentMatchAt(r.childCount)).join(e.pos).scrollIntoView()),!0)}a(Yv,"joinMaybeClear");function Ny(n,e,t){let r=e.nodeBefore,i=e.nodeAfter,o,s;if(r.type.spec.isolating||i.type.spec.isolating)return!1;if(Yv(n,e,t))return!0;let l=e.parent.canReplace(e.index(),e.index()+1);if(l&&(o=(s=r.contentMatchAt(r.childCount)).findWrapping(i.type))&&s.matchType(o[0]||i.type).validEnd){if(t){let d=e.pos+i.nodeSize,f=P.empty;for(let g=o.length-1;g>=0;g--)f=P.from(o[g].create(null,f));f=P.from(r.copy(f));let p=n.tr.step(new at(e.pos-1,d,e.pos,d,new U(f,1,0),o.length,!0)),m=d+2*o.length;na(p.doc,m)&&p.join(m),t(p.scrollIntoView())}return!0}let c=te.findFrom(e,1),u=c&&c.$from.blockRange(c.$to),h=u&&ta(u);if(h!=null&&h>=e.depth)return t&&t(n.tr.lift(u,h).scrollIntoView()),!0;if(l&&mi(i,"start",!0)&&mi(r,"end")){let d=r,f=[];for(;f.push(d),!d.isTextblock;)d=d.lastChild;let p=i,m=1;for(;!p.isTextblock;p=p.firstChild)m++;if(d.canReplace(d.childCount,d.childCount,p.content)){if(t){let g=P.empty;for(let b=f.length-1;b>=0;b--)g=P.from(f[b].copy(g));let k=n.tr.step(new at(e.pos-f.length,e.pos+i.nodeSize,e.pos+m,e.pos+i.nodeSize-m,new U(g,f.length,0),0,!0));t(k.scrollIntoView())}return!0}}return!1}a(Ny,"deleteBarrier");function My(n){return function(e,t){let r=e.selection,i=n<0?r.$from:r.$to,o=i.depth;for(;i.node(o).isInline;){if(!o)return!1;o--}return i.node(o).isTextblock?(t&&t(e.tr.setSelection(de.create(e.doc,n<0?i.start(o):i.end(o)))),!0):!1}}a(My,"selectTextblockSide");const Qv=My(-1),Xv=My(1);function Xu(n,e=null){return function(t,r){let{$from:i,$to:o}=t.selection,s=i.blockRange(o),l=s&&Og(s,n,e);return l?(r&&r(t.tr.wrap(s,l).scrollIntoView()),!0):!1}}a(Xu,"wrapIn");function Po(n,e=null){return function(t,r){let i=!1;for(let o=0;o<t.selection.ranges.length&&!i;o++){let{$from:{pos:s},$to:{pos:l}}=t.selection.ranges[o];t.doc.nodesBetween(s,l,(c,u)=>{if(i)return!1;if(!(!c.isTextblock||c.hasMarkup(n,e)))if(c.type==n)i=!0;else{let h=t.doc.resolve(u),d=h.index();i=h.parent.canReplaceWith(d,d+1,n)}})}if(!i)return!1;if(r){let o=t.tr;for(let s=0;s<t.selection.ranges.length;s++){let{$from:{pos:l},$to:{pos:c}}=t.selection.ranges[s];o.setBlockType(l,c,n,e)}r(o.scrollIntoView())}return!0}}a(Po,"setBlockType");function eN(n,e,t){for(let r=0;r<e.length;r++){let{$from:i,$to:o}=e[r],s=i.depth==0?n.inlineContent&&n.type.allowsMarkType(t):!1;if(n.nodesBetween(i.pos,o.pos,l=>{if(s)return!1;s=l.inlineContent&&l.type.allowsMarkType(t)}),s)return!0}return!1}a(eN,"markApplies");function la(n,e=null){return function(t,r){let{empty:i,$cursor:o,ranges:s}=t.selection;if(i&&!o||!eN(t.doc,s,n))return!1;if(r)if(o)n.isInSet(t.storedMarks||o.marks())?r(t.tr.removeStoredMark(n)):r(t.tr.addStoredMark(n.create(e)));else{let l=!1,c=t.tr;for(let u=0;!l&&u<s.length;u++){let{$from:h,$to:d}=s[u];l=t.doc.rangeHasMark(h.pos,d.pos,n)}for(let u=0;u<s.length;u++){let{$from:h,$to:d}=s[u];if(l)c.removeMark(h.pos,d.pos,n);else{let f=h.pos,p=d.pos,m=h.nodeAfter,g=d.nodeBefore,k=m&&m.isText?/^\s*/.exec(m.text)[0].length:0,b=g&&g.isText?/\s*$/.exec(g.text)[0].length:0;f+k<p&&(f+=k,p-=b),c.addMark(f,p,n.create(e))}}r(c.scrollIntoView())}return!0}}a(la,"toggleMark");function aa(...n){return function(e,t,r){for(let i=0;i<n.length;i++)if(n[i](e,t,r))return!0;return!1}}a(aa,"chainCommands");let Va=aa(Yu,wy,Cy),Dp=aa(Yu,jv,Vv);const on={Enter:aa(Wv,Kv,Uv,Zv),"Mod-Enter":qv,Backspace:Va,"Mod-Backspace":Va,"Shift-Backspace":Va,Delete:Dp,"Mod-Delete":Dp,"Mod-a":Gv},Ty={"Ctrl-h":on.Backspace,"Alt-Backspace":on["Mod-Backspace"],"Ctrl-d":on.Delete,"Ctrl-Alt-Backspace":on["Mod-Delete"],"Alt-Delete":on["Mod-Delete"],"Alt-d":on["Mod-Delete"],"Ctrl-a":Qv,"Ctrl-e":Xv};for(let n in on)Ty[n]=on[n];const tN=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform?os.platform()=="darwin":!1,nN=tN?Ty:on;var Hn={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Pl={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},rN=typeof navigator<"u"&&/Mac/.test(navigator.platform),iN=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var We=0;We<10;We++)Hn[48+We]=Hn[96+We]=String(We);for(var We=1;We<=24;We++)Hn[We+111]="F"+We;for(var We=65;We<=90;We++)Hn[We]=String.fromCharCode(We+32),Pl[We]=String.fromCharCode(We);for(var Wa in Hn)Pl.hasOwnProperty(Wa)||(Pl[Wa]=Hn[Wa]);function oN(n){var e=rN&&n.metaKey&&n.shiftKey&&!n.ctrlKey&&!n.altKey||iN&&n.shiftKey&&n.key&&n.key.length==1||n.key=="Unidentified",t=!e&&n.key||(n.shiftKey?Pl:Hn)[n.keyCode]||n.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}a(oN,"keyName");const sN=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function lN(n){let e=n.split(/-(?!$)/),t=e[e.length-1];t=="Space"&&(t=" ");let r,i,o,s;for(let l=0;l<e.length-1;l++){let c=e[l];if(/^(cmd|meta|m)$/i.test(c))s=!0;else if(/^a(lt)?$/i.test(c))r=!0;else if(/^(c|ctrl|control)$/i.test(c))i=!0;else if(/^s(hift)?$/i.test(c))o=!0;else if(/^mod$/i.test(c))sN?s=!0:i=!0;else throw new Error("Unrecognized modifier name: "+c)}return r&&(t="Alt-"+t),i&&(t="Ctrl-"+t),s&&(t="Meta-"+t),o&&(t="Shift-"+t),t}a(lN,"normalizeKeyName");function aN(n){let e=Object.create(null);for(let t in n)e[lN(t)]=n[t];return e}a(aN,"normalize");function qa(n,e,t=!0){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t&&e.shiftKey&&(n="Shift-"+n),n}a(qa,"modifiers");function $y(n){return new Xe({props:{handleKeyDown:Ay(n)}})}a($y,"keymap");function Ay(n){let e=aN(n);return function(t,r){let i=oN(r),o,s=e[qa(i,r)];if(s&&s(t.state,t.dispatch,t))return!0;if(i.length==1&&i!=" "){if(r.shiftKey){let l=e[qa(i,r,!1)];if(l&&l(t.state,t.dispatch,t))return!0}if((r.shiftKey||r.altKey||r.metaKey||i.charCodeAt(0)>127)&&(o=Hn[r.keyCode])&&o!=i){let l=e[qa(o,r)];if(l&&l(t.state,t.dispatch,t))return!0}}return!1}}a(Ay,"keydownHandler");var Iy=a((n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)},"ve$3"),Y=a((n,e,t)=>(Iy(n,e,"read from private field"),t?t.call(n):e.get(n)),"s$1"),Le=a((n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},"d$1"),$e=a((n,e,t,r)=>(Iy(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),"c");function Kn(n,e){return n.meta={package:"@milkdown/core",group:"System",...e},n}a(Kn,"k");const Ey={strong:(n,e,t,r)=>{const i=n.marker||t.options.strong||"*",o=t.enter("strong"),s=t.createTracker(r);let l=s.move(i+i);return l+=s.move(t.containerPhrasing(n,{before:l,after:i,...s.current()})),l+=s.move(i+i),o(),l},emphasis:(n,e,t,r)=>{const i=n.marker||t.options.emphasis||"*",o=t.enter("emphasis"),s=t.createTracker(r);let l=s.move(i);return l+=s.move(t.containerPhrasing(n,{before:l,after:i,...s.current()})),l+=s.move(i),o(),l}},Xs=jn("ConfigReady");function cN(n){const e=a(t=>(t.record(Xs),async()=>(await n(t),t.done(Xs),()=>{t.clearTimer(Xs)})),"t");return Kn(e,{displayName:"Config"}),e}a(cN,"ot$2");const oi=jn("InitReady"),Ka=ke([],"initTimer"),Rp=ke({},"editor"),Fo=ke([],"inputRules"),dn=ke([],"prosePlugins"),Lo=ke([],"remarkPlugins"),ku=ke([],"nodeView"),bu=ke([],"markView"),vr=ke(Bc().use(Ic).use(Dc),"remark"),yo=ke({handlers:Ey},"remarkStringifyOptions");function uN(n){const e=a(t=>(t.inject(Rp,n).inject(dn,[]).inject(Lo,[]).inject(Fo,[]).inject(ku,[]).inject(bu,[]).inject(yo,{handlers:Ey}).inject(vr,Bc().use(Ic).use(Dc)).inject(Ka,[Xs]).record(oi),async()=>{await t.waitTimers(Ka);const r=t.get(yo);return t.set(vr,Bc().use(Ic).use(Dc,r)),t.done(oi),()=>{t.remove(Rp).remove(dn).remove(Lo).remove(Fo).remove(ku).remove(bu).remove(yo).remove(vr).remove(Ka).clearTimer(oi)}}),"t");return Kn(e,{displayName:"Init"}),e}a(uN,"at$2");const Kt=jn("SchemaReady"),Ua=ke([],"schemaTimer"),cn=ke({},"schema"),si=ke([],"nodes"),li=ke([],"marks");function zp(n){var e;return{...n,parseDOM:(e=n.parseDOM)==null?void 0:e.map(t=>({priority:n.priority,...t}))}}a(zp,"Te$3");const Oy=a(n=>(n.inject(cn,{}).inject(si,[]).inject(li,[]).inject(Ua,[oi]).record(Kt),async()=>{await n.waitTimers(Ua);const e=n.get(vr),t=n.get(Lo).reduce((s,l)=>s.use(l.plugin,l.options),e);n.set(vr,t);const r=Object.fromEntries(n.get(si).map(([s,l])=>[s,zp(l)])),i=Object.fromEntries(n.get(li).map(([s,l])=>[s,zp(l)])),o=new vc({nodes:r,marks:i});return n.set(cn,o),n.done(Kt),()=>{n.remove(cn).remove(si).remove(li).remove(Ua).clearTimer(Kt)}}),"Ee$1");Kn(Oy,{displayName:"Schema"});const el=jn("ParserReady"),_y=a(()=>{throw Ru()},"Ie$2"),ko=ke(_y,"parser"),Ja=ke([],"parserTimer"),Dy=a(n=>(n.inject(ko,_y).inject(Ja,[Kt]).record(el),async()=>{await n.waitTimers(Ja);const e=n.get(vr),t=n.get(cn);return n.set(ko,NC.create(t,e)),n.done(el),()=>{n.remove(ko).remove(Ja).clearTimer(el)}}),"Ve$1");Kn(Dy,{displayName:"Parser"});const tl=jn("SerializerReady"),Za=ke([],"serializerTimer"),Ry=a(()=>{throw Ru()},"Me$2"),Ga=ke(Ry,"serializer"),zy=a(n=>(n.inject(Ga,Ry).inject(Za,[Kt]).record(tl),async()=>{await n.waitTimers(Za);const e=n.get(vr),t=n.get(cn);return n.set(Ga,TC.create(t,e)),n.done(tl),()=>{n.remove(Ga).remove(Za).clearTimer(tl)}}),"Ne$2");Kn(zy,{displayName:"Serializer"});const Ya=ke("","defaultValue"),io=ke({},"editorState"),Qa=ke(n=>n,"stateOptions"),Xa=ke([],"editorStateTimer"),nl=jn("EditorStateReady");function hN(n,e,t){if(typeof n=="string")return e(n);if(n.type==="html")return Ao.fromSchema(t).parse(n.dom);if(n.type==="json")return qt.fromJSON(t,n.value);throw eb(n)}a(hN,"ct$2");const dN=new Ge("MILKDOWN_STATE_TRACKER");function fN(n){const e=aa(Mv,Yu,wy,Cy);return n.Backspace=e,n}a(fN,"dt$2");const Py=a(n=>(n.inject(Ya,"").inject(io,{}).inject(Qa,e=>e).inject(Xa,[el,tl,bo]).record(nl),async()=>{await n.waitTimers(Xa);const e=n.get(cn),t=n.get(ko),r=n.get(Fo),i=n.get(Qa),o=n.get(dn),s=n.get(Ya),l=hN(s,t,e),c=[...o,new Xe({key:dN,state:{init:()=>{},apply:(d,f,p,m)=>{n.set(io,m)}}}),Rv({rules:r}),$y(fN(nN))];n.set(dn,c);const u=i({schema:e,doc:l,plugins:c}),h=Jc.create(u);return n.set(io,h),n.done(nl),()=>{n.remove(Ya).remove(io).remove(Qa).remove(Xa).clearTimer(nl)}}),"_e$1");Kn(Py,{displayName:"EditorState"});const ec=jn("EditorViewReady"),Nr=ke({},"editorView"),tc=ke([],"editorViewTimer"),rl=ke({},"editorViewOptions"),il=ke(null,"root"),xu=ke(null,"rootDOM"),wu=ke({},"rootAttrs");function pN(n,e){const t=document.createElement("div");t.className="milkdown",n.appendChild(t),e.set(xu,t);const r=e.get(wu);return Object.entries(r).forEach(([i,o])=>t.setAttribute(i,o)),t}a(pN,"ht$1");function mN(n){n.classList.add("editor"),n.setAttribute("role","textbox")}a(mN,"lt$2");const gN=new Ge("MILKDOWN_VIEW_CLEAR"),Fy=a(n=>(n.inject(il,document.body).inject(Nr,{}).inject(rl,{}).inject(xu,null).inject(wu,{}).inject(tc,[nl]).record(ec),async()=>{await n.wait(oi);const e=n.get(il)||document.body,t=typeof e=="string"?document.querySelector(e):e;n.update(dn,c=>[new Xe({key:gN,view:u=>{const h=t?pN(t,n):void 0;return(()=>{if(h&&t){const d=u.dom;t.replaceChild(h,d),h.appendChild(d)}})(),{destroy:()=>{h!=null&&h.parentNode&&h?.parentNode.replaceChild(u.dom,h),h?.remove()}}}}),...c]),await n.waitTimers(tc);const r=n.get(io),i=n.get(rl),o=Object.fromEntries(n.get(ku)),s=Object.fromEntries(n.get(bu)),l=new pu(t,{state:r,nodeViews:o,markViews:s,...i});return mN(l.dom),n.set(Nr,l),n.done(ec),()=>{l?.destroy(),n.remove(il).remove(Nr).remove(rl).remove(xu).remove(wu).remove(tc).clearTimer(ec)}}),"ze");Kn(Fy,{displayName:"EditorView"});var qr,nr,rs;let Ly=(rs=class{constructor(){Le(this,qr,void 0),Le(this,nr,void 0),$e(this,qr,new Am),$e(this,nr,null),this.setCtx=e=>{$e(this,nr,e)}}get ctx(){return Y(this,nr)}create(e,t){const r=e.create(Y(this,qr).sliceMap);return r.set(t),r}get(e){return Y(this,qr).get(e).get()}remove(e){return Y(this,qr).remove(e)}call(e,t){if(Y(this,nr)==null)throw sb();const r=this.get(e)(t),i=Y(this,nr).get(Nr);return r(i.state,i.dispatch,i)}},a(rs,"Ke"),rs);qr=new WeakMap,nr=new WeakMap;function yN(n="cmdKey"){return ke(()=>()=>!1,n)}a(yN,"Et$1");const ge=ke(new Ly,"commands"),nc=ke([Kt],"commandsTimer"),bo=jn("CommandsReady"),By=a(n=>{const e=new Ly;return e.setCtx(n),n.inject(ge,e).inject(nc,[Kt]).record(bo),async()=>(await n.waitTimers(nc),n.done(bo),()=>{n.remove(ge).remove(nc).clearTimer(bo)})},"Ae$2");Kn(By,{displayName:"Commands"});var Kr,bt,Nn,oo,ol,sl,pt,Mn,Ur,ll,Jr,so,al,rr,lo,xi;const kN=(xi=class{constructor(){Le(this,Kr,void 0),Le(this,bt,void 0),Le(this,Nn,void 0),Le(this,oo,void 0),Le(this,ol,void 0),Le(this,sl,void 0),Le(this,pt,void 0),Le(this,Mn,void 0),Le(this,Ur,void 0),Le(this,ll,void 0),Le(this,Jr,void 0),Le(this,so,void 0),Le(this,al,void 0),Le(this,rr,void 0),Le(this,lo,void 0),$e(this,Kr,!1),$e(this,bt,"Idle"),$e(this,Nn,[]),$e(this,oo,()=>{}),$e(this,ol,new Am),$e(this,sl,new pb),$e(this,pt,new Map),$e(this,Mn,new Map),$e(this,Ur,new fb(Y(this,ol),Y(this,sl))),$e(this,ll,()=>{const e=cN(async r=>{await Promise.all(Y(this,Nn).map(i=>i(r)))}),t=[Oy,Dy,zy,By,Py,Fy,uN(this),e];Y(this,Jr).call(this,t,Y(this,Mn))}),$e(this,Jr,(e,t)=>{e.forEach(r=>{const i=Y(this,Ur).produce(Y(this,Kr)?r.meta:void 0),o=r(i);t.set(r,{ctx:i,handler:o,cleanup:void 0})})}),$e(this,so,(e,t=!1)=>Promise.all([e].flat().map(r=>{const i=Y(this,pt).get(r),o=i?.cleanup;return t?Y(this,pt).delete(r):Y(this,pt).set(r,{ctx:void 0,handler:void 0,cleanup:void 0}),typeof o=="function"?o():o}))),$e(this,al,async()=>{await Promise.all([...Y(this,Mn).entries()].map(([e,{cleanup:t}])=>typeof t=="function"?t():t)),Y(this,Mn).clear()}),$e(this,rr,e=>{$e(this,bt,e),Y(this,oo).call(this,e)}),$e(this,lo,e=>[...e.entries()].map(async([t,r])=>{const{ctx:i,handler:o}=r;if(!o)return;const s=await o();e.set(t,{ctx:i,handler:o,cleanup:s})})),this.enableInspector=(e=!0)=>($e(this,Kr,e),this),this.onStatusChange=e=>($e(this,oo,e),this),this.config=e=>(Y(this,Nn).push(e),this),this.removeConfig=e=>($e(this,Nn,Y(this,Nn).filter(t=>t!==e)),this),this.use=e=>{const t=[e].flat();return t.flat().forEach(r=>{Y(this,pt).set(r,{ctx:void 0,handler:void 0,cleanup:void 0})}),Y(this,bt)==="Created"&&Y(this,Jr).call(this,t,Y(this,pt)),this},this.remove=async e=>Y(this,bt)==="OnCreate"?(console.warn("[Milkdown]: You are trying to remove plugins when the editor is creating, this is not recommended, please check your code."),new Promise(t=>{setTimeout(()=>{t(this.remove(e))},50)})):(await Y(this,so).call(this,[e].flat(),!0),this),this.create=async()=>Y(this,bt)==="OnCreate"?this:(Y(this,bt)==="Created"&&await this.destroy(),Y(this,rr).call(this,"OnCreate"),Y(this,ll).call(this),Y(this,Jr).call(this,[...Y(this,pt).keys()],Y(this,pt)),await Promise.all([Y(this,lo).call(this,Y(this,Mn)),Y(this,lo).call(this,Y(this,pt))].flat()),Y(this,rr).call(this,"Created"),this),this.destroy=async(e=!1)=>Y(this,bt)==="Destroyed"||Y(this,bt)==="OnDestroy"?this:Y(this,bt)==="OnCreate"?new Promise(t=>{setTimeout(()=>{t(this.destroy(e))},50)}):(e&&$e(this,Nn,[]),Y(this,rr).call(this,"OnDestroy"),await Y(this,so).call(this,[...Y(this,pt).keys()],e),await Y(this,al).call(this),Y(this,rr).call(this,"Destroyed"),this),this.action=e=>e(Y(this,Ur)),this.inspect=()=>Y(this,Kr)?[...Y(this,Mn).values(),...Y(this,pt).values()].map(({ctx:e})=>{var t;return(t=e?.inspector)==null?void 0:t.read()}).filter(e=>!!e):(console.warn("[Milkdown]: You are trying to collect inspection when inspector is disabled, please enable inspector by `editor.enableInspector()` first."),[])}static make(){return new xi}get ctx(){return Y(this,Ur)}get status(){return Y(this,bt)}},a(xi,"Ce"),xi);Kr=new WeakMap,bt=new WeakMap,Nn=new WeakMap,oo=new WeakMap,ol=new WeakMap,sl=new WeakMap,pt=new WeakMap,Mn=new WeakMap,Ur=new WeakMap,ll=new WeakMap,Jr=new WeakMap,so=new WeakMap,al=new WeakMap,rr=new WeakMap,lo=new WeakMap;let bN=kN;const xN="_repliesHolder_khmyr_1",wN="_parentsHolder_khmyr_6",CN="_loader_khmyr_10",SN="_noContent_khmyr_14",vN="_border_khmyr_21",NN="_replyBox_khmyr_38",MN="_missingNote_khmyr_44",TN="_bojan_khmyr_83",Ts={repliesHolder:xN,parentsHolder:wN,loader:CN,noContent:SN,border:vN,replyBox:NN,missingNote:MN,bojan:TN},$N="_newNoteBorder_sbubx_1",AN="_newNote_sbubx_1",IN="_leftSide_sbubx_28",EN="_controls_sbubx_32",ON="_primaryButton_sbubx_44",_N="_secondaryButton_sbubx_59",DN="_replyBox_sbubx_82",RN="_leftSideClosed_sbubx_94",zN="_input_sbubx_97",PN="_rightSideClosed_sbubx_125",FN="_border_sbubx_130",LN="_searchSuggestions_sbubx_157",ot={newNoteBorder:$N,newNote:AN,leftSide:IN,controls:EN,primaryButton:ON,secondaryButton:_N,replyBox:DN,leftSideClosed:RN,input:zN,rightSideClosed:PN,border:FN,searchSuggestions:LN},BN=le("<div><div><div></div><div>"),HN=le("<div>"),jN=le("<button><div></div><div><div>"),VN=a(n=>{const e=ls(),[t,r]=je(!1),i=fn(),o=a(()=>i?.activeUser,"activeUser"),s=a(()=>{r(!0),document.getElementById("reply_to_editor")?.scrollIntoView({block:"nearest",behavior:"smooth"})},"openReplyBox"),l=a(()=>{r(!1)},"closeReplyToNote");return gt(()=>{if(t())setTimeout(()=>{const c=document.getElementById("reply_new_note_text_area");c&&c?.focus()},100);else{const c=document.getElementById("reply_new_note_text_area");if(!c)return;c.value=""}}),(()=>{const c=HN();return H(c,O(Se,{get when(){return t()},get fallback(){return(()=>{const u=jN(),h=u.firstChild,d=h.nextSibling,f=d.firstChild;return u.$$click=s,H(h,O(Pn,{size:"sm",get user(){return o()}})),H(f,()=>e.formatMessage(pm.noteReply,{name:St(n.note.user)})),ne(p=>{const m=ot.replyBox,g=ot.leftSideClosed,k=ot.input;return m!==p._v$5&&E(u,p._v$5=m),g!==p._v$6&&E(h,p._v$6=g),k!==p._v$7&&E(d,p._v$7=k),p},{_v$5:void 0,_v$6:void 0,_v$7:void 0}),u})()},get children(){const u=BN(),h=u.firstChild,d=h.firstChild,f=d.nextSibling;return H(d,O(Pn,{size:"md",get user(){return o()}})),H(f,O(Sm,{id:"reply_to_editor",idPrefix:"reply_",get open(){return t()},get replyToNote(){return n.note},onClose:l,get onSuccess(){return n.onNotePosted}})),ne(p=>{const m=ot.newNoteBorder,g=ot.newNote,k=ot.leftSide,b=ot.rightSide;return m!==p._v$&&E(u,p._v$=m),g!==p._v$2&&E(h,p._v$2=g),k!==p._v$3&&E(d,p._v$3=k),b!==p._v$4&&E(f,p._v$4=b),p},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),u}})),ne(()=>$r(c,"id",n.id)),c})()},"ReplyToNote"),Hy=Ci(VN);Gl(["click"]);const WN="_navHeader_f173w_1",qN="_title_f173w_29",KN="_backIcon_f173w_34",rc={navHeader:WN,title:qN,backIcon:KN},UN=le("<button><div></div><div>"),JN=a(n=>(()=>{const e=UN(),t=e.firstChild,r=t.nextSibling;return e.$$click=()=>{window.history.back()},H(r,()=>n.title),ne(i=>{const o=rc.navHeader,s=rc.backIcon,l=rc.title;return o!==i._v$&&E(e,i._v$=o),s!==i._v$2&&E(t,i._v$2=s),l!==i._v$3&&E(r,i._v$3=l),i},{_v$:void 0,_v$2:void 0,_v$3:void 0}),e})(),"NavHeader"),ZN=Ci(JN);Gl(["click"]);const GN=le("<div><div><div></div><div><div></div><div></div></div></div><div>"),YN=a(n=>(()=>{const e=GN(),t=e.firstChild,r=t.firstChild,i=r.nextSibling,o=i.firstChild,s=o.nextSibling,l=t.nextSibling;return ne(c=>{const u=be.primaryNoteSkeleton,h=be.headerPN,d=be.avatarPN,f=be.userInfoPN,p=be.namePN,m=be.nip05PN,g=be.bodyPN;return u!==c._v$&&E(e,c._v$=u),h!==c._v$2&&E(t,c._v$2=h),d!==c._v$3&&E(r,c._v$3=d),f!==c._v$4&&E(i,c._v$4=f),p!==c._v$5&&E(o,c._v$5=p),m!==c._v$6&&E(s,c._v$6=m),g!==c._v$7&&E(l,c._v$7=g),c},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0}),e})(),"PrimaryNoteSkeleton"),QN=le("<div><div></div><div>"),XN=a(n=>(()=>{const e=QN(),t=e.firstChild,r=t.nextSibling;return ne(i=>{const o=be.replyToNoteSkeleton,s=be.avatarRN,l=be.bodyRN;return o!==i._v$&&E(e,i._v$=o),s!==i._v$2&&E(t,i._v$2=s),l!==i._v$3&&E(r,i._v$3=l),i},{_v$:void 0,_v$2:void 0,_v$3:void 0}),e})(),"ReplyToNoteSkeleton"),eM=le("<div><div><div></div></div><div><div>"),Pp=a(n=>(()=>{const e=eM(),t=e.firstChild,r=t.firstChild,i=t.nextSibling,o=i.firstChild;return ne(s=>{const l=be.threadNoteSkeleton,c=be.headerTN,u=be.avatarTN,h=be.bodyTN,d=be.fillTN;return l!==s._v$&&E(e,s._v$=l),c!==s._v$2&&E(t,s._v$2=c),u!==s._v$3&&E(r,s._v$3=u),h!==s._v$4&&E(i,s._v$4=h),d!==s._v$5&&E(o,s._v$5=d),s},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),e})(),"ThreadNoteSkeleton"),tM=le('<div id="primary_note" class="animated">'),nM=le("<div><div></div><div>"),ic=le("<div>"),rM=le("<div><p></p><p>"),iM=le('<div class="animated">'),oM=a(n=>{const e=fn(),t=ls(),r=Eu();let i,o="";const s=a(()=>{const{noteId:g}=n;return g.startsWith("note")?g:g.startsWith("nevent")?Ee.noteEncode(Ee.decode(g).data.id):Ee.noteEncode(g)},"postId"),l=yk(),c=gc(()=>{let g=l?.notes.find(k=>k.post.noteId===s());return g||(g=l?.notes.find(k=>k.repost?.note.noteId===s()),g&&r(`/e/${g?.post.noteId}`),g)}),u=a(()=>{const g=c();return g?yc(l?.notes.filter(k=>k.post.id!==g.post.id&&k.post.created_at<=g.post.created_at)||[],!0):[]},"parentNotes"),h=a(()=>{const g=c();return g?l?.notes.filter(k=>k.post.id!==g.post.id&&k.post.created_at>=g.post.created_at)||[]:[]},"replyNotes"),d=a(()=>{const g=c();if(!g)return[];const k=(l?.notes||[]).reduce((x,C)=>x.find(N=>N.pubkey===C.user.pubkey)?[...x]:[...x,{...C.user}],[]),b=Object.values(g.mentionedUsers||{}).filter(x=>!k.find(C=>x.pubkey===C.pubkey));return[...k,...b]},"people"),f=a(()=>l?.isFetching,"isFetching");gt(()=>{const g=s();g!==o&&(l?.actions.fetchNotes(g),o=g)}),gt(()=>{if(!c()||l?.isFetching)return;const g=document.getElementById("primary_note");g&&setTimeout(()=>{const x=g.getBoundingClientRect(),C=window.innerHeight-84,N=x.height<C&&u().length>0?"end":"start";if(g.scrollIntoView({block:N}),N==="start"){const A=84+(Vk()?54:0);window.scrollBy({top:-A})}},100)}),Ou(()=>{document.getElementById("primary_note")});const p=a(async(g,k)=>{const b=c();if(!k||!g.note||!e?.activeUser||!b)return;({...k,noteRefs:{...k.noteRefs,[b.id]:{...b}}});const x=`posted_note_${sn}`,C=await kc(e.publicKey,[g.note.id],x);l?.actions.insertNote(C[0])},"onNotePosted"),m=a(()=>{const g=St(c()?.user);return t.formatMessage(ya.pageTitle,{name:g})},"pageTitle");return(()=>{const g=ic();return H(g,O(jk,{get title(){return m()}}),null),H(g,O(fl,{to:"search_section",get children(){return O(vm,{})}}),null),H(g,O(fl,{to:"right_sidebar",get children(){return O(Hk,{get note(){return c()},get people(){return d()},get label(){return t.formatMessage(ya.sidebar)},get mentionLabel(){return t.formatMessage(ya.sidebarMentions)}})}}),null),H(g,O(ZN,{title:"Thread"}),null),H(g,O(Se,{get when(){return e?.isKeyLookupDone},get children(){return O(Nm,{name:"slide-fade",get children(){return O(Se,{get when(){return!f()},get fallback(){return(()=>{const k=ic();return H(k,O(YN,{}),null),H(k,O(XN,{}),null),H(k,O(ln,{each:new Array(10),children:()=>O(Pp,{})}),null),H(k,O(Pp,{}),null),ne(()=>E(k,Ts.loader)),k})()},get children(){const k=nM(),b=k.firstChild,x=b.nextSibling;H(b,O(ln,{get each(){return u()},children:N=>(()=>{const A=ic();return H(A,O(Rs,{note:N,parent:!0,shorten:!0,noteType:"thread"})),A})()})),H(k,O(Se,{get when(){return c()},get fallback(){return(()=>{const N=rM(),A=N.firstChild,S=A.nextSibling;return H(A,()=>t.formatMessage(Gd.missingNote.firstLine)),H(S,()=>t.formatMessage(Gd.missingNote.secondLine)),ne(()=>E(N,Ts.missingNote)),N})()},get children(){const N=tM();return H(N,O(Rs,{get note(){return c()},noteType:"primary",get quoteCount(){return l?.quoteCount}}),null),H(N,O(Se,{get when(){return e?.hasPublicKey()},get children(){return O(Hy,{get note(){return c()},onNotePosted:p})}}),null),N}}),x);const C=i;return typeof C=="function"?hl(C,x):i=x,H(x,O(ln,{get each(){return h()},children:N=>(()=>{const A=iM();return H(A,O(Rs,{note:N,shorten:!0,noteType:"thread"})),A})()})),ne(N=>{const A=Ts.parentsHolder,S=Ts.repliesHolder;return A!==N._v$&&E(b,N._v$=A),S!==N._v$2&&E(x,N._v$2=S),N},{_v$:void 0,_v$2:void 0}),k}})}})}}),null),g})()},"NoteThread"),sM="_header_83xjy_2",lM="_author_83xjy_13",aM="_userInfo_83xjy_19",cM="_userName_83xjy_23",uM="_nip05_83xjy_29",hM="_topBar_83xjy_36",dM="_left_83xjy_44",fM="_time_83xjy_51",pM="_client_83xjy_56",mM="_right_83xjy_68",gM="_longform_83xjy_75",yM="_title_83xjy_83",kM="_summary_83xjy_89",bM="_border_83xjy_93",xM="_text_83xjy_99",wM="_image_83xjy_105",CM="_content_83xjy_111",SM="_tags_83xjy_127",vM="_tag_83xjy_127",De={header:sM,author:lM,userInfo:aM,userName:cM,nip05:uM,topBar:hM,left:dM,time:fM,client:pM,right:mM,longform:gM,title:yM,summary:kM,border:bM,text:xM,image:wM,content:CM,tags:SM,tag:vM};let NM=a(n=>crypto.getRandomValues(new Uint8Array(n)),"random"),MM=a((n,e,t)=>{let r=(2<<Math.log(n.length-1)/Math.LN2)-1,i=-~(1.6*r*e/n.length);return(o=e)=>{let s="";for(;;){let l=t(i),c=i;for(;c--;)if(s+=n[l[c]&r]||"",s.length===o)return s}}},"customRandom"),TM=a((n,e=21)=>MM(n,e,NM),"customAlphabet");TM("abcedfghicklmn",10);function ae(n,e){const t=yN(n),r=a(i=>async()=>{r.key=t,await i.wait(bo);const o=e(i);return i.get(ge).create(t,o),r.run=s=>i.get(ge).call(n,s),()=>{i.get(ge).remove(t)}},"t");return r}a(ae,"re$1");function ut(n){const e=a(t=>async()=>{await t.wait(Kt);const r=n(t);return t.update(Fo,i=>[...i,r]),e.inputRule=r,()=>{t.update(Fo,i=>i.filter(o=>o!==r))}},"o");return e}a(ut,"oe$1");function $M(n,e){const t=a(r=>async()=>{const i=e(r);return r.update(li,o=>[...o.filter(s=>s[0]!==n),[n,i]]),t.id=n,t.schema=i,()=>{r.update(li,o=>o.filter(([s])=>s!==n))}},"r");return t.type=r=>{const i=r.get(cn).marks[n];if(!i)throw ab(n);return i},t}a($M,"Q$1");function eh(n,e){const t=a(r=>async()=>{const i=e(r);return r.update(si,o=>[...o.filter(s=>s[0]!==n),[n,i]]),t.id=n,t.schema=i,()=>{r.update(si,o=>o.filter(([s])=>s!==n))}},"r");return t.type=r=>{const i=r.get(cn).nodes[n];if(!i)throw lb(n);return i},t}a(eh,"W$2");function pn(n){let e;const t=a(r=>async()=>(await r.wait(Kt),e=n(r),r.update(dn,i=>[...i,e]),()=>{r.update(dn,i=>i.filter(o=>o!==e))}),"r");return t.plugin=()=>e,t.key=()=>e.spec.key,t}a(pn,"ue$2");function AM(n){const e=a(t=>async()=>{await t.wait(Kt);const r=n(t),i=$y(r);return t.update(dn,o=>[...o,i]),e.keymap=r,()=>{t.update(dn,o=>o.filter(s=>s!==i))}},"o");return e}a(AM,"X");function mn(n,e){const t=ke(n,e),r=a(i=>(i.inject(t),()=>()=>{i.remove(t)}),"t");return r.key=t,r}a(mn,"h");function Ue(n,e){const t=mn(e,n),r=eh(n,o=>o.get(t.key)(o)),i=[t,r];return i.id=r.id,i.node=r,i.type=o=>r.type(o),i.schema=r.schema,i.ctx=t,i.key=t.key,i.extendSchema=o=>s=>()=>{const l=s.get(t.key),c=o(l)(s);s.update(si,u=>[...u.filter(h=>h[0]!==n),[n,c]]),i.schema=c},i}a(Ue,"fe$2");function ds(n,e){const t=mn(e,n),r=$M(n,o=>o.get(t.key)(o)),i=[t,r];return i.id=r.id,i.mark=r,i.type=r.type,i.schema=r.schema,i.ctx=t,i.key=t.key,i.extendSchema=o=>s=>()=>{const l=s.get(t.key),c=o(l)(s);s.update(li,u=>[...u.filter(h=>h[0]!==n),[n,c]]),i.schema=c},i}a(ds,"ye$2");function ht(n,e){const t=Object.fromEntries(Object.entries(e).map(([s,{shortcuts:l}])=>[s,l])),r=mn(t,`${n}Keymap`),i=AM(s=>{const l=s.get(r.key),c=Object.entries(e).flatMap(([u,{command:h}])=>[l[u]].flat().map(d=>[d,h(s)]));return Object.fromEntries(c)}),o=[r,i];return o.ctx=r,o.shortcuts=i,o.key=r.key,o.keymap=i.keymap,o}a(ht,"ge$2");const zt=a((n,e=()=>({}))=>mn(e,`${n}Attr`),"he$2"),fs=a((n,e=()=>({}))=>mn(e,`${n}Attr`),"we$2");function vi(n,e,t){const r=mn(t??{},n),i=a(s=>async()=>{await s.wait(oi);const l={plugin:e(s),options:s.get(r.key)};return s.update(Lo,c=>[...c,l]),()=>{s.update(Lo,c=>c.filter(u=>u!==l))}},"e"),o=[r,i];return o.id=n,o.plugin=i,o.options=r,o}a(vi,"ke$2");function Fi(n,e){return t=>t.get(ge).call(n,e)}a(Fi,"Se$2");function Fp(){return n=>{const e=document.createElement("div"),t=n.get(cn),r=n.get(Nr),i=Ir.fromSchema(t).serializeFragment(r.state.doc.content);return e.appendChild(i),e.innerHTML}}a(Fp,"ve$2");function IM(n){return e=>{const t=e.get(Nr),r=e.get(ko)(n);if(!r)return;const i=t.state.selection.content();return t.dispatch(t.state.tr.replaceSelection(new U(r.content,i.openStart,i.openEnd)).scrollIntoView())}}a(IM,"Te$2");function jy(n){if(typeof n!="string")throw new TypeError("Expected a string");return n.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}a(jy,"escapeStringRegexp$2");function EM(n){if(typeof n!="string")throw new TypeError("Expected a string");return n.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}a(EM,"escapeStringRegexp$1");const OM=[["","ss"],["","Ss"],["","ae"],["","Ae"],["","oe"],["","Oe"],["","ue"],["","Ue"],["","A"],["","A"],["","A"],["","A"],["","Ae"],["","A"],["","AE"],["","C"],["","E"],["","E"],["","E"],["","E"],["","I"],["","I"],["","I"],["","I"],["","D"],["","N"],["","O"],["","O"],["","O"],["","O"],["","Oe"],["","O"],["","O"],["","U"],["","U"],["","U"],["","Ue"],["","U"],["","Y"],["","TH"],["","ss"],["","a"],["","a"],["","a"],["","a"],["","ae"],["","a"],["","ae"],["","c"],["","e"],["","e"],["","e"],["","e"],["","i"],["","i"],["","i"],["","i"],["","d"],["","n"],["","o"],["","o"],["","o"],["","o"],["","oe"],["","o"],["","o"],["","u"],["","u"],["","u"],["","ue"],["","u"],["","y"],["","th"],["","y"],["","SS"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","e"],["","E"],["","e"],["","E"],["","e"],["","E"],["","i"],["","I"],["","i"],["","I"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","u"],["","U"],["","u"],["","U"],["","y"],["","Y"],["","a"],["","A"],["","D"],["","d"],["","i"],["","I"],["","u"],["","U"],["","o"],["","O"],["","u"],["","U"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","e"],["","E"],["","e"],["","E"],["","e"],["","E"],["","e"],["","E"],["","e"],["","E"],["","e"],["","E"],["","e"],["","E"],["","e"],["","E"],["","i"],["","I"],["","i"],["","I"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","u"],["","U"],["","u"],["","U"],["","u"],["","U"],["","u"],["","U"],["","u"],["","U"],["","u"],["","U"],["","u"],["","U"],["","y"],["","Y"],["","y"],["","Y"],["","y"],["","Y"],["","y"],["","Y"],["","e"],["","a"],["","a"],["","w"],["","i"],["","y"],["","a"],["","b"],["","t"],["","t"],["","th"],["","j"],["","h"],["","kh"],["","d"],["","dh"],["","r"],["","z"],["","s"],["","sh"],["","s"],["","d"],["","t"],["","z"],["","e"],["","gh"],["","_"],["","f"],["","q"],["","k"],["","l"],["","m"],["","n"],["","h"],["","w"],["","a"],["","y"],["","a"],["","u"],["","i"],["","0"],["","1"],["","2"],["","3"],["","4"],["","5"],["","6"],["","7"],["","8"],["","9"],["","ch"],["","k"],["","g"],["","p"],["","zh"],["","y"],["","0"],["","1"],["","2"],["","3"],["","4"],["","5"],["","6"],["","7"],["","8"],["","9"],["","p"],["","z"],["","c"],["","d"],["","d"],["","r"],["","r"],["","z"],["","g"],["","x"],["","g"],["","n"],["","e"],["","e"],["","ai"],["","t"],["","d"],["","r"],["","n"],["","h"],["","h"],["","e"],["","A"],["","a"],["","B"],["","b"],["","V"],["","v"],["","G"],["","g"],["","D"],["","d"],["","ye"],["","Ye"],["","yE"],["","YE"],["","E"],["","e"],["","Yo"],["","yo"],["","Zh"],["","zh"],["","Z"],["","z"],["","I"],["","i"],["","iy"],["","Iy"],["","IY"],["","iY"],["","Y"],["","y"],["","K"],["","k"],["","L"],["","l"],["","M"],["","m"],["","N"],["","n"],["","O"],["","o"],["","P"],["","p"],["","R"],["","r"],["","S"],["","s"],["","T"],["","t"],["","U"],["","u"],["","F"],["","f"],["","Kh"],["","kh"],["","Ts"],["","ts"],["","Ch"],["","ch"],["","Sh"],["","sh"],["","Sch"],["","sch"],["",""],["",""],["","Y"],["","y"],["",""],["",""],["","E"],["","e"],["","Yu"],["","yu"],["","Ya"],["","ya"],["","a"],["","A"],["","s"],["","S"],["","t"],["","T"],["","t"],["","T"],["","s"],["","S"],["","c"],["","C"],["","g"],["","G"],["","i"],["","I"],["","a"],["","A"],["","b"],["","B"],["","g"],["","G"],["","d"],["","D"],["","ye"],["","Ye"],["","z"],["","Z"],["","e"],["","E"],["","y"],["","Y"],["","t"],["","T"],["","zh"],["","Zh"],["","i"],["","I"],["","l"],["","L"],["","kh"],["","Kh"],["","ts"],["","Ts"],["","k"],["","K"],["","h"],["","H"],["","dz"],["","Dz"],["","gh"],["","Gh"],["","tch"],["","Tch"],["","m"],["","M"],["","y"],["","Y"],["","n"],["","N"],["","sh"],["","Sh"],["","vo"],["","Vo"],["","ch"],["","Ch"],["","p"],["","P"],["","j"],["","J"],["","r"],["","R"],["","s"],["","S"],["","v"],["","V"],["","t"],["","T"],["","r"],["","R"],["","c"],["","C"],["","u"],["","U"],["","U"],["","p"],["","P"],["","q"],["","Q"],["","o"],["","O"],["","f"],["","F"],["","yev"],["","a"],["","b"],["","g"],["","d"],["","e"],["","v"],["","z"],["","t"],["","i"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","zh"],["","r"],["","s"],["","t"],["","u"],["","ph"],["","q"],["","gh"],["","k"],["","sh"],["","ch"],["","ts"],["","dz"],["","ts"],["","tch"],["","kh"],["","j"],["","h"],["","c"],["","d"],["","e"],["","n"],["","r"],["","s"],["","t"],["","u"],["","z"],["","C"],["","D"],["","E"],["","N"],["","R"],["","S"],["","T"],["","U"],["","Z"],["","h"],["","sh"],["","n"],["","r"],["","b"],["","lh"],["","k"],["","a"],["","v"],["","m"],["","f"],["","dh"],["","th"],["","l"],["","g"],["","gn"],["","s"],["","d"],["","z"],["","t"],["","y"],["","p"],["","j"],["","ch"],["","tt"],["","hh"],["","kh"],["","th"],["","z"],["","sh"],["","s"],["","d"],["","t"],["","z"],["","a"],["","gh"],["","q"],["","w"],["","a"],["","aa"],["","i"],["","ee"],["","u"],["","oo"],["","e"],["","ey"],["","o"],["","oa"],["",""],["","a"],["","v"],["","g"],["","d"],["","e"],["","z"],["","i"],["","th"],["","i"],["","k"],["","l"],["","m"],["","n"],["","ks"],["","o"],["","p"],["","r"],["","s"],["","t"],["","y"],["","f"],["","x"],["","ps"],["","o"],["","a"],["","e"],["","i"],["","o"],["","y"],["","i"],["","o"],["","s"],["","i"],["","y"],["","y"],["","i"],["","A"],["","B"],["","G"],["","D"],["","E"],["","Z"],["","I"],["","TH"],["","I"],["","K"],["","L"],["","M"],["","N"],["","KS"],["","O"],["","P"],["","R"],["","S"],["","T"],["","Y"],["","F"],["","X"],["","PS"],["","O"],["","A"],["","E"],["","I"],["","O"],["","Y"],["","I"],["","O"],["","I"],["","Y"],["","a"],["","e"],["","g"],["","i"],["","k"],["","l"],["","n"],["","u"],["","A"],["","E"],["","G"],["","I"],["","K"],["","L"],["","N"],["","U"],["","c"],["","s"],["","z"],["","C"],["","S"],["","Z"],["","a"],["","c"],["","e"],["","e"],["","i"],["","s"],["","u"],["","u"],["","z"],["","A"],["","C"],["","E"],["","E"],["","I"],["","S"],["","U"],["","U"],["","Kj"],["","kj"],["","Lj"],["","lj"],["","Nj"],["","nj"],["","Ts"],["","ts"],["","a"],["","c"],["","e"],["","l"],["","n"],["","s"],["","z"],["","z"],["","A"],["","C"],["","E"],["","L"],["","N"],["","S"],["","Z"],["","Z"],["","Ye"],["","I"],["","Yi"],["","G"],["","ye"],["","i"],["","yi"],["","g"],["","IJ"],["","ij"],["","c"],["","Y"],["","b"],["","t"],["","Bo"],["","B"],["","CE"],["","C"],["","Cr"],["","F"],["","m"],["","N"],["","Pt"],["","Rs"],["","W"],["","s"],["","E"],["","K"],["","T"],["","Dp"],["","S"],["","P"],["","G"],["","A"],["","S"],["","C"],["","tt"],["","S"],["","T"],["","R"],["","L"],["","P"],["","B"],["","$"],["","c"],["","Y"],["","W"],["","A"],["","B"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","C"],["","D"],["","g"],["","J"],["","K"],["","N"],["","O"],["","P"],["","Q"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","f"],["","h"],["","i"],["","j"],["","h"],["","l"],["","m"],["","n"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","D"],["","E"],["","F"],["","G"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","D"],["","E"],["","F"],["","G"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","l"],["","j"],["","A"],["","B"],["","G"],["","D"],["","E"],["","Z"],["","I"],["","TH"],["","I"],["","K"],["","L"],["","M"],["","N"],["","KS"],["","O"],["","P"],["","R"],["","TH"],["","S"],["","T"],["","Y"],["","F"],["","x"],["","PS"],["","O"],["","D"],["","a"],["","b"],["","g"],["","d"],["","e"],["","z"],["","i"],["","th"],["","i"],["","k"],["","l"],["","m"],["","n"],["","ks"],["","o"],["","p"],["","r"],["","s"],["","s"],["","t"],["","y"],["","f"],["","x"],["","ps"],["","o"],["","d"],["","E"],["","TH"],["","K"],["","f"],["","r"],["","p"],["","A"],["","V"],["","G"],["","D"],["","E"],["","Z"],["","I"],["","TH"],["","I"],["","K"],["","L"],["","M"],["","N"],["","KS"],["","O"],["","P"],["","S"],["","TH"],["","S"],["","T"],["","Y"],["","F"],["","X"],["","PS"],["","O"],["","D"],["","a"],["","v"],["","g"],["","d"],["","e"],["","z"],["","i"],["","th"],["","i"],["","k"],["","l"],["","m"],["","n"],["","ks"],["","o"],["","p"],["","r"],["","s"],["","s"],["","t"],["","y"],["","f"],["","x"],["","ps"],["","o"],["","a"],["","e"],["","i"],["","k"],["","f"],["","r"],["","p"],["","A"],["","B"],["","G"],["","D"],["","E"],["","Z"],["","I"],["","TH"],["","I"],["","K"],["","L"],["","M"],["","N"],["","KS"],["","O"],["","P"],["","R"],["","TH"],["","S"],["","T"],["","Y"],["","F"],["","X"],["","PS"],["","O"],["","D"],["","a"],["","v"],["","g"],["","d"],["","e"],["","z"],["","i"],["","th"],["","i"],["","k"],["","l"],["","m"],["","n"],["","ks"],["","o"],["","p"],["","r"],["","s"],["","s"],["","t"],["","y"],["","f"],["","x"],["","ps"],["","o"],["","a"],["","e"],["","i"],["","k"],["","f"],["","r"],["","p"],["","A"],["","V"],["","G"],["","D"],["","E"],["","Z"],["","I"],["","TH"],["","I"],["","K"],["","L"],["","M"],["","N"],["","KS"],["","O"],["","P"],["","S"],["","TH"],["","S"],["","T"],["","Y"],["","F"],["","X"],["","PS"],["","O"],["","D"],["","av"],["","g"],["","d"],["","e"],["","z"],["","i"],["","i"],["","th"],["","i"],["","k"],["","l"],["","m"],["","n"],["","ks"],["","o"],["","p"],["","r"],["","s"],["","s"],["","t"],["","y"],["","f"],["","x"],["","ps"],["","o"],["","a"],["","e"],["","i"],["","k"],["","f"],["","r"],["","p"],["","F"],["","f"],["","(a)"],["","(b)"],["","(c)"],["","(d)"],["","(e)"],["","(f)"],["","(g)"],["","(h)"],["","(i)"],["","(j)"],["","(k)"],["","(l)"],["","(m)"],["","(n)"],["","(o)"],["","(p)"],["","(q)"],["","(r)"],["","(s)"],["","(t)"],["","(u)"],["","(v)"],["","(w)"],["","(x)"],["","(y)"],["","(z)"],["","(A)"],["","(B)"],["","(C)"],["","(D)"],["","(E)"],["","(F)"],["","(G)"],["","(H)"],["","(I)"],["","(J)"],["","(K)"],["","(L)"],["","(N)"],["","(O)"],["","(P)"],["","(Q)"],["","(R)"],["","(S)"],["","(T)"],["","(U)"],["","(V)"],["","(W)"],["","(X)"],["","(Y)"],["","(Z)"],["","(a)"],["","(b)"],["","(b)"],["","(c)"],["","(e)"],["","(f)"],["","(g)"],["","(h)"],["","(i)"],["","(j)"],["","(k)"],["","(l)"],["","(m)"],["","(n)"],["","(o)"],["","(p)"],["","(q)"],["","(r)"],["","(s)"],["","(t)"],["","(u)"],["","(v)"],["","(w)"],["","(x)"],["","(y)"],["","(z)"],["","C"],["","c"],["","G"],["","g"],["","H"],["","h"],["","Z"],["","z"],["","0"],["","1"],["","2"],["","3"],["","4"],["","5"],["","6"],["","7"],["","8"],["","9"],["","0"],["","1"],["","2"],["","3"],["","4"],["","5"],["","6"],["","7"],["","8"],["","9"],["","0"],["","1"],["","2"],["","3"],["","4"],["","5"],["","6"],["","7"],["","8"],["","9"],["","0"],["","1"],["","2"],["","3"],["","4"],["","5"],["","6"],["","7"],["","8"],["","9"],["","0"],["","1"],["","2"],["","3"],["","4"],["","5"],["","6"],["","7"],["","8"],["","9"],["","1"],["","2"],["","3"],["","4"],["","5"],["","6"],["","7"],["","8"],["","9"],["","10"],["","11"],["","12"],["","13"],["","14"],["","15"],["","16"],["","17"],["","18"],["","19"],["","20"],["","1"],["","2"],["","3"],["","4"],["","5"],["","6"],["","7"],["","8"],["","9"],["","10"],["","11"],["","12"],["","13"],["","14"],["","15"],["","16"],["","17"],["","18"],["","19"],["","20"],["","1."],["","2."],["","3."],["","4."],["","5."],["","6."],["","7."],["","8."],["","9."],["","10."],["","11."],["","12."],["","13."],["","14."],["","15."],["","16."],["","17."],["","18."],["","19."],["","20."],["","0"],["","11"],["","12"],["","13"],["","14"],["","15"],["","16"],["","17"],["","18"],["","19"],["","20"],["","1"],["","2"],["","3"],["","4"],["","5"],["","6"],["","7"],["","8"],["","9"],["","10"],["","0"],["","&"],["","&"],["","&"],["","&"],["","&"],["","&"],["",'"'],["",'"'],["",'"'],["","?!"],["","?!"],["","?!"],["","?!"],["","/"],["","\\"],["","AR"],["","V"],["","V"],["","VR"],["","VF"],["","2"],["","5"],["","f"],["","W"],["","U"],["","V"],["","T"],["","V"],["","MB"],["","VB"],["","3B"],["","3B"],["","100"],["","BACK"],["","END"],["","ON!"],["","SOON"],["","TOP"],["","18"],["","abc"],["","ABCD"],["","abcd"],["","1234"],["","T&@%"],["#","#"],["*","*"],["0","0"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"],["8","8"],["9","9"],["","10"],["","A"],["","B"],["","AB"],["","CL"],["","O"],["","P"],["","SOS"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"]],_M=a((n,e)=>{for(const[t,r]of e)n=n.replace(new RegExp(EM(t),"g"),r);return n},"doCustomReplacements");function DM(n,e){if(typeof n!="string")throw new TypeError(`Expected a string, got \`${typeof n}\``);e={customReplacements:[],...e};const t=new Map([...OM,...e.customReplacements]);return n=n.normalize(),n=_M(n,t),n=n.normalize("NFD").replace(/\p{Diacritic}/gu,"").normalize(),n}a(DM,"transliterate");const RM=[["&"," and "],[""," unicorn "],[""," love "]],zM=a(n=>n.replace(/([A-Z]{2,})(\d+)/g,"$1 $2").replace(/([a-z\d]+)([A-Z]{2,})/g,"$1 $2").replace(/([a-z\d])([A-Z])/g,"$1 $2").replace(/([A-Z]+)([A-Z][a-rt-z\d]+)/g,"$1 $2"),"decamelize"),PM=a((n,e)=>{const t=jy(e);return n.replace(new RegExp(`${t}{2,}`,"g"),e).replace(new RegExp(`^${t}|${t}$`,"g"),"")},"removeMootSeparators"),FM=a(n=>{let e="a-z\\d";if(e+=n.lowercase?"":"A-Z",n.preserveCharacters.length>0)for(const t of n.preserveCharacters){if(t===n.separator)throw new Error(`The separator character \`${n.separator}\` cannot be included in preserved characters: ${n.preserveCharacters}`);e+=jy(t)}return new RegExp(`[^${e}]+`,"g")},"buildPatternSlug");function LM(n,e){if(typeof n!="string")throw new TypeError(`Expected a string, got \`${typeof n}\``);e={separator:"-",lowercase:!0,decamelize:!0,customReplacements:[],preserveLeadingUnderscore:!1,preserveTrailingDash:!1,preserveCharacters:[],...e};const t=e.preserveLeadingUnderscore&&n.startsWith("_"),r=e.preserveTrailingDash&&n.endsWith("-"),i=new Map([...RM,...e.customReplacements]);n=DM(n,{customReplacements:i}),e.decamelize&&(n=zM(n));const o=FM(e);return e.lowercase&&(n=n.toLowerCase()),n=n.replace(/([a-zA-Z\d]+)'([ts])(\s|$)/g,"$1$2$3"),n=n.replace(o,e.separator),n=n.replace(/\\/g,""),e.separator&&(n=PM(n,e.separator)),t&&(n=`_${n}`),r&&(n=`${n}-`),n}a(LM,"slugify");function BM(n,e){return function(t,r){let{$from:i,$to:o,node:s}=t.selection;if(s&&s.isBlock||i.depth<2||!i.sameParent(o))return!1;let l=i.node(-1);if(l.type!=n)return!1;if(i.parent.content.size==0&&i.node(-1).childCount==i.indexAfter(-1)){if(i.depth==3||i.node(-3).type!=n||i.index(-2)!=i.node(-2).childCount-1)return!1;if(r){let d=P.empty,f=i.index(-1)?1:i.index(-2)?2:3;for(let b=i.depth-f;b>=i.depth-3;b--)d=P.from(i.node(b).copy(d));let p=i.indexAfter(-1)<i.node(-2).childCount?1:i.indexAfter(-2)<i.node(-3).childCount?2:3;d=d.append(P.from(n.createAndFill()));let m=i.before(i.depth-(f-1)),g=t.tr.replace(m,i.after(-p),new U(d,4-f,0)),k=-1;g.doc.nodesBetween(m,g.doc.content.size,(b,x)=>{if(k>-1)return!1;b.isTextblock&&b.content.size==0&&(k=x+1)}),k>-1&&g.setSelection(te.near(g.doc.resolve(k))),r(g.scrollIntoView())}return!0}let c=o.pos==i.end()?l.contentMatchAt(0).defaultType:null,u=t.tr.delete(i.pos,o.pos),h=c?[e?{type:n,attrs:e}:null,{type:c}]:void 0;return fo(u.doc,i.pos,2,h)?(r&&r(u.split(i.pos,2,h).scrollIntoView()),!0):!1}}a(BM,"splitListItem");function Vy(n){return function(e,t){let{$from:r,$to:i}=e.selection,o=r.blockRange(i,s=>s.childCount>0&&s.firstChild.type==n);return o?t?r.node(o.depth-1).type==n?HM(e,t,n,o):jM(e,t,o):!0:!1}}a(Vy,"liftListItem");function HM(n,e,t,r){let i=n.tr,o=r.end,s=r.$to.end(r.depth);o<s&&(i.step(new at(o-1,s,o,s,new U(P.from(t.create(null,r.parent.copy())),1,0),1,!0)),r=new yl(i.doc.resolve(r.$from.pos),i.doc.resolve(s),r.depth));const l=ta(r);if(l==null)return!1;i.lift(r,l);let c=i.mapping.map(o,-1)-1;return na(i.doc,c)&&i.join(c),e(i.scrollIntoView()),!0}a(HM,"liftToOuterList");function jM(n,e,t){let r=n.tr,i=t.parent;for(let p=t.end,m=t.endIndex-1,g=t.startIndex;m>g;m--)p-=i.child(m).nodeSize,r.delete(p-1,p+1);let o=r.doc.resolve(t.start),s=o.nodeAfter;if(r.mapping.map(t.end)!=t.start+o.nodeAfter.nodeSize)return!1;let l=t.startIndex==0,c=t.endIndex==i.childCount,u=o.node(-1),h=o.index(-1);if(!u.canReplace(h+(l?0:1),h+1,s.content.append(c?P.empty:P.from(i))))return!1;let d=o.pos,f=d+s.nodeSize;return r.step(new at(d-(l?1:0),f+(c?1:0),d+1,f-1,new U((l?P.empty:P.from(i.copy(P.empty))).append(c?P.empty:P.from(i.copy(P.empty))),l?0:1,c?0:1),l?0:1)),e(r.scrollIntoView()),!0}a(jM,"liftOutOfList");function VM(n){return function(e,t){let{$from:r,$to:i}=e.selection,o=r.blockRange(i,u=>u.childCount>0&&u.firstChild.type==n);if(!o)return!1;let s=o.startIndex;if(s==0)return!1;let l=o.parent,c=l.child(s-1);if(c.type!=n)return!1;if(t){let u=c.lastChild&&c.lastChild.type==l.type,h=P.from(u?n.create():null),d=new U(P.from(n.create(null,P.from(l.type.create(null,h)))),u?3:1,0),f=o.start,p=o.end;t(e.tr.step(new at(f-(u?3:1),p,f,p,d,1,!0)).scrollIntoView())}return!0}}a(VM,"sinkListItem");function WM(n){const e=new Map;if(!n||!n.type)throw new Error("mdast-util-definitions expected node");return Si(n,"definition",function(r){const i=Lp(r.identifier);i&&!e.get(i)&&e.set(i,r)}),t;function t(r){const i=Lp(r);return e.get(i)}a(t,"definition")}a(WM,"definitions");function Lp(n){return String(n||"").toUpperCase()}a(Lp,"clean");function qM(){return function(n){const e=WM(n);Si(n,function(t,r,i){if(t.type==="definition"&&i!==void 0&&typeof r=="number")return i.children.splice(r,1),[_c,r];if(t.type==="imageReference"||t.type==="linkReference"){const o=e(t.identifier);if(o&&i&&typeof r=="number")return i.children[r]=t.type==="imageReference"?{type:"image",url:o.url,title:o.title,alt:t.alt}:{type:"link",url:o.url,title:o.title,children:t.children},[_c,r]}})}}a(qM,"remarkInlineLinks");function Wy(n,e){var t;if(!(e.childCount>=1&&((t=e.lastChild)==null?void 0:t.type.name)==="hardbreak")){n.next(e.content);return}const r=[];e.content.forEach((i,o,s)=>{s!==e.childCount-1&&r.push(i)}),n.next(P.fromArray(r))}a(Wy,"at$1");function T(n,e){return Object.assign(n,{meta:{package:"@milkdown/preset-commonmark",...e}}),n}a(T,"n$1");const th=fs("emphasis");T(th,{displayName:"Attr<emphasis>",group:"Emphasis"});const Ni=ds("emphasis",n=>({attrs:{marker:{default:n.get(yo).emphasis||"*"}},parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style",getAttrs:e=>e==="italic"}],toDOM:e=>["em",n.get(th.key)(e)],parseMarkdown:{match:e=>e.type==="emphasis",runner:(e,t,r)=>{e.openMark(r,{marker:t.marker}),e.next(t.children),e.closeMark(r)}},toMarkdown:{match:e=>e.type.name==="emphasis",runner:(e,t)=>{e.withMark(t,"emphasis",void 0,{marker:t.attrs.marker})}}}));T(Ni.mark,{displayName:"MarkSchema<emphasis>",group:"Emphasis"});T(Ni.ctx,{displayName:"MarkSchemaCtx<emphasis>",group:"Emphasis"});const ca=ae("ToggleEmphasis",n=>()=>la(Ni.type(n)));T(ca,{displayName:"Command<toggleEmphasisCommand>",group:"Emphasis"});const qy=ut(n=>hs(/(?:^|[^*])\*([^*]+)\*$/,Ni.type(n),{getAttr:()=>({marker:"*"}),updateCaptured:({fullMatch:e,start:t})=>e.startsWith("*")?{}:{fullMatch:e.slice(1),start:t+1}}));T(qy,{displayName:"InputRule<emphasis>|Star",group:"Emphasis"});const Ky=ut(n=>hs(/(?:^|[^_])_([^_]+)_$/,Ni.type(n),{getAttr:()=>({marker:"_"}),updateCaptured:({fullMatch:e,start:t})=>e.startsWith("_")?{}:{fullMatch:e.slice(1),start:t+1}}));T(Ky,{displayName:"InputRule<emphasis>|Underscore",group:"Emphasis"});const nh=ht("emphasisKeymap",{ToggleEmphasis:{shortcuts:"Mod-i",command:n=>{const e=n.get(ge);return()=>e.call(ca.key)}}});T(nh.ctx,{displayName:"KeymapCtx<emphasis>",group:"Emphasis"});T(nh.shortcuts,{displayName:"Keymap<emphasis>",group:"Emphasis"});const rh=fs("strong");T(rh,{displayName:"Attr<strong>",group:"Strong"});const ps=ds("strong",n=>({attrs:{marker:{default:n.get(yo).strong||"*"}},parseDOM:[{tag:"b"},{tag:"strong"},{style:"font-style",getAttrs:e=>e==="bold"}],toDOM:e=>["strong",n.get(rh.key)(e)],parseMarkdown:{match:e=>e.type==="strong",runner:(e,t,r)=>{e.openMark(r,{marker:t.marker}),e.next(t.children),e.closeMark(r)}},toMarkdown:{match:e=>e.type.name==="strong",runner:(e,t)=>{e.withMark(t,"strong",void 0,{marker:t.attrs.marker})}}}));T(ps.mark,{displayName:"MarkSchema<strong>",group:"Strong"});T(ps.ctx,{displayName:"MarkSchemaCtx<strong>",group:"Strong"});const ua=ae("ToggleStrong",n=>()=>la(ps.type(n)));T(ua,{displayName:"Command<toggleStrongCommand>",group:"Strong"});const Uy=ut(n=>hs(/(?:\*\*|__)([^*_]+)(?:\*\*|__)$/,ps.type(n),{getAttr:e=>({marker:e[0].startsWith("*")?"*":"_"})}));T(Uy,{displayName:"InputRule<strong>",group:"Strong"});const ih=ht("strongKeymap",{ToggleBold:{shortcuts:["Mod-b"],command:n=>{const e=n.get(ge);return()=>e.call(ua.key)}}});T(ih.ctx,{displayName:"KeymapCtx<strong>",group:"Strong"});T(ih.shortcuts,{displayName:"Keymap<strong>",group:"Strong"});const oh=fs("inlineCode");T(oh,{displayName:"Attr<inlineCode>",group:"InlineCode"});const Rn=ds("inlineCode",n=>({priority:100,code:!0,inclusive:!1,parseDOM:[{tag:"code"}],toDOM:e=>["code",n.get(oh.key)(e)],parseMarkdown:{match:e=>e.type==="inlineCode",runner:(e,t,r)=>{e.openMark(r),e.addText(t.value),e.closeMark(r)}},toMarkdown:{match:e=>e.type.name==="inlineCode",runner:(e,t,r)=>{e.withMark(t,"inlineCode",r.text||"")}}}));T(Rn.mark,{displayName:"MarkSchema<inlineCode>",group:"InlineCode"});T(Rn.ctx,{displayName:"MarkSchemaCtx<inlineCode>",group:"InlineCode"});const sh=ae("ToggleInlineCode",n=>()=>(e,t)=>{const{selection:r,tr:i}=e;if(r.empty)return!1;const{from:o,to:s}=r;return e.doc.rangeHasMark(o,s,Rn.type(n))?(t?.(i.removeMark(o,s,Rn.type(n))),!0):(Object.keys(e.schema.marks).filter(l=>l!==Rn.type.name).map(l=>e.schema.marks[l]).forEach(l=>{i.removeMark(o,s,l)}),t?.(i.addMark(o,s,Rn.type(n).create())),!0)});T(sh,{displayName:"Command<toggleInlineCodeCommand>",group:"InlineCode"});const Jy=ut(n=>hs(/(?:\`)([^\`]+)(?:\`)$/,Rn.type(n)));T(Jy,{displayName:"InputRule<inlineCodeInputRule>",group:"InlineCode"});const lh=ht("inlineCodeKeymap",{ToggleInlineCode:{shortcuts:"Mod-e",command:n=>{const e=n.get(ge);return()=>e.call(sh.key)}}});T(lh.ctx,{displayName:"KeymapCtx<inlineCode>",group:"InlineCode"});T(lh.shortcuts,{displayName:"Keymap<inlineCode>",group:"InlineCode"});const ah=fs("link");T(ah,{displayName:"Attr<link>",group:"Link"});const ai=ds("link",n=>({attrs:{href:{},title:{default:null}},parseDOM:[{tag:"a[href]",getAttrs:e=>{if(!(e instanceof HTMLElement))throw Gt(e);return{href:e.getAttribute("href"),title:e.getAttribute("title")}}}],toDOM:e=>["a",{...n.get(ah.key)(e),...e.attrs}],parseMarkdown:{match:e=>e.type==="link",runner:(e,t,r)=>{const i=t.url,o=t.title;e.openMark(r,{href:i,title:o}),e.next(t.children),e.closeMark(r)}},toMarkdown:{match:e=>e.type.name==="link",runner:(e,t)=>{e.withMark(t,"link",void 0,{title:t.attrs.title,url:t.attrs.href})}}}));T(ai.mark,{displayName:"MarkSchema<link>",group:"Link"});const Zy=ae("ToggleLink",n=>(e={})=>la(ai.type(n),e));T(Zy,{displayName:"Command<toggleLinkCommand>",group:"Link"});const Gy=ae("UpdateLink",n=>(e={})=>(t,r)=>{if(!r)return!1;let i,o=-1;const{selection:s}=t,{from:l,to:c}=s;if(t.doc.nodesBetween(l,l===c?c+1:c,(m,g)=>{if(ai.type(n).isInSet(m.marks))return i=m,o=g,!1}),!i)return!1;const u=i.marks.find(({type:m})=>m===ai.type(n));if(!u)return!1;const h=o,d=o+i.nodeSize,{tr:f}=t,p=ai.type(n).create({...u.attrs,...e});return p?(r(f.removeMark(h,d,u).addMark(h,d,p).setSelection(new de(f.selection.$anchor)).scrollIntoView()),!0):!1});T(Gy,{displayName:"Command<updateLinkCommand>",group:"Link"});const Yy=eh("doc",()=>({content:"block+",parseMarkdown:{match:({type:n})=>n==="root",runner:(n,e,t)=>{n.injectRoot(e,t)}},toMarkdown:{match:n=>n.type.name==="doc",runner:(n,e)=>{n.openNode("root"),n.next(e.content)}}}));T(Yy,{displayName:"NodeSchema<doc>",group:"Doc"});const ch=zt("paragraph");T(ch,{displayName:"Attr<paragraph>",group:"Paragraph"});const gn=Ue("paragraph",n=>({content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:e=>["p",n.get(ch.key)(e),0],parseMarkdown:{match:e=>e.type==="paragraph",runner:(e,t,r)=>{e.openNode(r),t.children?e.next(t.children):e.addText(t.value||""),e.closeNode()}},toMarkdown:{match:e=>e.type.name==="paragraph",runner:(e,t)=>{e.openNode("paragraph"),Wy(e,t),e.closeNode()}}}));T(gn.node,{displayName:"NodeSchema<paragraph>",group:"Paragraph"});T(gn.ctx,{displayName:"NodeSchemaCtx<paragraph>",group:"Paragraph"});const uh=ae("TurnIntoText",n=>()=>Po(gn.type(n)));T(uh,{displayName:"Command<turnIntoTextCommand>",group:"Paragraph"});const hh=ht("paragraphKeymap",{TurnIntoText:{shortcuts:"Mod-Alt-0",command:n=>{const e=n.get(ge);return()=>e.call(uh.key)}}});T(hh.ctx,{displayName:"KeymapCtx<paragraph>",group:"Paragraph"});T(hh.shortcuts,{displayName:"Keymap<paragraph>",group:"Paragraph"});const KM=Array(6).fill(0).map((n,e)=>e+1);function UM(n){return LM(n.textContent)}a(UM,"_t");const ha=mn(UM,"headingIdGenerator");T(ha,{displayName:"Ctx<HeadingIdGenerator>",group:"Heading"});const dh=zt("heading");T(dh,{displayName:"Attr<heading>",group:"Heading"});const zr=Ue("heading",n=>{const e=n.get(ha.key);return{content:"inline*",group:"block",defining:!0,attrs:{id:{default:""},level:{default:1}},parseDOM:KM.map(t=>({tag:`h${t}`,getAttrs:r=>{if(!(r instanceof HTMLElement))throw Gt(r);return{level:t,id:r.id}}})),toDOM:t=>[`h${t.attrs.level}`,{...n.get(dh.key)(t),id:t.attrs.id||e(t)},0],parseMarkdown:{match:({type:t})=>t==="heading",runner:(t,r,i)=>{const o=r.depth;t.openNode(i,{level:o}),t.next(r.children),t.closeNode()}},toMarkdown:{match:t=>t.type.name==="heading",runner:(t,r)=>{t.openNode("heading",void 0,{depth:r.attrs.level}),Wy(t,r),t.closeNode()}}}});T(zr.node,{displayName:"NodeSchema<heading>",group:"Heading"});T(zr.ctx,{displayName:"NodeSchemaCtx<heading>",group:"Heading"});const Qy=ut(n=>my(/^(?<hashes>#+)\s$/,zr.type(n),e=>{var t,r;const i=((r=(t=e.groups)==null?void 0:t.hashes)==null?void 0:r.length)||0,o=n.get(Nr),{$from:s}=o.state.selection,l=s.node();if(l.type.name==="heading"){let c=Number(l.attrs.level)+Number(i);return c>6&&(c=6),{level:c}}return{level:i}}));T(Qy,{displayName:"InputRule<wrapInHeadingInputRule>",group:"Heading"});const $n=ae("WrapInHeading",n=>e=>(e??(e=1),e<1?Po(gn.type(n)):Po(zr.type(n),{level:e})));T($n,{displayName:"Command<wrapInHeadingCommand>",group:"Heading"});const fh=ae("DowngradeHeading",n=>()=>(e,t,r)=>{const{$from:i}=e.selection,o=i.node();if(o.type!==zr.type(n)||!e.selection.empty||i.parentOffset!==0)return!1;const s=o.attrs.level-1;return s?(t?.(e.tr.setNodeMarkup(e.selection.$from.before(),void 0,{...o.attrs,level:s})),!0):Po(gn.type(n))(e,t,r)});T(fh,{displayName:"Command<downgradeHeadingCommand>",group:"Heading"});const ph=ht("headingKeymap",{TurnIntoH1:{shortcuts:"Mod-Alt-1",command:n=>{const e=n.get(ge);return()=>e.call($n.key,1)}},TurnIntoH2:{shortcuts:"Mod-Alt-2",command:n=>{const e=n.get(ge);return()=>e.call($n.key,2)}},TurnIntoH3:{shortcuts:"Mod-Alt-3",command:n=>{const e=n.get(ge);return()=>e.call($n.key,3)}},TurnIntoH4:{shortcuts:"Mod-Alt-4",command:n=>{const e=n.get(ge);return()=>e.call($n.key,4)}},TurnIntoH5:{shortcuts:"Mod-Alt-5",command:n=>{const e=n.get(ge);return()=>e.call($n.key,5)}},TurnIntoH6:{shortcuts:"Mod-Alt-6",command:n=>{const e=n.get(ge);return()=>e.call($n.key,6)}},DowngradeHeading:{shortcuts:["Delete","Backspace"],command:n=>{const e=n.get(ge);return()=>e.call(fh.key)}}});T(ph.ctx,{displayName:"KeymapCtx<heading>",group:"Heading"});T(ph.shortcuts,{displayName:"Keymap<heading>",group:"Heading"});const mh=zt("blockquote");T(mh,{displayName:"Attr<blockquote>",group:"Blockquote"});const ms=Ue("blockquote",n=>({content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:e=>["blockquote",n.get(mh.key)(e),0],parseMarkdown:{match:({type:e})=>e==="blockquote",runner:(e,t,r)=>{e.openNode(r).next(t.children).closeNode()}},toMarkdown:{match:e=>e.type.name==="blockquote",runner:(e,t)=>{e.openNode("blockquote").next(t.content).closeNode()}}}));T(ms.node,{displayName:"NodeSchema<blockquote>",group:"Blockquote"});T(ms.ctx,{displayName:"NodeSchemaCtx<blockquote>",group:"Blockquote"});const Xy=ut(n=>Gu(/^\s*>\s$/,ms.type(n)));T(Xy,{displayName:"InputRule<wrapInBlockquoteInputRule>",group:"Blockquote"});const gh=ae("WrapInBlockquote",n=>()=>Xu(ms.type(n)));T(gh,{displayName:"Command<wrapInBlockquoteCommand>",group:"Blockquote"});const yh=ht("blockquoteKeymap",{WrapInBlockquote:{shortcuts:"Mod-Shift-b",command:n=>{const e=n.get(ge);return()=>e.call(gh.key)}}});T(yh.ctx,{displayName:"KeymapCtx<blockquote>",group:"Blockquote"});T(yh.shortcuts,{displayName:"Keymap<blockquote>",group:"Blockquote"});const kh=zt("codeBlock",()=>({pre:{},code:{}}));T(kh,{displayName:"Attr<codeBlock>",group:"CodeBlock"});const gs=Ue("code_block",n=>({content:"text*",group:"block",marks:"",defining:!0,code:!0,attrs:{language:{default:""}},parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs:e=>{if(!(e instanceof HTMLElement))throw Gt(e);return{language:e.dataset.language}}}],toDOM:e=>{const t=n.get(kh.key)(e);return["pre",{...t.pre,"data-language":e.attrs.language},["code",t.code,0]]},parseMarkdown:{match:({type:e})=>e==="code",runner:(e,t,r)=>{const i=t.lang,o=t.value;e.openNode(r,{language:i}),o&&e.addText(o),e.closeNode()}},toMarkdown:{match:e=>e.type.name==="code_block",runner:(e,t)=>{var r;e.addNode("code",void 0,((r=t.content.firstChild)==null?void 0:r.text)||"",{lang:t.attrs.language})}}}));T(gs.node,{displayName:"NodeSchema<codeBlock>",group:"CodeBlock"});T(gs.ctx,{displayName:"NodeSchemaCtx<codeBlock>",group:"CodeBlock"});const e1=ut(n=>my(/^```(?<language>[a-z]*)?[\s\n]$/,gs.type(n),e=>{var t;return{language:((t=e.groups)==null?void 0:t.language)??""}}));T(e1,{displayName:"InputRule<createCodeBlockInputRule>",group:"CodeBlock"});const bh=ae("CreateCodeBlock",n=>(e="")=>Po(gs.type(n),{language:e}));T(bh,{displayName:"Command<createCodeBlockCommand>",group:"CodeBlock"});const JM=ae("UpdateCodeBlockLanguage",()=>({pos:n,language:e}={pos:-1,language:""})=>(t,r)=>n>=0?(r?.(t.tr.setNodeAttribute(n,"language",e)),!0):!1);T(JM,{displayName:"Command<updateCodeBlockLanguageCommand>",group:"CodeBlock"});const xh=ht("codeBlockKeymap",{CreateCodeBlock:{shortcuts:"Mod-Alt-c",command:n=>{const e=n.get(ge);return()=>e.call(bh.key)}}});T(xh.ctx,{displayName:"KeymapCtx<codeBlock>",group:"CodeBlock"});T(xh.shortcuts,{displayName:"Keymap<codeBlock>",group:"CodeBlock"});const wh=zt("image");T(wh,{displayName:"Attr<image>",group:"Image"});const Mi=Ue("image",n=>({inline:!0,group:"inline",selectable:!0,draggable:!0,marks:"",atom:!0,defining:!0,isolating:!0,attrs:{src:{default:""},alt:{default:""},title:{default:""}},parseDOM:[{tag:"img[src]",getAttrs:e=>{if(!(e instanceof HTMLElement))throw Gt(e);return{src:e.getAttribute("src")||"",alt:e.getAttribute("alt")||"",title:e.getAttribute("title")||e.getAttribute("alt")||""}}}],toDOM:e=>["img",{...n.get(wh.key)(e),...e.attrs}],parseMarkdown:{match:({type:e})=>e==="image",runner:(e,t,r)=>{const i=t.url,o=t.alt,s=t.title;e.addNode(r,{src:i,alt:o,title:s})}},toMarkdown:{match:e=>e.type.name==="image",runner:(e,t)=>{e.addNode("image",void 0,void 0,{title:t.attrs.title,url:t.attrs.src,alt:t.attrs.alt})}}}));T(Mi.node,{displayName:"NodeSchema<image>",group:"Image"});T(Mi.ctx,{displayName:"NodeSchemaCtx<image>",group:"Image"});const t1=ae("InsertImage",n=>(e={})=>(t,r)=>{if(!r)return!0;const{src:i="",alt:o="",title:s=""}=e,l=Mi.type(n).create({src:i,alt:o,title:s});return l&&r(t.tr.replaceSelectionWith(l).scrollIntoView()),!0});T(t1,{displayName:"Command<insertImageCommand>",group:"Image"});const n1=ae("UpdateImage",n=>(e={})=>(t,r)=>{const i=Lv(t.selection,Mi.type(n));if(!i)return!1;const{node:o,pos:s}=i,l={...o.attrs},{src:c,alt:u,title:h}=e;return c!==void 0&&(l.src=c),u!==void 0&&(l.alt=u),h!==void 0&&(l.title=h),r?.(t.tr.setNodeMarkup(s,void 0,l).scrollIntoView()),!0});T(n1,{displayName:"Command<updateImageCommand>",group:"Image"});const ZM=ut(n=>new rt(/!\[(?<alt>.*?)]\((?<filename>.*?)\s*(?="|\))"?(?<title>[^"]+)?"?\)/,(e,t,r,i)=>{const[o,s,l="",c]=t;return o?e.tr.replaceWith(r,i,Mi.type(n).create({src:l,alt:s,title:c})):null}));T(ZM,{displayName:"InputRule<insertImageInputRule>",group:"Image"});const Ch=zt("hardbreak",n=>({"data-is-inline":n.attrs.isInline}));T(Ch,{displayName:"Attr<hardbreak>",group:"Hardbreak"});const Mr=Ue("hardbreak",n=>({inline:!0,group:"inline",attrs:{isInline:{default:!1}},selectable:!1,parseDOM:[{tag:"br"}],toDOM:e=>["br",n.get(Ch.key)(e)],parseMarkdown:{match:({type:e})=>e==="break",runner:(e,t,r)=>{var i;e.addNode(r,{isInline:!!((i=t.data)!=null&&i.isInline)})}},leafText:()=>`
`,toMarkdown:{match:e=>e.type.name==="hardbreak",runner:(e,t)=>{t.attrs.isInline?e.addNode("text",void 0,`
`):e.addNode("break")}}}));T(Mr.node,{displayName:"NodeSchema<hardbreak>",group:"Hardbreak"});T(Mr.ctx,{displayName:"NodeSchemaCtx<hardbreak>",group:"Hardbreak"});const Sh=ae("InsertHardbreak",n=>()=>(e,t)=>{var r;const{selection:i,tr:o}=e;if(!(i instanceof de))return!1;if(i.empty){const s=i.$from.node();if(s.childCount>0&&((r=s.lastChild)==null?void 0:r.type.name)==="hardbreak")return t?.(o.replaceRangeWith(i.to-1,i.to,e.schema.node("paragraph")).setSelection(te.near(o.doc.resolve(i.to))).scrollIntoView()),!0}return t?.(o.setMeta("hardbreak",!0).replaceSelectionWith(Mr.type(n).create()).scrollIntoView()),!0});T(Sh,{displayName:"Command<insertHardbreakCommand>",group:"Hardbreak"});const vh=ht("hardbreakKeymap",{InsertHardbreak:{shortcuts:"Shift-Enter",command:n=>{const e=n.get(ge);return()=>e.call(Sh.key)}}});T(vh.ctx,{displayName:"KeymapCtx<hardbreak>",group:"Hardbreak"});T(vh.shortcuts,{displayName:"Keymap<hardbreak>",group:"Hardbreak"});const Nh=zt("hr");T(Nh,{displayName:"Attr<hr>",group:"Hr"});const ys=Ue("hr",n=>({group:"block",parseDOM:[{tag:"hr"}],toDOM:e=>["hr",n.get(Nh.key)(e)],parseMarkdown:{match:({type:e})=>e==="thematicBreak",runner:(e,t,r)=>{e.addNode(r)}},toMarkdown:{match:e=>e.type.name==="hr",runner:e=>{e.addNode("thematicBreak")}}}));T(ys.node,{displayName:"NodeSchema<hr>",group:"Hr"});T(ys.ctx,{displayName:"NodeSchemaCtx<hr>",group:"Hr"});const r1=ut(n=>new rt(/^(?:---|___\s|\*\*\*\s)$/,(e,t,r,i)=>{const{tr:o}=e;return t[0]&&o.replaceWith(r-1,i,ys.type(n).create()),o}));T(r1,{displayName:"InputRule<insertHrInputRule>",group:"Hr"});const i1=ae("InsertHr",n=>()=>(e,t)=>{if(!t)return!0;const r=gn.node.type(n).create(),{tr:i,selection:o}=e,{from:s}=o,l=ys.type(n).create();if(!l)return!0;const c=i.replaceSelectionWith(l).insert(s,r),u=te.findFrom(c.doc.resolve(s),1,!0);return u&&t(c.setSelection(u).scrollIntoView()),!0});T(i1,{displayName:"Command<insertHrCommand>",group:"Hr"});const Mh=zt("bulletList");T(Mh,{displayName:"Attr<bulletList>",group:"BulletList"});const Ti=Ue("bullet_list",n=>({content:"listItem+",group:"block",attrs:{spread:{default:!1}},parseDOM:[{tag:"ul",getAttrs:e=>{if(!(e instanceof HTMLElement))throw Gt(e);return{spread:e.dataset.spread}}}],toDOM:e=>["ul",{...n.get(Mh.key)(e),"data-spread":e.attrs.spread},0],parseMarkdown:{match:({type:e,ordered:t})=>e==="list"&&!t,runner:(e,t,r)=>{const i=t.spread!=null?`${t.spread}`:"false";e.openNode(r,{spread:i}).next(t.children).closeNode()}},toMarkdown:{match:e=>e.type.name==="bullet_list",runner:(e,t)=>{e.openNode("list",void 0,{ordered:!1,spread:t.attrs.spread==="true"}).next(t.content).closeNode()}}}));T(Ti.node,{displayName:"NodeSchema<bulletList>",group:"BulletList"});T(Ti.ctx,{displayName:"NodeSchemaCtx<bulletList>",group:"BulletList"});const o1=ut(n=>Gu(/^\s*([-+*])\s$/,Ti.type(n)));T(o1,{displayName:"InputRule<wrapInBulletListInputRule>",group:"BulletList"});const Th=ae("WrapInBulletList",n=>()=>Xu(Ti.type(n)));T(Th,{displayName:"Command<wrapInBulletListCommand>",group:"BulletList"});const $h=ht("bulletListKeymap",{WrapInBulletList:{shortcuts:"Mod-Alt-8",command:n=>{const e=n.get(ge);return()=>e.call(Th.key)}}});T($h.ctx,{displayName:"KeymapCtx<bulletListKeymap>",group:"BulletList"});T($h.shortcuts,{displayName:"Keymap<bulletListKeymap>",group:"BulletList"});const Ah=zt("orderedList");T(Ah,{displayName:"Attr<orderedList>",group:"OrderedList"});const $i=Ue("ordered_list",n=>({content:"listItem+",group:"block",attrs:{order:{default:1},spread:{default:!1}},parseDOM:[{tag:"ol",getAttrs:e=>{if(!(e instanceof HTMLElement))throw Gt(e);return{spread:e.dataset.spread,order:e.hasAttribute("start")?Number(e.getAttribute("start")):1}}}],toDOM:e=>["ol",{...n.get(Ah.key)(e),...e.attrs.order===1?{}:e.attrs.order,"data-spread":e.attrs.spread},0],parseMarkdown:{match:({type:e,ordered:t})=>e==="list"&&!!t,runner:(e,t,r)=>{const i=t.spread!=null?`${t.spread}`:"true";e.openNode(r,{spread:i}).next(t.children).closeNode()}},toMarkdown:{match:e=>e.type.name==="ordered_list",runner:(e,t)=>{e.openNode("list",void 0,{ordered:!0,start:1,spread:t.attrs.spread==="true"}),e.next(t.content),e.closeNode()}}}));T($i.node,{displayName:"NodeSchema<orderedList>",group:"OrderedList"});T($i.ctx,{displayName:"NodeSchemaCtx<orderedList>",group:"OrderedList"});const s1=ut(n=>Gu(/^\s*(\d+)\.\s$/,$i.type(n),e=>({order:Number(e[1])}),(e,t)=>t.childCount+t.attrs.order===Number(e[1])));T(s1,{displayName:"InputRule<wrapInOrderedListInputRule>",group:"OrderedList"});const Ih=ae("WrapInOrderedList",n=>()=>Xu($i.type(n)));T(Ih,{displayName:"Command<wrapInOrderedListCommand>",group:"OrderedList"});const Eh=ht("orderedListKeymap",{WrapInOrderedList:{shortcuts:"Mod-Alt-7",command:n=>{const e=n.get(ge);return()=>e.call(Ih.key)}}});T(Eh.ctx,{displayName:"KeymapCtx<orderedList>",group:"OrderedList"});T(Eh.shortcuts,{displayName:"Keymap<orderedList>",group:"OrderedList"});const Oh=zt("listItem");T(Oh,{displayName:"Attr<listItem>",group:"ListItem"});const Zt=Ue("list_item",n=>({group:"listItem",content:"block+",attrs:{label:{default:""},listType:{default:"bullet"},spread:{default:"true"}},defining:!0,parseDOM:[{tag:"li",getAttrs:e=>{if(!(e instanceof HTMLElement))throw Gt(e);return{label:e.dataset.label,listType:e.dataset["list-type"],spread:e.dataset.spread}}}],toDOM:e=>["li",{...n.get(Oh.key)(e),"data-label":e.attrs.label,"data-list-type":e.attrs.listType,"data-spread":e.attrs.spread},0],parseMarkdown:{match:({type:e})=>e==="listItem",runner:(e,t,r)=>{const i=t.label!=null?`${t.label}.`:"",o=t.label!=null?"ordered":"bullet",s=t.spread!=null?`${t.spread}`:"true";e.openNode(r,{label:i,listType:o,spread:s}),e.next(t.children),e.closeNode()}},toMarkdown:{match:e=>e.type.name==="list_item",runner:(e,t)=>{e.openNode("listItem",void 0,{spread:t.attrs.spread==="true"}),e.next(t.content),e.closeNode()}}}));T(Zt.node,{displayName:"NodeSchema<listItem>",group:"ListItem"});T(Zt.ctx,{displayName:"NodeSchemaCtx<listItem>",group:"ListItem"});const _h=ae("SinkListItem",n=>()=>VM(Zt.type(n)));T(_h,{displayName:"Command<sinkListItemCommand>",group:"ListItem"});const Dh=ae("LiftListItem",n=>()=>Vy(Zt.type(n)));T(Dh,{displayName:"Command<liftListItemCommand>",group:"ListItem"});const Rh=ae("SplitListItem",n=>()=>BM(Zt.type(n)));T(Rh,{displayName:"Command<splitListItemCommand>",group:"ListItem"});function GM(n){return(e,t,r)=>{const{selection:i}=e;if(!(i instanceof de))return!1;const{empty:o,$from:s}=i;if(!o||s.parentOffset!==0)return!1;const l=s.node(-1);return l.type!==Zt.type(n)||l.firstChild!==s.node()||s.node(-2).childCount>1?!1:Vy(Zt.type(n))(e,t,r)}}a(GM,"$t");const zh=ae("LiftFirstListItem",n=>()=>GM(n));T(zh,{displayName:"Command<liftFirstListItemCommand>",group:"ListItem"});const Ph=ht("listItemKeymap",{NextListItem:{shortcuts:"Enter",command:n=>{const e=n.get(ge);return()=>e.call(Rh.key)}},SinkListItem:{shortcuts:["Tab","Mod-]"],command:n=>{const e=n.get(ge);return()=>e.call(_h.key)}},LiftListItem:{shortcuts:["Shift-Tab","Mod-["],command:n=>{const e=n.get(ge);return()=>e.call(Dh.key)}},LiftFirstListItem:{shortcuts:["Backspace","Delete"],command:n=>{const e=n.get(ge);return()=>e.call(zh.key)}}});T(Ph.ctx,{displayName:"KeymapCtx<listItem>",group:"ListItem"});T(Ph.shortcuts,{displayName:"Keymap<listItem>",group:"ListItem"});const l1=eh("text",()=>({group:"inline",parseMarkdown:{match:({type:n})=>n==="text",runner:(n,e)=>{n.addText(e.value)}},toMarkdown:{match:n=>n.type.name==="text",runner:(n,e)=>{n.addNode("text",void 0,e.text)}}}));T(l1,{displayName:"NodeSchema<text>",group:"Text"});const Fh=zt("html");T(Fh,{displayName:"Attr<html>",group:"Html"});const Lh=Ue("html",n=>({atom:!0,group:"inline",inline:!0,attrs:{value:{default:""}},toDOM:e=>{const t=document.createElement("span"),r={...n.get(Fh.key)(e),"data-value":e.attrs.value,"data-type":"html"};return t.textContent=e.attrs.value,["span",r,e.attrs.value]},parseDOM:[{tag:'span[data-type="html"]',getAttrs:e=>({value:e.dataset.value??""})}],parseMarkdown:{match:({type:e})=>e==="html",runner:(e,t,r)=>{e.addNode(r,{value:t.value})}},toMarkdown:{match:e=>e.type.name==="html",runner:(e,t)=>{e.addNode("html",void 0,t.attrs.value)}}}));T(Lh.node,{displayName:"NodeSchema<html>",group:"Html"});T(Lh.ctx,{displayName:"NodeSchemaCtx<html>",group:"Html"});const YM=[Yy,ch,gn,ha,dh,zr,Ch,Mr,mh,ms,kh,gs,Nh,ys,wh,Mi,Mh,Ti,Ah,$i,Oh,Zt,th,Ni,rh,ps,oh,Rn,ah,ai,Fh,Lh,l1].flat(),QM=[Xy,o1,s1,e1,r1,Qy].flat(),XM=[qy,Ky,Jy,Uy],eT=[uh,gh,$n,fh,bh,Sh,i1,t1,n1,Ih,Th,_h,Rh,Dh,zh,ca,sh,ua,Zy,Gy],tT=[yh,xh,vh,ph,Ph,Eh,$h,hh,nh,lh,ih].flat(),Bh=vi("remarkAddOrderInList",()=>()=>n=>{Si(n,"list",e=>{if(e.ordered){const t=e.start??1;e.children.forEach((r,i)=>{r.label=i+t})}})});T(Bh.plugin,{displayName:"Remark<remarkAddOrderInListPlugin>",group:"Remark"});T(Bh.options,{displayName:"RemarkConfig<remarkAddOrderInListPlugin>",group:"Remark"});const Hh=vi("remarkLineBreak",()=>()=>n=>{const e=/[\t ]*(?:\r?\n|\r)/g;Si(n,"text",(t,r,i)=>{if(!t.value||typeof t.value!="string")return;const o=[];let s=0;e.lastIndex=0;let l=e.exec(t.value);for(;l;){const c=l.index;s!==c&&o.push({type:"text",value:t.value.slice(s,c)}),o.push({type:"break",data:{isInline:!0}}),s=c+l[0].length,l=e.exec(t.value)}if(o.length>0&&i&&typeof r=="number")return s<t.value.length&&o.push({type:"text",value:t.value.slice(s)}),i.children.splice(r,1,...o),r+o.length})});T(Hh.plugin,{displayName:"Remark<remarkLineBreak>",group:"Remark"});T(Hh.options,{displayName:"RemarkConfig<remarkLineBreak>",group:"Remark"});const jh=vi("remarkInlineLink",()=>qM);T(jh.plugin,{displayName:"Remark<remarkInlineLinkPlugin>",group:"Remark"});T(jh.options,{displayName:"RemarkConfig<remarkInlineLinkPlugin>",group:"Remark"});const nT=a(n=>!!n.children,"Gt"),rT=a(n=>n.type==="html","jt");function iT(n,e){return t(n,0,null)[0];function t(r,i,o){if(nT(r)){const s=[];for(let l=0,c=r.children.length;l<c;l++){const u=r.children[l];if(u){const h=t(u,l,r);if(h)for(let d=0,f=h.length;d<f;d++){const p=h[d];p&&s.push(p)}}}r.children=s}return e(r,i,o)}}a(iT,"zt");const Vh=vi("remarkHTMLTransformer",()=>()=>n=>{iT(n,(e,t,r)=>rT(e)?(r?.type==="root"&&(e.children=[{...e}],delete e.value,e.type="paragraph"),[e]):[e])});T(Vh.plugin,{displayName:"Remark<remarkHtmlTransformer>",group:"Remark"});T(Vh.options,{displayName:"RemarkConfig<remarkHtmlTransformer>",group:"Remark"});const Wh=vi("remarkMarker",()=>()=>(n,e)=>{const t=a(r=>e.value.charAt(r.position.start.offset),"r");Si(n,r=>["strong","emphasis"].includes(r.type),r=>{r.marker=t(r)})});T(Wh.plugin,{displayName:"Remark<remarkMarker>",group:"Remark"});T(Wh.options,{displayName:"RemarkConfig<remarkMarker>",group:"Remark"});const a1=pn(()=>{let n=!1;const e=new Ge("MILKDOWN_INLINE_NODES_CURSOR"),t=new Xe({key:e,state:{init(){return!1},apply(r){if(!r.selection.empty)return!1;const i=r.selection.$from,o=i.nodeBefore,s=i.nodeAfter;return!!(o&&s&&o.isInline&&!o.isText&&s.isInline&&!s.isText)}},props:{handleDOMEvents:{compositionend:(r,i)=>n?(n=!1,requestAnimationFrame(()=>{if(t.getState(r.state)){const o=r.state.selection.from;i.preventDefault(),r.dispatch(r.state.tr.insertText(i.data||"",o))}}),!0):!1,compositionstart:r=>(t.getState(r.state)&&(n=!0),!1),beforeinput:(r,i)=>{if(t.getState(r.state)&&i instanceof InputEvent&&i.data&&!n){const o=r.state.selection.from;return i.preventDefault(),r.dispatch(r.state.tr.insertText(i.data||"",o)),!0}return!1}},decorations(r){if(t.getState(r)){const i=r.selection.$from.pos,o=document.createElement("span"),s=Mt.widget(i,o,{side:-1}),l=document.createElement("span"),c=Mt.widget(i,l);return setTimeout(()=>{o.contentEditable="true",l.contentEditable="true"}),Ke.create(r.doc,[s,c])}return Ke.empty}}});return t});T(a1,{displayName:"Prose<inlineNodesCursorPlugin>",group:"Prose"});const c1=pn(n=>new Xe({key:new Ge("MILKDOWN_HARDBREAK_MARKS"),appendTransaction:(e,t,r)=>{if(!e.length)return;const[i]=e;if(!i)return;const[o]=i.steps;if(i.getMeta("hardbreak")){if(!(o instanceof Nt))return;const{from:s}=o;return r.tr.setNodeMarkup(s,Mr.type(n),void 0,[])}if(o instanceof hi){let s=r.tr;const{from:l,to:c}=o;return r.doc.nodesBetween(l,c,(u,h)=>{u.type===Mr.type(n)&&(s=s.setNodeMarkup(h,Mr.type(n),void 0,[]))}),s}}}));T(c1,{displayName:"Prose<hardbreakClearMarkPlugin>",group:"Prose"});const qh=mn(["table","code_block"],"hardbreakFilterNodes");T(qh,{displayName:"Ctx<hardbreakFilterNodes>",group:"Prose"});const u1=pn(n=>{const e=n.get(qh.key);return new Xe({key:new Ge("MILKDOWN_HARDBREAK_FILTER"),filterTransaction:(t,r)=>{const i=t.getMeta("hardbreak"),[o]=t.steps;if(i&&o){const{from:s}=o,l=r.doc.resolve(s);let c=l.depth,u=!0;for(;c>0;)e.includes(l.node(c).type.name)&&(u=!1),c--;return u}return!0}})});T(u1,{displayName:"Prose<hardbreakFilterPlugin>",group:"Prose"});const h1=pn(n=>{const e=new Ge("MILKDOWN_HEADING_ID"),t=a(r=>{if(r.composing)return;const i=n.get(ha.key),o=r.state.tr.setMeta("addToHistory",!1);let s=!1;r.state.doc.descendants((l,c)=>{if(l.type===zr.type(n)){if(l.textContent.trim().length===0)return;const u=l.attrs,h=i(l);u.id!==h&&(s=!0,o.setMeta(e,!0).setNodeMarkup(c,void 0,{...u,id:h}))}}),s&&r.dispatch(o)},"r");return new Xe({key:e,view:r=>(t(r),{update:i=>{t(i)}})})});T(h1,{displayName:"Prose<syncHeadingIdPlugin>",group:"Prose"});const d1=pn(n=>{const e=a(t=>{if(t.composing||!t.editable)return;const r=$i.type(n),i=Ti.type(n),o=Zt.type(n),s=t.state,l=a((h,d)=>{let f=!1;const p=`${d+1}.`;return h.label!==p&&(h.label=p,f=!0),f},"i");let c=s.tr,u=!1;s.doc.descendants((h,d,f,p)=>{if(h.type===i){const m=h.maybeChild(0);m?.type===o&&m.attrs.listType==="ordered"&&(u=!0,c.setNodeMarkup(d,r,{spread:"true"}),h.descendants((g,k,b,x)=>{if(g.type===o){const C={...g.attrs};l(C,x)&&(c=c.setNodeMarkup(k,void 0,C))}return!1}))}else if(h.type===o&&f?.type===r){const m={...h.attrs};let g=!1;m.listType!=="ordered"&&(m.listType="ordered",g=!0),f?.maybeChild(0)&&(g=l(m,p)),g&&(c=c.setNodeMarkup(d,void 0,m),u=!0)}}),u&&t.dispatch(c.setMeta("addToHistory",!1))},"e");return new Xe({key:new Ge("MILKDOWN_KEEP_LIST_ORDER"),view:t=>(e(t),{update:r=>{e(r)}})})});T(d1,{displayName:"Prose<syncListOrderPlugin>",group:"Prose"});const oT=[c1,qh,u1,a1,Bh,jh,Hh,Vh,Wh,h1,d1].flat(),sT=[YM,QM,XM,eT,tT,oT].flat();var Cu,Su;if(typeof WeakMap<"u"){let n=new WeakMap;Cu=a(e=>n.get(e),"readFromCache"),Su=a((e,t)=>(n.set(e,t),t),"addToCache")}else{const n=[];let t=0;Cu=a(r=>{for(let i=0;i<n.length;i+=2)if(n[i]==r)return n[i+1]},"readFromCache"),Su=a((r,i)=>(t==10&&(t=0),n[t++]=r,n[t++]=i),"addToCache")}var is,xe=(is=class{constructor(e,t,r,i){this.width=e,this.height=t,this.map=r,this.problems=i}findCell(e){for(let t=0;t<this.map.length;t++){const r=this.map[t];if(r!=e)continue;const i=t%this.width,o=t/this.width|0;let s=i+1,l=o+1;for(let c=1;s<this.width&&this.map[t+c]==r;c++)s++;for(let c=1;l<this.height&&this.map[t+this.width*c]==r;c++)l++;return{left:i,top:o,right:s,bottom:l}}throw new RangeError(`No cell with offset ${e} found`)}colCount(e){for(let t=0;t<this.map.length;t++)if(this.map[t]==e)return t%this.width;throw new RangeError(`No cell with offset ${e} found`)}nextCell(e,t,r){const{left:i,right:o,top:s,bottom:l}=this.findCell(e);return t=="horiz"?(r<0?i==0:o==this.width)?null:this.map[s*this.width+(r<0?i-1:o)]:(r<0?s==0:l==this.height)?null:this.map[i+this.width*(r<0?s-1:l)]}rectBetween(e,t){const{left:r,right:i,top:o,bottom:s}=this.findCell(e),{left:l,right:c,top:u,bottom:h}=this.findCell(t);return{left:Math.min(r,l),top:Math.min(o,u),right:Math.max(i,c),bottom:Math.max(s,h)}}cellsInRect(e){const t=[],r={};for(let i=e.top;i<e.bottom;i++)for(let o=e.left;o<e.right;o++){const s=i*this.width+o,l=this.map[s];r[l]||(r[l]=!0,!(o==e.left&&o&&this.map[s-1]==l||i==e.top&&i&&this.map[s-this.width]==l)&&t.push(l))}return t}positionAt(e,t,r){for(let i=0,o=0;;i++){const s=o+r.child(i).nodeSize;if(i==e){let l=t+e*this.width;const c=(e+1)*this.width;for(;l<c&&this.map[l]<o;)l++;return l==c?s-1:this.map[l]}o=s}}static get(e){return Cu(e)||Su(e,lT(e))}},a(is,"TableMap"),is);function lT(n){if(n.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+n.type.name);const e=aT(n),t=n.childCount,r=[];let i=0,o=null;const s=[];for(let u=0,h=e*t;u<h;u++)r[u]=0;for(let u=0,h=0;u<t;u++){const d=n.child(u);h++;for(let m=0;;m++){for(;i<r.length&&r[i]!=0;)i++;if(m==d.childCount)break;const g=d.child(m),{colspan:k,rowspan:b,colwidth:x}=g.attrs;for(let C=0;C<b;C++){if(C+u>=t){(o||(o=[])).push({type:"overlong_rowspan",pos:h,n:b-C});break}const N=i+C*e;for(let A=0;A<k;A++){r[N+A]==0?r[N+A]=h:(o||(o=[])).push({type:"collision",row:u,pos:h,n:k-A});const S=x&&x[A];if(S){const q=(N+A)%e*2,V=s[q];V==null||V!=S&&s[q+1]==1?(s[q]=S,s[q+1]=1):V==S&&s[q+1]++}}}i+=k,h+=g.nodeSize}const f=(u+1)*e;let p=0;for(;i<f;)r[i++]==0&&p++;p&&(o||(o=[])).push({type:"missing",row:u,n:p}),h++}const l=new xe(e,t,r,o);let c=!1;for(let u=0;!c&&u<s.length;u+=2)s[u]!=null&&s[u+1]<t&&(c=!0);return c&&cT(l,s,n),l}a(lT,"computeMap");function aT(n){let e=-1,t=!1;for(let r=0;r<n.childCount;r++){const i=n.child(r);let o=0;if(t)for(let s=0;s<r;s++){const l=n.child(s);for(let c=0;c<l.childCount;c++){const u=l.child(c);s+u.attrs.rowspan>r&&(o+=u.attrs.colspan)}}for(let s=0;s<i.childCount;s++){const l=i.child(s);o+=l.attrs.colspan,l.attrs.rowspan>1&&(t=!0)}e==-1?e=o:e!=o&&(e=Math.max(e,o))}return e}a(aT,"findWidth");function cT(n,e,t){n.problems||(n.problems=[]);const r={};for(let i=0;i<n.map.length;i++){const o=n.map[i];if(r[o])continue;r[o]=!0;const s=t.nodeAt(o);if(!s)throw new RangeError(`No cell with offset ${o} found`);let l=null;const c=s.attrs;for(let u=0;u<c.colspan;u++){const h=(i+u)%n.width,d=e[h*2];d!=null&&(!c.colwidth||c.colwidth[u]!=d)&&((l||(l=uT(c)))[u]=d)}l&&n.problems.unshift({type:"colwidth mismatch",pos:o,colwidth:l})}}a(cT,"findBadColWidths");function uT(n){if(n.colwidth)return n.colwidth.slice();const e=[];for(let t=0;t<n.colspan;t++)e.push(0);return e}a(uT,"freshColWidth");function Bp(n,e){if(typeof n=="string")return{};const t=n.getAttribute("data-colwidth"),r=t&&/^\d+(,\d+)*$/.test(t)?t.split(",").map(s=>Number(s)):null,i=Number(n.getAttribute("colspan")||1),o={colspan:i,rowspan:Number(n.getAttribute("rowspan")||1),colwidth:r&&r.length==i?r:null};for(const s in e){const l=e[s].getFromDOM,c=l&&l(n);c!=null&&(o[s]=c)}return o}a(Bp,"getCellAttrs");function Hp(n,e){const t={};n.attrs.colspan!=1&&(t.colspan=n.attrs.colspan),n.attrs.rowspan!=1&&(t.rowspan=n.attrs.rowspan),n.attrs.colwidth&&(t["data-colwidth"]=n.attrs.colwidth.join(","));for(const r in e){const i=e[r].setDOMAttr;i&&i(n.attrs[r],t)}return t}a(Hp,"setCellAttrs");function hT(n){const e=n.cellAttributes||{},t={colspan:{default:1},rowspan:{default:1},colwidth:{default:null}};for(const r in e)t[r]={default:e[r].default};return{table:{content:"table_row+",tableRole:"table",isolating:!0,group:n.tableGroup,parseDOM:[{tag:"table"}],toDOM(){return["table",["tbody",0]]}},table_row:{content:"(table_cell | table_header)*",tableRole:"row",parseDOM:[{tag:"tr"}],toDOM(){return["tr",0]}},table_cell:{content:n.cellContent,attrs:t,tableRole:"cell",isolating:!0,parseDOM:[{tag:"td",getAttrs:r=>Bp(r,e)}],toDOM(r){return["td",Hp(r,e),0]}},table_header:{content:n.cellContent,attrs:t,tableRole:"header_cell",isolating:!0,parseDOM:[{tag:"th",getAttrs:r=>Bp(r,e)}],toDOM(r){return["th",Hp(r,e),0]}}}}a(hT,"tableNodes");function Tt(n){let e=n.cached.tableNodeTypes;if(!e){e=n.cached.tableNodeTypes={};for(const t in n.nodes){const r=n.nodes[t],i=r.spec.tableRole;i&&(e[i]=r)}}return e}a(Tt,"tableNodeTypes");var _n=new Ge("selectingCells");function ks(n){for(let e=n.depth-1;e>0;e--)if(n.node(e).type.spec.tableRole=="row")return n.node(0).resolve(n.before(e+1));return null}a(ks,"cellAround");function ct(n){const e=n.selection.$head;for(let t=e.depth;t>0;t--)if(e.node(t).type.spec.tableRole=="row")return!0;return!1}a(ct,"isInTable");function da(n){const e=n.selection;if("$anchorCell"in e&&e.$anchorCell)return e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell;if("node"in e&&e.node&&e.node.type.spec.tableRole=="cell")return e.$anchor;const t=ks(e.$head)||dT(e.$head);if(t)return t;throw new RangeError(`No cell found around position ${e.head}`)}a(da,"selectionCell");function dT(n){for(let e=n.nodeAfter,t=n.pos;e;e=e.firstChild,t++){const r=e.type.spec.tableRole;if(r=="cell"||r=="header_cell")return n.doc.resolve(t)}for(let e=n.nodeBefore,t=n.pos;e;e=e.lastChild,t--){const r=e.type.spec.tableRole;if(r=="cell"||r=="header_cell")return n.doc.resolve(t-e.nodeSize)}}a(dT,"cellNear");function vu(n){return n.parent.type.spec.tableRole=="row"&&!!n.nodeAfter}a(vu,"pointsAtCell");function fT(n){return n.node(0).resolve(n.pos+n.nodeAfter.nodeSize)}a(fT,"moveCellForward");function Kh(n,e){return n.depth==e.depth&&n.pos>=e.start(-1)&&n.pos<=e.end(-1)}a(Kh,"inSameTable");function f1(n,e,t){const r=n.node(-1),i=xe.get(r),o=n.start(-1),s=i.nextCell(n.pos-o,e,t);return s==null?null:n.node(0).resolve(o+s)}a(f1,"nextCell");function Dr(n,e,t=1){const r={...n,colspan:n.colspan-t};return r.colwidth&&(r.colwidth=r.colwidth.slice(),r.colwidth.splice(e,t),r.colwidth.some(i=>i>0)||(r.colwidth=null)),r}a(Dr,"removeColSpan");function pT(n,e,t=1){const r={...n,colspan:n.colspan+t};if(r.colwidth){r.colwidth=r.colwidth.slice();for(let i=0;i<t;i++)r.colwidth.splice(e,0,0)}return r}a(pT,"addColSpan");function mT(n,e,t){const r=Tt(e.type.schema).header_cell;for(let i=0;i<n.height;i++)if(e.nodeAt(n.map[t+i*n.width]).type!=r)return!1;return!0}a(mT,"columnIsHeader");var mt,Me=(mt=class extends te{constructor(e,t=e){const r=e.node(-1),i=xe.get(r),o=e.start(-1),s=i.rectBetween(e.pos-o,t.pos-o),l=e.node(0),c=i.cellsInRect(s).filter(h=>h!=t.pos-o);c.unshift(t.pos-o);const u=c.map(h=>{const d=r.nodeAt(h);if(!d)throw RangeError(`No cell with offset ${h} found`);const f=o+h+1;return new Ml(l.resolve(f),l.resolve(f+d.content.size))});super(u[0].$from,u[0].$to,u),this.$anchorCell=e,this.$headCell=t}map(e,t){const r=e.resolve(t.map(this.$anchorCell.pos)),i=e.resolve(t.map(this.$headCell.pos));if(vu(r)&&vu(i)&&Kh(r,i)){const o=this.$anchorCell.node(-1)!=r.node(-1);return o&&this.isRowSelection()?mt.rowSelection(r,i):o&&this.isColSelection()?mt.colSelection(r,i):new mt(r,i)}return de.between(r,i)}content(){const e=this.$anchorCell.node(-1),t=xe.get(e),r=this.$anchorCell.start(-1),i=t.rectBetween(this.$anchorCell.pos-r,this.$headCell.pos-r),o={},s=[];for(let c=i.top;c<i.bottom;c++){const u=[];for(let h=c*t.width+i.left,d=i.left;d<i.right;d++,h++){const f=t.map[h];if(o[f])continue;o[f]=!0;const p=t.findCell(f);let m=e.nodeAt(f);if(!m)throw RangeError(`No cell with offset ${f} found`);const g=i.left-p.left,k=p.right-i.right;if(g>0||k>0){let b=m.attrs;if(g>0&&(b=Dr(b,0,g)),k>0&&(b=Dr(b,b.colspan-k,k)),p.left<i.left){if(m=m.type.createAndFill(b),!m)throw RangeError(`Could not create cell with attrs ${JSON.stringify(b)}`)}else m=m.type.create(b,m.content)}if(p.top<i.top||p.bottom>i.bottom){const b={...m.attrs,rowspan:Math.min(p.bottom,i.bottom)-Math.max(p.top,i.top)};p.top<i.top?m=m.type.createAndFill(b):m=m.type.create(b,m.content)}u.push(m)}s.push(e.child(c).copy(P.from(u)))}const l=this.isColSelection()&&this.isRowSelection()?e:s;return new U(P.from(l),1,1)}replace(e,t=U.empty){const r=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){const{$from:l,$to:c}=i[s],u=e.mapping.slice(r);e.replace(u.map(l.pos),u.map(c.pos),s?U.empty:t)}const o=te.findFrom(e.doc.resolve(e.mapping.slice(r).map(this.to)),-1);o&&e.setSelection(o)}replaceWith(e,t){this.replace(e,new U(P.from(t),0,0))}forEachCell(e){const t=this.$anchorCell.node(-1),r=xe.get(t),i=this.$anchorCell.start(-1),o=r.cellsInRect(r.rectBetween(this.$anchorCell.pos-i,this.$headCell.pos-i));for(let s=0;s<o.length;s++)e(t.nodeAt(o[s]),i+o[s])}isColSelection(){const e=this.$anchorCell.index(-1),t=this.$headCell.index(-1);if(Math.min(e,t)>0)return!1;const r=e+this.$anchorCell.nodeAfter.attrs.rowspan,i=t+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(r,i)==this.$headCell.node(-1).childCount}static colSelection(e,t=e){const r=e.node(-1),i=xe.get(r),o=e.start(-1),s=i.findCell(e.pos-o),l=i.findCell(t.pos-o),c=e.node(0);return s.top<=l.top?(s.top>0&&(e=c.resolve(o+i.map[s.left])),l.bottom<i.height&&(t=c.resolve(o+i.map[i.width*(i.height-1)+l.right-1]))):(l.top>0&&(t=c.resolve(o+i.map[l.left])),s.bottom<i.height&&(e=c.resolve(o+i.map[i.width*(i.height-1)+s.right-1]))),new mt(e,t)}isRowSelection(){const e=this.$anchorCell.node(-1),t=xe.get(e),r=this.$anchorCell.start(-1),i=t.colCount(this.$anchorCell.pos-r),o=t.colCount(this.$headCell.pos-r);if(Math.min(i,o)>0)return!1;const s=i+this.$anchorCell.nodeAfter.attrs.colspan,l=o+this.$headCell.nodeAfter.attrs.colspan;return Math.max(s,l)==t.width}eq(e){return e instanceof mt&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,t=e){const r=e.node(-1),i=xe.get(r),o=e.start(-1),s=i.findCell(e.pos-o),l=i.findCell(t.pos-o),c=e.node(0);return s.left<=l.left?(s.left>0&&(e=c.resolve(o+i.map[s.top*i.width])),l.right<i.width&&(t=c.resolve(o+i.map[i.width*(l.top+1)-1]))):(l.left>0&&(t=c.resolve(o+i.map[l.top*i.width])),s.right<i.width&&(e=c.resolve(o+i.map[i.width*(s.top+1)-1]))),new mt(e,t)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,t){return new mt(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,r=t){return new mt(e.resolve(t),e.resolve(r))}getBookmark(){return new gT(this.$anchorCell.pos,this.$headCell.pos)}},a(mt,"_CellSelection"),mt);Me.prototype.visible=!1;te.jsonID("cell",Me);var wi,gT=(wi=class{constructor(e,t){this.anchor=e,this.head=t}map(e){return new wi(e.map(this.anchor),e.map(this.head))}resolve(e){const t=e.resolve(this.anchor),r=e.resolve(this.head);return t.parent.type.spec.tableRole=="row"&&r.parent.type.spec.tableRole=="row"&&t.index()<t.parent.childCount&&r.index()<r.parent.childCount&&Kh(t,r)?new Me(t,r):te.near(r,1)}},a(wi,"_CellBookmark"),wi);function yT(n){if(!(n.selection instanceof Me))return null;const e=[];return n.selection.forEachCell((t,r)=>{e.push(Mt.node(r,r+t.nodeSize,{class:"selectedCell"}))}),Ke.create(n.doc,e)}a(yT,"drawCellSelection");function kT({$from:n,$to:e}){if(n.pos==e.pos||n.pos<n.pos-6)return!1;let t=n.pos,r=e.pos,i=n.depth;for(;i>=0&&!(n.after(i+1)<n.end(i));i--,t++);for(let o=e.depth;o>=0&&!(e.before(o+1)>e.start(o));o--,r--);return t==r&&/row|table/.test(n.node(i).type.spec.tableRole)}a(kT,"isCellBoundarySelection");function bT({$from:n,$to:e}){let t,r;for(let i=n.depth;i>0;i--){const o=n.node(i);if(o.type.spec.tableRole==="cell"||o.type.spec.tableRole==="header_cell"){t=o;break}}for(let i=e.depth;i>0;i--){const o=e.node(i);if(o.type.spec.tableRole==="cell"||o.type.spec.tableRole==="header_cell"){r=o;break}}return t!==r&&e.parentOffset===0}a(bT,"isTextSelectionAcrossCells");function xT(n,e,t){const r=(e||n).selection,i=(e||n).doc;let o,s;if(r instanceof oe&&(s=r.node.type.spec.tableRole)){if(s=="cell"||s=="header_cell")o=Me.create(i,r.from);else if(s=="row"){const l=i.resolve(r.from+1);o=Me.rowSelection(l,l)}else if(!t){const l=xe.get(r.node),c=r.from+1,u=c+l.map[l.width*l.height-1];o=Me.create(i,c+1,u)}}else r instanceof de&&kT(r)?o=de.create(i,r.from):r instanceof de&&bT(r)&&(o=de.create(i,r.$from.start(),r.$from.end()));return o&&(e||(e=n.tr)).setSelection(o),e}a(xT,"normalizeSelection");var wT=new Ge("fix-tables");function p1(n,e,t,r){const i=n.childCount,o=e.childCount;e:for(let s=0,l=0;s<o;s++){const c=e.child(s);for(let u=l,h=Math.min(i,s+3);u<h;u++)if(n.child(u)==c){l=u+1,t+=c.nodeSize;continue e}r(c,t),l<i&&n.child(l).sameMarkup(c)?p1(n.child(l),c,t+1,r):c.nodesBetween(0,c.content.size,r,t+1),t+=c.nodeSize}}a(p1,"changedDescendants");function CT(n,e){let t;const r=a((i,o)=>{i.type.spec.tableRole=="table"&&(t=ST(n,i,o,t))},"check");return e?e.doc!=n.doc&&p1(e.doc,n.doc,0,r):n.doc.descendants(r),t}a(CT,"fixTables");function ST(n,e,t,r){const i=xe.get(e);if(!i.problems)return r;r||(r=n.tr);const o=[];for(let c=0;c<i.height;c++)o.push(0);for(let c=0;c<i.problems.length;c++){const u=i.problems[c];if(u.type=="collision"){const h=e.nodeAt(u.pos);if(!h)continue;const d=h.attrs;for(let f=0;f<d.rowspan;f++)o[u.row+f]+=u.n;r.setNodeMarkup(r.mapping.map(t+1+u.pos),null,Dr(d,d.colspan-u.n,u.n))}else if(u.type=="missing")o[u.row]+=u.n;else if(u.type=="overlong_rowspan"){const h=e.nodeAt(u.pos);if(!h)continue;r.setNodeMarkup(r.mapping.map(t+1+u.pos),null,{...h.attrs,rowspan:h.attrs.rowspan-u.n})}else if(u.type=="colwidth mismatch"){const h=e.nodeAt(u.pos);if(!h)continue;r.setNodeMarkup(r.mapping.map(t+1+u.pos),null,{...h.attrs,colwidth:u.colwidth})}}let s,l;for(let c=0;c<o.length;c++)o[c]&&(s==null&&(s=c),l=c);for(let c=0,u=t+1;c<i.height;c++){const h=e.child(c),d=u+h.nodeSize,f=o[c];if(f>0){let p="cell";h.firstChild&&(p=h.firstChild.type.spec.tableRole);const m=[];for(let k=0;k<f;k++){const b=Tt(n.schema)[p].createAndFill();b&&m.push(b)}const g=(c==0||s==c-1)&&l==c?u+1:d-1;r.insert(r.mapping.map(g),m)}u=d}return r.setMeta(wT,{fixTables:!0})}a(ST,"fixTable");function vT(n){if(!n.size)return null;let{content:e,openStart:t,openEnd:r}=n;for(;e.childCount==1&&(t>0&&r>0||e.child(0).type.spec.tableRole=="table");)t--,r--,e=e.child(0).content;const i=e.child(0),o=i.type.spec.tableRole,s=i.type.schema,l=[];if(o=="row")for(let c=0;c<e.childCount;c++){let u=e.child(c).content;const h=c?0:Math.max(0,t-1),d=c<e.childCount-1?0:Math.max(0,r-1);(h||d)&&(u=Nu(Tt(s).row,new U(u,h,d)).content),l.push(u)}else if(o=="cell"||o=="header_cell")l.push(t||r?Nu(Tt(s).row,new U(e,t,r)).content:e);else return null;return NT(s,l)}a(vT,"pastedCells");function NT(n,e){const t=[];for(let i=0;i<e.length;i++){const o=e[i];for(let s=o.childCount-1;s>=0;s--){const{rowspan:l,colspan:c}=o.child(s).attrs;for(let u=i;u<i+l;u++)t[u]=(t[u]||0)+c}}let r=0;for(let i=0;i<t.length;i++)r=Math.max(r,t[i]);for(let i=0;i<t.length;i++)if(i>=e.length&&e.push(P.empty),t[i]<r){const o=Tt(n).cell.createAndFill(),s=[];for(let l=t[i];l<r;l++)s.push(o);e[i]=e[i].append(P.from(s))}return{height:e.length,width:r,rows:e}}a(NT,"ensureRectangular");function Nu(n,e){const t=n.createAndFill();return new Nl(t).replace(0,t.content.size,e).doc}a(Nu,"fitSlice");function MT({width:n,height:e,rows:t},r,i){if(n!=r){const o=[],s=[];for(let l=0;l<t.length;l++){const c=t[l],u=[];for(let h=o[l]||0,d=0;h<r;d++){let f=c.child(d%c.childCount);h+f.attrs.colspan>r&&(f=f.type.createChecked(Dr(f.attrs,f.attrs.colspan,h+f.attrs.colspan-r),f.content)),u.push(f),h+=f.attrs.colspan;for(let p=1;p<f.attrs.rowspan;p++)o[l+p]=(o[l+p]||0)+f.attrs.colspan}s.push(P.from(u))}t=s,n=r}if(e!=i){const o=[];for(let s=0,l=0;s<i;s++,l++){const c=[],u=t[l%e];for(let h=0;h<u.childCount;h++){let d=u.child(h);s+d.attrs.rowspan>i&&(d=d.type.create({...d.attrs,rowspan:Math.max(1,i-d.attrs.rowspan)},d.content)),c.push(d)}o.push(P.from(c))}t=o,e=i}return{width:n,height:e,rows:t}}a(MT,"clipCells");function TT(n,e,t,r,i,o,s){const l=n.doc.type.schema,c=Tt(l);let u,h;if(i>e.width)for(let d=0,f=0;d<e.height;d++){const p=t.child(d);f+=p.nodeSize;const m=[];let g;p.lastChild==null||p.lastChild.type==c.cell?g=u||(u=c.cell.createAndFill()):g=h||(h=c.header_cell.createAndFill());for(let k=e.width;k<i;k++)m.push(g);n.insert(n.mapping.slice(s).map(f-1+r),m)}if(o>e.height){const d=[];for(let m=0,g=(e.height-1)*e.width;m<Math.max(e.width,i);m++){const k=m>=e.width?!1:t.nodeAt(e.map[g+m]).type==c.header_cell;d.push(k?h||(h=c.header_cell.createAndFill()):u||(u=c.cell.createAndFill()))}const f=c.row.create(null,P.from(d)),p=[];for(let m=e.height;m<o;m++)p.push(f);n.insert(n.mapping.slice(s).map(r+t.nodeSize-2),p)}return!!(u||h)}a(TT,"growTable");function jp(n,e,t,r,i,o,s,l){if(s==0||s==e.height)return!1;let c=!1;for(let u=i;u<o;u++){const h=s*e.width+u,d=e.map[h];if(e.map[h-e.width]==d){c=!0;const f=t.nodeAt(d),{top:p,left:m}=e.findCell(d);n.setNodeMarkup(n.mapping.slice(l).map(d+r),null,{...f.attrs,rowspan:s-p}),n.insert(n.mapping.slice(l).map(e.positionAt(s,m,t)),f.type.createAndFill({...f.attrs,rowspan:p+f.attrs.rowspan-s})),u+=f.attrs.colspan-1}}return c}a(jp,"isolateHorizontal");function Vp(n,e,t,r,i,o,s,l){if(s==0||s==e.width)return!1;let c=!1;for(let u=i;u<o;u++){const h=u*e.width+s,d=e.map[h];if(e.map[h-1]==d){c=!0;const f=t.nodeAt(d),p=e.colCount(d),m=n.mapping.slice(l).map(d+r);n.setNodeMarkup(m,null,Dr(f.attrs,s-p,f.attrs.colspan-(s-p))),n.insert(m+f.nodeSize,f.type.createAndFill(Dr(f.attrs,0,s-p))),u+=f.attrs.rowspan-1}}return c}a(Vp,"isolateVertical");function Wp(n,e,t,r,i){let o=t?n.doc.nodeAt(t-1):n.doc;if(!o)throw new Error("No table found");let s=xe.get(o);const{top:l,left:c}=r,u=c+i.width,h=l+i.height,d=n.tr;let f=0;function p(){if(o=t?d.doc.nodeAt(t-1):d.doc,!o)throw new Error("No table found");s=xe.get(o),f=d.mapping.maps.length}a(p,"recomp"),TT(d,s,o,t,u,h,f)&&p(),jp(d,s,o,t,c,u,l,f)&&p(),jp(d,s,o,t,c,u,h,f)&&p(),Vp(d,s,o,t,l,h,c,f)&&p(),Vp(d,s,o,t,l,h,u,f)&&p();for(let m=l;m<h;m++){const g=s.positionAt(m,c,o),k=s.positionAt(m,u,o);d.replace(d.mapping.slice(f).map(g+t),d.mapping.slice(f).map(k+t),new U(i.rows[m-l],0,0))}p(),d.setSelection(new Me(d.doc.resolve(t+s.positionAt(l,c,o)),d.doc.resolve(t+s.positionAt(h-1,u-1,o)))),e(d)}a(Wp,"insertCells");var $T=Ay({ArrowLeft:$s("horiz",-1),ArrowRight:$s("horiz",1),ArrowUp:$s("vert",-1),ArrowDown:$s("vert",1),"Shift-ArrowLeft":As("horiz",-1),"Shift-ArrowRight":As("horiz",1),"Shift-ArrowUp":As("vert",-1),"Shift-ArrowDown":As("vert",1),Backspace:Is,"Mod-Backspace":Is,Delete:Is,"Mod-Delete":Is});function cl(n,e,t){return t.eq(n.selection)?!1:(e&&e(n.tr.setSelection(t).scrollIntoView()),!0)}a(cl,"maybeSetSelection");function $s(n,e){return(t,r,i)=>{if(!i)return!1;const o=t.selection;if(o instanceof Me)return cl(t,r,te.near(o.$headCell,e));if(n!="horiz"&&!o.empty)return!1;const s=m1(i,n,e);if(s==null)return!1;if(n=="horiz")return cl(t,r,te.near(t.doc.resolve(o.head+e),e));{const l=t.doc.resolve(s),c=f1(l,n,e);let u;return c?u=te.near(c,1):e<0?u=te.near(t.doc.resolve(l.before(-1)),-1):u=te.near(t.doc.resolve(l.after(-1)),1),cl(t,r,u)}}}a($s,"arrow");function As(n,e){return(t,r,i)=>{if(!i)return!1;const o=t.selection;let s;if(o instanceof Me)s=o;else{const c=m1(i,n,e);if(c==null)return!1;s=new Me(t.doc.resolve(c))}const l=f1(s.$headCell,n,e);return l?cl(t,r,new Me(s.$anchorCell,l)):!1}}a(As,"shiftArrow");function Is(n,e){const t=n.selection;if(!(t instanceof Me))return!1;if(e){const r=n.tr,i=Tt(n.schema).cell.createAndFill().content;t.forEachCell((o,s)=>{o.content.eq(i)||r.replace(r.mapping.map(s+1),r.mapping.map(s+o.nodeSize-1),new U(i,0,0))}),r.docChanged&&e(r)}return!0}a(Is,"deleteCellSelection");function AT(n,e){const t=n.state.doc,r=ks(t.resolve(e));return r?(n.dispatch(n.state.tr.setSelection(new Me(r))),!0):!1}a(AT,"handleTripleClick");function IT(n,e,t){if(!ct(n.state))return!1;let r=vT(t);const i=n.state.selection;if(i instanceof Me){r||(r={width:1,height:1,rows:[P.from(Nu(Tt(n.state.schema).cell,t))]});const o=i.$anchorCell.node(-1),s=i.$anchorCell.start(-1),l=xe.get(o).rectBetween(i.$anchorCell.pos-s,i.$headCell.pos-s);return r=MT(r,l.right-l.left,l.bottom-l.top),Wp(n.state,n.dispatch,s,l,r),!0}else if(r){const o=da(n.state),s=o.start(-1);return Wp(n.state,n.dispatch,s,xe.get(o.node(-1)).findCell(o.pos-s),r),!0}else return!1}a(IT,"handlePaste");function ET(n,e){var t;if(e.ctrlKey||e.metaKey)return;const r=qp(n,e.target);let i;if(e.shiftKey&&n.state.selection instanceof Me)o(n.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&r&&(i=ks(n.state.selection.$anchor))!=null&&((t=oc(n,e))==null?void 0:t.pos)!=i.pos)o(i,e),e.preventDefault();else if(!r)return;function o(c,u){let h=oc(n,u);const d=_n.getState(n.state)==null;if(!h||!Kh(c,h))if(d)h=c;else return;const f=new Me(c,h);if(d||!n.state.selection.eq(f)){const p=n.state.tr.setSelection(f);d&&p.setMeta(_n,c.pos),n.dispatch(p)}}a(o,"setCellSelection");function s(){n.root.removeEventListener("mouseup",s),n.root.removeEventListener("dragstart",s),n.root.removeEventListener("mousemove",l),_n.getState(n.state)!=null&&n.dispatch(n.state.tr.setMeta(_n,-1))}a(s,"stop");function l(c){const u=c,h=_n.getState(n.state);let d;if(h!=null)d=n.state.doc.resolve(h);else if(qp(n,u.target)!=r&&(d=oc(n,e),!d))return s();d&&o(d,u)}a(l,"move"),n.root.addEventListener("mouseup",s),n.root.addEventListener("dragstart",s),n.root.addEventListener("mousemove",l)}a(ET,"handleMouseDown");function m1(n,e,t){if(!(n.state.selection instanceof de))return null;const{$head:r}=n.state.selection;for(let i=r.depth-1;i>=0;i--){const o=r.node(i);if((t<0?r.index(i):r.indexAfter(i))!=(t<0?0:o.childCount))return null;if(o.type.spec.tableRole=="cell"||o.type.spec.tableRole=="header_cell"){const l=r.before(i),c=e=="vert"?t>0?"down":"up":t>0?"right":"left";return n.endOfTextblock(c)?l:null}}return null}a(m1,"atEndOfCell");function qp(n,e){for(;e&&e!=n.dom;e=e.parentNode)if(e.nodeName=="TD"||e.nodeName=="TH")return e;return null}a(qp,"domInCell");function oc(n,e){const t=n.posAtCoords({left:e.clientX,top:e.clientY});return t&&t?ks(n.state.doc.resolve(t.pos)):null}a(oc,"cellUnderMouse");var ss,OT=(ss=class{constructor(e,t){this.node=e,this.cellMinWidth=t,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Mu(e,this.colgroup,this.table,t),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!=this.node.type?!1:(this.node=e,Mu(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){return e.type=="attributes"&&(e.target==this.table||this.colgroup.contains(e.target))}},a(ss,"TableView"),ss);function Mu(n,e,t,r,i,o){var s;let l=0,c=!0,u=e.firstChild;const h=n.firstChild;if(h){for(let d=0,f=0;d<h.childCount;d++){const{colspan:p,colwidth:m}=h.child(d).attrs;for(let g=0;g<p;g++,f++){const k=i==f?o:m&&m[g],b=k?k+"px":"";l+=k||r,k||(c=!1),u?(u.style.width!=b&&(u.style.width=b),u=u.nextSibling):e.appendChild(document.createElement("col")).style.width=b}}for(;u;){const d=u.nextSibling;(s=u.parentNode)==null||s.removeChild(u),u=d}c?(t.style.width=l+"px",t.style.minWidth=""):(t.style.width="",t.style.minWidth=l+"px")}}a(Mu,"updateColumnsOnResize");var Ct=new Ge("tableColumnResizing");function _T({handleWidth:n=5,cellMinWidth:e=25,View:t=OT,lastColumnResizable:r=!0}={}){const i=new Xe({key:Ct,state:{init(o,s){return i.spec.props.nodeViews[Tt(s.schema).table.name]=(l,c)=>new t(l,e,c),new DT(-1,!1)},apply(o,s){return s.apply(o)}},props:{attributes:o=>{const s=Ct.getState(o);return s&&s.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(o,s)=>{RT(o,s,n,e,r)},mouseleave:o=>{zT(o)},mousedown:(o,s)=>{PT(o,s,e)}},decorations:o=>{const s=Ct.getState(o);if(s&&s.activeHandle>-1)return VT(o,s.activeHandle)},nodeViews:{}}});return i}a(_T,"columnResizing");var zn,DT=(zn=class{constructor(e,t){this.activeHandle=e,this.dragging=t}apply(e){const t=this,r=e.getMeta(Ct);if(r&&r.setHandle!=null)return new zn(r.setHandle,!1);if(r&&r.setDragging!==void 0)return new zn(t.activeHandle,r.setDragging);if(t.activeHandle>-1&&e.docChanged){let i=e.mapping.map(t.activeHandle,-1);return vu(e.doc.resolve(i))||(i=-1),new zn(i,t.dragging)}return t}},a(zn,"_ResizeState"),zn);function RT(n,e,t,r,i){const o=Ct.getState(n.state);if(o&&!o.dragging){const s=LT(e.target);let l=-1;if(s){const{left:c,right:u}=s.getBoundingClientRect();e.clientX-c<=t?l=Kp(n,e,"left",t):u-e.clientX<=t&&(l=Kp(n,e,"right",t))}if(l!=o.activeHandle){if(!i&&l!==-1){const c=n.state.doc.resolve(l),u=c.node(-1),h=xe.get(u),d=c.start(-1);if(h.colCount(c.pos-d)+c.nodeAfter.attrs.colspan-1==h.width-1)return}g1(n,l)}}}a(RT,"handleMouseMove");function zT(n){const e=Ct.getState(n.state);e&&e.activeHandle>-1&&!e.dragging&&g1(n,-1)}a(zT,"handleMouseLeave");function PT(n,e,t){var r;const i=(r=n.dom.ownerDocument.defaultView)!=null?r:window,o=Ct.getState(n.state);if(!o||o.activeHandle==-1||o.dragging)return!1;const s=n.state.doc.nodeAt(o.activeHandle),l=FT(n,o.activeHandle,s.attrs);n.dispatch(n.state.tr.setMeta(Ct,{setDragging:{startX:e.clientX,startWidth:l}}));function c(h){i.removeEventListener("mouseup",c),i.removeEventListener("mousemove",u);const d=Ct.getState(n.state);d?.dragging&&(BT(n,d.activeHandle,Up(d.dragging,h,t)),n.dispatch(n.state.tr.setMeta(Ct,{setDragging:null})))}a(c,"finish");function u(h){if(!h.which)return c(h);const d=Ct.getState(n.state);if(d&&d.dragging){const f=Up(d.dragging,h,t);HT(n,d.activeHandle,f,t)}}return a(u,"move"),i.addEventListener("mouseup",c),i.addEventListener("mousemove",u),e.preventDefault(),!0}a(PT,"handleMouseDown2");function FT(n,e,{colspan:t,colwidth:r}){const i=r&&r[r.length-1];if(i)return i;const o=n.domAtPos(e);let l=o.node.childNodes[o.offset].offsetWidth,c=t;if(r)for(let u=0;u<t;u++)r[u]&&(l-=r[u],c--);return l/c}a(FT,"currentColWidth");function LT(n){for(;n&&n.nodeName!="TD"&&n.nodeName!="TH";)n=n.classList&&n.classList.contains("ProseMirror")?null:n.parentNode;return n}a(LT,"domCellAround");function Kp(n,e,t,r){const i=t=="right"?-r:r,o=n.posAtCoords({left:e.clientX+i,top:e.clientY});if(!o)return-1;const{pos:s}=o,l=ks(n.state.doc.resolve(s));if(!l)return-1;if(t=="right")return l.pos;const c=xe.get(l.node(-1)),u=l.start(-1),h=c.map.indexOf(l.pos-u);return h%c.width==0?-1:u+c.map[h-1]}a(Kp,"edgeCell");function Up(n,e,t){const r=e.clientX-n.startX;return Math.max(t,n.startWidth+r)}a(Up,"draggedWidth");function g1(n,e){n.dispatch(n.state.tr.setMeta(Ct,{setHandle:e}))}a(g1,"updateHandle");function BT(n,e,t){const r=n.state.doc.resolve(e),i=r.node(-1),o=xe.get(i),s=r.start(-1),l=o.colCount(r.pos-s)+r.nodeAfter.attrs.colspan-1,c=n.state.tr;for(let u=0;u<o.height;u++){const h=u*o.width+l;if(u&&o.map[h]==o.map[h-o.width])continue;const d=o.map[h],f=i.nodeAt(d).attrs,p=f.colspan==1?0:l-o.colCount(d);if(f.colwidth&&f.colwidth[p]==t)continue;const m=f.colwidth?f.colwidth.slice():jT(f.colspan);m[p]=t,c.setNodeMarkup(s+d,null,{...f,colwidth:m})}c.docChanged&&n.dispatch(c)}a(BT,"updateColumnWidth");function HT(n,e,t,r){const i=n.state.doc.resolve(e),o=i.node(-1),s=i.start(-1),l=xe.get(o).colCount(i.pos-s)+i.nodeAfter.attrs.colspan-1;let c=n.domAtPos(i.start(-1)).node;for(;c&&c.nodeName!="TABLE";)c=c.parentNode;c&&Mu(o,c.firstChild,c,r,l,t)}a(HT,"displayColumnWidth");function jT(n){return Array(n).fill(0)}a(jT,"zeroes");function VT(n,e){const t=[],r=n.doc.resolve(e),i=r.node(-1);if(!i)return Ke.empty;const o=xe.get(i),s=r.start(-1),l=o.colCount(r.pos-s)+r.nodeAfter.attrs.colspan;for(let c=0;c<o.height;c++){const u=l+c*o.width-1;if((l==o.width||o.map[u]!=o.map[u+1])&&(c==0||o.map[u]!=o.map[u-o.width])){const h=o.map[u],d=s+h+i.nodeAt(h).nodeSize-1,f=document.createElement("div");f.className="column-resize-handle",t.push(Mt.widget(d,f))}}return Ke.create(n.doc,t)}a(VT,"handleDecorations");function Un(n){const e=n.selection,t=da(n),r=t.node(-1),i=t.start(-1),o=xe.get(r);return{...e instanceof Me?o.rectBetween(e.$anchorCell.pos-i,e.$headCell.pos-i):o.findCell(t.pos-i),tableStart:i,map:o,table:r}}a(Un,"selectedRect");function y1(n,{map:e,tableStart:t,table:r},i){let o=i>0?-1:0;mT(e,r,i+o)&&(o=i==0||i==e.width?null:0);for(let s=0;s<e.height;s++){const l=s*e.width+i;if(i>0&&i<e.width&&e.map[l-1]==e.map[l]){const c=e.map[l],u=r.nodeAt(c);n.setNodeMarkup(n.mapping.map(t+c),null,pT(u.attrs,i-e.colCount(c))),s+=u.attrs.rowspan-1}else{const c=o==null?Tt(r.type.schema).cell:r.nodeAt(e.map[l+o]).type,u=e.positionAt(s,i,r);n.insert(n.mapping.map(t+u),c.createAndFill())}}return n}a(y1,"addColumn");function WT(n,e){if(!ct(n))return!1;if(e){const t=Un(n);e(y1(n.tr,t,t.left))}return!0}a(WT,"addColumnBefore");function qT(n,e){if(!ct(n))return!1;if(e){const t=Un(n);e(y1(n.tr,t,t.right))}return!0}a(qT,"addColumnAfter");function KT(n,{map:e,table:t,tableStart:r},i){const o=n.mapping.maps.length;for(let s=0;s<e.height;){const l=s*e.width+i,c=e.map[l],u=t.nodeAt(c),h=u.attrs;if(i>0&&e.map[l-1]==c||i<e.width-1&&e.map[l+1]==c)n.setNodeMarkup(n.mapping.slice(o).map(r+c),null,Dr(h,i-e.colCount(c)));else{const d=n.mapping.slice(o).map(r+c);n.delete(d,d+u.nodeSize)}s+=h.rowspan}}a(KT,"removeColumn");function UT(n,e){if(!ct(n))return!1;if(e){const t=Un(n),r=n.tr;if(t.left==0&&t.right==t.map.width)return!1;for(let i=t.right-1;KT(r,t,i),i!=t.left;i--){const o=t.tableStart?r.doc.nodeAt(t.tableStart-1):r.doc;if(!o)throw RangeError("No table found");t.table=o,t.map=xe.get(o)}e(r)}return!0}a(UT,"deleteColumn");function JT(n,{map:e,table:t,tableStart:r},i){let o=0;for(let u=0;u<i;u++)o+=t.child(u).nodeSize;const s=o+t.child(i).nodeSize,l=n.mapping.maps.length;n.delete(o+r,s+r);const c=new Set;for(let u=0,h=i*e.width;u<e.width;u++,h++){const d=e.map[h];if(!c.has(d)){if(c.add(d),i>0&&d==e.map[h-e.width]){const f=t.nodeAt(d).attrs;n.setNodeMarkup(n.mapping.slice(l).map(d+r),null,{...f,rowspan:f.rowspan-1}),u+=f.colspan-1}else if(i<e.height&&d==e.map[h+e.width]){const f=t.nodeAt(d),p=f.attrs,m=f.type.create({...p,rowspan:f.attrs.rowspan-1},f.content),g=e.positionAt(i+1,u,t);n.insert(n.mapping.slice(l).map(r+g),m),u+=p.colspan-1}}}}a(JT,"removeRow");function ZT(n,e){if(!ct(n))return!1;if(e){const t=Un(n),r=n.tr;if(t.top==0&&t.bottom==t.map.height)return!1;for(let i=t.bottom-1;JT(r,t,i),i!=t.top;i--){const o=t.tableStart?r.doc.nodeAt(t.tableStart-1):r.doc;if(!o)throw RangeError("No table found");t.table=o,t.map=xe.get(t.table)}e(r)}return!0}a(ZT,"deleteRow");function GT(n,e){return function(t,r){if(!ct(t))return!1;const i=da(t);if(i.nodeAfter.attrs[n]===e)return!1;if(r){const o=t.tr;t.selection instanceof Me?t.selection.forEachCell((s,l)=>{s.attrs[n]!==e&&o.setNodeMarkup(l,null,{...s.attrs,[n]:e})}):o.setNodeMarkup(i.pos,null,{...i.nodeAfter.attrs,[n]:e}),r(o)}return!0}}a(GT,"setCellAttr");function YT(n){return function(e,t){if(!ct(e))return!1;if(t){const r=Tt(e.schema),i=Un(e),o=e.tr,s=i.map.cellsInRect(n=="column"?{left:i.left,top:0,right:i.right,bottom:i.map.height}:n=="row"?{left:0,top:i.top,right:i.map.width,bottom:i.bottom}:i),l=s.map(c=>i.table.nodeAt(c));for(let c=0;c<s.length;c++)l[c].type==r.header_cell&&o.setNodeMarkup(i.tableStart+s[c],r.cell,l[c].attrs);if(o.steps.length==0)for(let c=0;c<s.length;c++)o.setNodeMarkup(i.tableStart+s[c],r.header_cell,l[c].attrs);t(o)}return!0}}a(YT,"deprecated_toggleHeader");function Jp(n,e,t){const r=e.map.cellsInRect({left:0,top:0,right:n=="row"?e.map.width:1,bottom:n=="column"?e.map.height:1});for(let i=0;i<r.length;i++){const o=e.table.nodeAt(r[i]);if(o&&o.type!==t.header_cell)return!1}return!0}a(Jp,"isHeaderEnabledByType");function Uh(n,e){return e=e||{useDeprecatedLogic:!1},e.useDeprecatedLogic?YT(n):function(t,r){if(!ct(t))return!1;if(r){const i=Tt(t.schema),o=Un(t),s=t.tr,l=Jp("row",o,i),c=Jp("column",o,i),h=(n==="column"?l:n==="row"?c:!1)?1:0,d=n=="column"?{left:0,top:h,right:1,bottom:o.map.height}:n=="row"?{left:h,top:0,right:o.map.width,bottom:1}:o,f=n=="column"?c?i.cell:i.header_cell:n=="row"?l?i.cell:i.header_cell:i.cell;o.map.cellsInRect(d).forEach(p=>{const m=p+o.tableStart,g=s.doc.nodeAt(m);g&&s.setNodeMarkup(m,f,g.attrs)}),r(s)}return!0}}a(Uh,"toggleHeader");Uh("row",{useDeprecatedLogic:!0});Uh("column",{useDeprecatedLogic:!0});Uh("cell",{useDeprecatedLogic:!0});function QT(n,e){if(e<0){const t=n.nodeBefore;if(t)return n.pos-t.nodeSize;for(let r=n.index(-1)-1,i=n.before();r>=0;r--){const o=n.node(-1).child(r),s=o.lastChild;if(s)return i-1-s.nodeSize;i-=o.nodeSize}}else{if(n.index()<n.parent.childCount-1)return n.pos+n.nodeAfter.nodeSize;const t=n.node(-1);for(let r=n.indexAfter(-1),i=n.after();r<t.childCount;r++){const o=t.child(r);if(o.childCount)return i+1;i+=o.nodeSize}}return null}a(QT,"findNextCell");function k1(n){return function(e,t){if(!ct(e))return!1;const r=QT(da(e),n);if(r==null)return!1;if(t){const i=e.doc.resolve(r);t(e.tr.setSelection(de.between(i,fT(i))).scrollIntoView())}return!0}}a(k1,"goToNextCell");function XT(n,e){const t=n.selection.$anchor;for(let r=t.depth;r>0;r--)if(t.node(r).type.spec.tableRole=="table")return e&&e(n.tr.delete(t.before(r),t.after(r)).scrollIntoView()),!0;return!1}a(XT,"deleteTable");function e$({allowTableNodeSelection:n=!1}={}){return new Xe({key:_n,state:{init(){return null},apply(e,t){const r=e.getMeta(_n);if(r!=null)return r==-1?null:r;if(t==null||!e.docChanged)return t;const{deleted:i,pos:o}=e.mapping.mapResult(t);return i?null:o}},props:{decorations:yT,handleDOMEvents:{mousedown:ET},createSelectionBetween(e){return _n.getState(e.state)!=null?e.state.selection:null},handleTripleClick:AT,handleKeyDown:$T,handlePaste:IT},appendTransaction(e,t,r){return xT(r,CT(r,t),n)}})}a(e$,"tableEditing");function Zp(n,e){const t=String(n);if(typeof e!="string")throw new TypeError("Expected character");let r=0,i=t.indexOf(e);for(;i!==-1;)r++,i=t.indexOf(e,i+e.length);return r}a(Zp,"ccount");const t$=b1(/\p{P}|\p{S}/u),n$=b1(/\s/);function b1(n){return e;function e(t){return t!==null&&t>-1&&n.test(String.fromCharCode(t))}}a(b1,"regexCheck$2");function r$(n){if(typeof n!="string")throw new TypeError("Expected a string");return n.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}a(r$,"escapeStringRegexp");const Jh=a(function(n){if(n==null)return l$;if(typeof n=="function")return fa(n);if(typeof n=="object")return Array.isArray(n)?i$(n):o$(n);if(typeof n=="string")return s$(n);throw new Error("Expected function, string, or object as test")},"convert");function i$(n){const e=[];let t=-1;for(;++t<n.length;)e[t]=Jh(n[t]);return fa(r);function r(...i){let o=-1;for(;++o<e.length;)if(e[o].apply(this,i))return!0;return!1}}a(i$,"anyFactory");function o$(n){const e=n;return fa(t);function t(r){const i=r;let o;for(o in n)if(i[o]!==e[o])return!1;return!0}}a(o$,"propsFactory");function s$(n){return fa(e);function e(t){return t&&t.type===n}}a(s$,"typeFactory");function fa(n){return e;function e(t,r,i){return!!(a$(t)&&n.call(this,t,typeof r=="number"?r:void 0,i||void 0))}}a(fa,"castFactory");function l$(){return!0}a(l$,"ok");function a$(n){return n!==null&&typeof n=="object"&&"type"in n}a(a$,"looksLikeANode");const x1=[],c$=!0,Gp=!1,u$="skip";function h$(n,e,t,r){let i;typeof e=="function"&&typeof t!="function"?(r=t,t=e):i=e;const o=Jh(i),s=r?-1:1;l(n,void 0,[])();function l(c,u,h){const d=c&&typeof c=="object"?c:{};if(typeof d.type=="string"){const p=typeof d.tagName=="string"?d.tagName:typeof d.name=="string"?d.name:void 0;Object.defineProperty(f,"name",{value:"node ("+(c.type+(p?"<"+p+">":""))+")"})}return f;function f(){let p=x1,m,g,k;if((!e||o(c,u,h[h.length-1]||void 0))&&(p=d$(t(c,h)),p[0]===Gp))return p;if("children"in c&&c.children){const b=c;if(b.children&&p[0]!==u$)for(g=(r?b.children.length:-1)+s,k=h.concat(b);g>-1&&g<b.children.length;){const x=b.children[g];if(m=l(x,g,k)(),m[0]===Gp)return m;g=typeof m[1]=="number"?m[1]:g+s}}return p}}a(l,"factory")}a(h$,"visitParents");function d$(n){return Array.isArray(n)?n:typeof n=="number"?[c$,n]:n==null?x1:[n]}a(d$,"toResult");function f$(n,e,t){const i=Jh((t||{}).ignore||[]),o=p$(e);let s=-1;for(;++s<o.length;)h$(n,"text",l);function l(u,h){let d=-1,f;for(;++d<h.length;){const p=h[d],m=f?f.children:void 0;if(i(p,m?m.indexOf(p):void 0,f))return;f=p}if(f)return c(u,h)}a(l,"visitor");function c(u,h){const d=h[h.length-1],f=o[s][0],p=o[s][1];let m=0;const k=d.children.indexOf(u);let b=!1,x=[];f.lastIndex=0;let C=f.exec(u.value);for(;C;){const N=C.index,A={index:C.index,input:C.input,stack:[...h,u]};let S=p(...C,A);if(typeof S=="string"&&(S=S.length>0?{type:"text",value:S}:void 0),S===!1?f.lastIndex=N+1:(m!==N&&x.push({type:"text",value:u.value.slice(m,N)}),Array.isArray(S)?x.push(...S):S&&x.push(S),m=N+C[0].length,b=!0),!f.global)break;C=f.exec(u.value)}return b?(m<u.value.length&&x.push({type:"text",value:u.value.slice(m)}),d.children.splice(k,1,...x)):x=[u],k+x.length}a(c,"handler")}a(f$,"findAndReplace");function p$(n){const e=[];if(!Array.isArray(n))throw new TypeError("Expected find and replace tuple or list of tuples");const t=!n[0]||Array.isArray(n[0])?n:[n];let r=-1;for(;++r<t.length;){const i=t[r];e.push([m$(i[0]),g$(i[1])])}return e}a(p$,"toPairs");function m$(n){return typeof n=="string"?new RegExp(r$(n),"g"):n}a(m$,"toExpression");function g$(n){return typeof n=="function"?n:function(){return n}}a(g$,"toFunction");const sc="phrasing",lc=["autolink","link","image","label"];function y$(){return{transforms:[v$],enter:{literalAutolink:b$,literalAutolinkEmail:ac,literalAutolinkHttp:ac,literalAutolinkWww:ac},exit:{literalAutolink:S$,literalAutolinkEmail:C$,literalAutolinkHttp:x$,literalAutolinkWww:w$}}}a(y$,"gfmAutolinkLiteralFromMarkdown");function k$(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:sc,notInConstruct:lc},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:sc,notInConstruct:lc},{character:":",before:"[ps]",after:"\\/",inConstruct:sc,notInConstruct:lc}]}}a(k$,"gfmAutolinkLiteralToMarkdown");function b$(n){this.enter({type:"link",title:null,url:"",children:[]},n)}a(b$,"enterLiteralAutolink");function ac(n){this.config.enter.autolinkProtocol.call(this,n)}a(ac,"enterLiteralAutolinkValue");function x$(n){this.config.exit.autolinkProtocol.call(this,n)}a(x$,"exitLiteralAutolinkHttp");function w$(n){this.config.exit.data.call(this,n);const e=this.stack[this.stack.length-1];e.type,e.url="http://"+this.sliceSerialize(n)}a(w$,"exitLiteralAutolinkWww");function C$(n){this.config.exit.autolinkEmail.call(this,n)}a(C$,"exitLiteralAutolinkEmail");function S$(n){this.exit(n)}a(S$,"exitLiteralAutolink");function v$(n){f$(n,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,N$],[/([-.\w+]+)@([-\w]+(?:\.[-\w]+)+)/g,M$]],{ignore:["link","linkReference"]})}a(v$,"transformGfmAutolinkLiterals");function N$(n,e,t,r,i){let o="";if(!w1(i)||(/^w/i.test(e)&&(t=e+t,e="",o="http://"),!T$(t)))return!1;const s=$$(t+r);if(!s[0])return!1;const l={type:"link",title:null,url:o+e+s[0],children:[{type:"text",value:e+s[0]}]};return s[1]?[l,{type:"text",value:s[1]}]:l}a(N$,"findUrl");function M$(n,e,t,r){return!w1(r,!0)||/[-\d_]$/.test(t)?!1:{type:"link",title:null,url:"mailto:"+e+"@"+t,children:[{type:"text",value:e+"@"+t}]}}a(M$,"findEmail");function T$(n){const e=n.split(".");return!(e.length<2||e[e.length-1]&&(/_/.test(e[e.length-1])||!/[a-zA-Z\d]/.test(e[e.length-1]))||e[e.length-2]&&(/_/.test(e[e.length-2])||!/[a-zA-Z\d]/.test(e[e.length-2])))}a(T$,"isCorrectDomain");function $$(n){const e=/[!"&'),.:;<>?\]}]+$/.exec(n);if(!e)return[n,void 0];n=n.slice(0,e.index);let t=e[0],r=t.indexOf(")");const i=Zp(n,"(");let o=Zp(n,")");for(;r!==-1&&i>o;)n+=t.slice(0,r+1),t=t.slice(r+1),r=t.indexOf(")"),o++;return[n,t]}a($$,"splitUrl");function w1(n,e){const t=n.input.charCodeAt(n.index-1);return(n.index===0||n$(t)||t$(t))&&(!e||t!==47)}a(w1,"previous");function C1(n){return n.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}a(C1,"normalizeIdentifier$1");S1.peek=L$;function A$(){return{enter:{gfmFootnoteDefinition:E$,gfmFootnoteDefinitionLabelString:O$,gfmFootnoteCall:R$,gfmFootnoteCallString:z$},exit:{gfmFootnoteDefinition:D$,gfmFootnoteDefinitionLabelString:_$,gfmFootnoteCall:F$,gfmFootnoteCallString:P$}}}a(A$,"gfmFootnoteFromMarkdown");function I$(){return{unsafe:[{character:"[",inConstruct:["phrasing","label","reference"]}],handlers:{footnoteDefinition:B$,footnoteReference:S1}}}a(I$,"gfmFootnoteToMarkdown");function E$(n){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},n)}a(E$,"enterFootnoteDefinition");function O$(){this.buffer()}a(O$,"enterFootnoteDefinitionLabelString");function _$(n){const e=this.resume(),t=this.stack[this.stack.length-1];t.type,t.label=e,t.identifier=C1(this.sliceSerialize(n)).toLowerCase()}a(_$,"exitFootnoteDefinitionLabelString");function D$(n){this.exit(n)}a(D$,"exitFootnoteDefinition");function R$(n){this.enter({type:"footnoteReference",identifier:"",label:""},n)}a(R$,"enterFootnoteCall");function z$(){this.buffer()}a(z$,"enterFootnoteCallString");function P$(n){const e=this.resume(),t=this.stack[this.stack.length-1];t.type,t.label=e,t.identifier=C1(this.sliceSerialize(n)).toLowerCase()}a(P$,"exitFootnoteCallString");function F$(n){this.exit(n)}a(F$,"exitFootnoteCall");function S1(n,e,t,r){const i=t.createTracker(r);let o=i.move("[^");const s=t.enter("footnoteReference"),l=t.enter("reference");return o+=i.move(t.safe(t.associationId(n),{...i.current(),before:o,after:"]"})),l(),s(),o+=i.move("]"),o}a(S1,"footnoteReference");function L$(){return"["}a(L$,"footnoteReferencePeek");function B$(n,e,t,r){const i=t.createTracker(r);let o=i.move("[^");const s=t.enter("footnoteDefinition"),l=t.enter("label");return o+=i.move(t.safe(t.associationId(n),{...i.current(),before:o,after:"]"})),l(),o+=i.move("]:"+(n.children&&n.children.length>0?" ":"")),i.shift(4),o+=i.move(t.indentLines(t.containerFlow(n,i.current()),H$)),s(),o}a(B$,"footnoteDefinition");function H$(n,e,t){return e===0?n:(t?"":"    ")+n}a(H$,"map");const j$=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];v1.peek=U$;function V$(){return{canContainEols:["delete"],enter:{strikethrough:q$},exit:{strikethrough:K$}}}a(V$,"gfmStrikethroughFromMarkdown");function W$(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:j$}],handlers:{delete:v1}}}a(W$,"gfmStrikethroughToMarkdown");function q$(n){this.enter({type:"delete",children:[]},n)}a(q$,"enterStrikethrough");function K$(n){this.exit(n)}a(K$,"exitStrikethrough");function v1(n,e,t,r){const i=t.createTracker(r),o=t.enter("strikethrough");let s=i.move("~~");return s+=t.containerPhrasing(n,{...i.current(),before:s,after:"~"}),s+=i.move("~~"),o(),s}a(v1,"handleDelete");function U$(){return"~"}a(U$,"peekDelete");function J$(n,e={}){const t=(e.align||[]).concat(),r=e.stringLength||G$,i=[],o=[],s=[],l=[];let c=0,u=-1;for(;++u<n.length;){const m=[],g=[];let k=-1;for(n[u].length>c&&(c=n[u].length);++k<n[u].length;){const b=Z$(n[u][k]);if(e.alignDelimiters!==!1){const x=r(b);g[k]=x,(l[k]===void 0||x>l[k])&&(l[k]=x)}m.push(b)}o[u]=m,s[u]=g}let h=-1;if(typeof t=="object"&&"length"in t)for(;++h<c;)i[h]=Yp(t[h]);else{const m=Yp(t);for(;++h<c;)i[h]=m}h=-1;const d=[],f=[];for(;++h<c;){const m=i[h];let g="",k="";m===99?(g=":",k=":"):m===108?g=":":m===114&&(k=":");let b=e.alignDelimiters===!1?1:Math.max(1,l[h]-g.length-k.length);const x=g+"-".repeat(b)+k;e.alignDelimiters!==!1&&(b=g.length+b+k.length,b>l[h]&&(l[h]=b),f[h]=b),d[h]=x}o.splice(1,0,d),s.splice(1,0,f),u=-1;const p=[];for(;++u<o.length;){const m=o[u],g=s[u];h=-1;const k=[];for(;++h<c;){const b=m[h]||"";let x="",C="";if(e.alignDelimiters!==!1){const N=l[h]-(g[h]||0),A=i[h];A===114?x=" ".repeat(N):A===99?N%2?(x=" ".repeat(N/2+.5),C=" ".repeat(N/2-.5)):(x=" ".repeat(N/2),C=x):C=" ".repeat(N)}e.delimiterStart!==!1&&!h&&k.push("|"),e.padding!==!1&&!(e.alignDelimiters===!1&&b==="")&&(e.delimiterStart!==!1||h)&&k.push(" "),e.alignDelimiters!==!1&&k.push(x),k.push(b),e.alignDelimiters!==!1&&k.push(C),e.padding!==!1&&k.push(" "),(e.delimiterEnd!==!1||h!==c-1)&&k.push("|")}p.push(e.delimiterEnd===!1?k.join("").replace(/ +$/,""):k.join(""))}return p.join(`
`)}a(J$,"markdownTable");function Z$(n){return n==null?"":String(n)}a(Z$,"serialize");function G$(n){return n.length}a(G$,"defaultStringLength");function Yp(n){const e=typeof n=="string"?n.codePointAt(0):0;return e===67||e===99?99:e===76||e===108?108:e===82||e===114?114:0}a(Yp,"toAlignment");function Y$(){return{enter:{table:Q$,tableData:Qp,tableHeader:Qp,tableRow:eA},exit:{codeText:tA,table:X$,tableData:cc,tableHeader:cc,tableRow:cc}}}a(Y$,"gfmTableFromMarkdown");function Q$(n){const e=n._align;this.enter({type:"table",align:e.map(function(t){return t==="none"?null:t}),children:[]},n),this.data.inTable=!0}a(Q$,"enterTable");function X$(n){this.exit(n),this.data.inTable=void 0}a(X$,"exitTable");function eA(n){this.enter({type:"tableRow",children:[]},n)}a(eA,"enterRow");function cc(n){this.exit(n)}a(cc,"exit");function Qp(n){this.enter({type:"tableCell",children:[]},n)}a(Qp,"enterCell");function tA(n){let e=this.resume();this.data.inTable&&(e=e.replace(/\\([\\|])/g,nA));const t=this.stack[this.stack.length-1];t.type,t.value=e,this.exit(n)}a(tA,"exitCodeText");function nA(n,e){return e==="|"?e:n}a(nA,"replace");function rA(n){const e=n||{},t=e.tableCellPadding,r=e.tablePipeAlign,i=e.stringLength,o=t?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:f,table:s,tableCell:c,tableRow:l}};function s(p,m,g,k){return u(h(p,g,k),p.align)}function l(p,m,g,k){const b=d(p,g,k),x=u([b]);return x.slice(0,x.indexOf(`
`))}function c(p,m,g,k){const b=g.enter("tableCell"),x=g.enter("phrasing"),C=g.containerPhrasing(p,{...k,before:o,after:o});return x(),b(),C}function u(p,m){return J$(p,{align:m,alignDelimiters:r,padding:t,stringLength:i})}function h(p,m,g){const k=p.children;let b=-1;const x=[],C=m.enter("table");for(;++b<k.length;)x[b]=d(k[b],m,g);return C(),x}function d(p,m,g){const k=p.children;let b=-1;const x=[],C=m.enter("tableRow");for(;++b<k.length;)x[b]=c(k[b],p,m,g);return C(),x}function f(p,m,g){let k=Bu.inlineCode(p,m,g);return g.stack.includes("tableCell")&&(k=k.replace(/\|/g,"\\$&")),k}}a(rA,"gfmTableToMarkdown");function iA(){return{exit:{taskListCheckValueChecked:Xp,taskListCheckValueUnchecked:Xp,paragraph:sA}}}a(iA,"gfmTaskListItemFromMarkdown");function oA(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:lA}}}a(oA,"gfmTaskListItemToMarkdown");function Xp(n){const e=this.stack[this.stack.length-2];e.type,e.checked=n.type==="taskListCheckValueChecked"}a(Xp,"exitCheck");function sA(n){const e=this.stack[this.stack.length-2];if(e&&e.type==="listItem"&&typeof e.checked=="boolean"){const t=this.stack[this.stack.length-1];t.type;const r=t.children[0];if(r&&r.type==="text"){const i=e.children;let o=-1,s;for(;++o<i.length;){const l=i[o];if(l.type==="paragraph"){s=l;break}}s===t&&(r.value=r.value.slice(1),r.value.length===0?t.children.shift():t.position&&r.position&&typeof r.position.start.offset=="number"&&(r.position.start.column++,r.position.start.offset++,t.position.start=Object.assign({},r.position.start)))}}this.exit(n)}a(sA,"exitParagraphWithTaskListItem");function lA(n,e,t,r){const i=n.children[0],o=typeof n.checked=="boolean"&&i&&i.type==="paragraph",s="["+(n.checked?"x":" ")+"] ",l=t.createTracker(r);o&&l.move(s);let c=Bu.listItem(n,e,t,{...r,...l.current()});return o&&(c=c.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,u)),c;function u(h){return h+s}a(u,"check")}a(lA,"listItemWithTaskListItem");function aA(){return[y$(),A$(),V$(),Y$(),iA()]}a(aA,"gfmFromMarkdown");function cA(n){return{extensions:[k$(),I$(),W$(),rA(n),oA()]}}a(cA,"gfmToMarkdown");function uA(n,e,t,r){const i=n.length;let o=0,s;if(e<0?e=-e>i?0:i+e:e=e>i?i:e,t=t>0?t:0,r.length<1e4)s=Array.from(r),s.unshift(e,t),n.splice(...s);else for(t&&n.splice(e,t);o<r.length;)s=r.slice(o,o+1e4),s.unshift(e,0),n.splice(...s),o+=1e4,e+=1e4}a(uA,"splice$1");const em={}.hasOwnProperty;function hA(n){const e={};let t=-1;for(;++t<n.length;)dA(e,n[t]);return e}a(hA,"combineExtensions");function dA(n,e){let t;for(t in e){const i=(em.call(n,t)?n[t]:void 0)||(n[t]={}),o=e[t];let s;if(o)for(s in o){em.call(i,s)||(i[s]=[]);const l=o[s];fA(i[s],Array.isArray(l)?l:l?[l]:[])}}}a(dA,"syntaxExtension");function fA(n,e){let t=-1;const r=[];for(;++t<e.length;)(e[t].add==="after"?n:r).push(e[t]);uA(n,0,0,r)}a(fA,"constructs");const Bo=pa(/[A-Za-z]/),Zh=pa(/[\dA-Za-z]/);function pA(n){return n!==null&&(n<32||n===127)}a(pA,"asciiControl");function gi(n){return n!==null&&(n<0||n===32)}a(gi,"markdownLineEndingOrSpace$4");const N1=pa(/\p{P}|\p{S}/u),Ho=pa(/\s/);function pa(n){return e;function e(t){return t!==null&&t>-1&&n.test(String.fromCharCode(t))}}a(pa,"regexCheck$1");const mA={tokenize:wA,partial:!0},M1={tokenize:CA,partial:!0},T1={tokenize:SA,partial:!0},$1={tokenize:vA,partial:!0},gA={tokenize:NA,partial:!0},A1={tokenize:bA,previous:E1},I1={tokenize:xA,previous:O1},yn={tokenize:kA,previous:_1},Yt={};function yA(){return{text:Yt}}a(yA,"gfmAutolinkLiteral");let Qn=48;for(;Qn<123;)Yt[Qn]=yn,Qn++,Qn===58?Qn=65:Qn===91&&(Qn=97);Yt[43]=yn;Yt[45]=yn;Yt[46]=yn;Yt[95]=yn;Yt[72]=[yn,I1];Yt[104]=[yn,I1];Yt[87]=[yn,A1];Yt[119]=[yn,A1];function kA(n,e,t){const r=this;let i,o;return s;function s(d){return!Tu(d)||!_1.call(r,r.previous)||Gh(r.events)?t(d):(n.enter("literalAutolink"),n.enter("literalAutolinkEmail"),l(d))}function l(d){return Tu(d)?(n.consume(d),l):d===64?(n.consume(d),c):t(d)}function c(d){return d===46?n.check(gA,h,u)(d):d===45||d===95||Zh(d)?(o=!0,n.consume(d),c):h(d)}function u(d){return n.consume(d),i=!0,c}function h(d){return o&&i&&Bo(r.previous)?(n.exit("literalAutolinkEmail"),n.exit("literalAutolink"),e(d)):t(d)}}a(kA,"tokenizeEmailAutolink");function bA(n,e,t){const r=this;return i;function i(s){return s!==87&&s!==119||!E1.call(r,r.previous)||Gh(r.events)?t(s):(n.enter("literalAutolink"),n.enter("literalAutolinkWww"),n.check(mA,n.attempt(M1,n.attempt(T1,o),t),t)(s))}function o(s){return n.exit("literalAutolinkWww"),n.exit("literalAutolink"),e(s)}}a(bA,"tokenizeWwwAutolink");function xA(n,e,t){const r=this;let i="",o=!1;return s;function s(d){return(d===72||d===104)&&O1.call(r,r.previous)&&!Gh(r.events)?(n.enter("literalAutolink"),n.enter("literalAutolinkHttp"),i+=String.fromCodePoint(d),n.consume(d),l):t(d)}function l(d){if(Bo(d)&&i.length<5)return i+=String.fromCodePoint(d),n.consume(d),l;if(d===58){const f=i.toLowerCase();if(f==="http"||f==="https")return n.consume(d),c}return t(d)}function c(d){return d===47?(n.consume(d),o?u:(o=!0,c)):t(d)}function u(d){return d===null||pA(d)||gi(d)||Ho(d)||N1(d)?t(d):n.attempt(M1,n.attempt(T1,h),t)(d)}function h(d){return n.exit("literalAutolinkHttp"),n.exit("literalAutolink"),e(d)}}a(xA,"tokenizeProtocolAutolink");function wA(n,e,t){let r=0;return i;function i(s){return(s===87||s===119)&&r<3?(r++,n.consume(s),i):s===46&&r===3?(n.consume(s),o):t(s)}function o(s){return s===null?t(s):e(s)}}a(wA,"tokenizeWwwPrefix");function CA(n,e,t){let r,i,o;return s;function s(u){return u===46||u===95?n.check($1,c,l)(u):u===null||gi(u)||Ho(u)||u!==45&&N1(u)?c(u):(o=!0,n.consume(u),s)}function l(u){return u===95?r=!0:(i=r,r=void 0),n.consume(u),s}function c(u){return i||r||!o?t(u):e(u)}}a(CA,"tokenizeDomain");function SA(n,e){let t=0,r=0;return i;function i(s){return s===40?(t++,n.consume(s),i):s===41&&r<t?o(s):s===33||s===34||s===38||s===39||s===41||s===42||s===44||s===46||s===58||s===59||s===60||s===63||s===93||s===95||s===126?n.check($1,e,o)(s):s===null||gi(s)||Ho(s)?e(s):(n.consume(s),i)}function o(s){return s===41&&r++,n.consume(s),i}}a(SA,"tokenizePath");function vA(n,e,t){return r;function r(l){return l===33||l===34||l===39||l===41||l===42||l===44||l===46||l===58||l===59||l===63||l===95||l===126?(n.consume(l),r):l===38?(n.consume(l),o):l===93?(n.consume(l),i):l===60||l===null||gi(l)||Ho(l)?e(l):t(l)}function i(l){return l===null||l===40||l===91||gi(l)||Ho(l)?e(l):r(l)}function o(l){return Bo(l)?s(l):t(l)}function s(l){return l===59?(n.consume(l),r):Bo(l)?(n.consume(l),s):t(l)}}a(vA,"tokenizeTrail");function NA(n,e,t){return r;function r(o){return n.consume(o),i}function i(o){return Zh(o)?t(o):e(o)}}a(NA,"tokenizeEmailDomainDotTrail");function E1(n){return n===null||n===40||n===42||n===95||n===91||n===93||n===126||gi(n)}a(E1,"previousWww");function O1(n){return!Bo(n)}a(O1,"previousProtocol");function _1(n){return!(n===47||Tu(n))}a(_1,"previousEmail");function Tu(n){return n===43||n===45||n===46||n===95||Zh(n)}a(Tu,"gfmAtext");function Gh(n){let e=n.length,t=!1;for(;e--;){const r=n[e][1];if((r.type==="labelLink"||r.type==="labelImage")&&!r._balanced){t=!0;break}if(r._gfmAutolinkLiteralWalkedInto){t=!1;break}}return n.length>0&&!t&&(n[n.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),t}a(Gh,"previousUnbalanced");function MA(n){return n!==null&&n<-2}a(MA,"markdownLineEnding$2");function Fl(n){return n!==null&&(n<0||n===32)}a(Fl,"markdownLineEndingOrSpace$3");function $u(n){return n===-2||n===-1||n===32}a($u,"markdownSpace$2");function Yh(n,e,t,r){const i=r?r-1:Number.POSITIVE_INFINITY;let o=0;return s;function s(c){return $u(c)?(n.enter(t),l(c)):e(c)}function l(c){return $u(c)&&o++<i?(n.consume(c),l):(n.exit(t),e(c))}}a(Yh,"factorySpace$2");const TA={tokenize:$A,partial:!0};function $A(n,e,t){return r;function r(o){return $u(o)?Yh(n,i,"linePrefix")(o):i(o)}function i(o){return o===null||MA(o)?e(o):t(o)}}a($A,"tokenizeBlankLine");function Qh(n){return n.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}a(Qh,"normalizeIdentifier");const AA={tokenize:PA,partial:!0};function IA(){return{document:{91:{tokenize:DA,continuation:{tokenize:RA},exit:zA}},text:{91:{tokenize:_A},93:{add:"after",tokenize:EA,resolveTo:OA}}}}a(IA,"gfmFootnote");function EA(n,e,t){const r=this;let i=r.events.length;const o=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let s;for(;i--;){const c=r.events[i][1];if(c.type==="labelImage"){s=c;break}if(c.type==="gfmFootnoteCall"||c.type==="labelLink"||c.type==="label"||c.type==="image"||c.type==="link")break}return l;function l(c){if(!s||!s._balanced)return t(c);const u=Qh(r.sliceSerialize({start:s.end,end:r.now()}));return u.codePointAt(0)!==94||!o.includes(u.slice(1))?t(c):(n.enter("gfmFootnoteCallLabelMarker"),n.consume(c),n.exit("gfmFootnoteCallLabelMarker"),e(c))}}a(EA,"tokenizePotentialGfmFootnoteCall");function OA(n,e){let t=n.length;for(;t--;)if(n[t][1].type==="labelImage"&&n[t][0]==="enter"){n[t][1];break}n[t+1][1].type="data",n[t+3][1].type="gfmFootnoteCallLabelMarker";const r={type:"gfmFootnoteCall",start:Object.assign({},n[t+3][1].start),end:Object.assign({},n[n.length-1][1].end)},i={type:"gfmFootnoteCallMarker",start:Object.assign({},n[t+3][1].end),end:Object.assign({},n[t+3][1].end)};i.end.column++,i.end.offset++,i.end._bufferIndex++;const o={type:"gfmFootnoteCallString",start:Object.assign({},i.end),end:Object.assign({},n[n.length-1][1].start)},s={type:"chunkString",contentType:"string",start:Object.assign({},o.start),end:Object.assign({},o.end)},l=[n[t+1],n[t+2],["enter",r,e],n[t+3],n[t+4],["enter",i,e],["exit",i,e],["enter",o,e],["enter",s,e],["exit",s,e],["exit",o,e],n[n.length-2],n[n.length-1],["exit",r,e]];return n.splice(t,n.length-t+1,...l),n}a(OA,"resolveToPotentialGfmFootnoteCall");function _A(n,e,t){const r=this,i=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let o=0,s;return l;function l(d){return n.enter("gfmFootnoteCall"),n.enter("gfmFootnoteCallLabelMarker"),n.consume(d),n.exit("gfmFootnoteCallLabelMarker"),c}function c(d){return d!==94?t(d):(n.enter("gfmFootnoteCallMarker"),n.consume(d),n.exit("gfmFootnoteCallMarker"),n.enter("gfmFootnoteCallString"),n.enter("chunkString").contentType="string",u)}function u(d){if(o>999||d===93&&!s||d===null||d===91||Fl(d))return t(d);if(d===93){n.exit("chunkString");const f=n.exit("gfmFootnoteCallString");return i.includes(Qh(r.sliceSerialize(f)))?(n.enter("gfmFootnoteCallLabelMarker"),n.consume(d),n.exit("gfmFootnoteCallLabelMarker"),n.exit("gfmFootnoteCall"),e):t(d)}return Fl(d)||(s=!0),o++,n.consume(d),d===92?h:u}function h(d){return d===91||d===92||d===93?(n.consume(d),o++,u):u(d)}}a(_A,"tokenizeGfmFootnoteCall");function DA(n,e,t){const r=this,i=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let o,s=0,l;return c;function c(m){return n.enter("gfmFootnoteDefinition")._container=!0,n.enter("gfmFootnoteDefinitionLabel"),n.enter("gfmFootnoteDefinitionLabelMarker"),n.consume(m),n.exit("gfmFootnoteDefinitionLabelMarker"),u}function u(m){return m===94?(n.enter("gfmFootnoteDefinitionMarker"),n.consume(m),n.exit("gfmFootnoteDefinitionMarker"),n.enter("gfmFootnoteDefinitionLabelString"),n.enter("chunkString").contentType="string",h):t(m)}function h(m){if(s>999||m===93&&!l||m===null||m===91||Fl(m))return t(m);if(m===93){n.exit("chunkString");const g=n.exit("gfmFootnoteDefinitionLabelString");return o=Qh(r.sliceSerialize(g)),n.enter("gfmFootnoteDefinitionLabelMarker"),n.consume(m),n.exit("gfmFootnoteDefinitionLabelMarker"),n.exit("gfmFootnoteDefinitionLabel"),f}return Fl(m)||(l=!0),s++,n.consume(m),m===92?d:h}function d(m){return m===91||m===92||m===93?(n.consume(m),s++,h):h(m)}function f(m){return m===58?(n.enter("definitionMarker"),n.consume(m),n.exit("definitionMarker"),i.includes(o)||i.push(o),Yh(n,p,"gfmFootnoteDefinitionWhitespace")):t(m)}function p(m){return e(m)}}a(DA,"tokenizeDefinitionStart");function RA(n,e,t){return n.check(TA,e,n.attempt(AA,e,t))}a(RA,"tokenizeDefinitionContinuation");function zA(n){n.exit("gfmFootnoteDefinition")}a(zA,"gfmFootnoteDefinitionEnd");function PA(n,e,t){const r=this;return Yh(n,i,"gfmFootnoteDefinitionIndent",4+1);function i(o){const s=r.events[r.events.length-1];return s&&s[1].type==="gfmFootnoteDefinitionIndent"&&s[2].sliceSerialize(s[1],!0).length===4?e(o):t(o)}}a(PA,"tokenizeIndent");function uc(n,e,t,r){const i=n.length;let o=0,s;if(e<0?e=-e>i?0:i+e:e=e>i?i:e,t=t>0?t:0,r.length<1e4)s=Array.from(r),s.unshift(e,t),n.splice(...s);else for(t&&n.splice(e,t);o<r.length;)s=r.slice(o,o+1e4),s.unshift(e,0),n.splice(...s),o+=1e4,e+=1e4}a(uc,"splice");function FA(n){return n!==null&&(n<0||n===32)}a(FA,"markdownLineEndingOrSpace$2");const LA=D1(/\p{P}|\p{S}/u),BA=D1(/\s/);function D1(n){return e;function e(t){return t!==null&&t>-1&&n.test(String.fromCharCode(t))}}a(D1,"regexCheck");function tm(n){if(n===null||FA(n)||BA(n))return 1;if(LA(n))return 2}a(tm,"classifyCharacter");function HA(n,e,t){const r=[];let i=-1;for(;++i<n.length;){const o=n[i].resolveAll;o&&!r.includes(o)&&(e=o(e,t),r.push(o))}return e}a(HA,"resolveAll");function jA(n){let t=(n||{}).singleTilde;const r={tokenize:o,resolveAll:i};return t==null&&(t=!0),{text:{126:r},insideSpan:{null:[r]},attentionMarkers:{null:[126]}};function i(s,l){let c=-1;for(;++c<s.length;)if(s[c][0]==="enter"&&s[c][1].type==="strikethroughSequenceTemporary"&&s[c][1]._close){let u=c;for(;u--;)if(s[u][0]==="exit"&&s[u][1].type==="strikethroughSequenceTemporary"&&s[u][1]._open&&s[c][1].end.offset-s[c][1].start.offset===s[u][1].end.offset-s[u][1].start.offset){s[c][1].type="strikethroughSequence",s[u][1].type="strikethroughSequence";const h={type:"strikethrough",start:Object.assign({},s[u][1].start),end:Object.assign({},s[c][1].end)},d={type:"strikethroughText",start:Object.assign({},s[u][1].end),end:Object.assign({},s[c][1].start)},f=[["enter",h,l],["enter",s[u][1],l],["exit",s[u][1],l],["enter",d,l]],p=l.parser.constructs.insideSpan.null;p&&uc(f,f.length,0,HA(p,s.slice(u+1,c),l)),uc(f,f.length,0,[["exit",d,l],["enter",s[c][1],l],["exit",s[c][1],l],["exit",h,l]]),uc(s,u-1,c-u+3,f),c=u+f.length-2;break}}for(c=-1;++c<s.length;)s[c][1].type==="strikethroughSequenceTemporary"&&(s[c][1].type="data");return s}a(i,"resolveAllStrikethrough");function o(s,l,c){const u=this.previous,h=this.events;let d=0;return f;function f(m){return u===126&&h[h.length-1][1].type!=="characterEscape"?c(m):(s.enter("strikethroughSequenceTemporary"),p(m))}function p(m){const g=tm(u);if(m===126)return d>1?c(m):(s.consume(m),d++,p);if(d<2&&!t)return c(m);const k=s.exit("strikethroughSequenceTemporary"),b=tm(m);return k._open=!b||b===2&&!!g,k._close=!g||g===2&&!!b,l(m)}}a(o,"tokenizeStrikethrough")}a(jA,"gfmStrikethrough");function Es(n){return n!==null&&n<-2}a(Es,"markdownLineEnding$1");function nm(n){return n!==null&&(n<0||n===32)}a(nm,"markdownLineEndingOrSpace$1");function or(n){return n===-2||n===-1||n===32}a(or,"markdownSpace$1");function Li(n,e,t,r){const i=r?r-1:Number.POSITIVE_INFINITY;let o=0;return s;function s(c){return or(c)?(n.enter(t),l(c)):e(c)}function l(c){return or(c)&&o++<i?(n.consume(c),l):(n.exit(t),e(c))}}a(Li,"factorySpace$1");const Jd=class Jd{constructor(){this.map=[]}add(e,t,r){VA(this,e,t,r)}consume(e){if(this.map.sort(function(o,s){return o[0]-s[0]}),this.map.length===0)return;let t=this.map.length;const r=[];for(;t>0;)t-=1,r.push(e.slice(this.map[t][0]+this.map[t][1]),this.map[t][2]),e.length=this.map[t][0];r.push([...e]),e.length=0;let i=r.pop();for(;i;)e.push(...i),i=r.pop();this.map.length=0}};a(Jd,"EditMap");let Au=Jd;function VA(n,e,t,r){let i=0;if(!(t===0&&r.length===0)){for(;i<n.map.length;){if(n.map[i][0]===e){n.map[i][1]+=t,n.map[i][2].push(...r);return}i+=1}n.map.push([e,t,r])}}a(VA,"addImpl");function WA(n,e){let t=!1;const r=[];for(;e<n.length;){const i=n[e];if(t){if(i[0]==="enter")i[1].type==="tableContent"&&r.push(n[e+1][1].type==="tableDelimiterMarker"?"left":"none");else if(i[1].type==="tableContent"){if(n[e-1][1].type==="tableDelimiterMarker"){const o=r.length-1;r[o]=r[o]==="left"?"center":"right"}}else if(i[1].type==="tableDelimiterRow")break}else i[0]==="enter"&&i[1].type==="tableDelimiterRow"&&(t=!0);e+=1}return r}a(WA,"gfmTableAlign");function qA(){return{flow:{null:{tokenize:KA,resolveAll:UA}}}}a(qA,"gfmTable");function KA(n,e,t){const r=this;let i=0,o=0,s;return l;function l(v){let j=r.events.length-1;for(;j>-1;){const pe=r.events[j][1].type;if(pe==="lineEnding"||pe==="linePrefix")j--;else break}const J=j>-1?r.events[j][1].type:null,ce=J==="tableHead"||J==="tableRow"?S:c;return ce===S&&r.parser.lazy[r.now().line]?t(v):ce(v)}function c(v){return n.enter("tableHead"),n.enter("tableRow"),u(v)}function u(v){return v===124||(s=!0,o+=1),h(v)}function h(v){return v===null?t(v):Es(v)?o>1?(o=0,r.interrupt=!0,n.exit("tableRow"),n.enter("lineEnding"),n.consume(v),n.exit("lineEnding"),p):t(v):or(v)?Li(n,h,"whitespace")(v):(o+=1,s&&(s=!1,i+=1),v===124?(n.enter("tableCellDivider"),n.consume(v),n.exit("tableCellDivider"),s=!0,h):(n.enter("data"),d(v)))}function d(v){return v===null||v===124||nm(v)?(n.exit("data"),h(v)):(n.consume(v),v===92?f:d)}function f(v){return v===92||v===124?(n.consume(v),d):d(v)}function p(v){return r.interrupt=!1,r.parser.lazy[r.now().line]?t(v):(n.enter("tableDelimiterRow"),s=!1,or(v)?Li(n,m,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(v):m(v))}function m(v){return v===45||v===58?k(v):v===124?(s=!0,n.enter("tableCellDivider"),n.consume(v),n.exit("tableCellDivider"),g):A(v)}function g(v){return or(v)?Li(n,k,"whitespace")(v):k(v)}function k(v){return v===58?(o+=1,s=!0,n.enter("tableDelimiterMarker"),n.consume(v),n.exit("tableDelimiterMarker"),b):v===45?(o+=1,b(v)):v===null||Es(v)?N(v):A(v)}function b(v){return v===45?(n.enter("tableDelimiterFiller"),x(v)):A(v)}function x(v){return v===45?(n.consume(v),x):v===58?(s=!0,n.exit("tableDelimiterFiller"),n.enter("tableDelimiterMarker"),n.consume(v),n.exit("tableDelimiterMarker"),C):(n.exit("tableDelimiterFiller"),C(v))}function C(v){return or(v)?Li(n,N,"whitespace")(v):N(v)}function N(v){return v===124?m(v):v===null||Es(v)?!s||i!==o?A(v):(n.exit("tableDelimiterRow"),n.exit("tableHead"),e(v)):A(v)}function A(v){return t(v)}function S(v){return n.enter("tableRow"),q(v)}function q(v){return v===124?(n.enter("tableCellDivider"),n.consume(v),n.exit("tableCellDivider"),q):v===null||Es(v)?(n.exit("tableRow"),e(v)):or(v)?Li(n,q,"whitespace")(v):(n.enter("data"),V(v))}function V(v){return v===null||v===124||nm(v)?(n.exit("data"),q(v)):(n.consume(v),v===92?F:V)}function F(v){return v===92||v===124?(n.consume(v),V):V(v)}}a(KA,"tokenizeTable");function UA(n,e){let t=-1,r=!0,i=0,o=[0,0,0,0],s=[0,0,0,0],l=!1,c=0,u,h,d;const f=new Au;for(;++t<n.length;){const p=n[t],m=p[1];p[0]==="enter"?m.type==="tableHead"?(l=!1,c!==0&&(rm(f,e,c,u,h),h=void 0,c=0),u={type:"table",start:Object.assign({},m.start),end:Object.assign({},m.end)},f.add(t,0,[["enter",u,e]])):m.type==="tableRow"||m.type==="tableDelimiterRow"?(r=!0,d=void 0,o=[0,0,0,0],s=[0,t+1,0,0],l&&(l=!1,h={type:"tableBody",start:Object.assign({},m.start),end:Object.assign({},m.end)},f.add(t,0,[["enter",h,e]])),i=m.type==="tableDelimiterRow"?2:h?3:1):i&&(m.type==="data"||m.type==="tableDelimiterMarker"||m.type==="tableDelimiterFiller")?(r=!1,s[2]===0&&(o[1]!==0&&(s[0]=s[1],d=Os(f,e,o,i,void 0,d),o=[0,0,0,0]),s[2]=t)):m.type==="tableCellDivider"&&(r?r=!1:(o[1]!==0&&(s[0]=s[1],d=Os(f,e,o,i,void 0,d)),o=s,s=[o[1],t,0,0])):m.type==="tableHead"?(l=!0,c=t):m.type==="tableRow"||m.type==="tableDelimiterRow"?(c=t,o[1]!==0?(s[0]=s[1],d=Os(f,e,o,i,t,d)):s[1]!==0&&(d=Os(f,e,s,i,t,d)),i=0):i&&(m.type==="data"||m.type==="tableDelimiterMarker"||m.type==="tableDelimiterFiller")&&(s[3]=t)}for(c!==0&&rm(f,e,c,u,h),f.consume(e.events),t=-1;++t<e.events.length;){const p=e.events[t];p[0]==="enter"&&p[1].type==="table"&&(p[1]._align=WA(e.events,t))}return n}a(UA,"resolveTable");function Os(n,e,t,r,i,o){const s=r===1?"tableHeader":r===2?"tableDelimiter":"tableData",l="tableContent";t[0]!==0&&(o.end=Object.assign({},Zr(e.events,t[0])),n.add(t[0],0,[["exit",o,e]]));const c=Zr(e.events,t[1]);if(o={type:s,start:Object.assign({},c),end:Object.assign({},c)},n.add(t[1],0,[["enter",o,e]]),t[2]!==0){const u=Zr(e.events,t[2]),h=Zr(e.events,t[3]),d={type:l,start:Object.assign({},u),end:Object.assign({},h)};if(n.add(t[2],0,[["enter",d,e]]),r!==2){const f=e.events[t[2]],p=e.events[t[3]];if(f[1].end=Object.assign({},p[1].end),f[1].type="chunkText",f[1].contentType="text",t[3]>t[2]+1){const m=t[2]+1,g=t[3]-t[2]-1;n.add(m,g,[])}}n.add(t[3]+1,0,[["exit",d,e]])}return i!==void 0&&(o.end=Object.assign({},Zr(e.events,i)),n.add(i,0,[["exit",o,e]]),o=void 0),o}a(Os,"flushCell");function rm(n,e,t,r,i){const o=[],s=Zr(e.events,t);i&&(i.end=Object.assign({},s),o.push(["exit",i,e])),r.end=Object.assign({},s),o.push(["exit",r,e]),n.add(t+1,0,o)}a(rm,"flushTableEnd");function Zr(n,e){const t=n[e],r=t[0]==="enter"?"start":"end";return t[1][r]}a(Zr,"getPoint");function JA(n){return n!==null&&n<-2}a(JA,"markdownLineEnding");function ZA(n){return n!==null&&(n<0||n===32)}a(ZA,"markdownLineEndingOrSpace");function Iu(n){return n===-2||n===-1||n===32}a(Iu,"markdownSpace");function GA(n,e,t,r){const i=r?r-1:Number.POSITIVE_INFINITY;let o=0;return s;function s(c){return Iu(c)?(n.enter(t),l(c)):e(c)}function l(c){return Iu(c)&&o++<i?(n.consume(c),l):(n.exit(t),e(c))}}a(GA,"factorySpace");const YA={tokenize:XA};function QA(){return{text:{91:YA}}}a(QA,"gfmTaskListItem");function XA(n,e,t){const r=this;return i;function i(c){return r.previous!==null||!r._gfmTasklistFirstContentOfListItem?t(c):(n.enter("taskListCheck"),n.enter("taskListCheckMarker"),n.consume(c),n.exit("taskListCheckMarker"),o)}function o(c){return ZA(c)?(n.enter("taskListCheckValueUnchecked"),n.consume(c),n.exit("taskListCheckValueUnchecked"),s):c===88||c===120?(n.enter("taskListCheckValueChecked"),n.consume(c),n.exit("taskListCheckValueChecked"),s):t(c)}function s(c){return c===93?(n.enter("taskListCheckMarker"),n.consume(c),n.exit("taskListCheckMarker"),n.exit("taskListCheck"),l):t(c)}function l(c){return JA(c)?e(c):Iu(c)?n.check({tokenize:eI},e,t)(c):t(c)}}a(XA,"tokenizeTasklistCheck");function eI(n,e,t){return GA(n,r,"whitespace");function r(i){return i===null?t(i):e(i)}}a(eI,"spaceThenNonSpace");function tI(n){return hA([yA(),IA(),jA(n),qA(),QA()])}a(tI,"gfm");const nI={};function rI(n){const e=this,t=n||nI,r=e.data(),i=r.micromarkExtensions||(r.micromarkExtensions=[]),o=r.fromMarkdownExtensions||(r.fromMarkdownExtensions=[]),s=r.toMarkdownExtensions||(r.toMarkdownExtensions=[]);i.push(tI(t)),o.push(aA()),s.push(cA(t))}a(rI,"remarkGfm");function re(n,e){return Object.assign(n,{meta:{package:"@milkdown/preset-gfm",...e}}),n}a(re,"d");const Xh=fs("strike_through");re(Xh,{displayName:"Attr<strikethrough>",group:"Strikethrough"});const bs=ds("strike_through",n=>({parseDOM:[{tag:"del"},{style:"text-decoration",getAttrs:e=>e==="line-through"}],toDOM:e=>["del",n.get(Xh.key)(e)],parseMarkdown:{match:e=>e.type==="delete",runner:(e,t,r)=>{e.openMark(r),e.next(t.children),e.closeMark(r)}},toMarkdown:{match:e=>e.type.name==="strike_through",runner:(e,t)=>{e.withMark(t,"delete")}}}));re(bs.mark,{displayName:"MarkSchema<strikethrough>",group:"Strikethrough"});re(bs.ctx,{displayName:"MarkSchemaCtx<strikethrough>",group:"Strikethrough"});const ed=ae("ToggleStrikeThrough",n=>()=>la(bs.type(n)));re(ed,{displayName:"Command<ToggleStrikethrough>",group:"Strikethrough"});const R1=ut(n=>hs(/~([^~]+)~$/,bs.type(n)));re(R1,{displayName:"InputRule<strikethrough>",group:"Strikethrough"});const td=ht("strikeThroughKeymap",{ToggleStrikethrough:{shortcuts:"Mod-Alt-x",command:n=>{const e=n.get(ge);return()=>e.call(ed.key)}}});re(td.ctx,{displayName:"KeymapCtx<strikethrough>",group:"Strikethrough"});re(td.shortcuts,{displayName:"Keymap<strikethrough>",group:"Strikethrough"});function z1(n,e=3,t=3){const r=Array(t).fill(0).map(()=>Cs.type(n).createAndFill()),i=Array(t).fill(0).map(()=>ga.type(n).createAndFill()),o=Array(e).fill(0).map((s,l)=>ws.type(n).create(null,l===0?i:r));return xs.type(n).create(null,o)}a(z1,"se");function Ai(n){return Fv(e=>e.type.spec.tableRole==="table")(n)}a(Ai,"w");function Gr(n,e){const t=Ai(e);if(!t)return;const r=xe.get(t.node);if(!(n<0||n>=r.width))return r.cellsInRect({left:n,right:n+1,top:0,bottom:r.height}).map(i=>{const o=t.node.nodeAt(i);if(!o)return;const s=i+t.start;return{pos:s,start:s+1,node:o}}).filter(i=>i!=null)}a(Gr,"b");function Yr(n,e){const t=Ai(e);if(!t)return;const r=xe.get(t.node);if(!(n<0||n>=r.height))return r.cellsInRect({left:0,right:r.width,top:n,bottom:n+1}).map(i=>{const o=t.node.nodeAt(i);if(!o)return;const s=i+t.start;return{pos:s,start:s+1,node:o}}).filter(i=>i!=null)}a(Yr,"C");function iI(n){const e=Ai(n);if(!e)return;const t=xe.get(e.node);return t.cellsInRect({left:0,right:t.width,top:0,bottom:t.height}).map(r=>{const i=e.node.nodeAt(r),o=r+e.start;return{pos:o,start:o+1,node:i}})}a(iI,"Je");function oI(n){const e=iI(n.selection);if(e&&e[0]){const t=n.doc.resolve(e[0].pos),r=e[e.length-1];if(r){const i=n.doc.resolve(r.pos);return sa(n.setSelection(new Me(i,t)))}}return n}a(oI,"Qe");function P1(n,e,{map:t,tableStart:r,table:i},o){const s=Array(o).fill(0).reduce((c,u,h)=>c+i.child(h).nodeSize,r),l=Array(t.width).fill(0).map((c,u)=>{const h=i.nodeAt(t.map[u]);return Cs.type(n).createAndFill({alignment:h?.attrs.alignment})});return e.insert(s,ws.type(n).create(null,l)),e}a(P1,"ce");function F1(n){return e=>t=>{const r=Ai(t.selection),i=n==="row";if(r){const o=xe.get(r.node);if(e>=0&&e<(i?o.height:o.width)){const s=o.positionAt(i?e:o.height-1,i?o.width-1:e,r.node),l=t.doc.resolve(r.start+s),c=i?Me.rowSelection:Me.colSelection,u=o.positionAt(i?e:0,i?0:e,r.node),h=t.doc.resolve(r.start+u);return sa(t.setSelection(c(l,h)))}}return t}}a(F1,"ie");const sI=F1("row"),lI=F1("col");function im(n){return n[0].map((e,t)=>n.map(r=>r[t]))}a(im,"q");function L1(n,e){const t=[],r=xe.get(n);for(let i=0;i<r.height;i++){const o=n.child(i),s=[];for(let l=0;l<r.width;l++){if(!e[i][l])continue;const c=r.map[i*r.width+l],u=e[i][l],h=n.nodeAt(c).type.createChecked(Object.assign({},u.attrs),u.content,u.marks);s.push(h)}t.push(o.type.createChecked(o.attrs,s,o.marks))}return n.type.createChecked(n.attrs,t,n.marks)}a(L1,"de");function B1(n){const e=xe.get(n),t=[];for(let r=0;r<e.height;r++){const i=[],o={};for(let s=0;s<e.width;s++){const l=e.map[r*e.width+s],c=n.nodeAt(l),u=e.findCell(l);if(o[l]||u.top!==r){i.push(null);continue}o[l]=!0,i.push(c)}t.push(i)}return t}a(B1,"me");function H1(n,e,t,r){const i=e[0]>t[0]?-1:1,o=n.splice(e[0],e.length),s=o.length%2===0?1:0;let l;return r===-1&&i===1?l=t[0]-1:r===1&&i===-1?l=t[t.length-1]-s+1:l=i===-1?t[0]:t[t.length-1]-s,n.splice(l,0,...o),n}a(H1,"ue");function aI(n,e,t,r){let i=im(B1(n.node));return i=H1(i,e,t,r),i=im(i),L1(n.node,i)}a(aI,"tt");function cI(n,e,t,r){let i=B1(n.node);return i=H1(i,e,t,r),L1(n.node,i)}a(cI,"ot");function om(n,e){let t=n,r=n;for(let h=n;h>=0;h--){const d=Gr(h,e.selection);d&&d.forEach(f=>{const p=f.node.attrs.colspan+h-1;p>=t&&(t=h),p>r&&(r=p)})}for(let h=n;h<=r;h++){const d=Gr(h,e.selection);d&&d.forEach(f=>{const p=f.node.attrs.colspan+h-1;f.node.attrs.colspan>1&&p>r&&(r=p)})}const i=[];for(let h=t;h<=r;h++){const d=Gr(h,e.selection);d&&d.length&&i.push(h)}t=i[0],r=i[i.length-1];const o=Gr(t,e.selection),s=Yr(0,e.selection),l=e.doc.resolve(o[o.length-1].pos);let c;for(let h=r;h>=t;h--){const d=Gr(h,e.selection);if(d&&d.length){for(let f=s.length-1;f>=0;f--)if(s[f].pos===d[0].pos){c=d[0];break}if(c)break}}const u=e.doc.resolve(c.pos);return{$anchor:l,$head:u,indexes:i}}a(om,"J");function sm(n,e){let t=n,r=n;for(let h=n;h>=0;h--)Yr(h,e.selection).forEach(d=>{const f=d.node.attrs.rowspan+h-1;f>=t&&(t=h),f>r&&(r=f)});for(let h=n;h<=r;h++)Yr(h,e.selection).forEach(d=>{const f=d.node.attrs.rowspan+h-1;d.node.attrs.rowspan>1&&f>r&&(r=f)});const i=[];for(let h=t;h<=r;h++){const d=Yr(h,e.selection);d&&d.length&&i.push(h)}t=i[0],r=i[i.length-1];const o=Yr(t,e.selection),s=Gr(0,e.selection),l=e.doc.resolve(o[o.length-1].pos);let c;for(let h=r;h>=t;h--){const d=Yr(h,e.selection);if(d&&d.length){for(let f=s.length-1;f>=0;f--)if(s[f].pos===d[0].pos){c=d[0];break}if(c)break}}const u=e.doc.resolve(c.pos);return{$anchor:l,$head:u,indexes:i}}a(sm,"Q");function uI(n,e,t,r=!0){const i=Ai(n.selection);if(!i)return n;const{indexes:o}=om(e,n),{indexes:s}=om(t,n);if(o.includes(t))return n;const l=aI(i,o,s,0),c=sa(n).replaceWith(i.pos,i.pos+i.node.nodeSize,l);if(!r)return c;const u=xe.get(l),h=i.start,d=t,f=u.positionAt(u.height-1,d,l),p=c.doc.resolve(h+f),m=Me.colSelection,g=u.positionAt(0,d,l),k=c.doc.resolve(h+g);return c.setSelection(m(p,k))}a(uI,"nt");function hI(n,e,t,r=!0){const i=Ai(n.selection);if(!i)return n;const{indexes:o}=sm(e,n),{indexes:s}=sm(t,n);if(o.includes(t))return n;const l=cI(i,o,s,0),c=sa(n).replaceWith(i.pos,i.pos+i.node.nodeSize,l);if(!r)return c;const u=xe.get(l),h=i.start,d=t,f=u.positionAt(d,u.width-1,l),p=c.doc.resolve(h+f),m=Me.rowSelection,g=u.positionAt(d,0,l),k=c.doc.resolve(h+g);return c.setSelection(m(p,k))}a(hI,"lt");const ma=hT({tableGroup:"block",cellContent:"paragraph",cellAttributes:{alignment:{default:"left",getFromDOM:n=>n.style.textAlign||"left",setDOMAttr:(n,e)=>{e.style=`text-align: ${n||"left"}`}}}}),xs=Ue("table",()=>({...ma.table,parseMarkdown:{match:n=>n.type==="table",runner:(n,e,t)=>{const r=e.align,i=e.children.map((o,s)=>({...o,align:r,isHeader:s===0}));n.openNode(t),n.next(i),n.closeNode()}},toMarkdown:{match:n=>n.type.name==="table",runner:(n,e)=>{var t;const r=(t=e.content.firstChild)==null?void 0:t.content;if(!r)return;const i=[];r.forEach(o=>{i.push(o.attrs.alignment)}),n.openNode("table",void 0,{align:i}),n.next(e.content),n.closeNode()}}}));re(xs.node,{displayName:"NodeSchema<table>",group:"Table"});re(xs.ctx,{displayName:"NodeSchemaCtx<table>",group:"Table"});const ws=Ue("table_row",()=>({...ma.table_row,parseMarkdown:{match:n=>n.type==="tableRow",runner:(n,e,t)=>{const r=e.align,i=e.children.map((o,s)=>({...o,align:r[s],isHeader:e.isHeader}));n.openNode(t),n.next(i),n.closeNode()}},toMarkdown:{match:n=>n.type.name==="table_row",runner:(n,e)=>{n.openNode("tableRow"),n.next(e.content),n.closeNode()}}}));re(ws.node,{displayName:"NodeSchema<tableRow>",group:"Table"});re(ws.ctx,{displayName:"NodeSchemaCtx<tableRow>",group:"Table"});const Cs=Ue("table_cell",()=>({...ma.table_cell,parseMarkdown:{match:n=>n.type==="tableCell"&&!n.isHeader,runner:(n,e,t)=>{const r=e.align;n.openNode(t,{alignment:r}).openNode(n.schema.nodes.paragraph).next(e.children).closeNode().closeNode()}},toMarkdown:{match:n=>n.type.name==="table_cell",runner:(n,e)=>{n.openNode("tableCell").next(e.content).closeNode()}}}));re(Cs.node,{displayName:"NodeSchema<tableCell>",group:"Table"});re(Cs.ctx,{displayName:"NodeSchemaCtx<tableCell>",group:"Table"});const ga=Ue("table_header",()=>({...ma.table_header,parseMarkdown:{match:n=>n.type==="tableCell"&&!!n.isHeader,runner:(n,e,t)=>{const r=e.align;n.openNode(t,{alignment:r}),n.openNode(n.schema.nodes.paragraph),n.next(e.children),n.closeNode(),n.closeNode()}},toMarkdown:{match:n=>n.type.name==="table_header",runner:(n,e)=>{n.openNode("tableCell"),n.next(e.content),n.closeNode()}}}));re(ga.node,{displayName:"NodeSchema<tableHeader>",group:"Table"});re(ga.ctx,{displayName:"NodeSchemaCtx<tableHeader>",group:"Table"});const j1=ut(n=>new rt(/^\|(?<col>\d+)[xX](?<row>\d+)\|\s$/,(e,t,r,i)=>{var o,s;const l=e.doc.resolve(r);if(!l.node(-1).canReplaceWith(l.index(-1),l.indexAfter(-1),xs.type(n)))return null;const c=z1(n,Number((o=t.groups)==null?void 0:o.row),Number((s=t.groups)==null?void 0:s.col)),u=e.tr.replaceRangeWith(r,i,c);return u.setSelection(de.create(u.doc,r+3)).scrollIntoView()}));re(j1,{displayName:"InputRule<insertTableInputRule>",group:"Table"});const nd=ae("GoToPrevTableCell",()=>()=>k1(-1));re(nd,{displayName:"Command<goToPrevTableCellCommand>",group:"Table"});const rd=ae("GoToNextTableCell",()=>()=>k1(1));re(rd,{displayName:"Command<goToNextTableCellCommand>",group:"Table"});const id=ae("BreakTable",n=>()=>(e,t)=>{if(!ct(e))return!1;const{$head:r}=e.selection,i=r.after(),o=e.tr.replaceWith(i,i,gn.type(n).createAndFill());return o.setSelection(te.near(o.doc.resolve(i),1)).scrollIntoView(),t?.(o),!0});re(id,{displayName:"Command<breakTableCommand>",group:"Table"});const od=ae("InsertTable",n=>({row:e,col:t}={})=>(r,i)=>{const{selection:o,tr:s}=r,{from:l}=o,c=z1(n,e,t),u=s.replaceSelectionWith(c),h=te.findFrom(u.doc.resolve(l),1,!0);return h&&u.setSelection(h),i?.(u),!0});re(od,{displayName:"Command<insertTableCommand>",group:"Table"});const V1=ae("MoveRow",()=>({from:n,to:e}={})=>(t,r)=>{const{tr:i}=t;return!!r?.(hI(i,n??0,e??0,!0))});re(V1,{displayName:"Command<moveRowCommand>",group:"Table"});const W1=ae("MoveCol",()=>({from:n,to:e}={})=>(t,r)=>{const{tr:i}=t;return!!r?.(uI(i,n??0,e??0,!0))});re(W1,{displayName:"Command<moveColCommand>",group:"Table"});const q1=ae("SelectRow",()=>(n=0)=>(e,t)=>{const{tr:r}=e;return!!t?.(sI(n)(r))});re(q1,{displayName:"Command<selectRowCommand>",group:"Table"});const K1=ae("SelectCol",()=>(n=0)=>(e,t)=>{const{tr:r}=e;return!!t?.(lI(n)(r))});re(K1,{displayName:"Command<selectColCommand>",group:"Table"});const U1=ae("SelectTable",()=>()=>(n,e)=>{const{tr:t}=n;return!!e?.(oI(t))});re(U1,{displayName:"Command<selectTableCommand>",group:"Table"});const J1=ae("DeleteSelectedCells",()=>()=>(n,e)=>{const{selection:t}=n;if(!(t instanceof Me))return!1;const r=t.isRowSelection(),i=t.isColSelection();return r&&i?XT(n,e):i?UT(n,e):ZT(n,e)});re(J1,{displayName:"Command<deleteSelectedCellsCommand>",group:"Table"});const Z1=ae("AddColBefore",()=>()=>WT);re(Z1,{displayName:"Command<addColBeforeCommand>",group:"Table"});const G1=ae("AddColAfter",()=>()=>qT);re(G1,{displayName:"Command<addColAfterCommand>",group:"Table"});const Y1=ae("AddRowBefore",n=>()=>(e,t)=>{if(!ct(e))return!1;if(t){const r=Un(e);t(P1(n,e.tr,r,r.top))}return!0});re(Y1,{displayName:"Command<addRowBeforeCommand>",group:"Table"});const Q1=ae("AddRowAfter",n=>()=>(e,t)=>{if(!ct(e))return!1;if(t){const r=Un(e);t(P1(n,e.tr,r,r.bottom))}return!0});re(Q1,{displayName:"Command<addRowAfterCommand>",group:"Table"});const X1=ae("SetAlign",()=>(n="left")=>GT("alignment",n));re(X1,{displayName:"Command<setAlignCommand>",group:"Table"});const sd=ht("tableKeymap",{NextCell:{shortcuts:["Mod-]","Tab"],command:n=>{const e=n.get(ge);return()=>e.call(rd.key)}},PrevCell:{shortcuts:["Mod-[","Shift-Tab"],command:n=>{const e=n.get(ge);return()=>e.call(nd.key)}},ExitTable:{shortcuts:["Mod-Enter"],command:n=>{const e=n.get(ge);return()=>e.call(id.key)}}});re(sd.ctx,{displayName:"KeymapCtx<table>",group:"Table"});re(sd.shortcuts,{displayName:"Keymap<table>",group:"Table"});const hc="footnote_definition",lm="footnoteDefinition",ld=Ue("footnote_definition",()=>({group:"block",content:"block+",defining:!0,attrs:{label:{default:""}},parseDOM:[{tag:`dl[data-type="${hc}"]`,getAttrs:n=>{if(!(n instanceof HTMLElement))throw Gt(n);return{label:n.dataset.label}},contentElement:"dd"}],toDOM:n=>{const e=n.attrs.label;return["dl",{"data-label":e,"data-type":hc},["dt",e],["dd",0]]},parseMarkdown:{match:({type:n})=>n===lm,runner:(n,e,t)=>{n.openNode(t,{label:e.label}).next(e.children).closeNode()}},toMarkdown:{match:n=>n.type.name===hc,runner:(n,e)=>{n.openNode(lm,void 0,{label:e.attrs.label,identifier:e.attrs.label}).next(e.content).closeNode()}}}));re(ld.ctx,{displayName:"NodeSchemaCtx<footnodeDef>",group:"footnote"});re(ld.node,{displayName:"NodeSchema<footnodeDef>",group:"footnote"});const dc="footnote_reference",ad=Ue("footnote_reference",()=>({group:"inline",inline:!0,atom:!0,attrs:{label:{default:""}},parseDOM:[{tag:`sup[data-type="${dc}"]`,getAttrs:n=>{if(!(n instanceof HTMLElement))throw Gt(n);return{label:n.dataset.label}}}],toDOM:n=>{const e=n.attrs.label;return["sup",{"data-label":e,"data-type":dc},e]},parseMarkdown:{match:({type:n})=>n==="footnoteReference",runner:(n,e,t)=>{n.addNode(t,{label:e.label})}},toMarkdown:{match:n=>n.type.name===dc,runner:(n,e)=>{n.addNode("footnoteReference",void 0,void 0,{label:e.attrs.label,identifier:e.attrs.label})}}}));re(ad.ctx,{displayName:"NodeSchemaCtx<footnodeRef>",group:"footnote"});re(ad.node,{displayName:"NodeSchema<footnodeRef>",group:"footnote"});const ek=Zt.extendSchema(n=>e=>{const t=n(e);return{...t,attrs:{...t.attrs,checked:{default:null}},parseDOM:[{tag:'li[data-item-type="task"]',getAttrs:r=>{if(!(r instanceof HTMLElement))throw Gt(r);return{label:r.dataset.label,listType:r.dataset["list-type"],spread:r.dataset.spread,checked:r.dataset.checked?r.dataset.checked==="true":null}}},...t?.parseDOM||[]],toDOM:r=>t.toDOM&&r.attrs.checked==null?t.toDOM(r):["li",{"data-item-type":"task","data-label":r.attrs.label,"data-list-type":r.attrs.listType,"data-spread":r.attrs.spread,"data-checked":r.attrs.checked},0],parseMarkdown:{match:({type:r})=>r==="listItem",runner:(r,i,o)=>{if(i.checked==null){t.parseMarkdown.runner(r,i,o);return}const s=i.label!=null?`${i.label}.`:"",l=i.checked!=null?!!i.checked:null,c=i.label!=null?"ordered":"bullet",u=i.spread!=null?`${i.spread}`:"true";r.openNode(o,{label:s,listType:c,spread:u,checked:l}),r.next(i.children),r.closeNode()}},toMarkdown:{match:r=>r.type.name==="list_item",runner:(r,i)=>{if(i.attrs.checked==null){t.toMarkdown.runner(r,i);return}const o=i.attrs.label,s=i.attrs.listType,l=i.attrs.spread==="true",c=i.attrs.checked;r.openNode("listItem",void 0,{label:o,listType:s,spread:l,checked:c}),r.next(i.content),r.closeNode()}}}});re(ek,{displayName:"NodeSchema<listItem>",group:"ListItem"});const tk=ut(()=>new rt(/^\[(?<checked>\s|x)\]\s$/,(n,e,t,r)=>{var i;const o=n.doc.resolve(t);let s=0,l=o.node(s);for(;l&&l.type.name!=="list_item";)s--,l=o.node(s);if(!l||l.attrs.checked!=null)return null;const c=((i=e.groups)==null?void 0:i.checked)==="x",u=o.before(s),h=n.tr;return h.deleteRange(t,r).setNodeMarkup(u,void 0,{...l.attrs,checked:c}),h}));re(tk,{displayName:"InputRule<wrapInTaskListInputRule>",group:"ListItem"});const dI=[td,sd].flat(),fI=[j1,tk],pI=[R1],nk=pn(n=>{const e=new Ge("MILKDOWN_AUTO_INSERT_ZERO_SPACE"),t=a(i=>i.type===gn.type(n),"n"),r=a(i=>t(i)&&i.nodeSize===2,"o");return new Xe({key:e,props:{handleDOMEvents:{compositionstart(i){const{state:o,dispatch:s}=i,{tr:l,selection:c}=o,{$from:u}=c;return _p.safari&&ct(o)&&c.empty&&r(u.parent)&&s(l.insertText("",u.start())),!1},compositionend(i){const{state:o,dispatch:s}=i,{tr:l,selection:c}=o,{$from:u}=c;return _p.safari&&ct(o)&&c.empty&&t(u.parent)&&u.parent.textContent.startsWith("")&&s(l.delete(u.start(),u.start()+1)),!1}}}})});re(nk,{displayName:"Prose<autoInsertZeroSpaceInTablePlugin>",group:"Prose"});const rk=pn(()=>_T({}));re(rk,{displayName:"Prose<columnResizingPlugin>",group:"Prose"});const ik=pn(()=>e$());re(ik,{displayName:"Prose<tableEditingPlugin>",group:"Prose"});const cd=vi("remarkGFM",()=>rI);re(cd.plugin,{displayName:"Remark<remarkGFMPlugin>",group:"Remark"});re(cd.options,{displayName:"RemarkConfig<remarkGFMPlugin>",group:"Remark"});const mI=[nk,rk,ik,cd].flat(),gI=[ek,xs,ws,ga,Cs,ld,ad,Xh,bs].flat(),yI=[rd,nd,id,od,V1,W1,q1,K1,U1,J1,Y1,Q1,Z1,G1,X1,ed],kI=[gI,fI,pI,dI,mI,yI].flat();var Ll=200,ze=a(function(){},"RopeSequence");ze.prototype.append=a(function(e){return e.length?(e=ze.from(e),!this.length&&e||e.length<Ll&&this.leafAppend(e)||this.length<Ll&&e.leafPrepend(this)||this.appendInner(e)):this},"append");ze.prototype.prepend=a(function(e){return e.length?ze.from(e).append(this):this},"prepend");ze.prototype.appendInner=a(function(e){return new bI(this,e)},"appendInner");ze.prototype.slice=a(function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?ze.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))},"slice");ze.prototype.get=a(function(e){if(!(e<0||e>=this.length))return this.getInner(e)},"get");ze.prototype.forEach=a(function(e,t,r){t===void 0&&(t=0),r===void 0&&(r=this.length),t<=r?this.forEachInner(e,t,r,0):this.forEachInvertedInner(e,t,r,0)},"forEach");ze.prototype.map=a(function(e,t,r){t===void 0&&(t=0),r===void 0&&(r=this.length);var i=[];return this.forEach(function(o,s){return i.push(e(o,s))},t,r),i},"map");ze.from=a(function(e){return e instanceof ze?e:e&&e.length?new ok(e):ze.empty},"from");var ok=function(n){function e(r){n.call(this),this.values=r}a(e,"Leaf"),n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=a(function(){return this.values},"flatten"),e.prototype.sliceInner=a(function(i,o){return i==0&&o==this.length?this:new e(this.values.slice(i,o))},"sliceInner"),e.prototype.getInner=a(function(i){return this.values[i]},"getInner"),e.prototype.forEachInner=a(function(i,o,s,l){for(var c=o;c<s;c++)if(i(this.values[c],l+c)===!1)return!1},"forEachInner"),e.prototype.forEachInvertedInner=a(function(i,o,s,l){for(var c=o-1;c>=s;c--)if(i(this.values[c],l+c)===!1)return!1},"forEachInvertedInner"),e.prototype.leafAppend=a(function(i){if(this.length+i.length<=Ll)return new e(this.values.concat(i.flatten()))},"leafAppend"),e.prototype.leafPrepend=a(function(i){if(this.length+i.length<=Ll)return new e(i.flatten().concat(this.values))},"leafPrepend"),t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(e.prototype,t),e}(ze);ze.empty=new ok([]);var bI=function(n){function e(t,r){n.call(this),this.left=t,this.right=r,this.length=t.length+r.length,this.depth=Math.max(t.depth,r.depth)+1}return a(e,"Append"),n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.flatten=a(function(){return this.left.flatten().concat(this.right.flatten())},"flatten"),e.prototype.getInner=a(function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},"getInner"),e.prototype.forEachInner=a(function(r,i,o,s){var l=this.left.length;if(i<l&&this.left.forEachInner(r,i,Math.min(o,l),s)===!1||o>l&&this.right.forEachInner(r,Math.max(i-l,0),Math.min(this.length,o)-l,s+l)===!1)return!1},"forEachInner"),e.prototype.forEachInvertedInner=a(function(r,i,o,s){var l=this.left.length;if(i>l&&this.right.forEachInvertedInner(r,i-l,Math.max(o,l)-l,s+l)===!1||o<l&&this.left.forEachInvertedInner(r,Math.min(i,l),o,s)===!1)return!1},"forEachInvertedInner"),e.prototype.sliceInner=a(function(r,i){if(r==0&&i==this.length)return this;var o=this.left.length;return i<=o?this.left.slice(r,i):r>=o?this.right.slice(r-o,i-o):this.left.slice(r,o).append(this.right.slice(0,i-o))},"sliceInner"),e.prototype.leafAppend=a(function(r){var i=this.right.leafAppend(r);if(i)return new e(this.left,i)},"leafAppend"),e.prototype.leafPrepend=a(function(r){var i=this.left.leafPrepend(r);if(i)return new e(i,this.right)},"leafPrepend"),e.prototype.appendInner=a(function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},"appendInner"),e}(ze);const xI=500,On=class On{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let i,o;t&&(i=this.remapping(r,this.items.length),o=i.maps.length);let s=e.tr,l,c,u=[],h=[];return this.items.forEach((d,f)=>{if(!d.step){i||(i=this.remapping(r,f+1),o=i.maps.length),o--,h.push(d);return}if(i){h.push(new Bt(d.map));let p=d.step.map(i.slice(o)),m;p&&s.maybeStep(p).doc&&(m=s.mapping.maps[s.mapping.maps.length-1],u.push(new Bt(m,void 0,void 0,u.length+h.length))),o--,m&&i.appendMap(m,o)}else s.maybeStep(d.step);if(d.selection)return l=i?d.selection.map(i.slice(o)):d.selection,c=new On(this.items.slice(0,r).append(h.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:c,transform:s,selection:l}}addTransform(e,t,r,i){let o=[],s=this.eventCount,l=this.items,c=!i&&l.length?l.get(l.length-1):null;for(let h=0;h<e.steps.length;h++){let d=e.steps[h].invert(e.docs[h]),f=new Bt(e.mapping.maps[h],d,t),p;(p=c&&c.merge(f))&&(f=p,h?o.pop():l=l.slice(0,l.length-1)),o.push(f),t&&(s++,t=void 0),i||(c=f)}let u=s-r.depth;return u>CI&&(l=wI(l,u),s-=u),new On(l.append(o),s)}remapping(e,t){let r=new Cl;return this.items.forEach((i,o)=>{let s=i.mirrorOffset!=null&&o-i.mirrorOffset>=e?r.maps.length-i.mirrorOffset:void 0;r.appendMap(i.map,s)},e,t),r}addMaps(e){return this.eventCount==0?this:new On(this.items.append(e.map(t=>new Bt(t))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let r=[],i=Math.max(0,this.items.length-t),o=e.mapping,s=e.steps.length,l=this.eventCount;this.items.forEach(f=>{f.selection&&l--},i);let c=t;this.items.forEach(f=>{let p=o.getMirror(--c);if(p==null)return;s=Math.min(s,p);let m=o.maps[p];if(f.step){let g=e.steps[p].invert(e.docs[p]),k=f.selection&&f.selection.map(o.slice(c+1,p));k&&l++,r.push(new Bt(m,g,k))}else r.push(new Bt(m))},i);let u=[];for(let f=t;f<s;f++)u.push(new Bt(o.maps[f]));let h=this.items.slice(0,i).append(u).append(r),d=new On(h,l);return d.emptyItemCount()>xI&&(d=d.compress(this.items.length-r.length)),d}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),r=t.maps.length,i=[],o=0;return this.items.forEach((s,l)=>{if(l>=e)i.push(s),s.selection&&o++;else if(s.step){let c=s.step.map(t.slice(r)),u=c&&c.getMap();if(r--,u&&t.appendMap(u,r),c){let h=s.selection&&s.selection.map(t.slice(r));h&&o++;let d=new Bt(u.invert(),c,h),f,p=i.length-1;(f=i.length&&i[p].merge(d))?i[p]=f:i.push(d)}}else s.map&&r--},this.items.length,0),new On(ze.from(i.reverse()),o)}};a(On,"Branch");let Rr=On;Rr.empty=new Rr(ze.empty,0);function wI(n,e){let t;return n.forEach((r,i)=>{if(r.selection&&e--==0)return t=i,!1}),n.slice(t)}a(wI,"cutOffEvents");const Zl=class Zl{constructor(e,t,r,i){this.map=e,this.step=t,this.selection=r,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new Zl(t.getMap().invert(),t,this.selection)}}};a(Zl,"Item");let Bt=Zl;const Zd=class Zd{constructor(e,t,r,i,o){this.done=e,this.undone=t,this.prevRanges=r,this.prevTime=i,this.prevComposition=o}};a(Zd,"HistoryState");let jt=Zd;const CI=20;function SI(n,e,t,r){let i=t.getMeta(Tr),o;if(i)return i.historyState;t.getMeta(MI)&&(n=new jt(n.done,n.undone,null,0,-1));let s=t.getMeta("appendedTransaction");if(t.steps.length==0)return n;if(s&&s.getMeta(Tr))return s.getMeta(Tr).redo?new jt(n.done.addTransform(t,void 0,r,ul(e)),n.undone,am(t.mapping.maps[t.steps.length-1]),n.prevTime,n.prevComposition):new jt(n.done,n.undone.addTransform(t,void 0,r,ul(e)),null,n.prevTime,n.prevComposition);if(t.getMeta("addToHistory")!==!1&&!(s&&s.getMeta("addToHistory")===!1)){let l=t.getMeta("composition"),c=n.prevTime==0||!s&&n.prevComposition!=l&&(n.prevTime<(t.time||0)-r.newGroupDelay||!vI(t,n.prevRanges)),u=s?fc(n.prevRanges,t.mapping):am(t.mapping.maps[t.steps.length-1]);return new jt(n.done.addTransform(t,c?e.selection.getBookmark():void 0,r,ul(e)),Rr.empty,u,t.time,l??n.prevComposition)}else return(o=t.getMeta("rebased"))?new jt(n.done.rebased(t,o),n.undone.rebased(t,o),fc(n.prevRanges,t.mapping),n.prevTime,n.prevComposition):new jt(n.done.addMaps(t.mapping.maps),n.undone.addMaps(t.mapping.maps),fc(n.prevRanges,t.mapping),n.prevTime,n.prevComposition)}a(SI,"applyTransaction");function vI(n,e){if(!e)return!1;if(!n.docChanged)return!0;let t=!1;return n.mapping.maps[0].forEach((r,i)=>{for(let o=0;o<e.length;o+=2)r<=e[o+1]&&i>=e[o]&&(t=!0)}),t}a(vI,"isAdjacentTo");function am(n){let e=[];return n.forEach((t,r,i,o)=>e.push(i,o)),e}a(am,"rangesFor");function fc(n,e){if(!n)return null;let t=[];for(let r=0;r<n.length;r+=2){let i=e.map(n[r],1),o=e.map(n[r+1],-1);i<=o&&t.push(i,o)}return t}a(fc,"mapRanges");function NI(n,e,t){let r=ul(e),i=Tr.get(e).spec.config,o=(t?n.undone:n.done).popEvent(e,r);if(!o)return null;let s=o.selection.resolve(o.transform.doc),l=(t?n.done:n.undone).addTransform(o.transform,e.selection.getBookmark(),i,r),c=new jt(t?l:o.remaining,t?o.remaining:l,null,0,-1);return o.transform.setSelection(s).setMeta(Tr,{redo:t,historyState:c})}a(NI,"histTransaction");let pc=!1,cm=null;function ul(n){let e=n.plugins;if(cm!=e){pc=!1,cm=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){pc=!0;break}}return pc}a(ul,"mustPreserveItems");const Tr=new Ge("history"),MI=new Ge("closeHistory");function TI(n={}){return n={depth:n.depth||100,newGroupDelay:n.newGroupDelay||500},new Xe({key:Tr,state:{init(){return new jt(Rr.empty,Rr.empty,null,0,-1)},apply(e,t,r){return SI(t,r,e,n)}},config:n,props:{handleDOMEvents:{beforeinput(e,t){let r=t.inputType,i=r=="historyUndo"?lk:r=="historyRedo"?ak:null;return i?(t.preventDefault(),i(e.state,e.dispatch)):!1}}}})}a(TI,"history");function sk(n,e){return(t,r)=>{let i=Tr.getState(t);if(!i||(n?i.undone:i.done).eventCount==0)return!1;if(r){let o=NI(i,t,n);o&&r(e?o.scrollIntoView():o)}return!0}}a(sk,"buildCommand");const lk=sk(!1,!0),ak=sk(!0,!0);function Ii(n,e){return Object.assign(n,{meta:{package:"@milkdown/plugin-history",...e}}),n}a(Ii,"t");const ud=ae("Undo",()=>()=>lk);Ii(ud,{displayName:"Command<undo>"});const jo=ae("Redo",()=>()=>ak);Ii(jo,{displayName:"Command<redo>"});const hd=mn({},"historyProviderConfig");Ii(hd,{displayName:"Ctx<historyProviderConfig>"});const ck=pn(n=>TI(n.get(hd.key)));Ii(ck,{displayName:"Ctx<historyProviderPlugin>"});const dd=ht("historyKeymap",{Undo:{shortcuts:"Mod-z",command:n=>{const e=n.get(ge);return()=>e.call(ud.key)}},Redo:{shortcuts:["Mod-y","Shift-Mod-z"],command:n=>{const e=n.get(ge);return()=>e.call(jo.key)}}});Ii(dd.ctx,{displayName:"KeymapCtx<history>"});Ii(dd.shortcuts,{displayName:"Keymap<history>"});const $I=[hd,ck,dd,ud,jo].flat(),AI="_primalMarkdown_xdyem_1",II="_toolbar_xdyem_4",EI="_editor_xdyem_8",OI="_embeddedNote_xdyem_171",_I="_articlePreview_xdyem_250",bn={primalMarkdown:AI,toolbar:II,editor:EI,embeddedNote:OI,articlePreview:_I},DI=a(async(n,e,t,r,i,o,s)=>{const l={content:n,kind:Q.Highlight,tags:[["p",t],["a",r],["context",e],["alt","This highlight was made by https://primal.net web client"]],created_at:Math.floor(new Date().getTime()/1e3)};return await mm(l,o,s,i)},"sendHighlight"),RI=a(async(n,e,t,r)=>{const i={content:"",kind:Q.EventDeletion,tags:[["e",n],["alt","This event was deleted through the https://primal.net web client"]],created_at:Math.floor(new Date().getTime()/1e3)};return await mm(i,t,r,e)},"removeHighlight"),zI="_articleActionMenu_xm2je_1",PI="_iconCaption_xm2je_25",FI="_iconHighlight_xm2je_36",LI="_iconHighlightQuote_xm2je_46",BI="_iconHighlightComment_xm2je_56",HI="_iconHighlightRemove_xm2je_66",jI="_iconHighlightCopy_xm2je_76",VI="_articleHighlightComments_xm2je_86",WI="_header_xm2je_100",qI="_author_xm2je_107",KI="_caption_xm2je_115",UI="_name_xm2je_122",JI="_highlightComment_xm2je_125",ZI="_commentAuthor_xm2je_135",GI="_time_xm2je_152",YI="_commentContent_xm2je_159",QI="_suffix_xm2je_167",XI="_dots_xm2je_171",Ce={articleActionMenu:zI,iconCaption:PI,iconHighlight:FI,iconHighlightQuote:LI,iconHighlightComment:BI,iconHighlightRemove:HI,iconHighlightCopy:jI,articleHighlightComments:VI,header:WI,author:qI,caption:KI,name:UI,highlightComment:JI,commentAuthor:ZI,time:GI,commentContent:YI,suffix:QI,dots:XI},eE=le('<button data-highlight-menu-option="remove"><div></div><div>Remove'),tE=le('<button data-highlight-menu-option="highlight"><div></div><div>Highlight'),nE=le('<button data-highlight-menu-option="quote"><div></div><div>Quote'),rE=le('<button data-highlight-menu-option="comment"><div></div><div>Comment'),iE=le('<div><button data-highlight-menu-option="copy"><div></div><div>Copy'),oE=64+8,sE=a(n=>{const e=fn(),t=a(()=>(n.position?.y||0)-oE,"topP"),r=a(()=>{const d=n.position?.x||0,f=286;return d<f/2?d:d+f>640?640-f:d},"leftP"),i=a(d=>{let f=n.text,p=n.context;if(d){const m=d.getRangeAt(0).cloneContents();for(let k=0;k<m.childNodes.length;k++){const b=m.childNodes[k];if(b&&b.nodeName==="A"){const x=b.getAttribute("href");if(x?.startsWith("nostr:")){let C=document.createTextNode(x);b.replaceWith(C)}}}f=m.textContent||f;const g=d.anchorNode?.parentNode?.cloneNode(!0);if(g){for(let k=0;k<g.childNodes.length;k++){const b=g.childNodes[k];if(b&&b.nodeName==="A"){const x=b.getAttribute("href");if(x?.startsWith("nostr:")){let C=document.createTextNode(x);b.replaceWith(C)}}}p=g.textContent||p}}return{content:f,context:p}},"generateContentAndContext"),o=a(async(d,f,p)=>{if(!e)return{success:!1,reasons:["Author missing"]};const m=i(p);return await DI(d||m.content,f||m.context,n.article.pubkey,`${Q.LongForm}:${n.article.pubkey}:${(n.article.msg.tags.find(g=>g[0]==="d")||[])[1]}`,e.proxyThroughPrimal,e.activeRelays,e.relaySettings)},"createHighlight"),s=a(async(d,f=n.onCreate)=>{if(d&&d.preventDefault(),d&&d.stopPropagation(),!e)return;const p=`${Q.LongForm}:${n.article.pubkey}:${(n.article.msg.tags.find(m=>m[0]==="d")||[])[1]}`;if(n.highlight==="NEW_HIGHLIGHT"){const{content:m,context:g}=i(n.selection),k={id:Yd(),kind:Q.Highlight,context:g,content:m,tags:[["p",n.article.pubkey],["a",p],["context",g]],created_at:new Date().getTime()/1e3,sig:"UNSIGNED",pubkey:e.publicKey||""};f&&f(k);const{success:b,note:x}=await o(m,g,n.selection);b&&x&&f&&f(x,k.id),b||n.onRemove&&n.onRemove(k.id)}else{const m=n.highlight.content,g=(n.highlight.tags.find(C=>C[0]==="context")||[])[1],k={id:Yd(),kind:Q.Highlight,context:g,content:m,tags:[...n.highlight.tags],created_at:new Date().getTime()/1e3,sig:"UNSIGNED",pubkey:e.publicKey||""};f&&f(k);const{success:b,note:x}=await o(m,g);b&&x&&f&&f(x,k.id),b||n.onRemove&&n.onRemove(k.id)}},"onNewHighlight"),l=a(async()=>{if(!n.highlight||!e||n.highlight.pubkey!==e.publicKey)return;const d={...n.highlight};n.onRemove&&n.onRemove(n.highlight.id),await RI(d.id,e.proxyThroughPrimal,e.activeRelays,e?.relaySettings)},"onRemoveHighlight"),c=a(async()=>{if(n.highlight==="NEW_HIGHLIGHT"){const{success:d,note:f}=await o();d&&f&&n.onComment&&-n.onComment(f);return}n.onComment&&n.onComment(n.highlight)},"onComment"),u=a(async()=>{if(!e||!e?.hasPublicKey())return;if(n.highlight==="NEW_HIGHLIGHT"){const{success:f,note:p}=await o();if(!f||!p)return;const m=Ee.neventEncode({id:p.id,relays:e.activeRelays.map(g=>g.url),author:p.pubkey,kind:Q.Highlight});e?.actions?.quoteNote(`nostr:${m} nostr:${n.article.naddr}`),e?.actions?.showNewNoteForm(),n.onQuote&&n.onQuote(p);return}const d=Ee.neventEncode({id:n.highlight.id,relays:e.activeRelays.map(f=>f.url),author:n.highlight.pubkey,kind:Q.Highlight});e?.actions?.quoteNote(`nostr:${d} nostr:${n.article.naddr}`),e?.actions?.showNewNoteForm(),n.onQuote&&n.onQuote(n.highlight)},"onQuote"),h=a(d=>{d.preventDefault(),d.stopPropagation(),document.getSelection()?.empty?document.getSelection()?.empty():document.getSelection()?.removeAllRanges&&document.getSelection()?.removeAllRanges(),navigator.clipboard.writeText(n.text),n.onCopy&&n.onCopy(n.highlight.id)},"onCopy");return(()=>{const d=iE(),f=d.firstChild,p=f.firstChild,m=p.nextSibling;return H(d,O(_u,{get children(){return[O(kr,{get when(){return e?.publicKey&&n.highlight.pubkey===e?.publicKey},get children(){const g=eE(),k=g.firstChild,b=k.nextSibling;return g.$$mousedown=l,ne(x=>{const C=Ce.iconHighlightRemove,N=Ce.iconCaption;return C!==x._v$&&E(k,x._v$=C),N!==x._v$2&&E(b,x._v$2=N),x},{_v$:void 0,_v$2:void 0}),g}}),O(kr,{get when(){return e?.publicKey},get children(){const g=tE(),k=g.firstChild,b=k.nextSibling;return g.$$mousedown=s,ne(x=>{const C=Ce.iconHighlight,N=Ce.iconCaption;return C!==x._v$3&&E(k,x._v$3=C),N!==x._v$4&&E(b,x._v$4=N),x},{_v$3:void 0,_v$4:void 0}),g}})]}}),f),H(d,O(Se,{get when(){return e?.publicKey},get children(){return[(()=>{const g=nE(),k=g.firstChild,b=k.nextSibling;return g.$$mousedown=u,ne(x=>{const C=Ce.iconHighlightQuote,N=Ce.iconCaption;return C!==x._v$5&&E(k,x._v$5=C),N!==x._v$6&&E(b,x._v$6=N),x},{_v$5:void 0,_v$6:void 0}),g})(),(()=>{const g=rE(),k=g.firstChild,b=k.nextSibling;return g.$$mousedown=c,ne(x=>{const C=Ce.iconHighlightComment,N=Ce.iconCaption;return C!==x._v$7&&E(k,x._v$7=C),N!==x._v$8&&E(b,x._v$8=N),x},{_v$7:void 0,_v$8:void 0}),g})()]}}),f),f.$$mousedown=h,ne(g=>{const k=Ce.articleActionMenu,b=`top: ${t()}px; left: ${r()}px;`,x=Ce.iconHighlightCopy,C=Ce.iconCaption;return k!==g._v$9&&E(d,g._v$9=k),g._v$10=gm(d,b,g._v$10),x!==g._v$11&&E(p,g._v$11=x),C!==g._v$12&&E(m,g._v$12=C),g},{_v$9:void 0,_v$10:void 0,_v$11:void 0,_v$12:void 0}),d})()},"ArticleHighlightActionMenu"),lE=Ci(sE);Gl(["mousedown"]);var uk={},fd={};(function(n){n.__esModule=!0,n.default=i;var e=/[\u0300-\u036f]/g,t=//g,r=//g;function i(o){return o.toLowerCase().normalize("NFD").replace(e,"").replace(t,"l").replace(r,"n").trim()}a(i,"normalizeText")})(fd);var Xn={},um;function hm(){if(um)return Xn;um=1,Xn.__esModule=!0,Xn.aggressiveFuzzyMatch=c,Xn.createFuzzySearchImpl=f,Xn.experimentalSmartFuzzyMatch=u,Xn.fuzzyMatchImpl=d;var n=e(fd);function e(p){return p&&p.__esModule?p:{default:p}}a(e,"_interopRequireDefault");var t=Number.MAX_SAFE_INTEGER,r=a(function(m,g){return m.score-g.score},"sortByScore"),i=a(function(m,g){return m[0]-g[0]},"sortRangeTuple"),o=new Set(` []()-'"`.split(""));function s(p){return o.has(p)}a(s,"isValidWordBoundary");function l(p,m,g,k,b,x,C){if(p===k)return[0,[[0,p.length-1]]];var N=k.length,A=m.length,S=b.length;if(m===b)return[.1,[[0,A-1]]];if(m.startsWith(b))return[.5,[[0,S-1]]];var q=p.indexOf(k);if(q>-1&&s(p[q-1]))return[.9,[[q,q+N-1]]];var V=m.indexOf(b);if(V>-1&&s(m[V-1]))return[1,[[V,V+N-1]]];var F=x.length;if(F>1&&x.every(function(j){return g.has(j)})){var v=1.5+F*.2;return[v,x.map(function(j){var J=m.indexOf(j);return[J,J+j.length-1]}).sort(i)]}return V>-1?[2,[[V,V+N-1]]]:C==="aggressive"?c(m,b):C==="smart"?u(m,b):null}a(l,"matchesFuzzily");function c(p,m){for(var g=p.length,k=m.length,b=0,x=m[b],C=[],N=-1,A=-2,S=0;S<g;S+=1)if(p[S]===x){if(S!==A+1&&(N>=0&&C.push([N,A]),N=S),A=S,b+=1,b===k)return C.push([N,A]),h(C,p);x=m[b]}return null}a(c,"aggressiveFuzzyMatch");function u(p,m){for(var g=p.length,k=[],b=0,x=m[b],C=-1,N=-2;;){var A=p.indexOf(x,N+1);if(A===-1)break;if(A===0||s(p[A-1]))C=A;else{var S=m.length-b,q=p.length-A,V=Math.min(3,S,q),F=m.slice(b,b+V);if(p.slice(A,A+V)===F)C=A;else{N+=1;continue}}for(N=C;N<g&&p[N]===x;N+=1)b+=1,x=m[b];if(N-=1,k.push([C,N]),b===m.length)return h(k,p)}return null}a(u,"experimentalSmartFuzzyMatch");function h(p,m){var g=2;return p.forEach(function(k){var b=k[0],x=k[1],C=x-b+1,N=b===0||m[b]===" "||m[b-1]===" ",A=x===m.length-1||m[x]===" "||m[x+1]===" ",S=N&&A;S?g+=.2:N?g+=.4:C>=3?g+=.8:g+=1.6}),[g,p]}a(h,"scoreConsecutiveLetters");function d(p,m){var g=(0,n.default)(m),k=g.split(" "),b=(0,n.default)(p),x=new Set(b.split(" ")),C=l(p,b,x,m,g,k,"smart");return C?{item:p,score:C[0],matches:[C[1]]}:null}a(d,"fuzzyMatchImpl");function f(p,m){var g=m.strategy,k=g===void 0?"aggressive":g,b=m.getText,x=p.map(function(C){var N;if(b)N=b(C);else{var A=m.key?C[m.key]:C;N=[A]}var S=N.map(function(q){var V=q||"",F=(0,n.default)(V),v=new Set(F.split(" "));return[V,F,v]});return[C,S]});return function(C){var N=[],A=(0,n.default)(C),S=A.split(" ");return A.length?(x.forEach(function(q){for(var V=q[0],F=q[1],v=t,j=[],J=0,ce=F.length;J<ce;J+=1){var pe=F[J],se=pe[0],Ae=pe[1],Ne=pe[2],Oe=l(se,Ae,Ne,C,A,S,k);Oe?(v=Math.min(v,Oe[0]),j.push(Oe[1])):j.push(null)}v<t&&N.push({item:V,score:v,matches:j})}),N.sort(r),N):[]}}return a(f,"createFuzzySearchImpl"),Xn}a(hm,"requireImpl");(function(n){n.__esModule=!0,n.default=r,n.fuzzyMatch=i;var e=t(fd);n.normalizeText=e.default;function t(o){return o&&o.__esModule?o:{default:o}}a(t,"_interopRequireDefault");function r(o,s){return s===void 0&&(s={}),hm().createFuzzySearchImpl(o,s)}a(r,"createFuzzySearch");function i(o,s){return hm().fuzzyMatchImpl(o,s)}a(i,"fuzzyMatch")})(uk);const aE=fm(uk),cE=le("<div>"),uE=a(n=>{const[e,t]=je(),[r,i]=je("");return dl(async()=>{const o=document.createElement("div");try{const s=await bN.make().config(l=>{l.set(il,o),l.update(rl,c=>({...c,editable:()=>!1}))}).use(sT).use(kI).use($I).create();IM(n.content)(s.ctx),i(()=>Fp()(s.ctx)),t(()=>s)}catch(s){console.error("Failed init milkdown editor: ",s)}}),Ou(()=>e()?.destroy()),gt(()=>{const o=e();if(o&&n.highlights.length>0){let s=Fp()(o.ctx);const l=aE([n.original]),c=[];n.highlights.forEach(u=>{const h=l(u.content)[0];h&&c.push({item:h.item,hl:u,start:h.matches[0][0][0]||0,end:h.matches[0][0][1]||0})}),s=c.reduce((u,h)=>{let d=`${h.hl.content||""}`;const f=d.match(bk);let p=d;if(f&&n.article){const m=n.article.mentionedUsers&&n.article.mentionedUsers[ym(f[1])];return m&&(d=d.replaceAll(f[0],`<a href="${f[0]}" title="${f[1]}">@${St(m)}</a>`),p=d.replaceAll(`<a href="${f[0]}" title="${f[1]}">@${St(m)}</a>`,`@${St(m)}`)),u.replace(d,`${p}`).replace(p,`<a href="hl:${h.hl.id}" data-highlight="${h.hl.id}">${p}</a>`)}return u.replace(d,`<a href="hl:${h.hl.id}" data-highlight="${h.hl.id}">${d}</a>`)},s),i(()=>s)}}),(()=>{const o=cE();return ne(()=>o.innerHTML=kk.sanitize(r())),o})()},"MarkdownSlice"),mc=le("<div>"),hE=le('<div><div style="display:none;"></div><div>');function dE(n){const e=window.getSelection();if(!e?.rangeCount)return null;let t=e.getRangeAt(0).cloneRange();if(!t.getClientRects)return null;t.collapse(n);let r=t.getClientRects();if(r.length<=0)return null;let i=r[0];return{x:i.x,y:i.y}}a(dE,"getSelectionCoords");const fE=a(n=>{fn();const e=xk(),t=Eu(),r=km(),i=Du();let o,s;const[l,c]=je(),[u,h]=ao([]),d=a(()=>`note_${n.noteId}`,"id"),f=new Mm({gallery:`#${d()}`,children:`a.image_${n.noteId}`,showHideAnimationType:"zoom",initialZoomLevel:"fit",secondaryZoomLevel:2,maxZoomLevel:3,thumbSelector:`a.image_${n.noteId}`,pswpModule:()=>bm(()=>import("./photoswipe.esm-128e73ba.js"),[])});dl(()=>{f.init()});const[p,m]=je(),[g,k]=je(""),[b,x]=je(""),[C,N]=je(),[A,S]=je(),q=a(y=>{if(p()&&y===p().id)return;const _=n.highlights?.find(z=>z.id===y);if(_){const z=document.querySelector(`a[data-highlight="${_.id}"]`),D=z?.offsetLeft||0,B=z?.offsetTop||0;S(()=>({x:D,y:B})),k(()=>_.content),x(()=>_.tags.find(I=>I[0]==="context")||[])[1],m(()=>_),n.onHighlightSelected&&n.onHighlightSelected(_)}},"showHighlightMenu"),V=a(y=>{m(()=>{}),n.onHighlightSelected&&n.onHighlightSelected(void 0)},"hideHighlightMenu"),F=a(y=>{for(var _=[];y;y=y.parentNode)_.push(y);return _},"getParents"),v=a(y=>{if(y.target?.parentElement.getAttribute("data-highlight-menu-option")!==null)return;const z=document.getSelection();document.querySelector("a[data-highlight-selected")?.removeAttribute("data-highlight-selected");const D=F(y.target);if(!z||z.toString().length===0||!D.find(B=>B.className===bn.editor)){m(()=>{}),n.onHighlightSelected&&n.onHighlightSelected(void 0);return}N(()=>z),k(()=>z?.toString()),x(()=>z?.anchorNode?.parentElement?.innerText||""),j("NEW_HIGHLIGHT")},"onMouseUp"),j=a(y=>{const _=dE(!0),z=s?.getBoundingClientRect(),D=z?.left||0,B=z?.top||0;_&&S(()=>({x:_.x-D,y:_.y-B})),m(()=>y)},"showNewHighlightMenu");je();const J=a((y,_,z)=>{var D=y.substring(z||0).search(_);return D>=0?D+(z||0):D},"regexIndexOf"),ce=a((y,_,z,D=0)=>{let B=0,I=[];for(;B>=0;){const M=J(y,_,B);let L=1;if(M<0){if(B>0){I.push({index:B+D,value:y.substring(B),length:y.length,type:"md"});break}I.push({index:D,value:y,length:y.length,type:"md"});break}if(M>0){const X=y.substring(B,M);I.push({index:B+D,value:X,length:X.length,type:"md"})}const Z=y.slice(M).match(_);Z&&Z.length>0&&(L=Z[0].length,I.push({index:M+D,value:Z[0],length:L,type:z})),B=M+L}return I},"tokenizeByRegex"),pe=a((y,_,z,D)=>{let B=[];for(let I=0;I<y.length;I++){const M=y[I];if(M.type!==D){B.push({...M});continue}const L=ce(M.value,_,z,M.index);B.push(...L)}return B},"parseTokens"),se=a(y=>{let _=[{value:y,index:0,length:y.length,type:"md"}];return _=pe(_,Sk,"event","md"),_=pe(_,vk,"image","md"),_},"tokenizeContent"),Ae=a(y=>{if(y.type==="md"){const _=wk(y.value),z=_.replace(Ck,D=>{const[B,I]=D.split(":"),M=ym(I),L=n.article?.mentionedUsers&&n.article.mentionedUsers[M];return`[@${L?St(L):D}](${D} "${I}")`});return O(uE,{content:z,original:_,get article(){return n.article},get highlights(){return n.highlights||[]}})}if(y.type==="event"){let[_,z]=y.value.split(":");if(z.startsWith("nevent")){const D=Ee.decode(z).data,B=(n.article?.mentionedNotes||{})[D.id],I=B.post.kind||B.msg.kind;if(I===Q.Text&&(z=Ee.noteEncode(D.id)),I===Q.LongForm&&(z=Ee.naddrEncode({kind:I,pubkey:B.pubkey,identifier:(B.msg.tags.find(M=>M[0]==="d")||[])[1]})),I===void 0)return gc(()=>y.value)}if(z.startsWith("note")){const D=Ee.decode(z).data,B=(n.article?.mentionedNotes||{})[D];return O(Se,{when:B,get fallback(){return O(bc,{href:`/e/${z}`,get children(){return["nostr:",z]}})},get children(){const I=mc();return H(I,O(Wk,{get class(){return bn.embeddedNote},note:B,get mentionedUsers(){return B.mentionedUsers}})),ne(()=>E(I,bn.embeddedNote)),I}})}if(z.startsWith("naddr")){const D=n.article?.mentionedArticles&&n.article.mentionedArticles[z];return D?(()=>{const B=mc();return H(B,O(Jk,{article:D,bordered:!0,hideFooter:!0})),ne(()=>E(B,bn.articlePreview)),B})():["nostr:",z]}}if(y.type==="image"){let _="";if(y.value.startsWith("![")){let B=y.value.match(/\((.*?)\)/),I=y.value.match(/\[(.*?)\]/);_=B?B[1]:"",I&&I[1]}y.value.startsWith("http")&&(_=y.value);const z=r?.actions.getMedia(_,"o"),D=r?.actions.getMedia(_,"m")||r?.actions.getMedia(_,"o")||_;return O(xm,{get class(){return`noteimage image_${n.noteId}`},src:_,media:z,mediaThumb:D,width:640})}return gc(()=>y.value)},"renderToken");dl(async()=>{const y=se(n.content||"");h(()=>[...y]),s?.addEventListener("click",Ne),document?.addEventListener("mouseup",v)}),Ou(()=>{document?.removeEventListener("mouseup",v),s?.removeEventListener("click",Ne)});const Ne=a(y=>{y.preventDefault();const _=y.target;if(_.tagName==="A"){const z=_.getAttribute("href")||"",D=_.getAttribute("data-highlight")||"";if(z.startsWith("nostr:")){const[B,I]=z?.split(":");if(!I.startsWith("npub")&&!I.startsWith("note")&&!I.startsWith("nevent")&&!I.startsWith("naddr")&&!I.startsWith("nprofile"))return!1;const M=Ee.decode(I);switch(M.type){case"npub":t(i?.actions.profileLink(I)||"");break;case"note":t(`/e/${I}`);break;case"nprofile":const L=Qd(M.data.pubkey);t(i?.actions.profileLink(L)||"");break;case"nevent":if([Q.Text].includes(M.data.kind)){const Z=Ee.noteEncode(M.data.id);t(`/e/${Z}`)}if([Q.LongForm].includes(M.data.kind),[Q.Metadata].includes(M.data.kind)){const Z=Qd(M.data.id);t(i?.actions.profileLink(Z)||"")}break;case"naddr":[Q.Text,Q.LongForm].includes(M.data.kind)&&t(`/e/${I}`);break}return!1}return D?(q(D),_.setAttribute("data-highlight-selected","true"),!1):!0}},"onMouseClick"),Oe=a(()=>l()?.action(Fi(jo.key)),"undo"),dt=a(()=>l()?.action(Fi(jo.key)),"redo"),w=a(()=>l()?.action(Fi(ua.key)),"bold"),R=a(()=>l()?.action(Fi(ca.key)),"italic"),K=a(()=>l()?.action(Fi(od.key)),"table");return(()=>{const y=hE(),_=y.firstChild,z=_.nextSibling;H(y,O(Se,{get when(){return!n.readonly},get children(){const I=mc();return H(I,O(Ri,{onClick:Oe,children:"Undo"}),null),H(I,O(Ri,{onClick:dt,children:"Redo"}),null),H(I,O(Ri,{onClick:w,children:"Bold"}),null),H(I,O(Ri,{onClick:R,children:"Italic"}),null),H(I,O(Ri,{onClick:K,children:"Table"}),null),ne(()=>E(I,bn.toolbar)),I}}),_);const D=o;typeof D=="function"?hl(D,_):o=_;const B=s;return typeof B=="function"?hl(B,z):s=z,H(z,O(Se,{get when(){return p()},get children(){return O(lE,{get highlight(){return p()},get position(){return A()},get text(){return g()},get context(){return b()},get selection(){return C()},get article(){return n.article},onCreate:(I,M)=>{V(I.id),n.onHighlightCreated&&n.onHighlightCreated(I,M)},onRemove:I=>{e?.sendSuccess("Highlight removed"),V(),n.onHighlightRemoved&&n.onHighlightRemoved(I)},onComment:I=>{V(I.id),n.onHighlightReply&&n.onHighlightReply(I)},onCopy:I=>{I?e?.sendSuccess("Highlight copied"):e?.sendSuccess("Text copied"),V(),n.onHighlightDeselected&&n.onHighlightDeselected()},onQuote:I=>{V(I.id),n.onHighlightQuoted&&n.onHighlightQuoted(I)}})}}),null),H(z,O(Se,{get when(){return n.article},get children(){return O(ln,{each:u,children:Ae})}}),null),ne(I=>{const M=bn.primalMarkdown,L=bn.editor,Z=d(),X=bn.editor;return M!==I._v$&&E(y,I._v$=M),L!==I._v$2&&E(_,I._v$2=L),Z!==I._v$3&&$r(z,"id",I._v$3=Z),X!==I._v$4&&E(z,I._v$4=X),I},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),y})()},"PrimalMarkdown"),pE=le("<div><div>"),mE=a(n=>(()=>{const e=pE(),t=e.firstChild;return ne(r=>{const i=be.articleTotalZapsSkeleton,o=be.zapNumber;return i!==r._v$&&E(e,r._v$=i),o!==r._v$2&&E(t,r._v$2=o),r},{_v$:void 0,_v$2:void 0}),e})(),"ArticleTotalZapsSkeleton"),gE=le("<div>Total zaps"),yE=le("<div><div><span></span><span></span><span>sats"),kE=le("<div>More Reads from "),Bi=le("<div>"),bE=a(n=>{const e=ls(),t=fn(),[r,i]=ao([]),[o,s]=je(!1),l=a(async()=>{const c=`article_recomended_${sn}`;s(()=>!0);const h=(await Nk(t?.publicKey,n.user.pubkey,"authored",c)).filter(f=>f.id!==n.article.id),d=Mk(0,h.length,3);i(()=>d.map(f=>h[f])),s(()=>!1)},"getArticles");return gt(()=>{t?.isKeyLookupDone&&n.user&&l()}),(()=>{const c=Bi();return H(c,O(qk,{name:"slide-fade",get children(){return O(Se,{get when(){return t?.isKeyLookupDone&&n.article},get fallback(){return[(()=>{const u=Bi();return H(u,O(mE,{})),ne(()=>E(u,It.section)),u})(),(()=>{const u=Bi();return H(u,O(ba,{}),null),H(u,O(ba,{}),null),H(u,O(ba,{}),null),ne(()=>E(u,It.section)),u})()]},get children(){return O(Se,{get when(){return!o()},get fallback(){return"BOJAN"},get children(){const u=Bi();return H(u,O(Se,{get when(){return n.article.satszapped>0},get children(){return[(()=>{const h=gE();return ne(()=>E(h,`${It.headingPicks} animated`)),h})(),(()=>{const h=yE(),d=h.firstChild,f=d.firstChild,p=f.nextSibling,m=p.nextSibling;return H(p,()=>e.formatNumber(n.article.satszapped)),ne(g=>{const k=`${It.section} animated`,b=It.totalZaps,x=It.totalZapsIcon,C=It.amount,N=It.unit;return k!==g._v$&&E(h,g._v$=k),b!==g._v$2&&E(d,g._v$2=b),x!==g._v$3&&E(f,g._v$3=x),C!==g._v$4&&E(p,g._v$4=C),N!==g._v$5&&E(m,g._v$5=N),g},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),h})()]}}),null),H(u,O(Se,{get when(){return r.length>0},get children(){return[(()=>{const h=kE();return h.firstChild,H(h,()=>St(n.article.user),null),ne(()=>E(h,`${It.headingReads} animated`)),h})(),(()=>{const h=Bi();return H(h,O(ln,{each:r,children:d=>O(Yk,{article:d,short:!0})})),ne(()=>E(h,`${It.section} animated`)),h})()]}}),null),u}})}})}})),ne(u=>{const h=n.id,d=It.articleSidebar;return h!==u._v$6&&$r(c,"id",u._v$6=h),d!==u._v$7&&E(c,u._v$7=d),u},{_v$6:void 0,_v$7:void 0}),c})()},"ArticleSidebar"),xE=Ci(bE),wE=le("<div>..."),CE=le("<span>and <span>"),SE=le("<span>and <!> others"),vE=le("<div><div><div><div></div></div><div><span></span><span>highlighted"),NE=le("<div><div><div></div><div></div></div><div>"),ME=a(n=>{fn();const e=a(()=>n.comments.filter(h=>h.replyTo===n.highlight.id),"comms"),[t,r]=je(-1),[i,o]=je(-1);let s;gt(()=>{const h=n.highlight;if(!h||!s)return;const d=document.querySelector(`a[data-highlight="${h.id}"]`);if(!d)return;const f=d.getBoundingClientRect().top,p=window.innerHeight-104,m=84,g=s.offsetHeight||78,k=Math.min(p,g),b=g>=p?m:Math.max(f-k/2,m);r(()=>b),o(()=>k)});const[l,c]=je([]);gt(()=>{const h=n.getCoAuthors(n.highlight);c(()=>[...h])});const u=a(()=>{let h="";return t()>=0&&(h+=`top: ${t()}px; `),h+=`max-height: ${window.innerHeight-104}px;`,h},"style$1");return O(Se,{get when(){return n.highlight!==void 0},get children(){const h=vE(),d=h.firstChild,f=d.firstChild,p=f.firstChild,m=f.nextSibling,g=m.firstChild,k=g.nextSibling,b=s;return typeof b=="function"?hl(b,h):s=h,H(f,O(Pn,{get user(){return n.author},size:"xxs"}),null),H(f,O(ln,{get each(){return l().slice(0,5)},children:x=>O(Pn,{user:x,size:"xxs"})}),null),H(f,O(Se,{get when(){return l().length>5},get children(){const x=wE();return ne(()=>E(x,Ce.dots)),x}}),null),H(g,()=>St(n.author)),H(m,O(Se,{get when(){return l().length===1},get children(){const x=CE(),C=x.firstChild,N=C.nextSibling;return H(N,()=>St(l()[0])),ne(A=>{const S=Ce.suffix,q=Ce.name;return S!==A._v$&&E(x,A._v$=S),q!==A._v$2&&E(N,A._v$2=q),A},{_v$:void 0,_v$2:void 0}),x}}),k),H(m,O(Se,{get when(){return l().length>1},get children(){const x=SE(),C=x.firstChild,N=C.nextSibling;return N.nextSibling,H(x,()=>l().length,N),ne(()=>E(x,Ce.suffix)),x}}),k),H(h,O(ln,{get each(){return e()},children:x=>(()=>{const C=NE(),N=C.firstChild,A=N.firstChild,S=A.nextSibling,q=N.nextSibling;return H(N,O(Pn,{get user(){return x.user},size:"xxs"}),A),H(A,()=>St(x.user)),H(N,O(wm,{get user(){return x.user}}),S),H(S,()=>Kk(x.msg.created_at||0).label),H(q,()=>x.content),ne(V=>{const F=Ce.highlightComment,v=Ce.commentAuthor,j=Ce.name,J=Ce.time,ce=Ce.commentContent;return F!==V._v$12&&E(C,V._v$12=F),v!==V._v$13&&E(N,V._v$13=v),j!==V._v$14&&E(A,V._v$14=j),J!==V._v$15&&E(S,V._v$15=J),ce!==V._v$16&&E(q,V._v$16=ce),V},{_v$12:void 0,_v$13:void 0,_v$14:void 0,_v$15:void 0,_v$16:void 0}),C})()}),null),ne(x=>{const C=Ce.articleHighlightComments,N=n.highlight.id,A=u(),S=Ce.header,q=Ce.author,V=Ce.iconHighlight,F=Ce.caption,v=Ce.name,j=Ce.suffix;return C!==x._v$3&&E(h,x._v$3=C),N!==x._v$4&&$r(h,"data-highlight",x._v$4=N),x._v$5=gm(h,A,x._v$5),S!==x._v$6&&E(d,x._v$6=S),q!==x._v$7&&E(f,x._v$7=q),V!==x._v$8&&E(p,x._v$8=V),F!==x._v$9&&E(m,x._v$9=F),v!==x._v$10&&E(g,x._v$10=v),j!==x._v$11&&E(k,x._v$11=j),x},{_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0,_v$10:void 0,_v$11:void 0}),h}})},"ArticleHighlightComments"),TE=Ci(ME),$E=le("<div><div><div></div><div>"),AE=le("<div>"),IE=le("<button><div></div><div><div>"),EE=a(n=>{const e=ls(),[t,r]=je(!1),i=fn(),o=a(()=>i?.activeUser,"activeUser"),s=a(()=>{r(!0),document.getElementById("reply_to_editor")?.scrollIntoView({block:"nearest",behavior:"smooth"})},"openReplyBox"),l=a(()=>{r(!1),n.onCancel&&n.onCancel()},"closeReplyToNote"),c=a(()=>({id:n.highlight.id,noteId:n.highlight.id,msg:{...n.highlight},user:n.author,pubkey:i?.publicKey}),"highlight");return gt(()=>{if(t())setTimeout(()=>{const u=document.getElementById("reply_new_note_text_area");u&&u?.focus()},100);else{const u=document.getElementById("reply_new_note_text_area");if(!u)return;u.value=""}}),(()=>{const u=AE();return H(u,O(Se,{get when(){return t()},get fallback(){return(()=>{const h=IE(),d=h.firstChild,f=d.nextSibling,p=f.firstChild;return h.$$click=s,H(d,O(Pn,{size:"sm",get user(){return o()}})),H(p,()=>e.formatMessage(pm.noteReply,{name:St(n.author)})),ne(m=>{const g=`trigger_${n.id}`,k=ot.replyBox,b=ot.leftSideClosed,x=ot.input;return g!==m._v$5&&$r(h,"id",m._v$5=g),k!==m._v$6&&E(h,m._v$6=k),b!==m._v$7&&E(d,m._v$7=b),x!==m._v$8&&E(f,m._v$8=x),m},{_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0}),h})()},get children(){const h=$E(),d=h.firstChild,f=d.firstChild,p=f.nextSibling;return H(f,O(Pn,{size:"md",get user(){return o()}})),H(p,O(Sm,{id:"reply_to_editor",idPrefix:"reply_",get open(){return t()},get replyToNote(){return c()},onClose:l,get onSuccess(){return n.onNotePosted},get context(){return n.highlight.content}})),ne(m=>{const g=ot.newNoteBorder,k=ot.newNote,b=ot.leftSide,x=ot.rightSide;return g!==m._v$&&E(h,m._v$=g),k!==m._v$2&&E(d,m._v$2=k),b!==m._v$3&&E(f,m._v$3=b),x!==m._v$4&&E(p,m._v$4=x),m},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),h}})),ne(()=>$r(u,"id",n.id)),u})()},"ReplyToHighlight"),OE=Ci(EE);Gl(["click"]);const _E=le("<div><div><div></div><div><div></div><div></div></div></div><div><div><div></div><div></div></div><div></div><div></div><div>"),DE=a(n=>(()=>{const e=_E(),t=e.firstChild,r=t.firstChild,i=r.nextSibling,o=i.firstChild,s=o.nextSibling,l=t.nextSibling,c=l.firstChild,u=c.firstChild,h=u.nextSibling,d=c.nextSibling,f=d.nextSibling,p=f.nextSibling;return ne(m=>{const g=be.articleSkeleton,k=be.header,b=be.avatar,x=be.userInfo,C=be.name,N=be.nip05,A=be.body,S=be.toolbar,q=be.time,V=be.title,F=be.image,v=be.summary,j=be.content;return g!==m._v$&&E(e,m._v$=g),k!==m._v$2&&E(t,m._v$2=k),b!==m._v$3&&E(r,m._v$3=b),x!==m._v$4&&E(i,m._v$4=x),C!==m._v$5&&E(o,m._v$5=C),N!==m._v$6&&E(s,m._v$6=N),A!==m._v$7&&E(l,m._v$7=A),S!==m._v$8&&E(c,m._v$8=S),q!==m._v$9&&E(u,m._v$9=q),V!==m._v$10&&E(h,m._v$10=V),F!==m._v$11&&E(d,m._v$11=F),v!==m._v$12&&E(f,m._v$12=v),j!==m._v$13&&E(p,m._v$13=j),m},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0,_v$10:void 0,_v$11:void 0,_v$12:void 0,_v$13:void 0}),e})(),"ArticleSkeleton"),_s=le("<div>"),RE=le("<div><div><div>"),zE=le("<div>via "),PE=le("<div><div></div><div>"),FE=le("<div><div></div><div><div><div></div></div><div></div></div><div></div><div>"),dm={article:void 0,replies:[],page:{messages:[],users:{},postStats:{},mentions:{},noteActions:{},topZaps:{},wordCount:{}},users:[],isFetching:!1,lastReply:void 0,hasTiers:!1,highlights:[],heighlightsPage:{messages:[],users:{},postStats:{},mentions:{},noteActions:{},topZaps:{},wordCount:{}},heightlightReplies:[],selectedHighlight:void 0,replyToHighlight:void 0,noContent:!1},LE=a(n=>{const e=fn(),t=Du(),r=km();Tk(),Cm(),ls();const[i,o]=ao({...dm});ao();const s=a(()=>n.naddr,"naddr");let l="",c="",u;gt(()=>{const R=i.article;if(!R)return;const{likes:K,reposts:y,replies:_,zaps:z,satszapped:D}=R;d(()=>({likes:K,reposts:y,replies:_,zapCount:z,satsZapped:D}))});const[h,d]=ao({likes:i.article?.likes||0,liked:!1,reposts:i.article?.reposts||0,reposted:!1,replies:i.article?.replies||0,replied:!1,zapCount:i.article?.zaps||0,satsZapped:i.article?.satszapped||0,zapped:!1,zappedAmount:0,zappedNow:!1,isZapping:!1,showZapAnim:!1,hideZapIcon:!1,moreZapsAvailable:!1,isRepostMenuVisible:!1,topZaps:[],topZapsFeed:[],quoteCount:0}),f=new Mm({gallery:`#read_${s()}`,children:`a.hero_image_${s()}`,showHideAnimationType:"zoom",initialZoomLevel:"fit",secondaryZoomLevel:2,maxZoomLevel:3,thumbSelector:`a.hero_image_${s()}`,pswpModule:()=>bm(()=>import("./photoswipe.esm-128e73ba.js"),[])});dl(()=>{F(),v(),Oe()}),gt(()=>{i.article&&f.init()}),gt(()=>{i.article?.user&&g(i.article.user)}),gt(()=>{d("topZaps",()=>[...i.article?.topZaps||[]])});const p=a(()=>{if(i.article?.image)return r?.actions.getMedia(i.article.image,"o")},"articleMediaImage"),m=a(()=>{if(i.article?.image)return r?.actions.getMedia(i.article.image,"m")||r?.actions.getMedia(i.article.image,"o")||i.article.image},"articleMediaThumb"),g=a(R=>{if(!R)return;const K=`article_tiers_${sn}`,y=Ds(K,{onEvent:(_,z)=>{if(z.kind!==Q.TierList&&z.kind===Q.Tier){o("hasTiers",()=>!0);return}},onEose:()=>{y()}});$k(R.pubkey,K)},"getTiers"),k=a(R=>{t?.actions.closeCustomZapModal(),Di(()=>{d("zappedAmount",()=>R.amount||0),d("satsZapped",K=>K+(R.amount||0)),d("zapped",()=>!0),d("showZapAnim",()=>!0)}),N(R),S(R)},"onConfirmZap"),b=a(R=>{t?.actions.closeCustomZapModal(),t?.actions.resetCustomZap(),e?.publicKey&&Di(()=>{d("zapCount",y=>y+1),d("isZapping",()=>!1),d("showZapAnim",()=>!1),d("hideZapIcon",()=>!1),d("zapped",()=>!0)})},"onSuccessZap"),x=a(R=>{t?.actions.closeCustomZapModal(),t?.actions.resetCustomZap(),Di(()=>{d("zappedAmount",()=>-(R.amount||0)),d("satsZapped",K=>K-(R.amount||0)),d("isZapping",()=>!1),d("showZapAnim",()=>!1),d("hideZapIcon",()=>!1),d("zapped",()=>i.article?i.article.noteActions.zapped:!1)}),A(),q()},"onFailZap"),C=a(R=>{t?.actions.closeCustomZapModal(),t?.actions.resetCustomZap(),Di(()=>{d("zappedAmount",()=>-(R.amount||0)),d("satsZapped",K=>K-(R.amount||0)),d("isZapping",()=>!1),d("showZapAnim",()=>!1),d("hideZapIcon",()=>!1),d("zapped",()=>i.article?i.article.noteActions.zapped:!1)}),A(),q()},"onCancelZap"),N=a(R=>{const K=e?.publicKey;if(!K||!i.article)return;const y=[...h.topZaps];l=rf();const _={amount:R.amount||0,message:R.message||"",pubkey:K,eventId:i.article.id,id:l};if(!i.users.find(D=>D.pubkey===K)){const D=`article_pk_${sn}`,B=Ds(D,{onEvent:(I,M)=>{M&&j(M)},onEose:()=>{B(),J(i.page)}});Ok([K],D)}const z=[...y,{..._}].sort((D,B)=>B.amount-D.amount);d("topZaps",()=>[...z])},"addTopZap"),A=a(R=>{const K=h.topZaps.filter(y=>y.id!==l);d("topZaps",()=>[...K])},"removeTopZap"),S=a(R=>{const K=e?.publicKey;if(!K||!i.article)return;const y=[...h.topZapsFeed];c=rf();const _={amount:R.amount||0,message:R.message||"",pubkey:K,eventId:i.article.id,id:c},z=[...y,{..._}].sort((D,B)=>B.amount-D.amount).slice(0,4);d("topZapsFeed",()=>[...z])},"addTopZapFeed"),q=a(R=>{const K=h.topZapsFeed.filter(y=>y.id!==c);d("topZapsFeed",()=>[...K])},"removeTopZapFeed"),V=a(()=>({note:i.article,onConfirm:k,onSuccess:b,onFail:x,onCancel:C}),"customZapInfo"),F=a(()=>{o(()=>({...dm}))},"clearArticle"),v=a(async()=>{o("isFetching",()=>!0);const{users:R,notes:K,reads:y}=await Ak(e?.publicKey,s(),`thread_read_${s()}_${sn}`),_=y.find(z=>{if(z.noteId===s())return!0;const D=_i(s()),B=_i(z.naddr),I=`${D.data.kind}_${D.data.pubkey}_${D.data.identifier}`,M=`${B.data.kind}_${B.data.pubkey}_${B.data.identifier}`;return I===M});Di(()=>{o("users",()=>[...R]),o("replies",()=>[...K]),o("article",()=>({..._}))}),o("isFetching",()=>!1)},"fetchArticle"),j=a(R=>{if(R.kind===Q.Metadata){const K=R;o("page","users",y=>({...y,[K.pubkey]:{...K}}));return}if([Q.LongForm,Q.LongFormShell,Q.Text,Q.Repost].includes(R.kind)){const K=R;i.lastReply?.noteId!==Ee.noteEncode(K.id)&&o("page","messages",y=>[...y,{...K}]);return}if(R.kind===Q.NoteStats){const y=JSON.parse(R.content);o("page","postStats",_=>({..._,[y.event_id]:{...y}}));return}if(R.kind===Q.Mentions){const y=JSON.parse(R.content);let _=y.id;o("page","mentions",z=>({...z,[_]:{...y}})),[Q.LongForm,Q.LongFormShell].includes(y.kind)&&(_=Ee.naddrEncode({identifier:(y.tags.find(z=>z[0]==="d")||[])[1],pubkey:y.pubkey,kind:y.kind}),o("page","mentions",z=>({...z,[_]:{...y}})));return}if(R.kind===Q.NoteActions){const y=JSON.parse(R.content);o("page","noteActions",_=>({..._,[y.event_id]:{...y}}));return}if(R.kind===Q.LinkMetadata){const y=JSON.parse(R.content).resources[0];if(!y)return;const _={url:y.url,title:y.md_title,description:y.md_description,mediaType:y.mimetype,contentType:y.mimetype,images:[y.md_image],favicons:[y.icon_url]};Xd(()=>({[y.url]:_}));return}if(R.kind===Q.RelayHint){const K=JSON.parse(R.content);o("page","relayHints",y=>({...y,...K}))}if(R?.kind===Q.Zap){const K=R.tags.find(Z=>Z[0]==="description");if(!K)return;const y=JSON.parse(K[1]||"{}");let _="0",z=R?.tags?.find(Z=>Z[0]==="bolt11");if(z)try{_=`${ef(z[1])||0}`}catch{const X=y.tags.find(_e=>_e[0]==="amount");_=X?X[1]:"0"}const D=y.tags.find(Z=>Z[0]==="a");let B=(y.tags.find(Z=>Z[0]==="e")||[])[1];if(D){const Z=D[1],[X,_e,Fe]=Z.split(":");B=Ee.naddrEncode({kind:X,pubkey:_e,identifier:Fe})}const I={id:y.id,amount:parseInt(_||"0"),pubkey:y.pubkey,message:y.content,eventId:B},M=i.page.topZaps[B];if(M===void 0){o("page","topZaps",()=>({[B]:[{...I}]}));return}if(M.find(Z=>Z.id===I.id))return;const L=[...M,{...I}].sort((Z,X)=>X.amount-Z.amount);o("page","topZaps",B,()=>[...L]);return}},"updatePage"),J=a(R=>{const K={...R,messages:R.messages.filter(B=>B.kind===Q.Text)},y=Object.values(R.users).map(B=>tf(B,B.pubkey)),_=yc(nf(K,K.topZaps)),D=_k(R,R.topZaps).find(B=>{if(B.noteId===s())return!0;const I=_i(s()),M=_i(B.naddr),L=`${I.data.kind}_${I.data.pubkey}_${I.data.identifier}`,Z=`${M.data.kind}_${M.data.pubkey}_${M.data.identifier}`;return L===Z});o("users",()=>[...y]),o("replies",B=>[...B,..._]),o("article",()=>({...D})),o("isFetching",()=>!1)},"savePage"),ce=a((R="likes")=>{i.article&&t?.actions.openReactionModal(i.article.naddr,{likes:h.likes,zaps:h.zapCount,reposts:h.reposts,quotes:h.quoteCount,openOn:R})},"openReactionModal"),pe=a(()=>{i.article&&t?.actions.openContextMenu(i.article,u?.getBoundingClientRect(),()=>{t?.actions.openCustomZapModal(V())},ce)},"onContextMenuTrigger"),se=a(async R=>{const{success:K,note:y}=R;if(!K||!y||!e)return;const _=await kc(e.publicKey,[y.id],`reads_reply_${sn}`);o("replies",z=>[..._,...z])},"onReplyPosted"),Ae=a(async R=>{const{success:K,note:y}=R;if(!K||!y||!e)return;Ne(i.replyToHighlight.id);const _=await kc(e.publicKey,[y.id],`reads_reply_${sn}`);o("heightlightReplies",z=>[..._,...z]),o("replyToHighlight",()=>{})},"onHighlightPosted"),Ne=a(R=>{const K=document.querySelector(`a[data-highlight="${R}"]`);if(K){const y=K.offsetTop;window.scrollTo({top:y,behavior:"smooth"})}},"scrollToHighlight"),Oe=a(()=>{const R=_i(s()),{pubkey:K,identifier:y,kind:_}=R.data;if(![Q.LongForm,Q.LongFormShell].includes(_))return;const z=`lf_highlights_${s()}`,D=Ds(z,{onEvent:(B,I)=>{if(I.kind===Q.Highlight&&o("highlights",i.highlights.length,()=>I),I.kind===Q.Metadata){const M=I;o("heighlightsPage","users",L=>({...L,[M.pubkey]:{...M}}));return}if([Q.LongForm,Q.LongFormShell,Q.Text,Q.Repost].includes(I.kind)){const M=I;i.lastReply?.noteId!==Ee.noteEncode(M.id)&&o("heighlightsPage","messages",L=>[...L,{...M}]);return}if(I.kind===Q.NoteStats){const L=JSON.parse(I.content);o("heighlightsPage","postStats",Z=>({...Z,[L.event_id]:{...L}}));return}if(I.kind===Q.Mentions){const L=JSON.parse(I.content);let Z=L.id;o("heighlightsPage","mentions",X=>({...X,[Z]:{...L}})),[Q.LongForm,Q.LongFormShell].includes(L.kind)&&(Z=Ee.naddrEncode({identifier:(L.tags.find(X=>X[0]==="d")||[])[1],pubkey:L.pubkey,kind:L.kind}),o("heighlightsPage","mentions",X=>({...X,[Z]:{...L}})));return}if(I.kind===Q.NoteActions){const L=JSON.parse(I.content);o("heighlightsPage","noteActions",Z=>({...Z,[L.event_id]:{...L}}));return}if(I.kind===Q.LinkMetadata){const L=JSON.parse(I.content).resources[0];if(!L)return;const Z={url:L.url,title:L.md_title,description:L.md_description,mediaType:L.mimetype,contentType:L.mimetype,images:[L.md_image],favicons:[L.icon_url]};Xd(()=>({[L.url]:Z}));return}if(I.kind===Q.RelayHint){const M=JSON.parse(I.content);o("heighlightsPage","relayHints",L=>({...L,...M}))}if(I?.kind===Q.Zap){const M=I.tags.find(kt=>kt[0]==="description");if(!M)return;const L=JSON.parse(M[1]||"{}");let Z="0",X=I?.tags?.find(kt=>kt[0]==="bolt11");if(X)try{Z=`${ef(X[1])||0}`}catch{const Zn=L.tags.find(Ss=>Ss[0]==="amount");Z=Zn?Zn[1]:"0"}const _e=(L.tags.find(kt=>kt[0]==="e")||[])[1],Fe={id:L.id,amount:parseInt(Z||"0"),pubkey:L.pubkey,message:L.content,eventId:_e},Ye=i.page.topZaps[_e];if(Ye===void 0){o("heighlightsPage","topZaps",()=>({[_e]:[{...Fe}]}));return}if(Ye.find(kt=>kt.id===Fe.id))return;const Jn=[...Ye,{...Fe}].sort((kt,Zn)=>Zn.amount-kt.amount);o("heighlightsPage","topZaps",_e,()=>[...Jn]);return}},onEose:()=>{D(),dt(i.heighlightsPage)}});Ik(K,y,_,z,e?.publicKey)},"fetchHighlights"),dt=a(R=>{const K=Object.values(R.users).map(D=>tf(D,D.pubkey)),y=yc(nf(R,R.topZaps)),_=i.users.map(D=>D.pubkey),z=K.filter(D=>!_.includes(D.pubkey));o("users",D=>[...D,...z]),o("heightlightReplies",D=>[...D,...y])},"saveHighlightsPage"),w=a(R=>{if(!R)return[];const K=R.id,y=R.content,_=(R.tags.find(D=>D[0]==="context")||[])[1],z=i.highlights.filter(D=>{const B=(D.tags.find(I=>I[0]==="context")||[])[1];return D.content===y&&B===_&&D.id!==K}).reduce((D,B)=>D.includes(B.pubkey)||B.pubkey===R.pubkey?[...D]:[...D,B.pubkey],[]);return i.users.filter(D=>z.includes(D.pubkey))},"selectedHighlightCoAuthors");return[O(fl,{to:"search_section",get children(){return O(vm,{})}}),O(fl,{to:"right_sidebar",get children(){return[O(xE,{get user(){return i.article?.user},get article(){return i.article}}),O(TE,{get highlight(){return i.selectedHighlight},get comments(){return i.heightlightReplies},get author(){return i.users.find(R=>R.pubkey===i.selectedHighlight.pubkey)},getCoAuthors:w})]}}),O(Nm,{name:"slide-fade",get children(){return O(Se,{get when(){return i.article},get fallback(){return O(DE,{})},get children(){return O(Se,{get when(){return!i.noContent},get fallback(){return O(Qk,{title:"Read not found"})},get children(){const R=FE(),K=R.firstChild,y=K.nextSibling,_=y.firstChild,z=_.firstChild,D=_.nextSibling,B=y.nextSibling,I=B.nextSibling;return H(K,O(Se,{get when(){return i.article?.user},get children(){return O(bc,{get href(){return t?.actions.profileLink(i.article?.user.npub)||""},get children(){const M=RE(),L=M.firstChild,Z=L.firstChild;return H(M,O(Pn,{get user(){return i.article?.user},size:"sm"}),L),H(Z,()=>St(i.article?.user),null),H(Z,O(wm,{get user(){return i.article?.user}}),null),H(L,O(Se,{get when(){return i.article?.user.nip05},get children(){const X=_s();return H(X,()=>Ek(i.article?.user)),ne(()=>E(X,De.nip05)),X}}),null),ne(X=>{const _e=De.author,Fe=De.userInfo,Ye=De.userName;return _e!==X._v$&&E(M,X._v$=_e),Fe!==X._v$2&&E(L,X._v$2=Fe),Ye!==X._v$3&&E(Z,X._v$3=Ye),X},{_v$:void 0,_v$2:void 0,_v$3:void 0}),M}})}})),H(z,()=>Uk(i.article?.published)),H(_,O(Se,{get when(){return i.article?.client},get children(){const M=zE();return M.firstChild,H(M,()=>i.article?.client,null),ne(()=>E(M,De.client)),M}}),null),H(D,O(Zk,{get note(){return i.article}}),null),H(D,O(Lk,{ref(M){const L=u;typeof L=="function"?L(M):u=M},onClick:pe}),null),H(B,O(Se,{get when(){return i.article},get children(){return[(()=>{const M=_s();return H(M,()=>i.article?.title),ne(()=>E(M,De.title)),M})(),O(Se,{get when(){return(i.article?.image||"").length>0},get children(){return O(xm,{get class(){return`${De.image} hero_image_${s()}`},get src(){return i.article?.image},get media(){return p()},get mediaThumb(){return m()},width:640})}}),(()=>{const M=PE(),L=M.firstChild,Z=L.nextSibling;return H(Z,()=>i.article?.summary),ne(X=>{const _e=De.summary,Fe=De.border,Ye=De.text;return _e!==X._v$4&&E(M,X._v$4=_e),Fe!==X._v$5&&E(L,X._v$5=Fe),Ye!==X._v$6&&E(Z,X._v$6=Ye),X},{_v$4:void 0,_v$5:void 0,_v$6:void 0}),M})(),O(Bk,{get topZaps(){return h.topZaps},get zapCount(){return h.zapCount},get users(){return i.users},action:()=>ce("zaps"),doZap:()=>t?.actions.openCustomZapModal(V())}),O(fE,{get noteId(){return n.naddr},get content(){return i.article?.content||""},readonly:!0,get article(){return i.article},get highlights(){return i.highlights},onHighlightSelected:M=>{if(!M){o("selectedHighlight",()=>{});return}o("selectedHighlight",()=>({...M}))},onHighlightDeselected:()=>{o("selectedHighlight",()=>{})},onHighlightCreated:(M,L)=>{o("highlights",i.highlights.length,()=>({...M})),o("selectedHighlight",()=>{}),L&&i.highlights.find(Z=>Z.id===L)&&o("highlights",Z=>Z.filter(X=>X.id!==L))},onHighlightRemoved:M=>{o("highlights",L=>L.filter(Z=>Z.id!==M))},onHighlightReply:M=>{i.highlights.find(Z=>Z.id===M.id)||o("highlights",i.highlights.length,()=>({...M})),o("replyToHighlight",()=>({...M})),setTimeout(()=>{document.querySelector(`#trigger_reply_${M.id}`).click(),o("selectedHighlight",()=>{})},10)},onHighlightQuoted:M=>{i.highlights.find(Z=>Z.id===M.id)||o("highlights",i.highlights.length,()=>({...M})),o("selectedHighlight",()=>{})}}),(()=>{const M=_s();return H(M,O(ln,{get each(){return i.article?.tags},children:L=>O(bc,{href:`/reads/${L}`,get class(){return De.tag},children:L})})),ne(()=>E(M,De.tags)),M})(),(()=>{const M=_s();return H(M,O(Gk,{get note(){return i.article},state:h,updateState:d,get customZapInfo(){return V()},onZapAnim:S,size:"xwide"})),ne(()=>E(M,De.footer)),M})()]}})),H(R,O(_u,{get children(){return[O(kr,{get when(){return i.replyToHighlight},get children(){return O(OE,{get id(){return`reply_${i.replyToHighlight.id}`},get highlight(){return i.replyToHighlight},get author(){return i.users.find(M=>M.pubkey===i.replyToHighlight.pubkey)},onNotePosted:Ae,onCancel:()=>{Ne(i.replyToHighlight.id),o("replyToHighlight",()=>{})}})}}),O(kr,{get when(){return i.article},get children(){return O(Hy,{get note(){return i.article},onNotePosted:se})}})]}}),I),H(I,O(ln,{get each(){return i.replies},children:M=>O(Rs,{note:M,noteType:"thread",shorten:!0,size:"xwide"})})),ne(M=>{const L=De.header,Z=`${De.topBar} animated`,X=De.left,_e=De.time,Fe=De.right,Ye=`read_${s()}`,Jn=`${De.longform} animated`;return L!==M._v$7&&E(K,M._v$7=L),Z!==M._v$8&&E(y,M._v$8=Z),X!==M._v$9&&E(_,M._v$9=X),_e!==M._v$10&&E(z,M._v$10=_e),Fe!==M._v$11&&E(D,M._v$11=Fe),Ye!==M._v$12&&$r(B,"id",M._v$12=Ye),Jn!==M._v$13&&E(B,M._v$13=Jn),M},{_v$7:void 0,_v$8:void 0,_v$9:void 0,_v$10:void 0,_v$11:void 0,_v$12:void 0,_v$13:void 0}),R}})}})}})]},"Longform"),TO=a(()=>{const n=fn(),e=Cm(),t=Du(),r=Eu(),[i,o]=je(""),s=a(h=>{const d=`event_${sn}`,f=Ds(d,{onEvent:(p,m)=>{if(m.kind===Q.LongForm){const g=(m.tags.find(k=>k[0]==="d")||[])[1];if(g)try{const k=Ee.naddrEncode({kind:Q.LongForm,pubkey:m.pubkey,identifier:g});o(()=>k)}catch{ka("Failed to encode naddr with: ",Q.LongForm,m.pubkey,g),o("NONE")}else o("NONE");c(()=>"read");return}if(m.kind===Q.Text){try{o(()=>Ee.noteEncode(m.id))}catch{ka("Failed to decode note id: ",m.id),o(()=>"NONE")}c(()=>"note");return}},onEose:()=>{i().length===0&&(o(()=>""),c(()=>"not_found")),f()}});Pk(n?.publicKey,[h],d,!1)},"resolveFromId"),[l,c]=je("none");gt(()=>{u(e.id,e.identifier)});const u=a(async(h,d)=>{if(!h&&!d){c(()=>"not_found");return}if(h){if(h.startsWith("naddr")){const p=Ee.decode(h).data,m=p.pubkey,g=p.identifier;await Dk(n?.publicKey,m,`thred_profile_info_${sn}`);const k=t?.verifiedUsers[m];if(k){r(`/${k}/${g}`);return}o(()=>h),c(()=>"read");return}if(h.startsWith("note")){o(()=>h),c(()=>"note");return}if(h.startsWith("nevent"))try{const f=Ee.decode(h);s(f.data.id);return}catch{ka("Failed to decode nevent: ",h),c(()=>"not_found");return}s(h);return}if(d){const f=e.vanityName.toLowerCase();if(!f){c(()=>"not_found");return}const m=(await Rk(f)).names[f],g=Q.LongForm;try{const k=Ee.naddrEncode({pubkey:m,kind:g,identifier:d});o(()=>k),c(()=>"read");return}catch(k){zk("Error encoding naddr: ",k),c(()=>"not_found");return}}},"render");return O(_u,{get children(){return[O(kr,{get when(){return l()==="not_found"},get children(){return O(Fk,{})}}),O(kr,{get when(){return l()==="read"},get children(){return O(LE,{get naddr(){return i()}})}}),O(kr,{get when(){return l()==="note"},get children(){return O(oM,{get noteId(){return i()}})}})]}})},"EventPage");export{TO as default};
//# sourceMappingURL=Thread-50047969.js.map
