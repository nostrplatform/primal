var Re=Object.defineProperty;var o=(e,a)=>Re(e,"name",{value:a,configurable:!0});import{e as pe,r as ne,j as _,l as T,s as H,m as c,b3 as Be,t as U,u as he,B as _e,g as Ie,C as ce,E as de,c as b,S as K,N as Pe,a2 as Fe,T as ae,dO as Ee,bn as Se,ct as D,e0 as De,dP as Ke,dQ as Ne,cU as Ue,h as xe,ad as Ve,b as Le,d as se,cy as oe,e1 as qe,bi as N,ak as re,bL as Ge,x as we,a_ as We,$ as je,D as He,k as Qe,w as Oe,V as Ye,br as Je,F as Xe,A as Me,bk as Ae,al as et}from"./index-64dc6460.js";import{s as tt}from"./dates-9bcb2bf7.js";import{a as nt,c as at}from"./Note-f0f70728.js";import{j as k,m as ie,Z as it,n as $e,P as st,k as Te,a as ot,h as $,o as rt,p as lt}from"./ParsedNote-9900e3c8.js";import{B as ct}from"./ButtonGhost-a0fa1826.js";const dt=U("<button><div><div></div><div>"),ut={zap:k.zapType,like:k.likeType,reply:k.replyType,repost:k.repostType},ge=o(e=>(()=>{const a=dt(),C=a.firstChild,Z=C.firstChild,w=Z.nextSibling;return ne(a,"touchend",e.onTouchEnd??(()=>{}),!0),ne(a,"touchstart",e.onTouchStart??(()=>{}),!0),ne(a,"mouseup",e.onMouseUp??(()=>{}),!0),ne(a,"mousedown",e.onMouseDown??(()=>{}),!0),ne(a,"click",e.onClick??(()=>{}),!0),_(w,()=>e.label||""),T(y=>{const h=`btn_${e.type}_${e.note.id}`,l=`${k.stat} ${e.highlighted?k.highlighted:""}`,A=e.disabled,I=`${ut[e.type]} ${e.large?k.large:""}`,z=`${k.icon} ${e.large?k.large:""}`,V=e.hidden?"visibility: hidden":"visibility: visible",m=k.statNumber;return h!==y._v$&&H(a,"id",y._v$=h),l!==y._v$2&&c(a,y._v$2=l),A!==y._v$3&&(a.disabled=y._v$3=A),I!==y._v$4&&c(C,y._v$4=I),z!==y._v$5&&c(Z,y._v$5=z),y._v$6=Be(Z,V,y._v$6),m!==y._v$7&&c(w,y._v$7=m),y},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0}),a})(),"ArticleFooterActionButton");pe(["click","mousedown","mouseup","touchstart","touchend"]);const ve=U("<div>"),ft=o(e=>{const a=he(),C=_e(),Z=Ie(),[w,y]=ce(!1),[h,l]=ce(!1);de(()=>{const m=e.note;if(m){const f=`${m.msg.kind}:${m.pubkey}:${(m.msg.tags.find(u=>u[0]==="d")||[])[1]}`;y(()=>a?.bookmarks.includes(f)||!1)}});const A=o(async m=>{if(!a)return;const f=m.reduce((L,E)=>De.includes(E[0])?[...L,E[1]]:[...L],[]),u=Math.floor(new Date().getTime()/1e3);a.actions.updateBookmarks(f),Ke(a.publicKey,f);const{success:P,note:F}=await Ne([...m],u,"",a?.proxyThroughPrimal||!1,a.activeRelays,a?.relaySettings);P&&F&&Ue([F],`bookmark_import_${ae}`)},"updateBookmarks"),I=o(async m=>{if(!a||!e.note)return;const f=["a",`${e.note.msg.kind}:${e.note.pubkey}:${(e.note.msg.tags.find(u=>u[0]==="d")||[])[1]}`];if(!m.find(u=>u[0]===f[0]&&u[1]===f[1])){const u=[...m,[...f]];if(u.length<2){Se("BOOKMARK ISSUE: ",`before_bookmark_${ae}`),C?.actions.openConfirmModal({title:Z.formatMessage(D.confirm.title),description:Z.formatMessage(D.confirm.description),confirmLabel:Z.formatMessage(D.confirm.confirm),abortLabel:Z.formatMessage(D.confirm.abort),onConfirm:async()=>{await A(u),C.actions.closeConfirmModal()},onAbort:C.actions.closeConfirmModal});return}await A(u)}},"addBookmark"),z=o(async m=>{if(!a||!e.note)return;const f=["a",`${e.note.msg.kind}:${e.note.pubkey}:${(e.note.msg.tags.find(u=>u[0]==="d")||[])[1]}`];if(m.find(u=>u[0]===f[0]&&u[1]===f[1])){const u=m.filter(P=>P[0]!==f[0]||P[1]!==f[1]);if(u.length<1){Se("BOOKMARK ISSUE: ",`before_bookmark_${ae}`),C?.actions.openConfirmModal({title:Z.formatMessage(D.confirm.titleZero),description:Z.formatMessage(D.confirm.descriptionZero),confirmLabel:Z.formatMessage(D.confirm.confirmZero),abortLabel:Z.formatMessage(D.confirm.abortZero),onConfirm:async()=>{await A(u),C.actions.closeConfirmModal()},onAbort:C.actions.closeConfirmModal});return}await A(u)}},"removeBookmark"),V=o((m,f)=>{if(!a?.publicKey)return;let u=[];const P=Pe(`before_bookmark_${ae}`,{onEvent:(F,L)=>{!L||L.kind!==Fe.Bookmarks||(u=L.tags)},onEose:async()=>{m?await z(u):await I(u),f&&f(),l(()=>!1),P()}});l(()=>!0),Ee(a.publicKey,`before_bookmark_${ae}`)},"doBookmark");return(()=>{const m=ve();return _(m,b(ct,{onClick:f=>{f.preventDefault(),V(w())},get disabled(){return h()},get children(){return b(K,{get when(){return w()},get fallback(){return(()=>{const f=ve();return T(()=>c(f,`${ie.emptyBookmark} ${e.large?ie.large:""}`)),f})()},get children(){const f=ve();return T(()=>c(f,`${ie.fullBookmark} ${e.large?ie.large:""}`)),f}})}})),T(()=>c(m,ie.bookmark)),m})()},"BookmarkArticle"),mt=U('<div><button><div><div style="visibility:visible"></div><div></div></div></button><div>'),gt=o(()=>$e.op*1e3/$e.fr,"lottieDuration"),vt=o(e=>{const a=he(),C=Ve(),Z=Ie(),w=Le(),y=_e();let h,l=0,A,I;const z=o(()=>e.size??"normal","size"),V=[{action:()=>P(),label:"Repost Note",icon:"feed_repost"},{action:()=>u(),label:"Quote Note",icon:"quote"}],m=o(i=>{document?.getElementById(`repost_menu_${e.note.id}`)?.contains(i.target)||e.updateState("isRepostMenuVisible",()=>!1)},"onClickOutside");de(()=>{e.state.isRepostMenuVisible?document.addEventListener("click",m):document.removeEventListener("click",m)});const f=o(i=>{i.preventDefault(),e.updateState("isRepostMenuVisible",()=>!0)},"showRepostMenu"),u=o(()=>{if(!a?.hasPublicKey()){a?.actions.showGetStarted();return}e.updateState("isRepostMenuVisible",()=>!1),a?.actions?.quoteNote(`nostr:${e.note.naddr}`),a?.actions?.showNewNoteForm()},"doQuote"),P=o(async()=>{if(!a)return;if(!a.hasPublicKey()){a.actions.showGetStarted();return}e.updateState("isRepostMenuVisible",()=>!1);const{success:i}=await qe(e.note,a.proxyThroughPrimal,a.activeRelays,a.relaySettings);i?(N(()=>{e.updateState("reposts",g=>g+1),e.updateState("reposted",()=>!0)}),C?.sendSuccess(Z.formatMessage(re.repostSuccess))):C?.sendWarning(Z.formatMessage(re.repostFailed))},"doRepost"),F=o(()=>{},"doReply"),L=o(async i=>{if(i.preventDefault(),i.stopPropagation(),!a)return;if(!a.hasPublicKey()){a.actions.showGetStarted();return}await a.actions.addLike(e.note)&&N(()=>{e.updateState("likes",S=>S+1),e.updateState("liked",()=>!0)})},"doLike"),E=o(i=>{if(i.preventDefault(),i.stopPropagation(),!a?.hasPublicKey()){a?.actions.showGetStarted(),e.updateState("isZapping",()=>!1);return}if(!a.proxyThroughPrimal&&a.relays.length===0){C?.sendWarning(Z.formatMessage(re.noRelaysConnected));return}if(!Te(e.note.user)){C?.sendWarning(Z.formatMessage(re.zapUnavailable)),e.updateState("isZapping",()=>!1);return}l=setTimeout(()=>{y?.actions.openCustomZapModal(e.customZapInfo),e.updateState("isZapping",()=>!0)},500)},"startZap"),Q=o(i=>{if(i.preventDefault(),i.stopPropagation(),clearTimeout(l),!a?.hasPublicKey()){a?.actions.showGetStarted();return}!a.proxyThroughPrimal&&a.relays.length===0||!Te(e.note.user)||y?.customZap===void 0&&fe()},"commitZap"),ue=o(()=>{setTimeout(()=>{if(e.updateState("hideZapIcon",()=>!0),!h)return;let i=33,g=-6;z()==="xwide"&&(i=46,g=-7),z()==="wide"&&e.large&&(i=14,g=-10),z()==="short"&&(i=14,g=-6),h.style.left=`${i}px`,h.style.top=`${g}px`;const S=o(()=>{N(()=>{e.updateState("showZapAnim",()=>!1),e.updateState("hideZapIcon",()=>!1),e.updateState("zapped",()=>!0)}),h?.removeEventListener("complete",S)},"onAnimDone");h.addEventListener("complete",S);try{h.seek(0),h.play()}catch(R){console.warn("Failed to animte zap:",R),S()}},10)},"animateZap"),fe=o(async()=>{if(!a?.hasPublicKey()){a?.actions.showGetStarted();return}const i=w?.defaultZap.amount||10,g=w?.defaultZap.message||"",S=w?.defaultZap.emoji;N(()=>{e.updateState("isZapping",()=>!0),e.updateState("satsZapped",R=>R+i),e.updateState("showZapAnim",()=>!0)}),e.onZapAnim&&e.onZapAnim({amount:i,message:g,emoji:S}),setTimeout(async()=>{const R=await ot(e.note,a.publicKey,i,g,a.activeRelays);if(e.updateState("isZapping",()=>!1),R){e.customZapInfo.onSuccess({emoji:S,amount:i,message:g});return}e.customZapInfo.onFail({emoji:S,amount:i,message:g})},gt())},"doQuickZap"),q={zap:k.zapType,like:k.likeType,reply:k.replyType,repost:k.repostType};de(()=>{e.state.showZapAnim&&ue()});const me=o(()=>{const i=Ge(I),g=100;return(i.y||0)+g<window.innerHeight+window.scrollY?"down":"up"},"determineOrient");return(()=>{const i=mt(),g=i.firstChild,S=g.firstChild,R=S.firstChild,O=R.nextSibling,Y=g.nextSibling;i.$$click=d=>{d.preventDefault()};const J=A;typeof J=="function"?we(J,i):A=i,_(i,b(K,{get when(){return e.state.showZapAnim},get children(){return b(it,{get id(){return`note-med-zap-${e.note.id}`},src:$e,get class(){return e.large?k.largeZapLottie:k.mediumZapLottie},ref(d){const G=h;typeof G=="function"?G(d):h=d}})}}),g),_(i,b(ge,{get note(){return e.note},onClick:F,type:"reply",get highlighted(){return e.state.replied},get label(){return se(()=>e.state.replies===0)()?"":oe(e.state.replies,2)},get title(){return e.state.replies.toLocaleString()},get large(){return e.large}}),g),_(i,b(ge,{get note(){return e.note},onClick:d=>d.preventDefault(),onMouseDown:E,onMouseUp:Q,onTouchStart:E,onTouchEnd:Q,type:"zap",get highlighted(){return e.state.zapped||e.state.isZapping},get label(){return se(()=>e.state.satsZapped===0)()?"":oe(e.state.satsZapped,2)},get hidden(){return e.state.hideZapIcon},get title(){return e.state.satsZapped.toLocaleString()},get large(){return e.large}}),g),_(i,b(ge,{get note(){return e.note},onClick:L,type:"like",get highlighted(){return e.state.liked},get label(){return se(()=>e.state.likes===0)()?"":oe(e.state.likes,2)},get title(){return e.state.likes.toLocaleString()},get large(){return e.large}}),g),g.$$click=f;const j=I;return typeof j=="function"?we(j,S):I=S,_(O,(()=>{const d=se(()=>e.state.reposts===0);return()=>d()?"":oe(e.state.reposts,2)})()),_(S,b(st,{get id(){return`repost_menu_${e.note.id}`},items:V,position:"note_footer",get orientation(){return me()},get hidden(){return!e.state.isRepostMenuVisible}}),null),_(Y,b(ft,{get note(){return e.note},get large(){return e.large}})),T(d=>{const G=e.id,t=`${k.footer} ${k[z()]}`,n=`btn_repost_${e.note.id}`,r=`${k.stat} ${e.state.reposted?k.highlighted:""}`,M=e.state.reposts.toLocaleString(),x=`${q.repost}`,v=`${k.icon} ${e.large?k.large:""}`,p=k.statNumber,W=k.bookmarkFoot;return G!==d._v$&&H(i,"id",d._v$=G),t!==d._v$2&&c(i,d._v$2=t),n!==d._v$3&&H(g,"id",d._v$3=n),r!==d._v$4&&c(g,d._v$4=r),M!==d._v$5&&H(g,"title",d._v$5=M),x!==d._v$6&&c(S,d._v$6=x),v!==d._v$7&&c(R,d._v$7=v),p!==d._v$8&&c(O,d._v$8=p),W!==d._v$9&&c(Y,d._v$9=W),d},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0}),i})()},"ArticleFooter"),$t=xe(vt);pe(["click"]);const le=U("<div>"),ht=U("<div><div><div></div><div></div></div><div>"),_t=U("<div>+ "),ze=U("<img>"),kt=U("<div><div><div><div></div><div></div></div><div><div> minute read</div></div></div><div>"),bt=localStorage.getItem("devMode")==="true",yt=o(e=>{const a=_e(),C=he(),Z=We(),w=je(),y=Le(),[h,l]=He({likes:e.article.likes||0,liked:e.article.noteActions?.liked||!1,reposts:e.article.reposts||0,reposted:e.article.noteActions?.reposted||!1,replies:e.article.replies||0,replied:e.article.noteActions?.replied||!1,zapCount:e.article.zaps||0,satsZapped:e.article.satszapped||0,zapped:e.article.noteActions?.zapped||!1,zappedAmount:0,zappedNow:!1,isZapping:!1,showZapAnim:!1,hideZapIcon:!1,moreZapsAvailable:!1,isRepostMenuVisible:!1,topZaps:[],topZapsFeed:[],quoteCount:0});let A="",I="",z;const V=o(t=>{a?.actions.closeCustomZapModal(),N(()=>{l("zappedAmount",()=>t.amount||0),l("satsZapped",n=>n+(t.amount||0)),l("zapped",()=>!0),l("showZapAnim",()=>!0)}),P(t),L(t)},"onConfirmZap"),m=o(t=>{a?.actions.closeCustomZapModal(),a?.actions.resetCustomZap(),C?.publicKey&&N(()=>{l("zapCount",r=>r+1),l("isZapping",()=>!1),l("showZapAnim",()=>!1),l("hideZapIcon",()=>!1),l("zapped",()=>!0)})},"onSuccessZap"),f=o(t=>{a?.actions.closeCustomZapModal(),a?.actions.resetCustomZap(),N(()=>{l("zappedAmount",()=>-(t.amount||0)),l("satsZapped",n=>n-(t.amount||0)),l("isZapping",()=>!1),l("showZapAnim",()=>!1),l("hideZapIcon",()=>!1),l("zapped",()=>e.article.noteActions.zapped)}),F(),E()},"onFailZap"),u=o(t=>{a?.actions.closeCustomZapModal(),a?.actions.resetCustomZap(),N(()=>{l("zappedAmount",()=>-(t.amount||0)),l("satsZapped",n=>n-(t.amount||0)),l("isZapping",()=>!1),l("showZapAnim",()=>!1),l("hideZapIcon",()=>!1),l("zapped",()=>e.article.noteActions.zapped)}),F(),E()},"onCancelZap"),P=o(t=>{const n=C?.publicKey;if(!n)return;const r=[...h.topZaps];A=Ae();const M={amount:t.amount||0,message:t.message||"",pubkey:n,eventId:e.article.id,id:A};Z?.users.find(v=>v.pubkey===n)||Z?.actions.fetchUsers([n]);const x=[...r,{...M}].sort((v,p)=>p.amount-v.amount);l("topZaps",()=>[...x])},"addTopZap"),F=o(t=>{const n=h.topZaps.filter(r=>r.id!==A);l("topZaps",()=>[...n])},"removeTopZap"),L=o(t=>{const n=C?.publicKey;if(!n)return;const r=[...h.topZapsFeed];I=Ae();const M={amount:t.amount||0,message:t.message||"",pubkey:n,eventId:e.article.id,id:I},x=[...r,{...M}].sort((v,p)=>p.amount-v.amount).slice(0,4);l("topZapsFeed",()=>[...x])},"addTopZapFeed"),E=o(t=>{const n=h.topZapsFeed.filter(r=>r.id!==I);l("topZapsFeed",()=>[...n])},"removeTopZapFeed"),Q=o(()=>({note:e.article,onConfirm:V,onSuccess:m,onFail:f,onCancel:u}),"customZapInfo"),ue=o((t="likes")=>{a?.actions.openReactionModal(e.article.naddr,{likes:h.likes,zaps:h.zapCount,reposts:h.reposts,quotes:h.quoteCount,openOn:t})},"openReactionModal"),fe=o(()=>{a?.actions.openContextMenu(e.article,z?.getBoundingClientRect(),()=>{a?.actions.openCustomZapModal(Q())},ue)},"onContextMenuTrigger");let q;const[me,i]=ce(!1),g=o(()=>{const t=e.article.image;i(()=>!1);let n=w?.actions.getMediaUrl(t,"s");return n||(n=w?.actions.getMediaUrl(t,"m")),n||(n=w?.actions.getMediaUrl(t,"o")),n||(n=t,i(()=>!0)),n},"articleImage"),S=o(()=>{const t=e.article.user.picture;i(()=>!1);let n=w?.actions.getMediaUrl(t,"s");return n||(n=w?.actions.getMediaUrl(t,"m")),n||(n=w?.actions.getMediaUrl(t,"o")),n||(n=t,i(()=>!0)),n},"authorAvatar"),R=o(()=>{e.onRender&&e.onRender(e.article,q)},"onImageLoaded"),O=o(t=>{const n=t.target;let r=S();return(n.src===r||n.src.endsWith(r))&&(r=["sunrise_wave","ice_wave"].includes(y?.theme||"")?rt:lt),n.onerror="",n.src=r,!0},"onImageError"),Y=o(t=>{var n=t.offsetHeight,r=t.computedStyleMap().get("line-height").value,M=n/r;return M},"countLines"),[J,j]=ce("T3");de(()=>{e.article.title,e.article.summary;const t=q?.querySelector(`.${$.title}`),n=q?.querySelector(`.${$.summary}`);if(!t||!n)return;const r=Y(t);Y(n),r===1&&j("T1"),r===2&&j("T2"),r===3&&j("T3")});const d=o(()=>J()==="T1"?$.t1:J()==="T2"?$.t2:"","conetntStyles"),G=o(()=>{const t=a?.verifiedUsers[e.article.pubkey];if(!t)return`/e/${e.article.naddr}`;const r=et.decode(e.article.naddr).data;return`/${t}/${r.identifier}`},"articleUrl");return b(Me,{ref(t){const n=q;typeof n=="function"?n(t):q=t},get class(){return`${$.article} ${e.boredered?$.bordered:""}`},get href(){return G()},get style(){return e.height?`height: ${e.height}px`:""},get children(){return[b(K,{get when(){return!e.hideContext},get children(){const t=le();return _(t,b(nt,{ref(n){const r=z;typeof r=="function"?r(n):z=n},onClick:fe})),T(()=>c(t,$.upRightFloater)),t}}),(()=>{const t=ht(),n=t.firstChild,r=n.firstChild,M=r.nextSibling,x=n.nextSibling;return _(n,b(Qe,{get user(){return e.article.user},size:"micro"}),r),_(r,()=>Oe(e.article.user)),_(n,b(Ye,{get user(){return e.article.user}}),M),_(M,()=>e.article.user?.nip05||""),_(x,()=>tt(e.article.published)),T(v=>{const p=$.header,W=$.userInfo,X=$.userName,s=$.nip05,B=$.time;return p!==v._v$&&c(t,v._v$=p),W!==v._v$2&&c(n,v._v$2=W),X!==v._v$3&&c(r,v._v$3=X),s!==v._v$4&&c(M,v._v$4=s),B!==v._v$5&&c(x,v._v$5=B),v},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),t})(),(()=>{const t=kt(),n=t.firstChild,r=n.firstChild,M=r.firstChild,x=M.nextSibling,v=r.nextSibling,p=v.firstChild,W=p.firstChild,X=n.nextSibling;return _(M,()=>e.article.title),_(x,()=>e.article.summary),_(p,()=>Math.ceil(e.article.wordCount/Je),W),_(v,b(Xe,{get each(){return e.article.tags?.slice(0,3)},children:s=>b(Me,{href:`/reads/${s}`,get class(){return $.tag},children:s})}),null),_(v,b(K,{get when(){return e.article.tags?.length&&e.article.tags.length>3},get children(){const s=_t();return s.firstChild,_(s,()=>e.article.tags.length-3,null),T(()=>c(s,$.tag)),s}}),null),_(X,b(K,{get when(){return e.article.image},get fallback(){return b(K,{get when(){return S()},get fallback(){return(()=>{const s=le();return T(()=>c(s,$.placeholderImage)),s})()},get children(){const s=ze();return s.addEventListener("error",O),s.addEventListener("load",R),T(()=>H(s,"src",e.article.user.picture)),s}})},get children(){const s=ze();return s.addEventListener("error",O),s.addEventListener("load",R),T(B=>{const ee=g(),te=bt&&me()?"redBorder":"";return ee!==B._v$6&&H(s,"src",B._v$6=ee),te!==B._v$7&&c(s,B._v$7=te),B},{_v$6:void 0,_v$7:void 0}),s}})),T(s=>{const B=$.body,ee=$.text,te=`${$.content} ${d()}`,ke=$.title,be=$.summary,ye=$.tags,Ze=$.estimate,Ce=$.image;return B!==s._v$8&&c(t,s._v$8=B),ee!==s._v$9&&c(n,s._v$9=ee),te!==s._v$10&&c(r,s._v$10=te),ke!==s._v$11&&c(M,s._v$11=ke),be!==s._v$12&&c(x,s._v$12=be),ye!==s._v$13&&c(v,s._v$13=ye),Ze!==s._v$14&&c(p,s._v$14=Ze),Ce!==s._v$15&&c(X,s._v$15=Ce),s},{_v$8:void 0,_v$9:void 0,_v$10:void 0,_v$11:void 0,_v$12:void 0,_v$13:void 0,_v$14:void 0,_v$15:void 0}),t})(),b(K,{get when(){return e.article.topZaps?.length>0},get children(){const t=le();return _(t,b(at,{get note(){return e.article},action:()=>{},get topZaps(){return e.article.topZaps},topZapLimit:4})),T(()=>c(t,$.zaps)),t}}),b(K,{get when(){return!e.hideFooter},get children(){const t=le();return _(t,b($t,{get note(){return e.article},state:h,updateState:l,get customZapInfo(){return Q()},onZapAnim:L})),T(()=>c(t,$.footer)),t}})]}})},"ArticlePreview"),Tt=xe(yt);export{Tt as A,ft as B,$t as a};
//# sourceMappingURL=ArticlePreview-3d0aa4c8.js.map
