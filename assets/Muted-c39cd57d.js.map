{"version":3,"file":"Muted-c39cd57d.js","sources":["../../src/pages/Settings/Muted.tsx"],"sourcesContent":["import { Component, createEffect, createSignal, For, Show } from 'solid-js';\nimport styles from './Settings.module.scss';\n\nimport { useIntl } from '@cookbook/solid-intl';\nimport { settings as t, actions as tActions } from '../../translations';\nimport PageCaption from '../../components/PageCaption/PageCaption';\nimport { A } from '@solidjs/router';\nimport { useAccountContext } from '../../contexts/AccountContext';\nimport { getUserProfiles } from '../../lib/profile';\nimport { APP_ID } from '../../App';\nimport { subsTo } from '../../sockets';\nimport { convertToUser, nip05Verification, userName } from '../../stores/profile';\nimport { Kind } from '../../constants';\nimport { createStore } from 'solid-js/store';\nimport { PrimalUser } from '../../types/primal';\nimport Avatar from '../../components/Avatar/Avatar';\nimport { hexToNpub } from '../../lib/keys';\nimport PageTitle from '../../components/PageTitle/PageTitle';\nimport ButtonSecondary from '../../components/Buttons/ButtonSecondary';\nimport { useAppContext } from '../../contexts/AppContext';\n\nconst Muted: Component = () => {\n\n  const intl = useIntl();\n  const account = useAccountContext();\n  const app = useAppContext();\n\n  const [mutedUsers, setMutedUsers] = createStore<Record<string,PrimalUser>>({});\n\n  const mutedMetadataSubId = `muted_metadata_${APP_ID}`;\n\n  const [isFetching, setIsFetching] = createSignal(true);\n\n  const user = (pubkey: string) => mutedUsers[pubkey] || { pubkey, npub: hexToNpub(pubkey) };\n\n  createEffect(() => {\n    if (account && account.isKeyLookupDone) {\n\n      let pubkeys: string[] = [];\n      let users: Record<string, PrimalUser> = {};\n\n      const unsub = subsTo(mutedMetadataSubId, {\n        onEvent: (_, content) => {\n          if (content && [Kind.MuteList].includes(content?.kind || 0)) {\n            // @ts-ignore\n            pubkeys = content.tags.reduce((acc, t) => t[0] === 'p' ? [...acc, t[1]] : acc, []);\n          }\n          if (content?.kind === Kind.Metadata) {\n            users[content.pubkey] = convertToUser(content, content.pubkey);\n          }\n        },\n        onEose: () => {\n          setMutedUsers(() => ({ ...users }));\n          setIsFetching(false);\n          unsub();\n        },\n      });\n\n      getUserProfiles(account.muted, mutedMetadataSubId);\n    }\n  });\n\n  const unMuteUser = (user: PrimalUser) => {\n    account?.actions.removeFromMuteList(user.pubkey);\n  };\n\n  return (\n    <div>\n      <PageTitle title={`${intl.formatMessage(t.muted.title)} ${intl.formatMessage(t.title)}`} />\n\n      <PageCaption>\n        <A href='/settings' >{intl.formatMessage(t.index.title)}</A>:&nbsp;\n        <div>{intl.formatMessage(t.muted.title)}</div>\n      </PageCaption>\n\n      <div class={styles.settingsContentFull}>\n        <For\n          each={account?.muted}\n          fallback={\n            <Show when={!isFetching()}>\n              <div class={styles.emptyListBanner}>\n                {intl.formatMessage(t.muted.empty)}\n              </div>\n            </Show>\n          }\n        >\n          {pubkey => (\n            <div class={styles.mutedUser}>\n              <Show\n                when={user(pubkey)}\n                fallback={\n                  <>\n                    <A class={styles.userInfo} href={app?.actions.profileLink(pubkey) || ''}>\n                      <div class={styles.userName}>\n                        <div class={styles.verification}>{hexToNpub(pubkey)}</div>\n                      </div>\n                    </A>\n                    <button onClick={() => unMuteUser(user(pubkey))}>\n                      {intl.formatMessage(tActions.unmute)}\n                    </button>\n                  </>\n                }\n              >\n                <A class={styles.userInfo} href={app?.actions.profileLink(pubkey) || ''}>\n                  <Avatar user={user(pubkey)} size='vvs' />\n                  <div class={styles.userName}>\n                    <div class={styles.title}>{userName(user(pubkey))}</div>\n                    <div class={styles.verification}>{nip05Verification(user(pubkey))}</div>\n                  </div>\n                </A>\n                <ButtonSecondary onClick={() => unMuteUser(user(pubkey))}>\n                  {intl.formatMessage(tActions.unmute)}\n                </ButtonSecondary>\n              </Show>\n            </div>\n          )}\n        </For>\n      </div>\n    </div>\n  )\n}\n\nexport default Muted;\n"],"names":["Muted","intl","useIntl","account","useAccountContext","app","useAppContext","mutedUsers","setMutedUsers","createStore","mutedMetadataSubId","APP_ID","isFetching","setIsFetching","createSignal","user","pubkey","npub","hexToNpub","createEffect","isKeyLookupDone","users","unsub","subsTo","onEvent","_","content","Kind","MuteList","includes","kind","tags","reduce","acc","t","Metadata","convertToUser","onEose","getUserProfiles","muted","unMuteUser","actions","removeFromMuteList","_el$","_tmpl$2","_el$3","firstChild","_$insert","_$createComponent","PageTitle","title","formatMessage","PageCaption","children","A","href","index","_el$2","_tmpl$","For","each","fallback","Show","when","_el$4","empty","_$effect","_$className","styles","emptyListBanner","_el$5","userInfo","profileLink","_el$9","_el$10","_p$","_v$4","userName","_v$5","verification","undefined","_el$11","_tmpl$4","$$click","tActions","unmute","Avatar","size","_el$6","_tmpl$3","_el$7","_el$8","nextSibling","nip05Verification","_v$","_v$2","_v$3","ButtonSecondary","onClick","mutedUser","settingsContentFull","_$delegateEvents"],"mappings":"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"}