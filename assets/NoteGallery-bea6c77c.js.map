{"version":3,"mappings":"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","names":["defaultOptions","_PhotoSwipeDynamicCaption","lightbox","options","pswp","e","slide","captionYOffset","shiftedAmount","zoomLevel","mobileLayoutBreakpoint","captionElement","el","y","captionEl","x","isOnHorizontalEdge","width","type","prevType","imageWidth","imageHeight","captionSize","useMobileVersion","captionHTML","captionWidth","horizontalEnding","captionHeight","verticalEnding","verticalLeftover","initialPanAreaHeight","maxPositionX","rect","currSlideElement","hiddenCaption","img","__name","PhotoSwipeDynamicCaption","isVideoContent","content","_VideoContentSetup","itemData","element","linkEl","origEvent","pointerYPos","height","placeholderElStyle","isZoomable","key","source","sourceEl","src","usePlaceholder","VideoContentSetup","_PhotoSwipeVideoPlugin","PhotoSwipeVideoPlugin","NoteGallery","props","useIntl","media","useMediaContext","useNavigate","PhotoSwipeLightbox","gallery","note","id","children","post","noteId","showHideAnimationType","initialZoomLevel","secondaryZoomLevel","maxZoomLevel","thumbSelector","preloadFirstSlide","pswpModule","__vitePreload","store","setStore","createStore","images","onMount","urls","matchAll","imageOrVideoRegexG","result","next","done","push","value","i","length","origUrl","image","actions","getMedia","url","media_url","mt","imageThumb","thumbnails","getMediaUrl","captionContent","init","onCleanup","destroy","mediaFreeNote","newNote","replace","trim","_$createComponent","ParsedNote","ignoreMedia","noLinks","noPreviews","isEmbeded","noLightbox","firstImage","isMissingThumbnal","isDev","noVideoThumbnail","_el$","_tmpl$","_el$2","firstChild","_$insert","For","each","index","Switch","Match","when","startsWith","_el$3","_tmpl$4","_el$6","_el$8","_el$9","_el$10","Show","fallback","_el$13","_tmpl$2","_$effect","_$className","styles","videoIcon","_el$4","galleryIcon","dur","_el$5","humanizeTime","videoDuration","_el$14","_tmpl$5","_el$15","_p$","_v$14","missingThumb","_v$15","_$setAttribute","undefined","_el$7","_tmpl$3","addEventListener","A","noteLink","href","_v$5","videoGallery","_v$6","_v$7","_v$8","_v$9","_v$10","mediaNote","_v$11","_$style","_el$11","_el$12","NoteImage","mediaThumb","altSrc","shortHeight","plainBorder","caption","_el$16","_tmpl$6","_el$17","_v$16","_v$17","_v$12","_v$13","_v$","_v$2","_v$3","_v$4","imageGallery","hookForDev"],"sources":["../../node_modules/photoswipe-dynamic-caption-plugin/photoswipe-dynamic-caption-plugin.esm.js","../../node_modules/photoswipe-video-plugin/src/default-options.js","../../node_modules/photoswipe-video-plugin/src/video-content-setup.js","../../node_modules/photoswipe-video-plugin/src/index.js","../../src/components/Note/NoteGallery.tsx"],"sourcesContent":["/**\r\n * PhotoSwipe Dynamic Caption plugin v1.2.7\r\n * https://github.com/dimsemenov/photoswipe-dynamic-caption-plugin\r\n * \r\n * By https://dimsemenov.com\r\n */\r\n\r\nconst defaultOptions = {\r\n  captionContent: '.pswp-caption-content',\r\n  type: 'auto',\r\n  horizontalEdgeThreshold: 20,\r\n  mobileCaptionOverlapRatio: 0.3,\r\n  mobileLayoutBreakpoint: 600,\r\n  verticallyCenterImage: false\r\n};\r\n\r\nclass PhotoSwipeDynamicCaption {\r\n  constructor(lightbox, options) {\r\n    this.options = {\r\n      ...defaultOptions,\r\n      ...options\r\n    };\r\n\r\n    this.lightbox = lightbox;\r\n\r\n    this.lightbox.on('init', () => {\r\n      this.pswp = this.lightbox.pswp;\r\n      this.initCaption();\r\n    });\r\n  }\r\n\r\n  initCaption() {\r\n    const { pswp } = this;\r\n\r\n    pswp.on('change', () => {\r\n      // make sure caption is displayed after slides are switched\r\n      this.showCaption(this.pswp.currSlide);\r\n    });\r\n\r\n    pswp.on('calcSlideSize', (e) => this.onCalcSlideSize(e));\r\n\r\n    pswp.on('slideDestroy', (e) => {\r\n      if (e.slide.dynamicCaption) {\r\n        if (e.slide.dynamicCaption.element) {\r\n          e.slide.dynamicCaption.element.remove();\r\n        }\r\n        delete e.slide.dynamicCaption;\r\n      }\r\n    });\r\n\r\n    // hide caption if zoomed\r\n    pswp.on('zoomPanUpdate', ({ slide }) => {\r\n      if (pswp.opener.isOpen && slide.dynamicCaption) {\r\n        if (slide.currZoomLevel > slide.zoomLevels.initial) {\r\n          this.hideCaption(slide);\r\n        } else {\r\n          this.showCaption(slide);\r\n        }\r\n  \r\n        // move caption on vertical drag\r\n        if (slide.dynamicCaption.element) {\r\n          let captionYOffset = 0;\r\n          if (slide.currZoomLevel <= slide.zoomLevels.initial) {\r\n            const shiftedAmount = slide.pan.y - slide.bounds.center.y;\r\n            if (Math.abs(shiftedAmount) > 1) {\r\n              captionYOffset = shiftedAmount;\r\n            }\r\n          }\r\n\r\n          this.setCaptionYOffset(slide.dynamicCaption.element, captionYOffset);\r\n        }\r\n\r\n        this.adjustPanArea(slide, slide.currZoomLevel);\r\n      }\r\n    });\r\n\r\n    pswp.on('beforeZoomTo', (e) => {\r\n      this.adjustPanArea(pswp.currSlide, e.destZoomLevel);\r\n    });\r\n\r\n    // Stop default action of tap when tapping on the caption\r\n    pswp.on('tapAction', (e) => {\r\n      if (e.originalEvent.target.closest('.pswp__dynamic-caption')) {\r\n        e.preventDefault();\r\n      }\r\n    });\r\n  }\r\n\r\n  adjustPanArea(slide, zoomLevel) {\r\n    if (slide.dynamicCaption && slide.dynamicCaption.adjustedPanAreaSize) {\r\n      if (zoomLevel > slide.zoomLevels.initial) {\r\n        slide.panAreaSize.x = slide.dynamicCaption.originalPanAreaSize.x;\r\n        slide.panAreaSize.y = slide.dynamicCaption.originalPanAreaSize.y;\r\n      } else {\r\n        // Restore panAreaSize after we zoom back to initial position\r\n        slide.panAreaSize.x = slide.dynamicCaption.adjustedPanAreaSize.x;\r\n        slide.panAreaSize.y = slide.dynamicCaption.adjustedPanAreaSize.y;\r\n      }\r\n    }\r\n  }\r\n\r\n  useMobileLayout() {\r\n    const { mobileLayoutBreakpoint } = this.options;\r\n\r\n    if (typeof mobileLayoutBreakpoint === 'function') {\r\n      return mobileLayoutBreakpoint.call(this);\r\n    } else if (typeof mobileLayoutBreakpoint === 'number') {\r\n      if (window.innerWidth < mobileLayoutBreakpoint) {\r\n        return true;\r\n      }\r\n    }\r\n    \r\n    return false;\r\n  }\r\n\r\n  hideCaption(slide) {\r\n    if (slide.dynamicCaption && !slide.dynamicCaption.hidden) {\r\n      const captionElement = slide.dynamicCaption.element;\r\n\r\n      if (!captionElement) {\r\n        return;\r\n      }\r\n\r\n      slide.dynamicCaption.hidden = true;\r\n      captionElement.classList.add('pswp__dynamic-caption--faded');\r\n\r\n      // Disable caption visibility with the delay, so it's not interactable \r\n      if (slide.captionFadeTimeout) {\r\n        clearTimeout(slide.captionFadeTimeout);\r\n      }\r\n      slide.captionFadeTimeout = setTimeout(() => {\r\n        captionElement.style.visibility = 'hidden';\r\n        delete slide.captionFadeTimeout;\r\n      }, 400);\r\n    }\r\n  }\r\n\r\n  setCaptionYOffset(el, y) {\r\n    el.style.transform = `translateY(${y}px)`;\r\n  }\r\n\r\n  showCaption(slide) {\r\n    if (slide.dynamicCaption && slide.dynamicCaption.hidden) {\r\n      const captionElement = slide.dynamicCaption.element;\r\n\r\n      if (!captionElement) {\r\n        return;\r\n      }\r\n\r\n      slide.dynamicCaption.hidden = false;\r\n      captionElement.style.visibility = 'visible';\r\n      \r\n      clearTimeout(slide.captionFadeTimeout);\r\n      slide.captionFadeTimeout = setTimeout(() => {\r\n        captionElement.classList.remove('pswp__dynamic-caption--faded');\r\n        delete slide.captionFadeTimeout;;\r\n      }, 50);\r\n    }\r\n  }\r\n\r\n  setCaptionPosition(captionEl, x, y) {\r\n    const isOnHorizontalEdge = (x <= this.options.horizontalEdgeThreshold);\r\n    captionEl.classList[\r\n      isOnHorizontalEdge ? 'add' : 'remove'\r\n    ]('pswp__dynamic-caption--on-hor-edge');\r\n\r\n    captionEl.style.left = x + 'px';\r\n    captionEl.style.top = y + 'px';\r\n  }\r\n\r\n  setCaptionWidth(captionEl, width) {\r\n    if (!width) {\r\n      captionEl.style.removeProperty('width');\r\n    } else {\r\n      captionEl.style.width = width + 'px';\r\n    }\r\n  }\r\n\r\n  setCaptionType(captionEl, type) {\r\n    const prevType = captionEl.dataset.pswpCaptionType;\r\n    if (type !== prevType) {\r\n      captionEl.classList.add('pswp__dynamic-caption--' + type);\r\n      captionEl.classList.remove('pswp__dynamic-caption--' + prevType);\r\n      captionEl.dataset.pswpCaptionType = type;\r\n    }\r\n  }\r\n\r\n  updateCaptionPosition(slide) {\r\n    if (!slide.dynamicCaption || !slide.dynamicCaption.type || !slide.dynamicCaption.element) {\r\n      return;\r\n    }\r\n\r\n    if (slide.dynamicCaption.type === 'mobile') {\r\n      this.setCaptionType(\r\n        slide.dynamicCaption.element, \r\n        slide.dynamicCaption.type\r\n      );\r\n      \r\n      slide.dynamicCaption.element.style.removeProperty('left');\r\n      slide.dynamicCaption.element.style.removeProperty('top');\r\n      this.setCaptionWidth(slide.dynamicCaption.element, false);\r\n      return;\r\n    }\r\n\r\n    const zoomLevel = slide.zoomLevels.initial;\r\n    const imageWidth = Math.ceil(slide.width * zoomLevel);\r\n    const imageHeight = Math.ceil(slide.height * zoomLevel);\r\n    \r\n    this.setCaptionType(slide.dynamicCaption.element, slide.dynamicCaption.type);\r\n    if (slide.dynamicCaption.type === 'aside') {\r\n      this.setCaptionPosition(\r\n        slide.dynamicCaption.element,\r\n        slide.bounds.center.x + imageWidth,\r\n        slide.bounds.center.y\r\n      );\r\n      this.setCaptionWidth(slide.dynamicCaption.element, false);\r\n    } else if (slide.dynamicCaption.type === 'below') {\r\n      this.setCaptionPosition(\r\n        slide.dynamicCaption.element,\r\n        slide.bounds.center.x,\r\n        slide.bounds.center.y + imageHeight\r\n      );\r\n      this.setCaptionWidth(slide.dynamicCaption.element, imageWidth);\r\n    }\r\n  }\r\n\r\n  onCalcSlideSize(e) {\r\n    const { slide } = e;\r\n    let captionSize;\r\n    let useMobileVersion;\r\n\r\n    if (!slide.dynamicCaption) {\r\n      slide.dynamicCaption = {\r\n        element: undefined,\r\n        type: false,\r\n        hidden: false\r\n      };\r\n\r\n      const captionHTML = this.getCaptionHTML(slide);\r\n\r\n      if (!captionHTML) {\r\n        return;\r\n      }\r\n\r\n      slide.dynamicCaption.element = document.createElement('div');\r\n      slide.dynamicCaption.element.className = 'pswp__dynamic-caption pswp__hide-on-close';\r\n      slide.dynamicCaption.element.innerHTML = captionHTML;\r\n\r\n      this.pswp.dispatch('dynamicCaptionUpdateHTML', { \r\n        captionElement: slide.dynamicCaption.element,\r\n        slide\r\n      });\r\n\r\n      slide.holderElement.appendChild(slide.dynamicCaption.element);\r\n    }\r\n\r\n    if (!slide.dynamicCaption.element) {\r\n      return;\r\n    }\r\n\r\n    this.storeOriginalPanAreaSize(slide);\r\n\r\n    slide.bounds.update(slide.zoomLevels.initial);\r\n    \r\n    if (this.useMobileLayout()) {\r\n      slide.dynamicCaption.type = 'mobile';\r\n      useMobileVersion = true;\r\n    } else {\r\n      if (this.options.type === 'auto') {\r\n        if (slide.bounds.center.x > slide.bounds.center.y) {\r\n          slide.dynamicCaption.type = 'aside';\r\n        } else {\r\n          slide.dynamicCaption.type = 'below';\r\n        }\r\n      } else {\r\n        slide.dynamicCaption.type = this.options.type;\r\n      }\r\n    } \r\n\r\n    const imageWidth = Math.ceil(slide.width * slide.zoomLevels.initial);\r\n    const imageHeight = Math.ceil(slide.height * slide.zoomLevels.initial);\r\n\r\n    this.setCaptionType(\r\n      slide.dynamicCaption.element, \r\n      slide.dynamicCaption.type\r\n    );\r\n\r\n    if (slide.dynamicCaption.type === 'aside') {\r\n      this.setCaptionWidth(slide.dynamicCaption.element, false);\r\n      captionSize = this.measureCaptionSize(slide.dynamicCaption.element, e.slide);\r\n\r\n      const captionWidth = captionSize.x;      \r\n\r\n      const horizontalEnding = imageWidth + slide.bounds.center.x;\r\n      const horizontalLeftover = (slide.panAreaSize.x - horizontalEnding);\r\n\r\n      if (horizontalLeftover <= captionWidth) {\r\n        slide.panAreaSize.x -= captionWidth;\r\n        this.recalculateZoomLevelAndBounds(slide);\r\n      } else {\r\n        // do nothing, caption will fit aside without any adjustments\r\n      }\r\n    } else if (slide.dynamicCaption.type === 'below' || useMobileVersion) {\r\n      this.setCaptionWidth(\r\n        slide.dynamicCaption.element, \r\n        useMobileVersion ? this.pswp.viewportSize.x : imageWidth\r\n      );\r\n\r\n      captionSize = this.measureCaptionSize(slide.dynamicCaption.element, e.slide);\r\n      const captionHeight = captionSize.y;\r\n\r\n      if (this.options.verticallyCenterImage) {\r\n        slide.panAreaSize.y -= captionHeight;\r\n        this.recalculateZoomLevelAndBounds(slide);\r\n      } else {\r\n        // Lift up the image only by caption height\r\n\r\n        // vertical ending of the image\r\n        const verticalEnding = imageHeight + slide.bounds.center.y;\r\n\r\n        // height between bottom of the screen and ending of the image\r\n        // (before any adjustments applied) \r\n        const verticalLeftover = slide.panAreaSize.y - verticalEnding;\r\n        const initialPanAreaHeight = slide.panAreaSize.y;\r\n\r\n        if (verticalLeftover <= captionHeight) {\r\n          // lift up the image to give more space for caption\r\n          slide.panAreaSize.y -= Math.min((captionHeight - verticalLeftover) * 2, captionHeight);\r\n\r\n          // we reduce viewport size, thus we need to update zoom level and pan bounds\r\n          this.recalculateZoomLevelAndBounds(slide);\r\n\r\n          const maxPositionX = slide.panAreaSize.x * this.options.mobileCaptionOverlapRatio / 2;\r\n\r\n          // Do not reduce viewport height if too few space available\r\n          if (useMobileVersion \r\n              && slide.bounds.center.x > maxPositionX) {\r\n            // Restore the default position\r\n            slide.panAreaSize.y = initialPanAreaHeight;\r\n            this.recalculateZoomLevelAndBounds(slide);\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      // mobile\r\n    }\r\n\r\n    this.storeAdjustedPanAreaSize(slide);\r\n    this.updateCaptionPosition(slide);\r\n  }\r\n\r\n  measureCaptionSize(captionEl, slide) {\r\n    const rect = captionEl.getBoundingClientRect();\r\n    const event = this.pswp.dispatch('dynamicCaptionMeasureSize', {\r\n      captionEl,\r\n      slide,\r\n      captionSize: {\r\n        x: rect.width,\r\n        y: rect.height\r\n      }\r\n    });\r\n    return event.captionSize;\r\n  }\r\n\r\n  recalculateZoomLevelAndBounds(slide) {\r\n    slide.zoomLevels.update(slide.width, slide.height, slide.panAreaSize);\r\n    slide.bounds.update(slide.zoomLevels.initial);\r\n  }\r\n\r\n  storeAdjustedPanAreaSize(slide) {\r\n    if (slide.dynamicCaption) {\r\n      if (!slide.dynamicCaption.adjustedPanAreaSize) {\r\n        slide.dynamicCaption.adjustedPanAreaSize = {};\r\n      }\r\n      slide.dynamicCaption.adjustedPanAreaSize.x = slide.panAreaSize.x;\r\n      slide.dynamicCaption.adjustedPanAreaSize.y = slide.panAreaSize.y;\r\n    }\r\n  }\r\n\r\n  storeOriginalPanAreaSize(slide) {\r\n    if (slide.dynamicCaption) {\r\n      if (!slide.dynamicCaption.originalPanAreaSize) {\r\n        slide.dynamicCaption.originalPanAreaSize = {};\r\n      }\r\n      slide.dynamicCaption.originalPanAreaSize.x = slide.panAreaSize.x;\r\n      slide.dynamicCaption.originalPanAreaSize.y = slide.panAreaSize.y;\r\n    }\r\n  }\r\n\r\n  getCaptionHTML(slide) {\r\n    if (typeof this.options.captionContent === 'function') {\r\n      return this.options.captionContent.call(this, slide);\r\n    }\r\n\r\n    const currSlideElement = slide.data.element;\r\n    let captionHTML = '';\r\n    if (currSlideElement) {\r\n      const hiddenCaption = currSlideElement.querySelector(this.options.captionContent);\r\n      if (hiddenCaption) {\r\n        // get caption from element with class pswp-caption-content\r\n        captionHTML = hiddenCaption.innerHTML;\r\n      } else {\r\n        const img = currSlideElement.querySelector('img');\r\n        if (img) {\r\n          // get caption from alt attribute\r\n          captionHTML = img.getAttribute('alt');\r\n        }\r\n      }\r\n    }\r\n    return captionHTML;\r\n  }\r\n}\r\n\r\nexport default PhotoSwipeDynamicCaption;\r\n","export const defaultOptions = {\r\n  videoAttributes: { controls: '', playsinline: '', preload: 'auto' },\r\n  autoplay: true,\r\n\r\n  // prevent drag/swipe gesture over the bottom part of video\r\n  // set to 0 to disable\r\n  preventDragOffset: 40\r\n};\r\n","/**\r\n * Check if slide has video content\r\n *\r\n * @param {Slide|Content} content Slide or Content object\r\n * @returns Boolean\r\n */\r\nfunction isVideoContent(content) {\r\n  return (content && content.data && content.data.type === 'video');\r\n}\r\n\r\nclass VideoContentSetup {\r\n  constructor(lightbox, options) {\r\n    this.options = options;\r\n\r\n    this.initLightboxEvents(lightbox);\r\n    lightbox.on('init', () => {\r\n      this.initPswpEvents(lightbox.pswp);\r\n    });\r\n  }\r\n\r\n  initLightboxEvents(lightbox) {\r\n    lightbox.on('contentLoad', this.onContentLoad.bind(this));\r\n    lightbox.on('contentDestroy', this.onContentDestroy.bind(this));\r\n    lightbox.on('contentActivate', this.onContentActivate.bind(this));\r\n    lightbox.on('contentDeactivate', this.onContentDeactivate.bind(this));\r\n    lightbox.on('contentAppend', this.onContentAppend.bind(this));\r\n    lightbox.on('contentResize', this.onContentResize.bind(this));\r\n\r\n    lightbox.addFilter('isKeepingPlaceholder', this.isKeepingPlaceholder.bind(this));\r\n    lightbox.addFilter('isContentZoomable', this.isContentZoomable.bind(this));\r\n    lightbox.addFilter('useContentPlaceholder', this.useContentPlaceholder.bind(this));\r\n\r\n    lightbox.addFilter('domItemData', (itemData, element, linkEl) => {\r\n      if (itemData.type === 'video' && linkEl) {\r\n        if (linkEl.dataset.pswpVideoSources) {\r\n          itemData.videoSources = JSON.parse(pswpVideoSources);\r\n        } else if (linkEl.dataset.pswpVideoSrc) {\r\n          itemData.videoSrc = linkEl.dataset.pswpVideoSrc;\r\n        } else {\r\n          itemData.videoSrc = linkEl.href;\r\n        }\r\n      }\r\n      return itemData;\r\n    });\r\n  }\r\n\r\n  initPswpEvents(pswp) {\r\n    // Prevent draggin when pointer is in bottom part of the video\r\n    // todo: add option for this\r\n    pswp.on('pointerDown', (e) => {\r\n      const slide = pswp.currSlide;\r\n      if (isVideoContent(slide) && this.options.preventDragOffset) {\r\n        const origEvent = e.originalEvent;\r\n        if (origEvent.type === 'pointerdown') {\r\n          const videoHeight = Math.ceil(slide.height * slide.currZoomLevel);\r\n          const verticalEnding = videoHeight + slide.bounds.center.y;\r\n          const pointerYPos = origEvent.pageY - pswp.offset.y;\r\n          if (pointerYPos > verticalEnding - this.options.preventDragOffset \r\n              && pointerYPos < verticalEnding) {\r\n            e.preventDefault();\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    // do not append video on nearby slides\r\n    pswp.on('appendHeavy', (e) => {\r\n      if (isVideoContent(e.slide) && !e.slide.isActive) {\r\n        e.preventDefault();\r\n      }\r\n    });\r\n\r\n    pswp.on('close', () => {\r\n      if (isVideoContent(pswp.currSlide.content)) {\r\n        // Switch from zoom to fade closing transition,\r\n        // as zoom transition is choppy for videos\r\n        if (!pswp.options.showHideAnimationType\r\n          || pswp.options.showHideAnimationType === 'zoom') {\r\n          pswp.options.showHideAnimationType = 'fade';\r\n        }\r\n\r\n        // pause video when closing\r\n        this.pauseVideo(pswp.currSlide.content);\r\n      }\r\n    });\r\n  }\r\n\r\n  onContentDestroy({ content }) {\r\n    if (isVideoContent(content)) {\r\n      if (content._videoPosterImg) {\r\n        content._videoPosterImg.onload =  content._videoPosterImg.onerror = null;\r\n        content._videoPosterImg = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  onContentResize(e) {\r\n    if (isVideoContent(e.content)) {\r\n      e.preventDefault();\r\n\r\n      const width = e.width;\r\n      const height = e.height;\r\n      const content = e.content;\r\n\r\n      if (content.element) {\r\n        content.element.style.width = width + 'px';\r\n        content.element.style.height = height + 'px';\r\n      }\r\n  \r\n      if (content.slide && content.slide.placeholder) {\r\n        // override placeholder size, so it more accurately matches the video\r\n        const placeholderElStyle = content.slide.placeholder.element.style;\r\n        placeholderElStyle.transform = 'none';\r\n        placeholderElStyle.width = width + 'px';\r\n        placeholderElStyle.height = height + 'px';\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  isKeepingPlaceholder(isZoomable, content) {\r\n    if (isVideoContent(content)) {\r\n      return false;\r\n    }\r\n    return isZoomable;\r\n  }\r\n\r\n  isContentZoomable(isZoomable, content) {\r\n    if (isVideoContent(content)) {\r\n      return false;\r\n    }\r\n    return isZoomable;\r\n  }\r\n\r\n  onContentActivate({ content }) {\r\n    if (isVideoContent(content) && this.options.autoplay) {\r\n      this.playVideo(content);\r\n    }\r\n  }\r\n\r\n  onContentDeactivate({ content }) {\r\n    if (isVideoContent(content)) {\r\n      this.pauseVideo(content);\r\n    }\r\n  }\r\n\r\n  onContentAppend(e) {\r\n    if (isVideoContent(e.content)) {\r\n      e.preventDefault();\r\n      e.content.isAttached = true;\r\n      e.content.appendImage();\r\n    }\r\n  }\r\n\r\n  onContentLoad(e) {\r\n    const content = e.content; // todo: videocontent\r\n\r\n    if (!isVideoContent(e.content)) {\r\n      return;\r\n    }\r\n\r\n    // stop default content load\r\n    e.preventDefault();\r\n\r\n    if (content.element) {\r\n      return;\r\n    }\r\n\r\n    content.state = 'loading';\r\n    content.type = 'video'; // TODO: move this to pswp core?\r\n\r\n    content.element = document.createElement('video');\r\n\r\n    if (this.options.videoAttributes) {\r\n      for(let key in this.options.videoAttributes) {\r\n        content.element.setAttribute(key, this.options.videoAttributes[key] || '');\r\n      }\r\n    }\r\n\r\n    content.element.setAttribute('poster', content.data.msrc);\r\n\r\n    this.preloadVideoPoster(content, content.data.msrc);\r\n\r\n    content.element.style.position = 'absolute';\r\n    content.element.style.left = 0;\r\n    content.element.style.top = 0;\r\n    \r\n    if (content.data.videoSources) {\r\n      content.data.videoSources.forEach((source) => {\r\n        let sourceEl = document.createElement('source');\r\n        sourceEl.src = source.src;\r\n        sourceEl.type = source.type;\r\n        content.element.appendChild(sourceEl);\r\n      });\r\n    } else if (content.data.videoSrc) {\r\n      // Force video preload\r\n      // https://muffinman.io/blog/hack-for-ios-safari-to-display-html-video-thumbnail/\r\n      // this.element.src = this.data.videoSrc + '#t=0.001';\r\n      content.element.src = content.data.videoSrc;\r\n    }\r\n  }\r\n\r\n  preloadVideoPoster(content, src) {\r\n    if (!content._videoPosterImg && src) {\r\n      content._videoPosterImg = new Image();\r\n      content._videoPosterImg.src = src;\r\n      if (content._videoPosterImg.complete) {\r\n        content.onLoaded();\r\n      } else {\r\n        content._videoPosterImg.onload =  content._videoPosterImg.onerror = () => {\r\n          content.onLoaded();\r\n        };\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  playVideo(content) {\r\n    if (content.element) {\r\n      content.element.play();\r\n    }\r\n  }\r\n\r\n  pauseVideo(content) {\r\n    if (content.element) {\r\n      content.element.pause();\r\n    }\r\n  }\r\n\r\n  useContentPlaceholder(usePlaceholder, content) {\r\n    if (isVideoContent(content)) {\r\n      return true;\r\n    }\r\n    return usePlaceholder;\r\n  }\r\n\r\n}\r\n\r\nexport default VideoContentSetup;\r\n","import { defaultOptions } from './default-options.js';\r\nimport VideoContentSetup from './video-content-setup.js';\r\n\r\nclass PhotoSwipeVideoPlugin {\r\n  constructor(lightbox, options) {\r\n    new VideoContentSetup(lightbox, {\r\n      ...defaultOptions,\r\n      ...options\r\n    });\r\n  }\r\n}\r\n\r\nexport default PhotoSwipeVideoPlugin;\r\n","import { Component, For, Match, onCleanup, onMount, Show, Switch } from 'solid-js';\nimport { MediaVariant, PrimalNote } from '../../types/primal';\n\n\nimport styles from './Note.module.scss';\nimport { useIntl } from '@cookbook/solid-intl';\nimport { hookForDev } from '../../lib/devTools';\nimport PhotoSwipeLightbox from 'photoswipe/lightbox';\n// @ts-ignore\nimport PhotoSwipeDynamicCaption from 'photoswipe-dynamic-caption-plugin';\n// @ts-ignore\nimport PhotoSwipeVideoPlugin from 'photoswipe-video-plugin';\n\nimport NoteImage from '../NoteImage/NoteImage';\nimport { imageOrVideoRegexG } from '../../constants';\nimport { useMediaContext } from '../../contexts/MediaContext';\nimport { createStore } from 'solid-js/store';\nimport { A, useNavigate } from '@solidjs/router';\nimport ParsedNote from '../ParsedNote/ParsedNote';\nimport { humanizeTime, isDev } from '../../utils';\n\nconst NoteGallery: Component<{\n  note: PrimalNote,\n  id?: string,\n}> = (props) => {\n  const intl = useIntl();\n  const media = useMediaContext();\n  const navigate = useNavigate();\n\n  const lightbox = new PhotoSwipeLightbox({\n    gallery: `#galleryimage_${props.note.id}`,\n    children: `a.image_${props.note.post.noteId}`,\n    showHideAnimationType: 'zoom',\n    initialZoomLevel: 'fit',\n    secondaryZoomLevel: 2,\n    maxZoomLevel: 3,\n    thumbSelector: `a.image_${props.note.post.noteId}`,\n    preloadFirstSlide: true,\n    pswpModule: () => import('photoswipe'),\n  });\n\n  const [store, setStore] = createStore<{\n    images : {\n      origUrl: string,\n      url: string,\n      image: MediaVariant | undefined,\n      imageThumb: string | undefined,\n      type: string | undefined,\n      noVideoThumbnail?: boolean,\n    }[],\n  }>({\n    images: [],\n  });\n\n  onMount(() => {\n    const urls = props.note.content.matchAll(imageOrVideoRegexG);\n    let result = urls.next();\n    let images: string[] = [];\n\n    while (!result.done) {\n      images.push(result.value[0]);\n      result = urls.next();\n    }\n\n    for (let i=0; i<images.length; i++) {\n      let origUrl = images[i];\n\n      let image = media?.actions.getMedia(origUrl, 'o');\n      let url = image?.media_url || origUrl;\n      let type = image?.mt;\n\n      let imageThumb =\n        media?.thumbnails[origUrl] ||\n        media?.actions.getMediaUrl(origUrl, 's') ||\n        media?.actions.getMediaUrl(origUrl, 'm') ||\n        media?.actions.getMediaUrl(origUrl, 'o') ||\n        origUrl;\n\n      setStore('images', store.images.length, () => ({ origUrl, url, image, imageThumb, type }));\n    }\n\n\n    const videoPlugin = new PhotoSwipeVideoPlugin(lightbox, {\n      // Plugins options\n      // type: 'aside',\n      // captionContent: '.pswp-caption-content'\n    });\n\n    const captionPlugin = new PhotoSwipeDynamicCaption(lightbox, {\n      // Plugins options\n      type: 'aside',\n      captionContent: '.pswp-caption-content'\n    });\n\n    lightbox.init();\n  });\n\n  onCleanup(() => {\n    lightbox.destroy()\n  })\n\n  const mediaFreeNote = (note: PrimalNote) => {\n    const newNote = {\n      ...note,\n      content: note.content.replace(imageOrVideoRegexG, '').trim(),\n    };\n\n    return <ParsedNote\n      note={newNote}\n      ignoreMedia={true}\n      noLinks=\"links\"\n      noPreviews={true}\n      isEmbeded={false}\n      noLightbox={true}\n    />\n  }\n\n  const firstImage = () => store.images[0];\n\n  const isMissingThumbnal = (image: any) => !isDev() || image.noVideoThumbnail;\n\n  return (\n    <div\n      id={`galleryimage_${props.note.id}`}\n      data-note={props.note.id}\n      data-url={firstImage()?.url}\n      class=\"animated\"\n    >\n      <div class={styles.imageGallery}>\n        <For each={store.images}>\n          {(image, index) => (\n            <Switch>\n              <Match when={image.type?.startsWith('video')}>\n                <div\n                  class={styles.videoGallery}\n                  style={`z-index: ${store.images.length - index()}`}\n                >\n                  <Show\n                    when={store.images.length > 1}\n                    fallback={<div class={styles.videoIcon}></div>}\n                  >\n                    <div class={styles.galleryIcon}></div>\n                  </Show>\n                  <Show when={image.image?.dur}>\n                    <div class={styles.videoDuration}>\n                      {humanizeTime(image.image?.dur || 0)}\n                    </div>\n                  </Show>\n                  <a\n                    class={`galleryimage image_${props.note.noteId} cell_${1}`}\n                    href={image.image?.media_url}\n                    data-pswp-video-src={image.image?.media_url}\n                    data-pswp-width=\"800\"\n                    data-pswp-height=\"600\"\n                    data-pswp-type=\"video\"\n                  >\n                    <Show\n                      when={!image.noVideoThumbnail}\n                      fallback={<div class={isMissingThumbnal(image) ? styles.missingThumb : ''}>\n                        <video src={image.origUrl} width={148} height={148} ></video>\n                      </div>}\n                    >\n                      <img src={image.imageThumb} onerror={() => setStore('images', 0, 'noVideoThumbnail', true)} />\n                    </Show>\n\n                    <div class=\"pswp-caption-content\">\n                      <div class={styles.mediaNote}>\n                        <div class={styles.note}>\n                          {mediaFreeNote(props.note)}\n                        </div>\n                        <A\n                          class={styles.noteLink}\n                          href={`/e/${props.note.noteId}`}\n                        >\n                          Go to note\n                        </A>\n                      </div>\n                    </div>\n                  </a>\n                </div>\n              </Match>\n              <Match when={true}>\n                <div\n                  class={styles.videoGallery}\n                  style={`z-index: ${store.images.length - index()}`}\n                >\n                  <Show\n                    when={store.images.length > 1}\n                  >\n                    <div class={styles.galleryIcon}></div>\n                  </Show>\n\n                  <NoteImage\n                    class={`galleryimage image_${props.note.post.noteId} cell_${1}`}\n                    src={image.url}\n                    media={image.image}\n                    mediaThumb={image.imageThumb}\n                    altSrc={image.imageThumb}\n                    isDev={isDev()}\n                    width={210}\n                    shortHeight={true}\n                    plainBorder={true}\n                    caption={\n                      <div class={styles.mediaNote}>\n                        <div class={styles.note}>\n                          {mediaFreeNote(props.note)}\n                        </div>\n                        <A\n                          class={styles.noteLink}\n                          href={`/e/${props.note.noteId}`}\n                        >\n                          Go to note\n                        </A>\n                      </div>\n                    }\n                  />\n                </div>\n              </Match>\n            </Switch>\n          )}\n        </For>\n      </div>\n    </div>\n  )\n}\n\nexport default hookForDev(NoteGallery);\n"],"file":"assets/NoteGallery-bea6c77c.js"}