var D=Object.defineProperty;var l=(e,c)=>D(e,"name",{value:c,configurable:!0});import{h as I,c as n,l as b,m as _,t as $,L as H,j as m,s as L,u as E,g as j,D as q,E as z,W as J,cn as U,n as W,a2 as N,co as G,cp as Q,cq as X,cr as Y,cs as Z,ct as y,S as x,H as ee,M as V,F as K,cu as te,T as ne,cv as re}from"./index-64dc6460.js";import{T as oe}from"./ParsedNote-9900e3c8.js";import{A as se}from"./ArticlePreview-3d0aa4c8.js";import{a as u,S as ie,s as R}from"./SelectionItem-0e1bfb8a.js";import{S as v}from"./G5FCC32B-f4759418.js";import{N as ae}from"./Note-f0f70728.js";import{P as le}from"./PageCaption-27eb7f4c.js";import{P as ce}from"./PageTitle-3d0a9832.js";import{P as ue}from"./Paginator-4878ac5b.js";import"./dates-9bcb2bf7.js";import"./ButtonGhost-a0fa1826.js";import"./Buttons.module-e818c1ea.js";import"./5WXHJDCZ-8b9b8e69.js";import"./index-b4296c5e.js";import"./ButtonPrimary-1f64caa8.js";import"./Loader-1ac7e304.js";import"./RLGGFAYQ-2a48be09.js";import"./LR7LBJN3-a1aba763.js";import"./index-c76cfba2.js";import"./QJIB6BDF-1d7b1e44.js";import"./JNCCF6MP-19ab5fd3.js";import"./index-a25c8160.js";const de=$("<div>"),ge=$("<div><div>Note Feeds:"),me=l(e=>{const c=l(()=>typeof e.initialValue=="string"?e.options.find(t=>t.value===e.initialValue):e.initialValue,"defaultValue"),d=l(()=>e.value?typeof e.value=="string"?{label:e.value,value:e.value}:e.value:c(),"value");return n(v,{get id(){return e.id},get class(){return u.selectionBox},get options(){return e.options},optionValue:"value",optionTextValue:"label",optionDisabled:"disabled",itemComponent:t=>ie(t),get defaultValue(){return c()},get value(){return d()},get onChange(){return e.onChange},get children(){return[n(v.Trigger,{get class(){return e.big?u.triggerBig:u.trigger},get children(){return[n(v.Value,{children:t=>t.selectedOption()?.label||""}),n(v.Icon,{get children(){const t=de();return b(()=>_(t,e.big?u.selectionIconBig:u.selectionIcon)),t}})]}}),n(v.Content,{get class(){return u.selectionContent},get children(){return[(()=>{const t=ge(),s=t.firstChild;return b(r=>{const g=u.caption,i=u.title;return g!==r._v$&&_(t,r._v$=g),i!==r._v$2&&_(s,r._v$2=i),r},{_v$:void 0,_v$2:void 0}),t})(),n(v.Listbox,{get class(){return u.listbox}})]}})]}})},"SelectionBox"),fe=I(me),ke=l(e=>{const c=H(),d=l(i=>{e.onSelect(i.value||"")},"selectOption"),t=l(i=>{const h=c?.selectedFeed;if(h?.hex&&i.value){const o=i.value.split("_"),a=encodeURI(h.hex)==o[0],f=o[1]==="undefined"?h.includeReplies===void 0:h.includeReplies?.toString()===o[1];return a&&f}return!1},"isSelected"),s=l(()=>{let i=[];return i.push({label:"Bookmarked Notes",value:"notes"}),i.push({label:"Bookmarked Reads",value:"reads"}),[...i]},"options"),r=l(()=>s().find(i=>i.value===e.inital),"initialValue"),g=l(()=>e.selected?s().find(i=>i.value===e.selected):r(),"selectedValue");return n(fe,{get options(){return s()},onChange:d,get initialValue(){return r()},get value(){return g()},isSelected:t,get isPhone(){return e.isPhone},get big(){return e.big}})},"BookmarksSelect"),he=I(ke),ve=$("<div><div>"),_e=l(e=>(()=>{const c=ve(),d=c.firstChild;return m(d,n(he,{big:!0,get initial(){return e.kind},get selected(){return e.kind},get onSelect(){return e.onSelect}})),b(t=>{const s=e.id,r=`${R.bigFeedSelect} ${R.readsFeed}`;return s!==t._v$&&L(c,"id",t._v$=s),r!==t._v$2&&_(d,t._v$2=r),t},{_v$:void 0,_v$2:void 0}),c})(),"BookmarksHeader"),$e=I(_e),be="_bookmarkFeed_1p8gb_1",pe="_loader_1p8gb_7",Se="_noBookmarks_1p8gb_17",T={bookmarkFeed:be,loader:pe,noBookmarks:Se},F=$("<div>"),Be=$("<div><span>Bookmarks"),w=$('<div class="animated">'),C={fetchingInProgress:!1,notes:[],reads:[],paging:{...te()},kind:"notes"},Ue=l(()=>{const e=E(),c=j(),d=20,[t,s]=q({...C});z(J(()=>e?.isKeyLookupDone,o=>{if(o&&e?.publicKey){const a=U(e?.publicKey);a&&a!==t.kind&&s("kind",()=>a),(a==="notes"&&t.notes.length===0||a==="reads"&&t.reads.length===0)&&s("fetchingInProgress",()=>!0),g(e?.publicKey)}})),W(()=>{s(()=>({...C}))});const r=l(()=>t.kind||"notes","kind"),g=l(async(o,a=0)=>{if(!o)return;const f=`bookmark_feed_${a}_${ne}`,k=r()==="reads"?N.LongForm:N.Text,A=JSON.stringify({id:"feed",kind:"notes",kinds:[k],notes:"bookmarks",pubkey:o});let p=0;r()==="reads"?p=G(t.reads,t.paging):r()==="notes"&&(p=Q(t.notes,t.paging));const{notes:M,reads:O,paging:S}=await X(e?.publicKey,A,f,{until:a,limit:d,offset:p});if(r()==="notes"){const B=Y(M,S);s("notes",P=>[...P,...B])}if(r()==="reads"){const B=Z(O,S);s("reads",P=>[...P,...B])}s("paging",()=>({...S})),s("fetchingInProgress",()=>!1)},"fetchBookmarks"),i=l(()=>{const o=t.paging.since||0;o>0&&g(e?.publicKey,o)},"fetchNextPage"),h=l(o=>{s(()=>({...C})),s("fetchingInProgress",()=>!0),s("kind",()=>o),re(e?.publicKey,o),g(e?.publicKey)},"onChangeKind");return[n(ce,{get title(){return c.formatMessage(y.pageTitle)}}),n(le,{get title(){return c.formatMessage(y.pageTitle)},get children(){return n(x,{get when(){return r()},get fallback(){return Be()},get children(){return n($e,{get kind(){return r()},onSelect:h})}})}}),(()=>{const o=F();return m(o,n(x,{get when(){return!t.fetchingInProgress&&t.notes.length===0&&t.reads.length===0},get children(){const a=F();return m(a,()=>c.formatMessage(y.noBookmarks)),b(()=>_(a,T.noBookmarks)),a}}),null),m(o,n(oe,{name:"slide-fade",get children(){return n(x,{get when(){return!t.fetchingInProgress},get children(){const a=F();return m(a,n(ee,{get children(){return[n(V,{get when(){return r()==="notes"},get children(){return n(K,{get each(){return t.notes},children:f=>(()=>{const k=w();return m(k,n(ae,{note:f})),k})()})}}),n(V,{get when(){return r()==="reads"},get children(){return n(K,{get each(){return t.reads},children:f=>(()=>{const k=w();return m(k,n(se,{article:f})),k})()})}})]}})),a}})}}),null),m(o,n(ue,{loadNextPage:i}),null),b(()=>_(o,T.bookmarkFeed)),o})()]},"Bookmarks");export{Ue as default};
//# sourceMappingURL=Bookmarks-07082af2.js.map
