var S=Object.defineProperty;var u=(e,v)=>S(e,"name",{value:v,configurable:!0});import{u as k,D as A,cu as F,E as $,W as M,j as h,c as a,M as w,F as P,H as x,l as C,m as _,t as D,cq as I,T as E,cr as R,cs as T,bi as j}from"./index-64dc6460.js";import{A as q}from"./ArticlePreview-3d0aa4c8.js";import{N as z}from"./Note-f0f70728.js";import{P as H}from"./Paginator-4878ac5b.js";import{F as J,s as m}from"./FeedMarketPlaceItem-1368feb7.js";const K=D("<div><div></div><div>"),Q=u(e=>{const v=k(),[r,i]=A({notes:[],reads:[],paging:{...F()},isFetching:!1}),y=u(async()=>{if(r.isFetching||!e.type)return;i("isFetching",()=>!0);const d=e.dvm?.primal_spec??JSON.stringify({dvm_id:e.dvm?.identifier,dvm_pubkey:e.dvm?.pubkey,kind:e.type});let s=0;const o=r.paging.since||0;e.type==="reads"?s=r.reads.reduce((n,f)=>o===f.published?n+1:n,0):e.type==="notes"&&(s=r.notes.reduce((n,f)=>o===f.msg.created_at?n+1:n,0));const{notes:t,reads:g,paging:c}=await I(v?.publicKey,d,`dvm_preview_${E}`,{limit:20,until:r.paging.since,offset:s}),l=R(t,c),N=T(g,c);j(()=>{i("notes",n=>[...n,...l]),i("reads",n=>[...n,...N]),i("paging",()=>({...c}))}),i("isFetching",()=>!1)},"getFeedPreview"),b=u(()=>{i(()=>({notes:[],reads:[],paging:{...F()},isFetching:!1}))},"clearPreview");return $(M(()=>e.dvm&&e.type,()=>{e.dvm&&e.type?y():b()})),$(()=>{}),(()=>{const d=K(),s=d.firstChild,o=s.nextSibling;return h(s,a(J,{get dvm(){return e.dvm},get author(){return e.author},get stats(){return e.stats},get metadata(){return e.metadata},get actions(){return e.actions},size:"header",get commonUsers(){return e.commonFollows}})),h(o,a(x,{get children(){return[a(w,{get when(){return e.type==="notes"},get children(){return a(P,{get each(){return r.notes},children:t=>a(z,{note:t,shorten:!0,noteType:"feed"})})}}),a(w,{get when(){return e.type==="reads"},get children(){return a(P,{get each(){return r.reads},children:t=>a(q,{article:t})})}})]}})),h(d,a(H,{loadNextPage:y}),null),C(t=>{const g=`${m.feedMarketplacePreview} ${e.isInDialog?m.previewInDialog:""}`,c=m.dvmCaption,l=m.dvmList;return g!==t._v$&&_(d,t._v$=g),c!==t._v$2&&_(s,t._v$2=c),l!==t._v$3&&_(o,t._v$3=l),t},{_v$:void 0,_v$2:void 0,_v$3:void 0}),d})()},"FeedMarketPlacePreview");export{Q as F};
//# sourceMappingURL=FeedMarketPlacePreview-16ae6dd4.js.map
