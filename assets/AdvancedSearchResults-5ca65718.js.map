{"version":3,"file":"AdvancedSearchResults-5ca65718.js","sources":["../../src/pages/AdvancedSearchResults.tsx"],"sourcesContent":["import { A, useNavigate, useParams } from '@solidjs/router';\nimport { Component, createEffect, createSignal, For, Match, on, onMount, Show, Switch } from 'solid-js';\nimport Loader from '../components/Loader/Loader';\nimport Note from '../components/Note/Note';\nimport PageTitle from '../components/PageTitle/PageTitle';\nimport StickySidebar from '../components/StickySidebar/StickySidebar';\nimport styles from './FeedsTest.module.scss';\nimport { useAdvancedSearchContext } from '../contexts/AdvancedSearchContext';\nimport { Kind } from '../constants';\nimport ArticlePreview from '../components/ArticlePreview/ArticlePreview';\nimport Paginator from '../components/Paginator/Paginator';\nimport { TextField } from '@kobalte/core/text-field';\nimport ButtonLink from '../components/Buttons/ButtonLink';\nimport SaveFeedDialog from '../components/SaveFeedDialog/SaveFeedDialog';\nimport { setAdvSearchState } from './AdvancedSearch';\nimport AdvancedSearchCommadTextField from '../components/AdvancedSearch/AdvancedSearchCommadTextField';\nimport { useAccountContext } from '../contexts/AccountContext';\n\n\nconst AdvancedSearchResults: Component = () => {\n  const params = useParams()\n  const search = useAdvancedSearchContext();\n  const navigate = useNavigate();\n  const account = useAccountContext();\n\n  const [openAddFeedDialog, setAddFeedDialog] = createSignal<boolean>(false);\n  const [allowCommandChange, setAllowCommandChange] = createSignal(false);\n  const [queryString, setQueryString] = createSignal('');\n\n  const isPremium = () => ['premium', 'premium-legend'].includes(account?.membershipStatus.tier || '');\n\n  createEffect(on(() => params.query, (v, p) => {\n    if (!v || v === p) return;\n\n    let q = decodeURIComponent(params.query);\n\n    if (!q.includes(' pas:1')) {\n      q += ' pas:1';\n    }\n\n    setQueryString(() => q);\n    search?.actions.clearSearch();\n    search?.actions.findContent(q);\n  }));\n\n  const kind = () => {\n    const isRead = queryString().search(/kind:30023/) >= 0;\n\n    if (isRead) return Kind.LongForm;\n\n    return 1;\n  }\n\n  createEffect(on(() => params.query, (v, p) => {\n    if (!v || v === p) return;\n\n    setAdvSearchState('command', () => v);\n  }))\n\n  const feedType = () => [Kind.LongForm].includes(kind()) ?\n  'reads' : 'home';\n\n  const submitCommandChange = (command: string) => {\n    if (command === queryString()) {\n      search?.actions.clearSearch();\n      search?.actions.findContent(command);\n      return false;\n    }\n\n    navigate(`/asearch/${encodeURIComponent(queryString())}`);\n  }\n\n  return (\n    <>\n      <PageTitle title=\"Advanced search results\"/>\n\n        <div class={styles.advancedSerchResultsHeader}>\n          <div class={styles.caption}>\n            <div>search results</div>\n          </div>\n          <div class={styles.actions}>\n\n            <SaveFeedDialog\n              open={openAddFeedDialog()}\n              setOpen={setAddFeedDialog}\n              query={queryString()}\n              feedType={feedType()}\n            />\n\n            <ButtonLink\n              onClick={() => navigate('/asearch', { state: { query: queryString() } })}\n            >\n              Back to Advanced search\n            </ButtonLink>\n          </div>\n        </div>\n\n      <StickySidebar>\n        <AdvancedSearchCommadTextField\n          command={queryString()}\n          onCommandChange={setQueryString}\n          submitCommandChange={submitCommandChange}\n        />\n      </StickySidebar>\n\n      <div class={styles.list}>\n        <Switch>\n          <Match when={[Kind.LongForm, Kind.LongFormShell].includes(kind())}>\n            <For each={search?.reads} >\n              {article => <ArticlePreview article={article} />}\n            </For>\n          </Match>\n          <Match when={[Kind.Text].includes(kind())}>\n            <For each={search?.notes} >\n              {note => <Note note={note} shorten={true} />}\n            </For>\n          </Match>\n          <Match when={!search?.isFetchingContent && (search?.notes.length === 0 || search?.reads.length === 0)}>\n            <div class={styles.noResults}>\n              No results found\n\n              <For each={search?.errors}>\n                {error => <div class={styles.error}>{error}</div>}\n              </For>\n            </div>\n          </Match>\n        </Switch>\n\n        <Show when={search?.isFetchingContent}><Loader /></Show>\n\n        <Show when={!isPremium()}>\n          <div class={styles.moreSearchInfo}>\n            <div>\n              <div class={styles.moreSearchCaption}>\n                This is a Primal Premium feed.\n              </div>\n              <div class={styles.moreSearchDescription}>\n                Buy a Subscription to become a Nostr power user and support our work:\n              </div>\n            </div>\n\n            <A href='/premium' class={styles.premiumLink}>Get Primal Premium</A>\n          </div>\n        </Show>\n      </div>\n\n      <Paginator loadNextPage={() => search?.actions.fetchContentNextPage(queryString())} />\n    </>\n  )\n}\n\nexport default AdvancedSearchResults;\n"],"names":["AdvancedSearchResults","params","useParams","search","useAdvancedSearchContext","navigate","useNavigate","account","useAccountContext","openAddFeedDialog","setAddFeedDialog","createSignal","queryString","setQueryString","isPremium","includes","membershipStatus","tier","createEffect","on","query","v","p","q","decodeURIComponent","actions","clearSearch","findContent","kind","Kind","LongForm","setAdvSearchState","feedType","submitCommandChange","command","encodeURIComponent","_$createComponent","PageTitle","title","_el$","_tmpl$","_el$2","firstChild","_el$3","nextSibling","_$insert","SaveFeedDialog","open","setOpen","ButtonLink","onClick","state","children","_$effect","_p$","_v$","styles","advancedSerchResultsHeader","_v$2","caption","_v$3","_$className","undefined","StickySidebar","AdvancedSearchCommadTextField","onCommandChange","_el$4","_tmpl$4","Switch","Match","when","LongFormShell","For","each","reads","article","ArticlePreview","Text","notes","note","Note","shorten","isFetchingContent","length","_el$5","_tmpl$2","errors","error","_el$11","noResults","Show","Loader","_el$7","_tmpl$3","_el$8","_el$9","_el$10","A","href","premiumLink","_v$4","moreSearchInfo","_v$5","moreSearchCaption","_v$6","moreSearchDescription","list","Paginator","loadNextPage","fetchContentNextPage"],"mappings":"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"}