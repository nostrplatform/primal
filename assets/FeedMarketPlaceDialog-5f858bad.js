var Y=Object.defineProperty;var D=(r,E)=>Y(r,"name",{value:E,configurable:!0});import{h as Z,e as ee,u as Q,C as z,E as W,j as C,c as m,F as X,S as L,l as I,m as a,s as P,t as M,x as te,D as ne,N as de,a2 as O,aR as re,du as ie,H as se,M as U,T as oe}from"./index-64dc6460.js";import{C as ae}from"./CheckBox2-65e1c04f.js";import{s as N,F as ce}from"./FeedMarketPlaceItem-1368feb7.js";import{A as ve}from"./AdvancedSearchDialog-eff41eef.js";import{B as j}from"./ButtonSecondary-cc5e2282.js";import{F as le}from"./FeedMarketPlacePreview-16ae6dd4.js";import{B as ue}from"./ButtonPrimary-1f64caa8.js";import{e as _e}from"./FeedMarketPlace-34349272.js";const fe="_feedItem_ynqcn_1",me="_feedInfo_ynqcn_14",ge="_feedName_ynqcn_20",$e="_feedDescription_ynqcn_31",he="_controls_ynqcn_42",ke="_manageControls_ynqcn_47",ye="_feedEnabled_ynqcn_51",be="_mngButton_ynqcn_55",Ie="_deleteButton_ynqcn_76",Ce="_editButton_ynqcn_76",Be="_sortButton_ynqcn_97",De="_feedEdit_ynqcn_121",we="_feedNameInput_ynqcn_125",Se="_feedEditControl_ynqcn_138",Ee="_dragIcon_ynqcn_168",qe="_closeIcon_ynqcn_178",Fe="_checkIcon_ynqcn_188",Ae="_draggedBefore_ynqcn_198",Me="_draggedAfter_ynqcn_202",Ne="_draggedItem_ynqcn_206",e={feedItem:fe,feedInfo:me,feedName:ge,feedDescription:$e,controls:he,manageControls:ke,feedEnabled:ye,mngButton:be,deleteButton:Ie,editButton:Ce,sortButton:Be,feedEdit:De,feedNameInput:we,feedEditControl:Se,dragIcon:Ee,closeIcon:qe,checkIcon:Fe,draggedBefore:Ae,draggedAfter:Me,draggedItem:Ne},V=M("<div>"),xe=M('<div><input><div><button title="Update"><div></div></button><button title="Cancel"><div>'),Le=M("<div><div></div><div>"),H=M("<button><div>"),Te=M("<div><div><button><div>"),Pe=["primal"],Oe=D(r=>{let E;const y=Q(),[q,x]=z(""),[T,u]=z(""),g=D(i=>i.spec,"constructId"),F=D(i=>{r.actions.remove&&r.actions.remove(i,r.feedType)},"removeFeed"),_=D(i=>{const $=`${g(i)}`;x(()=>$),u(()=>i.name);const n=document.getElementById(`input_${$}`);n&&n.focus()},"editFeed"),t=D(i=>{r.actions.rename&&r.actions.rename(i,T(),r.feedType),x("")},"updateFeedName"),w=D(i=>{let $=i.getElementsByClassName(e.feedItem),n=null;for(let c of $)c.draggable=!0,c.ondragstart=h=>{n=c;for(let s of $)s===n&&s.classList.add(e.draggedItem)},c.ondragenter=h=>{const s=n.getAttribute("data-index"),v=c.getAttribute("data-index");s>v&&(c.classList.add(e.draggedBefore),c.classList.remove(e.draggedAfter)),s<v&&(c.classList.add(e.draggedAfter),c.classList.remove(e.draggedBefore))},c.ondragleave=()=>{c.classList.remove(e.draggedBefore),c.classList.remove(e.draggedAfter)},c.ondragend=()=>{for(let h of $)h.classList.remove(e.draggedItem),c.classList.remove(e.draggedBefore),c.classList.remove(e.draggedAfter)},c.ondragover=h=>h.preventDefault(),c.ondrop=h=>{if(h.preventDefault(),c!=n){const s=n.getAttribute("data-index"),v=c.getAttribute("data-index");r.actions.move&&r.actions.move(s,v,r.feedType);for(let f of $)f.classList.remove(e.draggedBefore),f.classList.remove(e.draggedBefore),f.classList.remove(e.draggeditem)}}},"sortList");W(()=>{E&&r.feeds.length>0&&w(E)});const S=D(i=>Pe.includes(i.feedkind||""),"isLockedFeed");return(()=>{const i=V(),$=E;return typeof $=="function"?te($,i):E=i,C(i,m(L,{get when(){return r.feeds.length>0},get children(){return m(X,{get each(){return r.feeds},children:(n,c)=>(()=>{const h=V();return C(h,m(L,{get when(){return q()===g(n)},get fallback(){return[(()=>{const s=Le(),v=s.firstChild,f=v.nextSibling;return C(v,()=>n.name),C(f,()=>n.description),I(k=>{const d=e.feedInfo,b=e.feedName,l=e.feedDescription;return d!==k._v$12&&a(s,k._v$12=d),b!==k._v$13&&a(v,k._v$13=b),l!==k._v$14&&a(f,k._v$14=l),k},{_v$12:void 0,_v$13:void 0,_v$14:void 0}),s})(),m(L,{get when(){return y?.hasPublicKey()},get children(){const s=Te(),v=s.firstChild,f=v.firstChild,k=f.firstChild;return C(v,m(L,{get when(){return S(n)},get children(){const d=V();return C(d,m(ae,{onChange:b=>{r.actions.enable&&r.actions.enable(n,b,r.feedType)},get checked(){return n.enabled}})),I(()=>a(d,e.feedEnabled)),d}}),f),C(v,m(L,{get when(){return!S(n)},get children(){return[(()=>{const d=H(),b=d.firstChild;return d.$$click=()=>_(n),I(l=>{const o=e.mngButton,B=S(n),A=e.editButton;return o!==l._v$15&&a(d,l._v$15=o),B!==l._v$16&&(d.disabled=l._v$16=B),A!==l._v$17&&a(b,l._v$17=A),l},{_v$15:void 0,_v$16:void 0,_v$17:void 0}),d})(),(()=>{const d=H(),b=d.firstChild;return d.$$click=()=>F(n),I(l=>{const o=e.mngButton,B=S(n),A=e.deleteButton;return o!==l._v$18&&a(d,l._v$18=o),B!==l._v$19&&(d.disabled=l._v$19=B),A!==l._v$20&&a(b,l._v$20=A),l},{_v$18:void 0,_v$19:void 0,_v$20:void 0}),d})()]}}),f),f.$$click=()=>{},I(d=>{const b=e.controls,l=e.manageControls,o=e.sortButton,B=e.dragIcon;return b!==d._v$21&&a(s,d._v$21=b),l!==d._v$22&&a(v,d._v$22=l),o!==d._v$23&&a(f,d._v$23=o),B!==d._v$24&&a(k,d._v$24=B),d},{_v$21:void 0,_v$22:void 0,_v$23:void 0,_v$24:void 0}),s}})]},get children(){const s=xe(),v=s.firstChild,f=v.nextSibling,k=f.firstChild,d=k.firstChild,b=k.nextSibling,l=b.firstChild;return v.$$keyup=o=>{o.code==="Enter"&&t(n),o.code==="Escape"&&x("")},v.$$input=o=>u(()=>o.target?.value),k.$$click=()=>t(n),b.$$click=()=>{x("")},I(o=>{const B=e.feedEdit,A=`input_${g(n)}`,p=e.feedNameInput,K=e.feedEditControl,R=e.checkIcon,J=e.closeIcon;return B!==o._v$3&&a(s,o._v$3=B),A!==o._v$4&&P(v,"id",o._v$4=A),p!==o._v$5&&a(v,o._v$5=p),K!==o._v$6&&a(f,o._v$6=K),R!==o._v$7&&a(d,o._v$7=R),J!==o._v$8&&a(l,o._v$8=J),o},{_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0}),I(()=>v.value=T()),s}})),I(s=>{const v=e.feedItem,f=n.spec,k=c();return v!==s._v$9&&a(h,s._v$9=v),f!==s._v$10&&P(h,"data-value",s._v$10=f),k!==s._v$11&&P(h,"data-index",s._v$11=k),s},{_v$9:void 0,_v$10:void 0,_v$11:void 0}),h})()})}})),I(n=>{const c=r.id,h=e.feedSorter;return c!==n._v$&&P(i,"id",n._v$=c),h!==n._v$2&&a(i,n._v$2=h),n},{_v$:void 0,_v$2:void 0}),i})()},"FeedSorter"),We=Z(Oe);ee(["input","keyup","click"]);const Ve=M("<div><div></div><div><div>Select a feed to preview it"),G=M("<div>"),pe=M("<div>Feed Marketplace"),Xe=D(r=>{const E=Q(),[y,q]=ne({..._e});W(()=>{r.open?x():T()});const x=D(()=>{const u=`feed_market_${oe}`,g=de(u,{onEvent:(F,_)=>{if(_.kind===O.DVM){const t=JSON.parse(_.content),w=(_.tags?.find(i=>i[0]==="d")||["d",""])[1],S={id:_.id,name:t.name||"",about:t.about||"",amount:t.amount||"free",primalVerifiedRequired:t.primalVerifiedRequired||!1,pubkey:_.pubkey,supportedKinds:_.tags?.reduce((i,$)=>$[0]==="k"?[...i,$[1]]:i,[])||[],identifier:w,picture:t.picture,image:t.image,coordinate:`${O.DVM}:${_.pubkey}:${w}`,primal_spec:t.primal_spec};q("dvms",y.dvms.length,()=>({...S}));return}if(_.kind===O.Metadata){const t=re(_,_.pubkey);q("users",t.pubkey,()=>({...t}));return}if(_.kind===O.NoteStats){const t=JSON.parse(_.content);if(!t.event_id)return;q("dvmStats",t.event_id,()=>({likes:t.likes||0,satszapped:t.satszapped||0}))}},onEose:()=>{g()}});ie(E?.publicKey,u,r.type)},"fetchDVMs"),T=D(()=>{setTimeout(()=>{q(()=>({dvms:[],dvmStats:{},users:{},previewDvm:void 0}))},300)},"clearDVMs");return m(ve,{get open(){return r.open},get setOpen(){return r.setOpen},get title(){return(()=>{const u=pe();return I(()=>a(u,N.feedMarketplaceTitle)),u})()},triggerClass:"hidden",get children(){return m(se,{get children(){return[m(U,{get when(){return!y.previewDvm},get children(){const u=Ve(),g=u.firstChild,F=g.nextSibling,_=F.firstChild;return C(g,m(X,{get each(){return y.dvms},children:t=>m(ce,{dvm:t,get author(){return y.users[t.pubkey]},get stats(){return y.dvmStats[t.id]},onClick:w=>{q("previewDvm",()=>({...w}))}})})),C(F,m(j,{light:!0,onClick:()=>r.setOpen&&r.setOpen(!1),children:"Cancel"}),null),I(t=>{const w=N.feedMarketplaceContent,S=N.booths,i=N.feedMarketplaceFooter,$=N.instruction;return w!==t._v$&&a(u,t._v$=w),S!==t._v$2&&a(g,t._v$2=S),i!==t._v$3&&a(F,t._v$3=i),$!==t._v$4&&a(_,t._v$4=$),t},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),u}}),m(U,{get when(){return y.previewDvm},get children(){return[(()=>{const u=G();return C(u,m(le,{get dvm(){return y.previewDvm},get author(){return y.users[y.previewDvm?.pubkey||""]},get stats(){return y.dvmStats[y.previewDvm?.id||""]},get type(){return r.type||"notes"},isInDialog:!0})),I(()=>a(u,N.feedMarketplaceContent)),u})(),(()=>{const u=G();return C(u,m(j,{light:!0,onClick:()=>q("previewDvm",()=>{}),children:"Back"}),null),C(u,m(ue,{onClick:()=>{const g=y.previewDvm;if(!r.onAddFeed||!g)return;const F=g.primal_spec??JSON.stringify({dvm_id:g.id,dvm_pubkey:g.pubkey,kind:r.type}),_={name:g.name,description:g.about,spec:F,enabled:!0,feedkind:"dvm"};r.onAddFeed(_)},children:"Add feed"}),null),I(()=>a(u,N.feedMarketplacePreviewFooter)),u})()]}})]}})}})},"FeedMarketPlaceDialog");export{We as F,Xe as a};
//# sourceMappingURL=FeedMarketPlaceDialog-5f858bad.js.map
